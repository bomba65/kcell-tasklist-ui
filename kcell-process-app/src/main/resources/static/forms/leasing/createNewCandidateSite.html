<form role="form" class="form-horizontal" name="kcell_form" novalidate>
    <style>
        .background-yellow-accordion .panel-body {
            background-color: #ffffcc;
            border: 1px solid #b3b3b3;
            color: #333;
        }

        .far-end-info {
            background: #f7f7f7;
            padding: 3px;
            border-radius: 10px;
            border: solid 1px;
            font-weight: bold;
            cursor: pointer;
        }

        .far-end-delete {
            float: right;
            margin-right: 3px;
        }

        tr.far-end-antennas td {
            padding-top: 12px;
        }
    </style>
    <script cam-script type="text/form-script" type="text/javascript">
        inject(['$scope', '$http', 'Uri', '$rootScope', '$q', '$timeout', 'toasty', 'exModal', function ($scope, $http, Uri, $rootScope, $q, $timeout, toasty, exModal) {
            var variables = [
                'resolutions',
                'ncpID',
                'siteType',
                'regionName',
                'latitude',
                'longitude',
                'cn_altitude',
                'initiator',
                'project',
                'reason',
                'part',
                'plannedCabinetType',
                'targetCoverage',
                'rbsType',
                'bands',
                'cn_height_constr',
                'candidate',
                'cellAntenna',
                'renterCompany',
                'transmissionAntenna',
                'powerSource',
                'farEndInformation',
                'threeFarEndNotNecessary',
                'confirmSendingRequestReceiveTsKZT',
                'address',
            ];

            var variablesToCreate = [
                {
                    name: 'candidate',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'cellAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'renterCompany',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'transmissionAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'powerSource',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'farEndInformation',
                    type: 'Json',
                    value: []
                },
                {
                    name: 'siteObjectType',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'legalType',
                    type: 'String',
                    value: 'other'
                },
                {
                    name: 'threeFarEndNotNecessary',
                    type: 'Json',
                    value: []
                }
            ];

            var files = ['actOfPerformanceTechnicalConditionsFiles',
            'uploadCopyOfOwnerSignedLeaseContractFiles',
            'confirmApprovalLeaseContractInSAPCMFiles',
            'confirmLoadingLeaseContractInSAPCMFiles',
            'confirmSendMessageToStartPaymentKPFEFiles',
            'approvalContractRentInSAPFiles',
            'approvalPowerContractInSAPFiles',
            'checkAndApproveFEFiles',
            'commercialOnAirFiles',
            'confirmActOfPerformanceTechnicalConditionsFiles',
            'confirmPaymentDevelopmentOfTCKTFiles',
            'confirmPaymentDevelopmentOfTCKTForFEFiles',
            'confirmReceiptEstimateFiles',
            'confirmReceiptEstimateForFEFiles',
            'ConfirmReceiptOfTSfromRESforCandidateFiles',
            'confirmReceiptResponseKPFiles',
            'confirmReceiptResponseKPFEFiles',
            'confirmSigningLeaseContractFiles',
            'confirmStartLeasingFiles',
            'confirmStartLeasingNOFiles',
            'confirmTFOfConnectingToLandlordPowerGridForFEFiles',
            'confirmTFOfConnectingToPowerGridForCandidateFiles',
            'connectionFromOwnerNetworksFiles',
            'contractRentLoadingSAPFiles',
            'createNewCandidateSiteFiles',
            'defineInstallationProblemFiles',
            'estimateTechnicalCapabilityResFiles',
            'installationWorksDoneFiles',
            'modifyCandidateSiteFiles',
            'powerContractLoadingInSAPFiles',
            'powerProblemSolutionFiles',
            'preparationSSIDandTSSRFiles',
            'preperationSSIDorTSSRProjectFiles',
            'receivingApprovalFromTheLandlordFiles',
            'receivingContractDevDesignEstimateFiles',
            'receivingContractDevDesignEstimateForFEFiles',
            'receivingContractInstallationWorksFiles',
            'receivingContractInstallationWorksForFEFiles',
            'receivingContractPSDFiles',
            'receivingTSFiles',
            'receivingTSForFEFiles',
            'registrationCommercialOfferFiles',
            'registrationCommercialOfferForFEFiles',
            'reqKZTRwithTechEquipmentParamsFiles',
            'reqKZTRwithTechEquipmentParamsForFEFiles',
            'requestForAdmissionForWorkOnTUFiles',
            'requestTechnicalParametersKPFiles',
            'requestTechnicalParametersKPFEFiles',
            'requestTechnicalParametersKTFiles',
            'requestTechnicalParametersKTForFEFiles',
            'sendMessageToStartPaymentKPFiles',
            'sendMessageToStartPaymentKPForFEFiles',
            'sendMessageToStartPaymentKTFiles',
            'sendMessageToStartPaymentKTForFEFiles',
            'sendMessageToStartPaymentNationalFiles',
            'sendMessageToStartPaymentSimpleFiles',
            'signingLeaseContractAddAgreementFiles',
            'signingLeaseContractAddAgreementForFEFiles',
            'signingLeaseContractAddAgreementKPFiles',
            'signingLeaseContractAddAgreementKPFEFiles',
            'signingLeaseContractAddAgreementKTFiles',
            'startingInstallationWorksFiles',
            'transmissionProblemSolutionFiles',
            'uploadSignedOwnerLeaseContractFiles'];

            $scope.leasingFiles = [];
            $scope.deletedFiles = [];
            $scope.latitudePattern = '(4([1-9]{1}.[0-9]{6}|0.([6-9]{1}[0-9]{5}|5([7-9]{1}[0-9]{4}|6(9[0-9]{3}|8[0-9]{3}))))|5([0-4]{1}.[0-9]{6}|5.([0-3]{1}[0-9]{5}|4([0-3]{1}[0-9]{4}|40000))))';
            $scope.longitudePattern = '([5-7]{1}[0-9]{1}.[0-9]{6}|4([7-9]{1}.[0-9]{6}|6.([5-9]{1}[0-9]{5}|49([4-9]{1}|3)[0-9]{3}))|8([0-6]{1}.[0-9]{6}|7.([0-2]{1}[0-9]{5}|3(0[0-9]{4}|1([0-4]{1}[0-9]{3}|5000)))))';


            $scope.candidate = {};
            $scope.form = {};
            $scope.editableForm = false;
            $scope.newFe = {};
            $scope.caDUforAdd = '';
            $scope.selectedAntennas = [];
            $scope.trFrequencyBands = '';
            $http.get('/camunda/api/engine/engine/default/task/' + camForm.taskId).then(
                    function(result){
                        $scope.taskAssignee = result.data.assignee;
                    },
                    function (error) {
                        console.log(error.data);
                    }
            );
            camForm.on('form-loaded', function () {
                variables.forEach(function (el) {
                    camForm.variableManager.fetchVariable(el);
                });
                files.forEach(function (f) {
                    camForm.variableManager.fetchVariable(f);
                });
                $http.get('/camunda/api/engine/engine/default/task/' + camForm.taskId).then(
                    function (result) {
                        $scope.processInstanceId = result.data.processInstanceId;
                        $scope.taskKey = result.data.taskDefinitionKey;
                        $http.get('/camunda/api/engine/engine/default/process-instance/' + $scope.processInstanceId).then(
                            function(result){
                                $scope.businessKey = result.data.businessKey;
                            },
                            function (error) {console.log(error.data);}
                        );
                    },
                    function (error) {
                        console.log(error.data);
                    }
                );
                $scope.leasingInfo = [];
                $scope.leasingInfo.files = [];
                $scope.dictionary = {};
                $scope.cellAntenna = {
                    selectedAntennas: [],
                    cn_du: []
                };
                $scope.cellAntenna.address = {
                    ca_diff_address:false
                };
                $scope.nearEnd = {};
                $scope.renterCompany = {};
                $scope.threeFarEndNotNecessary= {};
                $scope.powerSource = {};
                $scope.dictionary = {};
                $scope.transmissionAntenna = {};
                $scope.transmissionAntenna.address = {
                    ca_diff_address:false
                };
                if (!$scope.rbsLocationChecked) $scope.rbsLocationChecked = 0;
                $scope.checkRbsLocationTouched = false;
                $scope.checkTPSTouched = false;
                $scope.checkTPSBTouched = false;
                $scope.deletedFarEnd = false;
                $scope.oblastList=[];
                $scope.cityList=[];
                $scope.addressesList = [];
                $scope.address = {};
                $scope.currentFarEnd = {};
                $scope.cai_addr_oblast = '';
                $scope.alphabet = 'abcdefghijklmnopqrstuvwxyz'.split('');

                $scope.cellAntenna.sectors = []; //[{"antennas":[{}], "active": "active"}, {"antennas":[{}]}, {"antennas":[{}]}];

                $scope.sector = {
                    "antennas":[{}],
                }

                $scope.selectedAntennaSector = {};
                $scope.selectedSectorTab = 0;

                //tabs
                $scope.minTab = 0;
                $scope.maxTab = 3;

                //default values is cellAntennaInformations
                $scope.sector.cn_gsm900 = 'No';
                $scope.sector.cn_dcs1800 = 'No';
                $scope.sector.cn_wcdma2100 = 'No';
                $scope.sector.cn_umts900 = 'No';
                $scope.sector.cn_lte800 = 'No';
                $scope.sector.cn_ret_lte800 = 'No';
                $scope.sector.cn_lte1800 = 'No';
                $scope.sector.cn_ret_lte1800 = 'No';
                $scope.sector.cn_lte2100 = 'No';
                $scope.sector.cn_ret_lte2100 = 'No';
                $scope.sector.cn_duplex_gsm = 'No/No';
                $scope.sector.cn_diversity = 'No/No';
                $scope.sector.cn_power_splitter = 'No/No';
                $scope.sector.cn_hcu = 'No/No';
                $scope.sector.cn_asc = 'No';
                $scope.sector.cn_ret = 'Yes';
                $scope.sector.cn_tma_gsm = 'No/No/No';
                $scope.sector.cn_tcc = 'No/No';
                $scope.sector.cn_gsm_range = 'No/No';

                $scope.frequenciesFeByAntennaType = [];
                $scope.frequenciesByAntennaType = [];

                $scope.variablesFetched = false;
                $scope.catalogsFetched = false;

                //----------------------------------------

                $http.get('/api/leasingCatalogs?version=5').then(
                    function(result){
                        angular.extend($scope.dictionary, result.data);

                        var antennaTypePromise = $http.get('/camunda/catalogs/api/get/id/34').then(function(promiseResult){return promiseResult.data;});
                        var trAntennaTypePromise = $http.get('/camunda/catalogs/api/get/id/20').then(function(promiseResult){return promiseResult.data;});
                        var antennaModelPromise = $http.get('/camunda/catalogs/api/get/id/19').then(function(promiseResult){return promiseResult.data;});
                        var antennaLocationsPromise = $http.get('/camunda/catalogs/api/get/id/64').then(function(promiseResult){return promiseResult.data;});
                        var newCatalogsPromise = $http.post('/camunda/catalogs/api/get/rolloutcatalogids', [14, 4, 13, 15, 21, 22, 30, 31, 32, 40, 59, 109]).then(function(promiseResult){return promiseResult.data;});
                        var newBscRncsPromise = $http.get('/camunda/asset-management/bcs_rnc').then(function(promiseResult){return promiseResult.data;});
                        var newFrequenciesPromise = $http.get('/camunda/catalogs/api/get/id/17').then(function(promiseResult){return promiseResult.data;});

                        $q.all([antennaTypePromise, trAntennaTypePromise, antennaModelPromise, antennaLocationsPromise, newCatalogsPromise, newBscRncsPromise, newFrequenciesPromise]).then(function(allPromises) {
                            var antennaTypePromiseResult = allPromises[0];
                            var trAntennaTypePromiseResult = allPromises[1];
                            var antennaModelPromiseResult = allPromises[2];
                            var antennaLocationsPromiseResult = allPromises[3];
                            var newCatalogsPromiseResult = allPromises[4];
                            var newBscRncsPromiseResult = allPromises[5];
                            var newFrequenciesPromiseResult = allPromises[6];
                            var newBscRncs = [];
                            var newAntennas = [];
                            var newAntennaTypes =  [];
                            var newAntennaType =  [];
                            var newAntennaLocations =  [];
                            var newRbsLocation =  [];
                            var newLegalType =  [];
                            var newAddresses =  [];
                            var newFrequencies =  [];

                            newFrequenciesPromiseResult.data.$list.forEach(function(e){
                                var tempItem = {
                                    frequency: e.value + 'GHz',
                                    diameters: []
                                };
                                if(e.TR_Antenna_Type){
                                    e.TR_Antenna_Type.value.forEach(function(v){
                                        trAntennaTypePromiseResult.data.$list.forEach(function(t){
                                            if(t.id === v){
                                                if(t['Antenna Diameter']) {
                                                    tempItem.diameters.push(t['Antenna Diameter'].value.replace(/([a-zA-Z ])/g, ""));
                                                }
                                            }
                                        });
                                    });
                                    newFrequencies.push(tempItem);
                                }
                            });
                            console.log(newFrequencies);

                            $scope.dictionary.constructionType = newCatalogsPromiseResult.construction_type;
                            $scope.dictionary.transmissionType = newCatalogsPromiseResult.transmission_type;
                            $scope.dictionary.dUnit = newCatalogsPromiseResult.digital_unit_types;
                            $scope.dictionary.FarEndConstructiontype = newCatalogsPromiseResult.fe_construction_type;
                            $scope.dictionary.equipmentType = newCatalogsPromiseResult.tr_equipment_type.filter( i => {return (i.hasOwnProperty('id') && i.id !== null)});
                            $scope.dictionary.frequencies = newFrequencies;
                            // $scope.dictionary.legalType = newCatalogsPromiseResult.legal_type;

                            newCatalogsPromiseResult.rbs_location.forEach(function(item){
                                newRbsLocation.push({
                                    "title": item.name,
                                    "id": item.id,
                                    "catalogsId": item.catalogsId
                                });
                            });

                            newBscRncsPromiseResult.forEach(function(item){
                                if (item.bsc_rnc_name && !item.bsc_rnc_name.includes('test') && !item.bsc_rnc_name.includes('test')) {
                                    newBscRncs.push({
                                        "name": item.bsc_rnc_name,
                                        "assetsid": item.id,
                                        "id": item.bscid
                                    });
                                }
                            });

                            newCatalogsPromiseResult.legal_type.forEach(function(item){
                                var oldLegalTypes = $scope.dictionary.legalType;
                                var findedOldLegalType = oldLegalTypes.find(olp => {return olp.desc === item.name})

                                var newItem = {
                                    "desc": item.name,
                                    "udbid":item.id,
                                    "catalogsId": item.catalogsId
                                }
                                if(findedOldLegalType && findedOldLegalType.id) {
                                    newItem.id = findedOldLegalType.id;
                                }
                                newLegalType.push(newItem);
                            });

                            antennaModelPromiseResult.data.$list.forEach(function(item){
                                var tempItem = {
                                    "antenna": item.value,
                                    "description": ""
                                };
                                if(item.dimensions){
                                    tempItem.dimension = item.dimensions.value;
                                }
                                if(item.weight){
                                    tempItem.weight = item.weight.value;
                                }
                                if(item.udb_id){
                                    tempItem.idbid = item.udb_id.value;
                                }
                                if(item.id){
                                    tempItem.catalog_value_id = item.id.value;
                                }
                                newAntennas.push(tempItem);
                            });
                            antennaTypePromiseResult.data.$list.forEach(function(item){
                                newAntennaTypes.push({
                                    "name": item.value,
                                    "id": item.id
                                });
                            });
                            antennaLocationsPromiseResult.data.$list.forEach(function(item){
                                newAntennaLocations.push({
                                    "name": item.value,
                                    "id": item.id
                                });
                            });

                            trAntennaTypePromiseResult.data.$list.forEach(function(item){
                                var tempItem = {
                                    "name": item.value,
                                    "frequencies": []
                                };
                                newFrequenciesPromiseResult.data.$list.forEach(function(e){
                                    if(e.TR_Antenna_Type){
                                        e.TR_Antenna_Type.value.forEach(function(v){
                                            if(item.id === v){
                                                tempItem.frequencies.push(e.value+'GHz');
                                            }
                                        });
                                    }
                                });

                                //if ($scope.dictionary.antennaType) {
                                //    const findedOldDictAntennaType = $scope.dictionary.antennaType.find(a => { return a.name === item.value})
                                //    if (findedOldDictAntennaType && findedOldDictAntennaType.hasOwnProperty('frequencies') && findedOldDictAntennaType.frequencies.length > 0) {
                                //        tempItem.frequencies = findedOldDictAntennaType.frequencies;
                                //    }
                                //}
                                if(item['Antenna Diameter']) {
                                    tempItem.diameter = item['Antenna Diameter'].value;
                                }
                                if(item['Weight']) {
                                    tempItem.weight = item['Weight'].value.split(' ')[0];
                                }
                                if(item.udb_id){
                                    tempItem.idbid = item.udb_id.value;
                                }
                                newAntennaType.push(tempItem);
                            });
                            var mappedD = _.keyBy(newCatalogsPromiseResult.district, o => o.catalogsId)
                            var mappedO = _.keyBy(newCatalogsPromiseResult.oblast, o => o.catalogsId)

                            newCatalogsPromiseResult.city_village.forEach(function(item){
                                var tempItem = {
                                    "city": item.name,
                                    "catalogsId": item.catalogsId
                                };
                                if(item['parent']) {
                                    // var findedDistrict = newCatalogsPromiseResult.district.find(function(d){ return d.catalogsId === item.parent.toString()});
                                    var findedDistrict = mappedD[item.parent.toString()];
                                    if(findedDistrict !== null ) {
                                        tempItem.district = findedDistrict.name
                                        tempItem.districtCatalogsId = findedDistrict.catalogsId
                                        if (findedDistrict.hasOwnProperty('parent')){
                                            // var findedOblast = newCatalogsPromiseResult.oblast.find(function(o){ return o.catalogsId === findedDistrict.parent.toString()});
                                            var findedOblast = mappedO[findedDistrict.parent.toString()];
                                            if (findedOblast !== null) {
                                                tempItem.oblast = findedOblast.name
                                                tempItem.oblastCatalogsId = findedOblast.catalogsId
                                            }
                                        }
                                    }
                                }
                                newAddresses.push(tempItem);
                            });
                            $scope.antennasList = newAntennas;
                            $scope.dictionary.antennas = newAntennas;
                            $scope.dictionary.antennaTypes = newAntennaTypes;
                            $scope.dictionary.antennaType = newAntennaType;
                            $scope.dictionary.antennaLocation = newAntennaLocations;
                            $scope.dictionary.rbsLocation = newRbsLocation;
                            $scope.dictionary.legalType = newLegalType;
                            $scope.dictionary.BSC = newBscRncs;
                            $scope.dictionary.radioUnit = newCatalogsPromiseResult.radio_unit_types;

                            if (!$scope.powerSource.cableLayingType) $scope.powerSource.cableLayingType = $scope.dictionary.cableLayingType;
                            $scope.availableBands = $scope.dictionary.bands;
                            $scope.frequencyBand = $scope.dictionary.frequencyBand;
                            $scope.constructionTypesList = $scope.dictionary.constructionType;
                            $scope.addressesList = newAddresses;
                            $scope.dictionary.addresses = newAddresses;
                            $scope.oblastList = _.uniqBy($scope.dictionary.addresses, 'oblast').map( (e, index) => { return {"name" : e.oblast, "id" : index} });
                            $scope.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                            $scope.districtList = _.uniqBy($scope.dictionary.addresses, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                            $scope.filteredDistricts = $scope.districtList;
                            $scope.filteredDistrictsInCAI = $scope.districtList;

                            $scope.catalogsFetched = true;
                            if($scope.transmissionAntenna && $scope.transmissionAntenna.antennaType && $scope.transmissionAntenna.antennaType !== null) {
                                $scope.frequenciesByAntennaType = _.find($scope.dictionary.antennaType, function (p) {
                                    return p.name === $scope.transmissionAntenna.antennaType;
                                })
                            }

                            // if($scope.candidate.constructionType && $scope.dictionary.constructionType) {
                            //     const finded = $scope.dictionary.constructionType.find(c => {return c.name === $scope.candidate.constructionType.name})
                            //     if (finded && finded !== null) {
                            //         $scope.candidate.constructionType = finded;
                            //     }
                            // }


                            if ($scope.catalogsFetched && $scope.variablesFetched){
                                $scope.setConstructionType()
                                if ($scope.farEndInformation && $scope.farEndInformation.length > 0) {
                                    console.log('farEndInformation is not null')
                                    $scope.openFarEndInformation(0);
                                }
                            }
                        });
                    },
                    function(error){
                        console.log(error);
                    }
                );

                $scope.setConstructionType = function () {
                    let i = $scope.dictionary.constructionType.findIndex( a => { return a.name === $scope.candidate.constructionType.name })
                    if (i > -1){
                        $scope.candidate.constructionType = $scope.dictionary.constructionType[i]
                        $scope.leasingInfo.candidate.constructionType = $scope.dictionary.constructionType[i]
                    }
                }

                $scope.farEndInformation = [];
            });

            $scope.$watch('transmissionAntenna.antennaType', function (antennaType) {
                $scope.frequenciesByAntennaType = _.find($scope.dictionary.antennaType, function (p) {
                    return p.name === antennaType;
                })
            }, true);

            $scope.$watch('currentFarEnd.feAntennaType', function (antennaType) {
                $scope.frequenciesFeByAntennaType = _.find($scope.dictionary.antennaType, function (p) {
                    return p.name === antennaType;
                })
            }, true);

            $scope.$watch('dictionary.antennaType', function (antennaType) {
                $scope.frequenciesByAntennaType = _.find(antennaType, function (p) {
                    return p.name === $scope.transmissionAntenna.antennaType;
                })

                $scope.frequenciesFeByAntennaType = _.find(antennaType, function (p) {
                    return p.name === $scope.currentFarEnd.feAntennaType
                })
            }, true);

            camForm.on('variables-fetched', function () {
                $scope.createNewCandidateSiteFiles = [];

                variables.forEach(function (el) {
                    if(camForm.variableManager.variables[el].value){
                        if (el == 'address' ) {
                            $scope[el] = camForm.variableManager.variables[el] ? camForm.variableManager.variables[el].value : {};
                            $scope.leasingInfo[el] = camForm.variableManager.variables[el] ? camForm.variableManager.variables[el].value : {};
                        } else if (el == 'candidate') {
                            // console.log('candidate:', camForm.variableManager.variables[el].value)

                            $scope.candidate = camForm.variableManager.variables[el].value;
                            $scope.leasingInfo[el] = camForm.variableManager.variables[el].value;
                            if($scope.candidate.constructionType){
                                $scope.candidate.constructionType = JSON.parse(angular.toJson($scope.candidate.constructionType))
                                delete $scope.candidate.constructionType.$$hashKey
                            }

                        } else if (el == 'cellAntenna') {
                            let cellAntenna = camForm.variableManager.variables[el].value;
                            if (camForm.variableManager.variables[el].value.cn_du) {
                                if (typeof camForm.variableManager.variables[el].value.cn_du === 'string') {
                                    cellAntenna.cn_du = [camForm.variableManager.variables[el].value.cn_du]
                                }
                            } else {
                                cellAntenna.cn_du = [];
                            }
                            cellAntenna.cn_du = cellAntenna.cn_du.filter(el => el)
                            $scope.cellAntenna = cellAntenna;
                        } else if (el == 'farEndInformation') {
                            $scope[el] = camForm.variableManager.variables[el].value;
                            $scope.leasingInfo[el] = camForm.variableManager.variables[el].value;
                        } else {
                            $scope[el] = camForm.variableManager.variables[el].value;
                            $scope.leasingInfo[el] = camForm.variableManager.variables[el].value;
                        }
                    }
                });

                $scope.variablesFetched = true;

                if ($scope.catalogsFetched && $scope.variablesFetched){
                    $scope.setConstructionType()
                    if ($scope.farEndInformation && $scope.farEndInformation.length > 0) {
                        console.log('farEndInformation is not null')
                        $scope.openFarEndInformation(0);
                    }
                }

                files.forEach(function (f) {
                    if(camForm.variableManager.variables[f] && camForm.variableManager.variables[f].value){
                        if ( f.toLowerCase().includes('file') ) {
                            $scope.leasingFiles = $scope.leasingFiles.concat(camForm.variableManager.variables[f].value)
                        }
                    }
                });

                $scope.candidate.selectedBands = [];
                    if ($scope.bands) {
                        angular.forEach($scope.availableBands, function (b) {
                            b.value = _.some($scope.bands, function (selected) {
                                return b.title === selected.title;
                            });
                            if (b.value) {
                            $scope.candidate.selectedBands.push(b);
                            }
                        });
                    }
                if(!$scope.newCandidateRRFiles){
                    $scope.newCandidateRRFiles = [];
                }


                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskResult',
                    type: 'String',
                    value: ''
                });
                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskComment',
                    type: 'String',
                    value: ''
                });
                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteDeletedFiles',
                    type: 'Json',
                    value: ''
                });
                camForm.variableManager.createVariable({
                    name: 'rbsLocationChecked',
                    type: 'Integer',
                    value: $scope.rbsLocationChecked
                });
                $scope.createNewCandidateSiteTaskResult = 'Confirm candidate';
                // $scope.candidate.longitude = $scope.longitude;
                // $scope.candidate.latitude = $scope.latitude;
                $scope.candidate.rbsType = $scope.rbsType;
                if($scope.candidate.dateOfVisit){
                    $scope.candidate.dateOfVisit = new Date($scope.candidate.dateOfVisit);
                }
                if ($scope.farEndInformation) {
                     angular.forEach($scope.farEndInformation, function (fe) {
                            if (fe.surveyDate) {
                                fe.surveyDate = new Date(fe.surveyDate);
                            }
                     });

                }
                if($scope.candidate.rbsLocation){
                    angular.forEach($scope.candidate.rbsLocation, function (l) {
                        if(l.value){
                           $scope.rbsLocationChecked+=1;
                        }
                    });
                }

                if(!($scope.cellAntenna && $scope.cellAntenna.sectors && $scope.cellAntenna.sectors.length > 0)){
                    $scope.newSector();
                    $scope.newSector();
                    $scope.newSector();
                }


                for (let s of $scope.cellAntenna.sectors) {
                    s.antennas.forEach( a => {
                        if (a.antennaType && typeof a.antennaType === 'string'){
                            return a.antennaType = {};
                        }
                    });
                }

                $scope.filteredAntennaTypesBySiteType = [];
                if ($scope.siteType) {
                    if ($scope.siteType.id === "2" || $scope.siteType.id === "1" || $scope.siteType.id === "4"){
                        $scope.filteredAntennaTypesBySiteType.push('G900')
                        $scope.filteredAntennaTypesBySiteType.push('G1800')
                        $scope.filteredAntennaTypesBySiteType.push('U900')
                        $scope.filteredAntennaTypesBySiteType.push('U2100')
                        $scope.filteredAntennaTypesBySiteType.push('L800')
                        $scope.filteredAntennaTypesBySiteType.push('L1800')
                        $scope.filteredAntennaTypesBySiteType.push('L2100')
                        $scope.filteredAntennaTypesBySiteType.push('L2600')
                    } else {
                        if ($scope.siteType.name.includes('2')){
                            $scope.filteredAntennaTypesBySiteType.push('G900')
                            $scope.filteredAntennaTypesBySiteType.push('G1800')
                        }
                        if ($scope.siteType.name.includes('3')){
                            $scope.filteredAntennaTypesBySiteType.push('U900')
                            $scope.filteredAntennaTypesBySiteType.push('U2100')
                        }
                        if ($scope.siteType.name.includes('4')){
                            $scope.filteredAntennaTypesBySiteType.push('L800')
                            $scope.filteredAntennaTypesBySiteType.push('L1800')
                            $scope.filteredAntennaTypesBySiteType.push('L2100')
                            $scope.filteredAntennaTypesBySiteType.push('L2600')
                        }
                    }
                }
            });

            camForm.on('submit', function (evt) {
                /*angular.forEach($scope.farEndInformation, function (fe, i) {
                        if (i==0) fe.priority=true;
                        else fe.priority=false;
                });*/

                //evt.submitPrevented = true;

                $scope.candidate.assignedUser = $scope.taskAssignee;
                // Закоментил, потому что не работает. receivingContractDevDesignEstimateForFETaskResult переменки нигде нет.
                // camForm.variableManager.variableValue('receivingContractDevDesignEstimateForFETaskResult', $scope.receivingContractDevDesignEstimateForFETaskResult);
                camForm.variableManager.variableValue('createNewCandidateSiteTaskResult', $scope.createNewCandidateSiteTaskResult);
                camForm.variableManager.variableValue('createNewCandidateSiteTaskComment', $scope.createNewCandidateSiteTaskComment);

                var thisTaskFiles = $scope.leasingFiles.filter(f => {return f.varName === 'createNewCandidateSiteFiles'});
                if(!camForm.variableManager.variables['createNewCandidateSiteFiles'].type){
                    camForm.variableManager.destroyVariable('createNewCandidateSiteFiles');
                    camForm.variableManager.createVariable({
                        name: 'createNewCandidateSiteFiles',
                        type: 'Json',
                        value: thisTaskFiles
                    });
                } else {
                    camForm.variableManager.variableValue('createNewCandidateSiteFiles', thisTaskFiles);
                }

                camForm.variableManager.destroyVariable('address');
                camForm.variableManager.createVariable({
                    name: 'address',
                    type: 'Json',
                    value: $scope.address
                });

                angular.forEach(variablesToCreate, function (el) {
                    if(!camForm.variableManager.variables[el.name] || (camForm.variableManager.variables[el.name] && !camForm.variableManager.variables[el.name].type)){
                        if(camForm.variableManager.variables[el.name] && !camForm.variableManager.variables[el.name].type){
                            camForm.variableManager.destroyVariable(el.name);
                        }
                        if (el.name === 'candidate' && $scope[el.name].cn_altitude === undefined) {
                            console.log("Пустой altitude")
                            $scope['candidate'].cn_altitude = 0
                        }
                        camForm.variableManager.createVariable({
                            name: el.name,
                            type: el.type,
                            value: $scope[el.name]
                        });
                    } else {
                        if (el.name === 'candidate' && $scope['candidate'].cn_altitude === undefined) {
                            console.log("Пустой altitude")
                            $scope['candidate'].cn_altitude = 0
                        }
                        camForm.variableManager.variableValue(el.name, $scope[el.name]);
                    }
                });
                if($scope.candidate.siteName){
                    camForm.variableManager.createVariable({
                        name: 'siteName',
                        type: 'String',
                        value: $scope.candidate.siteName
                    });
                    camForm.variableManager.createVariable({
                        name: 'site_name',
                        type: 'String',
                        value: $scope.candidate.siteName
                    });
                }
                // for search
                if($scope.renterCompany.legalType){
                    camForm.variableManager.createVariable({
                        name: 'leasingCandidateLegalType',
                        type: 'String',
                        value: $scope.renterCompany.legalType
                    });
                }
                if($scope.renterCompany.legalType){
                    camForm.variableManager.createVariable({
                        name: 'legalTypeCatalogId',
                        type: 'Long',
                        value: $scope.renterCompany.legalTypeCatalogId
                    });
                }

                if(camForm.variableManager.variables['transmissionTypeForSearch'] && camForm.variableManager.variables['transmissionTypeForSearch'].type){
                    camForm.variableManager.variableValue('transmissionTypeForSearch', $scope.candidate.transmissionType);
                } else {
                    if(camForm.variableManager.variables['transmissionTypeForSearch']){
                        camForm.variableManager.destroyVariable('transmissionTypeForSearch');
                    }
                    camForm.variableManager.createVariable({
                        name: 'transmissionTypeForSearch',
                        type: 'String',
                        value: $scope.candidate.transmissionType
                    });
                }

                if ($scope.farEndInformation && $scope.farEndInformation.length > 0) {
                    var farEndLegalTypes = ',';
                    angular.forEach($scope.farEndInformation, function (fe) {
                        if (fe.legalType) {
                            farEndLegalTypes = farEndLegalTypes + fe.legalType + ',';
                        }
                    });
                    camForm.variableManager.createVariable({
                        name: 'leasingFarEndLegalType',
                        type: 'String',
                        value: farEndLegalTypes
                    });
                }
                if(camForm.variableManager.variables.hasOwnProperty($scope.taskKey + "DeletedFiles")){
                    camForm.variableManager.destroyVariable($scope.taskKey + "DeletedFiles");
                    camForm.variableManager.createVariable({
                        name: $scope.taskKey + "DeletedFiles",
                        type: 'Json',
                        value: $scope.deletedFiles
                    });
                } else {
                    camForm.variableManager.variableValue($scope.taskKey + "DeletedFiles", $scope.deletedFiles);
                }
                camForm.variableManager.destroyVariable('resolutions');
            });

            $scope.$watch('availableBands', function (availableBands) {
                $scope.candidate.selectedBands = [];
                if (availableBands){
                    availableBands.forEach(function (b) {
                        if (b.value) {
                            $scope.candidate.selectedBands.push(b);
                        }
                    })
                }
            }, true);

            $scope.sortableOptions = {
                'ui-preserve-size': true,
                stop: function(e, ui) {
                    $scope.farEndInformation[0].priority = true;
                    angular.forEach($scope.farEndInformation, function (fe, i) {
                        if(i !== 0) fe.priority = false;
                    });
                }
            };
            $scope.checkFrequency = function(val, index) {
                var yes = false;
                var temp = String(val);
                angular.forEach($scope.frequencyBand, function (freq, i) {
                        if (freq.substring(0, temp.length) === temp) {
                         yes = true;
                         $scope.frequencyBandValid = true;
                        }
                    });
                    if (!yes) {
                        $scope.cellAntenna.selectedAntennas[index].frequencyBand = '';
                        $scope.frequencyBandValid = false;
                    }
            };
            $scope.cellAntennaTypeChanged = function(val, parent, index) {
                const pIndex = parent.$index
                if($scope.cellAntenna) {
                    if($scope.cellAntenna.sectors && $scope.cellAntenna.sectors.length >0){
                        if($scope.cellAntenna.sectors[pIndex].antennas && $scope.cellAntenna.sectors[pIndex].antennas.length >0) {
                            $scope.cellAntenna.sectors[pIndex].antennas[index].frequencyBand = parseInt(val.replace(/[^0-9.]/gi, ''));
                        }
                    }
                }
                // $scope.cellAntenna.selectedAntennas[index].frequencyBand = val.replace(/[^0-9.]/gi, '');
                // console.log('$scope.cellAntenna.selectedAntennas[index].frequencyBand')
                // console.log($scope.cellAntenna.selectedAntennas[index].frequencyBand)
                // $scope.checkFrequency($scope.cellAntenna.selectedAntennas[index].frequencyBand, index)
            }
            $scope.checkAzimuth = function(val, index) {
                if (!(val>=0 && val <=360)) $scope.cellAntenna.selectedAntennas[index].azimuth = '';
            };

            $scope.azimuthPattern = '([0-9]|[1-8][0-9]|9[0-9]|[12][0-9]{2}|3[0-5][0-9]|360)';


            $scope.deleteFE = function (index) {
                exModal.open({
                    scope: {
                        //farEndInformation : $scope.farEndInformation,
                        //index: index,
                        validate: function(index) {
                            $scope.currentFarEnd = undefined;
                            $scope.farEndInformation.splice(index, 1);
                        },
                    },
                    templateUrl: './js/partials/deleteFarEndValidation.html',
                    size: 'sm'
                }).then(function (results) {
                });
                /*
                if ($scope.currentFarEnd == $scope.farEndInformation[index]) {
                $scope.farEndInformation.splice(index, 1);
                var feLength = $scope.farEndInformation.length;
                if (feLength>0 && feLength>index-1) {
                    if (index!=0) $scope.currentFarEnd = $scope.farEndInformation[index-1];
                    else $scope.currentFarEnd = $scope.farEndInformation[index];
                }
                } else $scope.farEndInformation.splice(index, 1);
                $scope.currentFarEnd = undefined;
                $scope.farEndInformation.splice(index, 1);
                */

            };

            $scope.getCoordinatesByFE = function(feName, index) {
                return $http.get('/camunda/leasing/feData/' + feName).then(function (res) {
                    console.log(res.data)
                    $scope.currentFarEnd.fe_longitude = res.data.longitude
                    $scope.currentFarEnd.fe_latitude = res.data.latitude
                    return res.data
                }, function (error) {
                    console.log(error);
                });
            }

            $scope.getRadians = function (val) {
                const pi = 3.14159265358979;
                return pi*val/180;
            }

            $scope.autoSetAzimuth = function () {
                const primaryFE = $scope.farEndInformation && $scope.farEndInformation.length >0 ? $scope.farEndInformation[0] : null
                const NE_address = $scope.transmissionAntenna && $scope.transmissionAntenna.address ? $scope.transmissionAntenna.address : null
                if (primaryFE && NE_address) {
                    if ( primaryFE.fe_longitude && primaryFE.fe_latitude && NE_address.latitude && NE_address.longitude) {
                        const pi = 3.14159265358979;
                        let fe_long = parseFloat(primaryFE.fe_longitude) //'77.507694')
                        let fe_lat = parseFloat(primaryFE.fe_latitude )//'52.648194')
                        let ne_long = parseFloat(NE_address.longitude) //'77.233417')
                        let ne_lat = parseFloat(NE_address.latitude) //'52.782889')
                        const ne_long_radians = $scope.getRadians(ne_long)
                        const ne_lat_radians = $scope.getRadians(ne_lat)
                        const fe_long_radians = $scope.getRadians(fe_long)
                        const fe_lat_radians = $scope.getRadians(fe_lat)
                        // Math.cos(x)
                        const cosNeLat = Math.cos(ne_lat_radians)
                        const cosFeLat = Math.cos(fe_lat_radians)
                        const sinNeLat = Math.sin(ne_lat_radians)
                        const sinFeLat = Math.sin(fe_lat_radians)
                        const deltaLong = Math.abs(ne_long_radians - fe_long_radians);
                        const cosDeltaLong = Math.cos(deltaLong)
                        const sinDeltaLongNE = Math.sin(fe_long_radians - ne_long_radians)
                        const sinDeltaLongFE = Math.sin(ne_long_radians - fe_long_radians)
                        const angleDelta = Math.acos(sinNeLat*sinFeLat + cosFeLat*cosNeLat*cosDeltaLong)
                        const angleDiff = Math.atan2(sinDeltaLongNE*cosFeLat, (cosNeLat*sinFeLat-cosFeLat*sinNeLat*cosDeltaLong) )
                        function mod(n, m) {
                            return ((n % m) + m) % m;
                        }
                        const neAzimuth = Math.round(180*mod(angleDiff,(2*pi))/pi*100)/100
                                // =180*(MOD(B16,2*H23)/H23)
                        $scope.transmissionAntenna.azimuth = neAzimuth;
                    } else {
                        alert('Заполните корректно поля FE Longitude, FE Latitude, NE Longitude, NE Latitude')
                    }
                }
            }

            $scope.openFarEndInformation = function(index) {
                $scope.currentFarEnd = $scope.farEndInformation[index];
                if($scope.currentFarEnd.farEndName !== null && (!($scope.currentFarEnd.hasOwnProperty('fe_longitude') && $scope.currentFarEnd.fe_longitude !== null) || !($scope.currentFarEnd.hasOwnProperty('fe_latitude') && $scope.currentFarEnd.fe_latitude !== null))) {
                    $scope.getCoordinatesByFE($scope.currentFarEnd.farEndName);

                }
                if ($scope.currentFarEnd.surveyDate) {
                    $scope.currentFarEnd.surveyDate = new Date($scope.currentFarEnd.surveyDate);
                }
                if (!($scope.currentFarEnd.renterCompany && $scope.currentFarEnd.renterCompany.legalName)) {
                    $scope.currentFarEnd.renterCompany = { legalName : ''};
                }
                if($scope.currentFarEnd.feAntennaType && $scope.currentFarEnd.feAntennaType !== null) {
                    $scope.frequenciesFeByAntennaType = _.find($scope.dictionary.antennaType, function (p) {
                        return p.name === $scope.currentFarEnd.feAntennaType;
                    })
                }
                if ($scope.currentFarEnd && $scope.currentFarEnd.constructionType !== null && $scope.currentFarEnd.constructionType.name !== null) {
                    console.log('const-n type is not null ||| ' + $scope.currentFarEnd.constructionType.name)
                    console.log('_.find from $scope.dictionary.FarEndConstructiontype ', _.find($scope.dictionary.FarEndConstructiontype, function (p) {
                        return p.name === $scope.currentFarEnd.constructionType.name;
                    }))

                    $scope.currentFarEnd.constructionType = _.find($scope.dictionary.FarEndConstructiontype, function (p) {
                        return p.name === $scope.currentFarEnd.constructionType.name;
                    })
                }

                $scope.currentFarEnd.dictionary = {};
                $scope.currentFarEnd.dictionary.filteredDistricts = $scope.districtList;
                $scope.currentFarEnd.dictionary.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId": e.catalogsId} });
            };

            var currentDate = new Date();
            $scope.datepickerOptions = {
                minDate: currentDate
            };

            $scope.fromFirstToSecondWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.cellAntenna.selectedAntennas.push($scope.antennasList[index]);
                        $scope.antennasList.splice(index, 1);
                    });
                }
                $scope.firstMultiselect = [];
            };

            $scope.fromSecondToFirstWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.antennasList.push($scope.antennasList[index]);
                        $scope.cellAntenna.selectedAntennas.splice(index, 1);
                    });
                }
                $scope.secondMultiselect = [];
            };

            $scope.getCity = function (val) {
                if (val.length < 2) {
                    return []
                }
                return _.filter($scope.cityList, function(o) { return o.name.toLowerCase().includes(val.toLowerCase()); })
            };

            $scope.getFilteredBSC = function (val) {
                if (val.length < 1) {
                    return []
                }
                $scope.candidate.bsc = undefined;
                return _.filter($scope.dictionary.BSC, function(o) { return o.name.toLowerCase().includes(val.toLowerCase()); })
            };

            $scope.getFarEndCity = function (val) {
                if (val.length < 2) {
                    return []
                }
                return _.filter($scope.currentFarEnd.dictionary.cityList, function(o) { return o.name.toLowerCase().includes(val.toLowerCase()); })
            };

            $scope.filterDistrictAfterSelectObl = function (cn_addr_oblast) {
                $scope.address.cn_addr_oblast = cn_addr_oblast
                $scope.address.cn_addr_district = ''
                $scope.address.cn_addr_city = ''
                if($scope.address.cn_addr_oblast && $scope.address.cn_addr_oblast !== ''){
                    $scope.filteredByOblast = $scope.dictionary.addresses.filter(a => {return a.oblast === $scope.address.cn_addr_oblast});
                    $scope.filteredDistricts = _.uniqBy($scope.filteredByOblast, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                    $scope.cityList = _.uniqBy($scope.filteredByOblast, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                } else {
                    $scope.filteredDistricts = $scope.districtList;
                    $scope.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                }
            }

            $scope.filterDistrictAfterSelectOblInCAI = function (cn_addr_oblast) {
                $scope.cellAntenna.address.cn_addr_oblast = cn_addr_oblast
                $scope.cellAntenna.address.cn_addr_district = ''
                $scope.cellAntenna.address.cn_addr_city = ''
                if($scope.cellAntenna.address.cn_addr_oblast && $scope.cellAntenna.address.cn_addr_oblast !== ''){
                    $scope.filteredByOblast = $scope.dictionary.addresses.filter(a => {return a.oblast === $scope.cellAntenna.address.cn_addr_oblast});
                    $scope.filteredDistrictsInCAI = _.uniqBy($scope.filteredByOblast, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                    $scope.cityList = _.uniqBy($scope.filteredByOblast, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                } else {
                    $scope.filteredDistrictsInCAI = $scope.districtList;
                    $scope.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                }
            }

            $scope.filterDistrictAfterSelectOblInNEI = function (cn_addr_oblast) {
                try{
                    $scope.transmissionAntenna.address.cn_addr_oblast = cn_addr_oblast;
                    $scope.transmissionAntenna.address.cn_addr_district = '';
                    $scope.transmissionAntenna.address.cn_addr_city = '';
                    if($scope.transmissionAntenna.address.cn_addr_oblast && $scope.transmissionAntenna.address.cn_addr_oblast !== ''){
                        $scope.filteredByOblast = $scope.dictionary.addresses.filter(a => {return a.oblast === $scope.transmissionAntenna.address.cn_addr_oblast});
                        $scope.filteredDistrictsInNEI = _.uniqBy($scope.filteredByOblast, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                        $scope.cityList = _.uniqBy($scope.filteredByOblast, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                    } else {
                        $scope.filteredDistrictsInNEI = $scope.districtList;
                        $scope.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                    }
                } catch (e) {
                    console.log(e);
                }
            }

            $scope.filterDistrictAfterSelectFarEndObl = function (cn_addr_oblast) {
                $scope.currentFarEnd.address.cn_addr_oblast = cn_addr_oblast
                $scope.currentFarEnd.address.cn_addr_district = ''
                $scope.currentFarEnd.address.cn_addr_city = ''
                if($scope.currentFarEnd.address.cn_addr_oblast && $scope.currentFarEnd.address.cn_addr_oblast !== ''){
                    $scope.currentFarEnd.dictionary = {}
                    $scope.currentFarEnd.dictionary.filteredByOblast = $scope.dictionary.addresses.filter(a => {return a.oblast === $scope.currentFarEnd.address.cn_addr_oblast});
                    $scope.currentFarEnd.dictionary.filteredDistricts = _.uniqBy($scope.currentFarEnd.dictionary.filteredByOblast, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                    $scope.currentFarEnd.dictionary.cityList = _.uniqBy($scope.currentFarEnd.dictionary.filteredByOblast, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                } else {
                    $scope.currentFarEnd.dictionary.filteredDistricts = $scope.districtList;
                    $scope.currentFarEnd.dictionary.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                }
            }

            $scope.getSite = function (val) {
                return $http.get('/camunda/sites/name/contains/' + val + '?forRollout=true').then(
                        function (response) {
                            return response.data
                        }
                );
            };

            $scope.transmissionTypeChanged = function () {
                if ($scope.catalogsFetched && $scope.variablesFetched && $scope.candidate.transmissionType){
                    let finded = _.find($scope.dictionary.transmissionType, function (p) {
                        return p.name === $scope.candidate.transmissionType;})
                    if (finded) {
                        $scope.candidate.transmissionTypeAmCatalogsId = finded.catalogsId;
                    }
                }

            }

            $scope.siteSelected = function ($item) {
                $scope.newFe.farEndName = $item.site_name;
                $scope.newFe.farEndId = $item.name;
                $scope.newFe.farEndSequence = $item.id;
                $scope.newFe.index = $scope.farEndInformation.length;
                $scope.newFe.priority = false;
                if (!$scope.newFe.hasOwnProperty('dictionary')){
                    $scope.newFe.dictionary = {};
                    $scope.newFe.dictionary.filteredDistricts = $scope.districtList;
                    $scope.newFe.dictionary.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index, "catalogsId" : e.catalogsId} });
                }
                if($scope.newFe.index===0) $scope.newFe.priority = true;
                $scope.farEndInformation.push($scope.newFe);
                $scope.currentFarEnd = $scope.newFe;
                if($scope.currentFarEnd.farEndName !== null && (!($scope.currentFarEnd.hasOwnProperty('fe_longitude') && $scope.currentFarEnd.fe_longitude !== null) || !($scope.currentFarEnd.hasOwnProperty('fe_latitude') && $scope.currentFarEnd.fe_latitude !== null))) {
                    $scope.getCoordinatesByFE($scope.currentFarEnd.farEndName);
                    // console.log('coordinates')
                    // console.log(coordinates)
                    // $scope.currentFarEnd.fe_longitude = coordinates.longitude
                    // $scope.currentFarEnd.fe_latitude = coordinates.latitude
                }
                $scope.newFe = {};

            }

            $scope.newSector = function () {
                let newS = JSON.parse(angular.toJson($scope.sector));
                $scope.cellAntenna.sectors.push(newS);
                // console.log($scope.cellAntenna.sectors)
                if ($scope.selectedSectorTab+1 < $scope.cellAntenna.sectors.length) {
                    $scope.selectedSectorTab = $scope.cellAntenna.sectors.length - 1;
                    $scope.cellAntenna.sectors[$scope.selectedSectorTab].active = 'active';

                    if ($scope.selectedSectorTab === $scope.maxTab) {
                        $scope.minTab= $scope.minTab + 1;
                        $scope.maxTab= $scope.maxTab + 1;
                    }
                } else {
                    $scope.cellAntenna.sectors[$scope.selectedSectorTab].active = 'active';
                }
            }

            $scope.$watch('address', function (project) {
                if (!$scope.cellAntenna.address.ca_diff_address){
                    $scope.cellAntenna.address = JSON.parse(JSON.stringify($scope.address))
                }
                if (!$scope.transmissionAntenna.address.ca_diff_address){
                    $scope.transmissionAntenna.address = JSON.parse(JSON.stringify($scope.address))
                    $scope.transmissionAntenna.address.latitude = $scope.candidate.latitude
                    $scope.transmissionAntenna.address.longitude = $scope.candidate.longitude
                }
            }, true);

            $scope.cellAntennaDiffAddressChecked = function (checkedStatus) {
                if(!checkedStatus) {
                    $scope.cellAntenna.address = JSON.parse(JSON.stringify($scope.address))
                    $scope.filterDistrictAfterSelectOblInNEI($scope.transmissionAntenna.address.cn_addr_oblast)
                }
            };
            $scope.nearEndDiffAddressChecked = function (checkedStatus) {
                try{
                    if(!checkedStatus) {
                        $scope.transmissionAntenna.address = JSON.parse(JSON.stringify($scope.address))
                        $scope.transmissionAntenna.address.latitude = $scope.candidate.latitude;
                        $scope.transmissionAntenna.address.longitude = $scope.candidate.longitude;
                        $scope.filterDistrictAfterSelectOblInNEI($scope.transmissionAntenna.address.cn_addr_oblast)
                    }
                } catch(e) {
                    console.log(e);
                }
            };

            $scope.addressCitySelected = function ($item) {
                $scope.address.cn_addr_city = $item.name;
                $scope.address.cn_addr_city_id = $item.id;
                if ($item.catalogsId) {
                    $scope.address.city_catalogs_id = $item.catalogsId;
                }

                let findByCity = {};
                if ($scope.address.cn_addr_oblast && $scope.address.cn_addr_oblast !== null && $scope.address.cn_addr_oblast !== '') {
                    findByCity = _.find($scope.dictionary.addresses, {'city': $item.name, 'oblast' : $scope.address.cn_addr_oblast})
                } else {
                    findByCity = _.find($scope.dictionary.addresses, {'city': $item.name})
                }
                $scope.address.cn_addr_district = findByCity ? findByCity.district : '';
                if (!$scope.address.cn_addr_oblast || $scope.address.cn_addr_oblast !== findByCity.oblast ) {
                    $scope.address.cn_addr_oblast = findByCity ? findByCity.oblast : '';
                }
            };

            $scope.cellInfoAddressCitySelected = function ($item) {
                if ($item.catalogsId) {
                    $scope.cellAntenna.address.city_catalogs_id = $item.catalogsId;
                }
                let findByCity = {};
                if ($scope.cellAntenna.address.cn_addr_oblast && $scope.cellAntenna.address.cn_addr_oblast !== null && $scope.cellAntenna.address.cn_addr_oblast !== '') {
                    findByCity = _.find($scope.dictionary.addresses, {'city': $item.name, 'oblast' : $scope.cellAntenna.address.cn_addr_oblast})
                } else {
                    findByCity = _.find($scope.dictionary.addresses, {'city': $item.name})
                }
                $scope.cellAntenna.address.cn_addr_district = findByCity ? findByCity.district : '';
                if (!$scope.cellAntenna.address.cn_addr_oblast || $scope.cellAntenna.address.cn_addr_oblast !== findByCity.oblast ) {
                    $scope.cellAntenna.address.cn_addr_oblast = findByCity ? findByCity.oblast : '';
                }

            };

           $scope.nearEndInfoAddressCitySelected = function ($item) {
               if ($item.catalogsId) {
                   $scope.transmissionAntenna.address.city_catalogs_id = $item.catalogsId;
               }
               let findByCity = {};
               if ($scope.transmissionAntenna.address.cn_addr_oblast && $scope.transmissionAntenna.address.cn_addr_oblast !== null && $scope.transmissionAntenna.address.cn_addr_oblast !== '') {
                   findByCity = _.find($scope.dictionary.addresses, {'city': $item.name, 'oblast' : $scope.transmissionAntenna.address.cn_addr_oblast})
               } else {
                   findByCity = _.find($scope.dictionary.addresses, {'city': $item.name})
               }
                $scope.transmissionAntenna.address.cn_addr_district = findByCity ? findByCity.district : '';
                if (!$scope.transmissionAntenna.address.cn_addr_oblast || $scope.transmissionAntenna.address.cn_addr_oblast !== findByCity.oblast ) {
                    $scope.transmissionAntenna.address.cn_addr_oblast = findByCity ? findByCity.oblast : '';
                }
            };

            $scope.farEndAddressCitySelected = function ($item) {
                if ($item.catalogsId) {
                    $scope.currentFarEnd.address.city_catalogs_id = $item.catalogsId;
                }
                let findByCity = {};
                if ($scope.currentFarEnd.address.cn_addr_oblast && $scope.currentFarEnd.address.cn_addr_oblast !== null && $scope.currentFarEnd.address.cn_addr_oblast !== '') {
                    findByCity = _.find($scope.dictionary.addresses, {'city': $item.name, 'oblast' : $scope.currentFarEnd.address.cn_addr_oblast})
                } else {
                    findByCity = _.find($scope.dictionary.addresses, {'city': $item.name})
                }
                $scope.currentFarEnd.address.cn_addr_district = findByCity ? findByCity.district : '';
                if (!$scope.currentFarEnd.address.cn_addr_oblast || $scope.currentFarEnd.address.cn_addr_oblast !== findByCity.oblast ) {
                    $scope.currentFarEnd.address.cn_addr_oblast = findByCity ? findByCity.oblast : '';
                }
            };

            $scope.checkRbsLocation  = function($index, val) {
                if (val) $scope.rbsLocationChecked +=1;
                else $scope.rbsLocationChecked -=1;
                $scope.checkRbsLocationTouched = true;
            };

            $scope.checkTPS = function(val) {
                if (val==='TPS installation required (TPS is missing)') {
                    $scope.powerSource.cn_tps_belongs = '';
                    $scope.powerSource.cn_tps_belongs_commentary = '';
                    $scope.powerSource.cn_tps_distance = '';
                    $scope.checkTPSTouched = false;
                }
                else {
                    $scope.checkTPSTouched = true;
                }
            };


            $scope.checkTPSB = function(val) {
                if (val==='Other') {
                    $scope.checkTPSBTouched = true;
                }
                else {
                    $scope.powerSource.cn_tps_belongs_commentary = '';
                    $scope.checkTPSBTouched = false;
                }
            };

            $scope.defineByAntennaType = function (antennaType, type) {
                if (antennaType) {
                    if (type === 'transmission') {
                        console.log($scope.dictionary.antennaType);
                        console.log(type);
                        angular.forEach($scope.dictionary.antennaType, function (type) {
                            if(type.name === antennaType) {
                                $scope.transmissionAntenna.diameter = type.diameter;
                                $scope.transmissionAntenna.weight = type.weight;
                                $scope.transmissionAntenna.udb_id = type.udb_id;
                            }
                        });
                    }
                    else {
                        angular.forEach($scope.dictionary.antennaType, function (type) {
                            if(type.name === antennaType) {
                                $scope.currentFarEnd.diameter = type.diameter;
                                $scope.currentFarEnd.weight = parseFloat(type.weight);
                            }
                        });
                    }
                } else {
                    if (type === 'transmission') {
                        $scope.transmissionAntenna.diameter = undefined;
                        $scope.transmissionAntenna.weight = undefined;
                    } else {
                        $scope.currentFarEnd.diameter = undefined;
                        $scope.currentFarEnd.weight = undefined;
                    }
                }
            };

            $scope.defineWeightByAntennaDiameter = function (antennaDiameter) {
                if(antennaDiameter){
                    angular.forEach($scope.dictionary.antennaDiameter, function (d) {
                        if(d.diameter === antennaDiameter){
                            $scope.currentFarEnd.weight = parseFloat(d.weight);
                        }
                    });
                } else {
                    $scope.currentFarEnd.weight = undefined;
                }
            };
            $scope.$watch('project', function (project) {
                $scope.reasonsByProject = [];
                $scope.reasonsByProject = _.filter($scope.dictionary.reasons, function (r) {
                    if (_.find(r.project, function (p) {return p === project; }) ) { return true} else return false;
                })
            }, true);

            $scope.fileSelected = function (el, fileName) {
                $timeout(function () {
                    $scope.$apply(function () {
                        uploadFileToMinio(el.files[0], fileName);
                    });
                })
            };

            function uploadFileToMinio(file, fileName) {
                var fileIndex = $scope[fileName].length;

                var fileToUpload = {
                    date: new Date(),
                    author:  $scope.taskAssignee,
                    name: file.name.replace(/[/\\?%*:|"<>]/g, '-'),
                    path: $scope.processInstanceId + '/' + camForm.taskId + '/' + file.name.replace(/[/\\?%*:|"<>]/g, '-')
                };
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/put/' + fileToUpload.path,
                    transformResponse: []
                }).then(function (response) {
                    $http.put(response.data, file, {headers: {'Content-Type': undefined}}).then(
                            function () {
                                fileToUpload.varName = 'createNewCandidateSiteFiles';
                                $scope.leasingFiles.push(fileToUpload);
                                //$scope[fileName].push(fileToUpload);
                                angular.element(document.querySelector('#' + fileName)).val(null);
                                // console.log($scope.leasingFiles)
                            },
                            function (error) {
                                console.log(error.data);
                            }
                    );
                }, function(error){
                    console.log(error.data);
                });
            };

            $scope.clearFile = function (list, fileIndex) {
                $scope[list].splice(fileIndex, 1);
            }

            $scope.fileDownload = function (file) {
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/get/' + file.path,
                    transformResponse: []
                }).then(function (response) {
                    document.getElementById('fileDownloadIframe').src = response.data;
                }, function(error){
                    console.log(error.data);
                });
            }

            function prepareRRCreatedata(){
                var data = {
                    processInstanceId: $scope.processInstanceId,
                    taskId: camForm.taskId,
                    ncpID: $scope.ncpID,
                    cellAntennaAddress:$scope.cellAntenna.address? $scope.cellAntenna.address: '',
                    contactName: $scope.renterCompany.contactName?$scope.renterCompany.contactName:'',
                    contactPosition: $scope.renterCompany.contactPosition? $scope.renterCompany.contactPosition: '',
                    contactInfo: $scope.renterCompany.contactInfo? $scope.renterCompany.contactInfo: '',
                    rcLegalName:$scope.renterCompany.legalName?$scope.renterCompany.legalName:'',
                    rcLegalAddress:$scope.renterCompany.legalAddress?$scope.renterCompany.legalAddress:'',
                    rcTelFax: $scope.renterCompany.telFax?$scope.renterCompany.telFax:'',
                    rcFirstLeaderName:$scope.renterCompany.firstLeaderName?$scope.renterCompany.firstLeaderName:'',
                    rcFirstLeaderPos:$scope.renterCompany.firstLeaderPos?$scope.renterCompany.firstLeaderPos:'',
                    rcEmail:$scope.renterCompany.email?$scope.renterCompany.email:''
                };

                if($scope.candidate){
                    data.siteName = $scope.candidate.siteName? $scope.candidate.siteName : '';
                    data.latitude = $scope.candidate.latitude?$scope.candidate.latitude:'';
                    data.longitude = $scope.candidate.longitude?$scope.candidate.longitude:'';
                    data.cn_altitude = $scope.candidate.cn_altitude?$scope.candidate.cn_altitude:'';
                    data.constructionType = $scope.candidate.constructionType ? $scope.candidate.constructionType : {};
                    data.square = $scope.candidate.square?$scope.candidate.square:'';
                    data.rbsType = $scope.candidate.rbsType?$scope.candidate.rbsType:'';
                    data.cn_height_constr = $scope.candidate.cn_height_constr?$scope.candidate.cn_height_constr:'';
                    data.newCandidateComments = $scope.candidate.comments?$scope.candidate.comments:'';

                    if($scope.candidate.dateOfVisit){
                        var dateOfVisit = new Date($scope.candidate.dateOfVisit);
                        data.dateOfVisit = (dateOfVisit.getDate()>9?dateOfVisit.getDate():'0'+dateOfVisit.getDate()) + '-' + (dateOfVisit.getMonth()>9?dateOfVisit.getMonth()+1:'0'+(dateOfVisit.getMonth()+1)) + '-' + dateOfVisit.getFullYear();
                    }
                    if ($scope.bands){
                        var selectedBands = '';
                        angular.forEach($scope.bands, function (b) {
                            selectedBands += (selectedBands===''?b.title:'+'+b.title);
                        });
                        data.selectedBands = selectedBands;
                    }
                    if($scope.candidate.rbsLocation){
                        var rbsLocation = '';
                        angular.forEach($scope.candidate.rbsLocation, function (l) {
                            if(l.value){
                                rbsLocation += (rbsLocation===''?l.title:', '+l.title);
                            }
                        });
                        data.rbsLocation = rbsLocation;
                    }
                }
                if($scope.cellAntenna){
                    if($scope.cellAntenna.selectedAntennas){
                        var selectedCellAntennas = '';
                        var selectedCellAntennaDimensions = '';
                        var selectedCellAntennaWeight = '';
                        var selectedCellAntennaQuantity = '';
                        var selectedCellAntennaFrequencyBand = '';
                        var selectedCellAntennaAzimuth = '';
                        var selectedCellAntennaSuspensionHeight='';

                        angular.forEach($scope.cellAntenna.selectedAntennas, function (a) {
                            selectedCellAntennas += (selectedCellAntennas===''?a.antenna:', '+a.antenna);
                            if(a.dimension){
                                selectedCellAntennaDimensions += (selectedCellAntennas===''?a.dimension:', '+a.dimension);
                            }
                            if(a.weight){
                                selectedCellAntennaWeight += (selectedCellAntennas===''?a.weight:', '+a.weight);
                            }
                            if (a.quantity) selectedCellAntennaQuantity += (selectedCellAntennas===''?a.quantity:', '+a.quantity);
                            if (a.frequencyBand) selectedCellAntennaFrequencyBand += (selectedCellAntennas===''?a.frequencyBand:', '+a.frequencyBand);
                            if (a.azimuth) selectedCellAntennaAzimuth += (selectedCellAntennas===''?a.azimuth:', '+a.azimuth);
                            if (a.suspensionHeight)  selectedCellAntennaSuspensionHeight += (selectedCellAntennas===''?a.suspensionHeight:', '+a.suspensionHeight);

                        });
                        data.selectedCellAntennas=selectedCellAntennas;
                        data.cellAntennaDimensions=selectedCellAntennaDimensions;
                        data.cellAntennaWeight=selectedCellAntennaWeight;
                        data.cellAntennaQuantity = selectedCellAntennaQuantity;
                        data.cellAntennaFrequencyBand = selectedCellAntennaFrequencyBand;
                        data.cellAntennaSuspensionHeight =selectedCellAntennaSuspensionHeight;
                        data.cellAntennaAzimuth = selectedCellAntennaAzimuth;
                    }

                }
                if($scope.transmissionAntenna){
                    data.transmissionAntennaAntennaType = $scope.transmissionAntenna.antennaType?$scope.transmissionAntenna.antennaType:'';
                    data.transmissionAntennaAntennaQuantity = $scope.transmissionAntenna.antennaQuantity?$scope.transmissionAntenna.antennaQuantity:'';
                    data.transmissionAntennaAntennaFrequencyBand = $scope.transmissionAntenna.frequencyBand?$scope.transmissionAntenna.frequencyBand:'';
                    data.transmissionAntennaAntennaDiameter = $scope.transmissionAntenna.diameter?$scope.transmissionAntenna.diameter:'';
                    data.transmissionAntennaAntennaWeight = $scope.transmissionAntenna.weight?$scope.transmissionAntenna.weight:'';
                    data.transmissionAntennaAntennaSuspensionHeight = $scope.transmissionAntenna.suspensionHeight?$scope.transmissionAntenna.suspensionHeight:'';
                    data.transmissionAntennaAntennaAzimuth = $scope.transmissionAntenna.azimuth?$scope.transmissionAntenna.azimuth:'';
                }
                if($scope.powerSource){
                    data.landlord = $scope.powerSource.provideUs3Phase?$scope.powerSource.provideUs3Phase:'';
                    data.cableLength = $scope.powerSource.cableLength?$scope.powerSource.cableLength:'';
                    data.monthlyPC = $scope.powerSource.agreeToReceiveMonthlyPayment?$scope.powerSource.agreeToReceiveMonthlyPayment:'';
                    data.res4 = $scope.powerSource.closestPublic04?$scope.powerSource.closestPublic04:'';
                    data.res10 = $scope.powerSource.closestPublic10?$scope.powerSource.closestPublic10:'';
                    var cableLayingType = '';
                    angular.forEach($scope.powerSource.cableLayingType, function (t) {
                        if(t.value){
                            cableLayingType += (cableLayingType===''?t.title:', '+t.title);
                        }
                    });
                    data.cableLayingType = cableLayingType;
                }
                if($scope.farEndInformation && $scope.farEndInformation.length > 0){
                    var index = 0;
                    angular.forEach($scope.farEndInformation, function (fe, i) {
                        if(fe.priority === true){
                            index = i;
                        }
                    });

                    data.farEndSitename = $scope.farEndInformation[index].farEndName?$scope.farEndInformation[index].farEndName:'';
                    data.farEndAdress = '';
                    Object.values(scope.leasingCandidate.address).forEach((s, index) => {
                        data.farEndAdress += index > 0 ? ', ' + s : s
                    })
                    $scope.farEndInformation[index].farEndAddress?$scope.farEndInformation[index].farEndAddress:'';
                    data.farEndContact = $scope.farEndInformation[index].contractInformation?$scope.farEndInformation[index].contractInformation:'';
                    data.farEndSquare = $scope.farEndInformation[index].square?$scope.farEndInformation[index].square:'';
                    data.farEndEquipment = $scope.farEndInformation[index].equipmentType?$scope.farEndInformation[index].equipmentType:'';
                    data.farEndAntennasQuantity = $scope.farEndInformation[index].antennasQuantity?$scope.farEndInformation[index].antennasQuantity:'';
                    data.farEndAntennaDiameter = $scope.farEndInformation[index].antennaDiameter?$scope.farEndInformation[index].antennaDiameter:'';
                    //data.farEndTXFrequency = $scope.farEndInformation[index].TXFrequency?$scope.farEndInformation[index].TXFrequency:'';
                    //data.farEndRXFrequency = $scope.farEndInformation[index].RXFrequency?$scope.farEndInformation[index].RXFrequency:'';
                    data.farEndWeight = $scope.farEndInformation[index].weight?$scope.farEndInformation[index].weight:'';
                    data.farEndFrequencyBand = $scope.farEndInformation[index].frequencyBand? $scope.farEndInformation[index].frequencyBand:'';
                    data.farEndSuspensionHeight = $scope.farEndInformation[index].suspensionHeight?$scope.farEndInformation[index].suspensionHeight:'';
                    data.farEndAzimuth = $scope.farEndInformation[index].azimuth?$scope.farEndInformation[index].azimuth:'';
                    data.farEndConstructionType = $scope.farEndInformation[index].constructionType?$scope.farEndInformation[index].constructionType:'';
                    data.farEndComments = $scope.farEndInformation[index].comments?$scope.farEndInformation[index].comments:'';
                    data.farEndResultsOfVisit = $scope.farEndInformation[index].resultsOfVisit?$scope.farEndInformation[index].resultsOfVisit:'';
                    //newFe.surveyDate

                    if($scope.farEndInformation[index].renterCompany){
                        data.farEnleasingCandidatedRcLegalName = $scope.farEndInformation[index].renterCompany.legalName?$scope.farEndInformation[index].renterCompany.legalName:'';
                        data.farEndRcLegalAddress = $scope.farEndInformation[index].renterCompany.legalAddress?$scope.farEndInformation[index].renterCompany.legalAddress:'';
                        data.farEndRcTelFax = $scope.farEndInformation[index].renterCompany.telFax?$scope.farEndInformation[index].renterCompany.telFax:'';
                        data.farEndRcFirstLeaderName = $scope.farEndInformation[index].renterCompany.firstLeaderName?$scope.farEndInformation[index].renterCompany.firstLeaderName:'';
                        data.farEndRcFirstLeaderPosition = $scope.farEndInformation[index].renterCompany.firstLeaderPosition?$scope.farEndInformation[index].renterCompany.firstLeaderPosition:'';
                        data.farEndRcEmail = $scope.farEndInformation[index].renterCompany.email?$scope.farEndInformation[index].renterCompany.email:'';
                        data.farEndRcContactName = $scope.farEndInformation[index].renterCompany.name?$scope.farEndInformation[index].renterCompany.name:'';
                        data.farEndRcContactPosition = $scope.farEndInformation[index].renterCompany.position?$scope.farEndInformation[index].renterCompany.position:'';
                        data.farEndRcContactInformation = $scope.farEndInformation[index].renterCompany.contactInformation?$scope.farEndInformation[index].renterCompany.contactInformation:'';
                    }
                }

                return data;
            }

            $scope.downloadRRfile = function(){
                $http.post('/camunda/leasing/rrfile/create',prepareRRCreatedata()).then(function (res) {
                    $http({
                        method: 'GET',
                        url: '/camunda/uploads/get/' + res.data,
                        transformResponse: []
                    }).then(function (response) {
                        document.getElementById('fileDownloadIframe').src = response.data;
                    }, function(error){
                        console.log(error.data);
                    });
                }, function (error) {
                    console.log(error);
                });
            }

            $scope.defineSiteObjectType = function () {
                if($scope.renterCompany && ($scope.renterCompany.legalType === 'national_kazakhtelecom' || $scope.renterCompany.legalType === 'national_kazteleradio' || $scope.renterCompany.legalType === 'national_kazpost')){
                    $scope.siteObjectType = 'national';
                } else {
                    $scope.siteObjectType = 'other';
                }
                $scope.legalType = $scope.renterCompany.legalType;
            }

            $scope.changeLegalType = function () {
                const finded = $scope.dictionary.legalType.find(e => { return e.id === $scope.renterCompany.legalType})
                if (finded) {
                    if($scope.renterCompany){
                        $scope.renterCompany.legalTypeCatalogId = finded.catalogsId;
                    }
                }
                if ( $scope.renterCompany.legalType === 'national_kazakhtelecom' ) {
                    $scope.renterCompany.legalName = 'АО "Казахтелеком"'
                } else if ( $scope.renterCompany.legalType === 'national_kazteleradio' ) {
                    $scope.renterCompany.legalName = 'АО "Казтелерадио"'
                } else if ( $scope.renterCompany.legalType === 'national_kazpost' ) {
                    $scope.renterCompany.legalName = 'АО "Казпочта"'
                } else {
                    $scope.renterCompany.legalName = ''
                }
            }

            $scope.changeFarEndLegalType = function () {
                if ($scope.currentFarEnd && $scope.currentFarEnd.renterCompany && $scope.currentFarEnd.legalType) {
                    $scope.currentFarEnd.renterCompany.legalName = ''
                    if ( $scope.currentFarEnd.legalType === 'national_kazakhtelecom' ) {
                        $scope.currentFarEnd.renterCompany.legalName = 'АО "Казахтелеком"'
                    } if ( $scope.currentFarEnd.legalType === 'national_kazteleradio' ) {
                        $scope.currentFarEnd.renterCompany.legalName = 'АО "Казтелерадио'
                    } else if ( $scope.currentFarEnd.legalType === 'national_kazpost' ) {
                        $scope.currentFarEnd.renterCompany.legalName = 'АО "Казпочта"'
                    }
                }
            }

            $scope.selectAntennaSector = function (index) {
                //if($scope.renterCompany && ($scope.renterCompany.legalType === 'national_kazakhtelecom' || $scope.renterCompany.legalType === 'national_kazteleradio' || $scope.renterCompany.legalType === 'national_kazpost')){
                //    $scope.siteObjectType = 'national';
                //} else {
                //    $scope.siteObjectType = 'other';
                //}
                $scope.selectedSectorTab = index;
                //$scope.selectedAntennaSector = $scope.cellAntenna.sectors[index];
            }

            $scope.antennaNameSelected = function (sector, antenna, a) {
                const obj = $scope.antennasList.find(b=>{ return b.antenna === a});
                if(obj){
                    console.log("obj>>>>")
                    console.log(obj)
                    $scope.cellAntenna.sectors[sector].antennas[antenna].dimension = obj.dimension;
                    $scope.cellAntenna.sectors[sector].antennas[antenna].weight = obj.weight;
                    $scope.cellAntenna.sectors[sector].antennas[antenna].udb_id = obj.idbid;
                    $scope.cellAntenna.sectors[sector].antennas[antenna].catalog_value_id = obj.catalog_value_id;
                    console.log("<<<<obj")
                }
            }
            $scope.antennaLocationSelected = function (sector, antenna, a) {
                const obj = $scope.dictionary.antennaLocation.find(b=>{ return b.name === a});
                if(obj){
                    console.log("obj>>>>")
                    console.log(obj)
                    $scope.cellAntenna.sectors[sector].antennas[antenna].cn_antenna_loc_catalog_value_id = obj.id;
                    console.log("<<<<obj")
                }
            }



            $scope.checkAntennaBands = function (bandName, sectorIndex) {
                console.log('sectorIndex')
                console.log(sectorIndex)
                if($scope.cellAntenna.sectors) {
                    const s = $scope.cellAntenna.sectors[sectorIndex]

                    const finded = s.antennas.find( a => {
                        if (a.antennaType && a.antennaType[bandName]){
                            return a.antennaType[bandName]
                        }
                    });
                    if (finded) {
                        return false
                    }
                }
                return true
            }

            $scope.changedAntennaQuantity = function (antennaIndex, sectorIndex) {
                const a = $scope.cellAntenna.sectors[sectorIndex].antennas[antennaIndex];
                if (a.antennaType) {
                    Object.keys(a.antennaType).forEach( b => {
                        $scope.countAntennaQuantity(b, sectorIndex)
                    })
                }

            }

            $scope.countAntennaQuantity = function (bandName, sectorIndex) {
                // ant.antennaType[a]
                const s = $scope.cellAntenna.sectors[sectorIndex];
                if ( !s.bands) {
                    s.bands = {};
                }
                if (!s.bands[bandName]) {
                    s.bands[bandName] = {};
                }
                const filtered = s.antennas.filter( a => { return a.antennaType[bandName]});
                if (filtered.length > 0 && s) {
                    if ( !s.bands) {
                        s.bands = {};
                    }
                    if (!s.bands[bandName]) {
                        s.bands[bandName] = {};
                    }
                    s.bands[bandName].cn_gsm_antenna_quantity = 0 ;
                    filtered.forEach( a => {
                        console.log(a)
                        s.bands[bandName].cn_gsm_antenna_quantity += a.quantity ? parseInt(a.quantity) : 0;
                    })
                    // s.bands[bandName].cn_gsm_antenna_quantity = filtered.length;
                    s.bands[bandName].active = true;
                } else {
                    if ( !s.bands) {
                        s.bands = {};
                    }
                    s.bands[bandName] = {};
                    s.bands[bandName].active = false;
                }

                checkAntennaBandsSelected();
            }

            $scope.checkCableTypeSelected =function (){
                if($scope.powerSource.cableLayingType ){
                            var checked = false;
                                    Object.keys($scope.powerSource.cableLayingType).forEach( b => {
                                        if($scope.powerSource.cableLayingType[b].value){
                                            checked = true;
                                        }
                                    });
                          $scope.cableTypeChecked=checked;
                        }


            }
            function checkAntennaBandsSelected(){
                if($scope.cellAntenna && $scope.cellAntenna.sectors){
                    angular.forEach($scope.cellAntenna.sectors, function(sector){
                        if(sector.antennas){
                            angular.forEach(sector.antennas, function(ant){
                                var checked = false;
                                console.log(ant.antennaType);
                                if(ant.antennaType){
                                    Object.keys(ant.antennaType).forEach( b => {
                                        if(ant.antennaType[b]){
                                            checked = true;
                                        }
                                    });
                                }
                                ant.sectorAntennaBandsChecked = checked;
                            });
                        }
                    });
                }
            }

            $scope.tabStepRight = function () {
                if ($scope.selectedSectorTab+1 < $scope.cellAntenna.sectors.length) {
                    $scope.selectedSectorTab = $scope.selectedSectorTab + 1;
                    $scope.cellAntenna.sectors[$scope.selectedSectorTab].active = 'active';

                    if ($scope.selectedSectorTab === $scope.maxTab) {
                        $scope.minTab= $scope.minTab + 1;
                        $scope.maxTab= $scope.maxTab + 1;
                    }
                } else {
                    $scope.cellAntenna.sectors[$scope.selectedSectorTab].active = 'active';
                }
            }

            $scope.tabStepLeft = function () {
                if ($scope.selectedSectorTab-1 >= 0) {
                    $scope.selectedSectorTab = $scope.selectedSectorTab - 1;
                    $scope.cellAntenna.sectors[$scope.selectedSectorTab].active = 'active';

                    if ($scope.selectedSectorTab+1 === $scope.minTab) {
                        $scope.minTab= $scope.minTab - 1;
                        $scope.maxTab= $scope.maxTab - 1;
                    }
                } else {
                    $scope.cellAntenna.sectors[$scope.selectedSectorTab].active = 'active';
                }
            }

            $scope.checkRegExp = function (reString, str) {
                var re = new RegExp('^' + reString + '$');
                return re.test(str);
            }

            $scope.preSubmit = function() {
                var deferred = $q.defer();
                console.log('scope.kcell_form1')
                console.log($scope.kcell_form)
                if ($scope.farEndInformation && $scope.farEndInformation.length > 0) {
                    $scope.farEndInformation.forEach( f => {
                        if (f.fe_longitude && f.fe_latitude && !($scope.checkRegExp($scope.latitudePattern, f.fe_latitude) && $scope.checkRegExp($scope.longitudePattern, f.fe_longitude))) {
                            deferred.reject('Please check Far End latitude and longitude format');
                            return deferred.promise;
                        }
                    })
                    if ($scope.currentFarEnd.farEndName !== $scope.farEndInformation[0].farEndName) {
                        deferred.reject('Please check priority Far End');
                        return deferred.promise;
                    }

                    console.log('$scope.kcell_form2')
                    console.log($scope.kcell_form)
                }
                if($scope.kcell_form.$error && $scope.kcell_form.$error.required && $scope.kcell_form.$error.required.length > 0) {
                    deferred.reject('Please fill required fields');
                    return deferred.promise;
                }
                if(hasBandsNotSelected() && $scope.createNewCandidateSiteTaskResult !== 'NCP cancel required'){
                    deferred.reject('Please select bands in for each cell antennas in sectors');
                    return deferred.promise;
                }

                if($scope.farEndInformation.length < 3 && !$scope.threeFarEndNotNecessary.check && $scope.candidate.transmissionType !== 'Provider' && $scope.candidate.transmissionType !== 'Satellite'  && $scope.createNewCandidateSiteTaskResult !== 'NCP cancel required'){
                    deferred.reject('At least 3 Far End Information should be added!!!');
                    return deferred.promise;
                }

                if ($scope.candidate.siteName && $scope.createNewCandidateSiteTaskResult !== 'NCP cancel required') {
                    let substr = $scope.candidate.siteName.substring(0,5)
                    if ( substr !== $scope.ncpID) {
                        deferred.reject('Invalid sitename value');
                        return deferred.promise;
                    }
                }
                /*
                else {
                    return $http.post('/camunda/leasing/rrfile/create',prepareRRCreatedata()).then(function (result) {
                        console.log(result.data);
                    },
                    function(error){
                        toasty.error(error.data.message);
                    });
                }*/
                var tempLat;
                var tempLong;
                var validLat = true;
                var validLong = true;
                if (validLat && validLong) {
                  deferred.resolve();
                  return deferred.promise;
                }
            };

        function hasBandsNotSelected(){
            var hasBandsNotSelected = false;
            if($scope.cellAntenna && $scope.cellAntenna.sectors){
                angular.forEach($scope.cellAntenna.sectors, function(sector){
                    if(sector.antennas){
                        angular.forEach(sector.antennas, function(ant){
                            var checked = false;
                            if(ant.antennaType){
                                Object.keys(ant.antennaType).forEach( b => {
                                    if(ant.antennaType[b]){
                                        checked = true;
                                    }
                                });
                            }
                            if(!checked){
                                hasBandsNotSelected = true;
                            }
                        });
                    }
                });
            }
            return hasBandsNotSelected;
        }

            $scope.isError = function(block) {
                try {
                    var error = false;
                    if($scope.kcell_form){
                        var keys = Object.keys($scope.kcell_form);
                        var fields = [];
                        if(block === 'candidateInformation') {
                            fields = ['siteName', 'latitude', 'longitude', 'constructionType', 'transmissionType', 'square', 'rbsLocation', 'radio', 'createNewCandidateSiteTaskComment', 'leasingCandidate', 'cn_addr_oblast', 'cn_addr_district', 'cn_addr_city', 'cn_addr_street', 'cn_addr_building', 'cn_addr_cadastral_number', 'cn_addr_note', 'cai_addr_oblast', 'cai_addr_district', 'cai_addr_street', 'cai_addr_building', 'cai_addr_cadastral_number', 'cai_addr_note', 'antennaName', 'quantity_', 'dimensions_', 'frequencyBand_', 'weight_', 'azimuth_', 'suspensionHeight_', 'check_', 'antennaLocation', 'cn_gsm900', 'cn_lte800', 'cn_dcs1800', 'cn_ret_lte800', 'cn_wcdma2100', 'cn_lte1800', 'cn_umts900', 'cn_ret_lte1800', 'cn_trx', 'cn_lte2100', 'cn_wcdma_carrier', 'cn_ret_lte2100', 'cn_gsm_antenna_quantity', 'cn_lte_antenna_quantity', 'cn_tilt_mech_gsm', 'cn_tilt_mech_lte', 'cn_tilt_electr_gsm', 'cn_tilt_electr_lte', 'cn_direction_gsm', 'cn_direction_lte', 'cn_height_gsm', 'cn_height_lte', 'cn_duplex_gsm', 'cn_diversity', 'cn_power_splitter', 'cn_hcu', 'cn_asc', 'cn_ret', 'cn_tma_gsm', 'cn_tcc', 'cn_gsm_range', 'selectedAntennas', 'antennasQuantity', 'address', 'legalType', 'RClegalName', 'legalAddress', 'telFax', 'firstLeaderName', 'firstLeaderPos', 'email', 'contactName', 'position', 'contractInfo', 'antennaType', 'antennaQuantity', 'frequencyBand', 'TRSuspensionHeight', 'TRazimuth', 'provideUs3Phase', 'cableLength', 'cableLayingType', 'agreeToReceiveMonthlyPayment', 'closestPublic04', 'closestPublic10', 'cn_tps', 'cn_tps_belongs', 'cn_tps_belongs_commentary', 'cn_tps_distance'];
                        } else if(block === 'address') {
                            fields = ['cn_addr_oblast' ,'cn_addr_district' ,'cn_addr_city' ,'cn_addr_street' ,'cn_addr_building' ,'cn_addr_cadastral_number' ,'cn_addr_note'];
                        } else if(block === 'cellAntennaInformation'){
                            fields = ['antennaLocation', 'antennaNameInSector_', 'azimuth_', 'cai_addr_building', 'cai_addr_cadastral_number', 'cai_addr_district', 'cai_addr_note', 'cai_addr_oblast', 'cai_addr_street', 'check_', 'cai_addr_city', 'cn_asc', 'cn_dcs1800_', 'cn_direction_gsm_', 'cn_direction_lte_', 'cn_diversity_', 'cn_duplex_gsm_', 'cn_gsm900_', 'cn_gsm_antenna_quantity_', 'cn_gsm_range_', 'cn_hcu_', 'cn_height_gsm_', 'cn_height_lte_', 'cn_lte1800_', 'cn_lte2100_', 'cn_lte800_', 'cn_lte_antenna_quantity_', 'cn_power_splitter_', 'cn_ret_', 'cn_ret_lte1800_', 'cn_ret_lte2100_', 'cn_ret_lte800_', 'cn_tcc_', 'cn_tilt_electr_gsm_', 'cn_tilt_electr_lte_', 'cn_tilt_mech_gsm_', 'cn_tilt_mech_lte_', 'cn_tma_gsm_', 'cn_trx_', 'cn_umts900_', 'cn_wcdma2100_', 'cn_wcdma_carrier_', 'dimensions_', 'dUnit', 'frequencyBand_', 'quantity_', 'radioUnit_', 'suspensionHeight_', 'weight_'];
                        } else if(block === 'renterCompany') {
                            fields = ['legalType', 'RClegalName', 'legalAddress', 'telFax', 'firstLeaderName', 'firstLeaderPos', 'email', 'contactName', 'position', 'contractInfo'];
                        } else if(block === 'nearEndInformation') {
                            fields = ['antennaType', 'antennaQuantity', 'frequencyBand', 'TRSuspensionHeight', 'TRazimuth', 'nei_addr_oblast', 'nei_addr_district', 'nei_addr_city', 'nei_addr_street', 'nei_addr_building', 'nei_addr_cadastral_number', 'nei_addr_note'];
                        } else if(block === 'powerSource') {
                            fields = ['agreeToReceiveMonthlyPayment', 'cableLength', 'closestPublic04', 'closestPublic10', 'cn_tps', 'cn_tps_belongs', 'cn_tps_belongs_commentary', 'cn_tps_distance', 'provideUs3Phase'];
                        } else if(block === 'farEndInformation') {
                            fields = ['farEndName', 'threeFarEndNotNecessaryCheck', 'threeFarEndNotNecessaryCheckComment', 'fe_form_contractInformation', 'fe_form_equipmentType', 'fe_form_FarEnd_cn_addr_building', 'fe_form_FarEnd_cn_addr_cadastral_number', 'fe_form_FarEnd_cn_addr_district', 'fe_form_FarEnd_cn_addr_note', 'fe_form_FarEnd_cn_addr_oblast', 'fe_form_FarEnd_cn_addr_street', 'fe_form_FarEnd_n_addr_city', 'fe_form_farEndAddress', 'fe_form_farEndLegalType', 'fe_form_FeAntennasQuantity', 'fe_form_feAntennaType', 'fe_form_FeAzimuth', 'fe_form_FeComments', 'fe_form_FeConstructionType', 'fe_form_FeDiameter', 'fe_form_FeFrequencyBand', 'fe_form_FERC_ContractInformation', 'fe_form_FERC_Name', 'fe_form_FERC_Position', 'fe_form_FERCemail', 'fe_form_FERCFirstLeaderName', 'fe_form_FERCFirstLeaderPosition', 'fe_form_FERCLegalAddress', 'fe_form_FERClegalName', 'fe_form_FERCTelFax', 'fe_form_FeSquare', 'fe_form_FeSuspensionHeight', 'fe_form_FeWeight', 'fe_form_ResultsOfVisit', 'fe_form_surveyDate'];
                        } else if(block === 'farEndInformationAccordion') {
                            fields = ['fe_form_contractInformation', 'fe_form_equipmentType', 'fe_form_FarEnd_cn_addr_building', 'fe_form_FarEnd_cn_addr_cadastral_number', 'fe_form_FarEnd_cn_addr_district', 'fe_form_FarEnd_cn_addr_note', 'fe_form_FarEnd_cn_addr_oblast', 'fe_form_FarEnd_cn_addr_street', 'fe_form_FarEnd_n_addr_city', 'fe_form_farEndAddress', 'fe_form_farEndLegalType', 'fe_form_FeAntennasQuantity', 'fe_form_feAntennaType', 'fe_form_FeAzimuth', 'fe_form_FeComments', 'fe_form_FeConstructionType', 'fe_form_FeDiameter', 'fe_form_FeFrequencyBand', 'fe_form_FERC_ContractInformation', 'fe_form_FERC_Name', 'fe_form_FERC_Position', 'fe_form_FERCemail', 'fe_form_FERCFirstLeaderName', 'fe_form_FERCFirstLeaderPosition', 'fe_form_FERCLegalAddress', 'fe_form_FERClegalName', 'fe_form_FERCTelFax', 'fe_form_FeSquare', 'fe_form_FeSuspensionHeight', 'fe_form_FeWeight', 'fe_form_ResultsOfVisit', 'fe_form_surveyDate'];
                        } else if(block === 'farEndAddress') {
                            fields = ['fe_form_FarEnd_cn_addr_oblast', 'fe_form_FarEnd_cn_addr_district', 'fe_form_FarEnd_n_addr_city', 'fe_form_FarEnd_cn_addr_street', 'fe_form_FarEnd_cn_addr_building', 'fe_form_FarEnd_cn_addr_cadastral_number', 'fe_form_FarEnd_cn_addr_note'];
                        } else if(block === 'transmissionInfo') {
                            fields = ['channelCapacity', 'nei_addr_oblast', 'ne_longitude', 'ne_latitude', 'nei_addr_building', 'nei_addr_note', 'nei_addr_street'];
                        } else if(block === 'nearEndAddress') {
                            fields = ['nei_addr_oblast', 'ne_longitude', 'ne_latitude', 'nei_addr_building', 'nei_addr_note', 'nei_addr_street'];
                        } else if(block === 'cellAntennaAddress') {
                            fields = ['cai_addr_oblast', 'cai_addr_building', 'cai_addr_note', 'cai_addr_street'];
                        }
                        keys.forEach(function (key) {
                            if (!key.startsWith('$')) {
                                fields.forEach(function (field) {
                                    if(block === 'nearEndInformation'){
                                        if (key === field) {
                                            if ($scope.kcell_form[key].$error) {
                                                error = error || ($scope.kcell_form[key].$error.required && ($scope.kcell_form[key].$touched || $scope.view.submitted));
                                            }
                                        }
                                    } else {
                                        if (key.startsWith(field)) {
                                            if ($scope.kcell_form[key].$error) {
                                                error = error || ($scope.kcell_form[key].$error.required && ($scope.kcell_form[key].$touched || $scope.view.submitted));
                                            }
                                        }
                                        if(block === 'cellAntennaInformation'){
                                            error = error || (hasBandsNotSelected() && $scope.view.submitted && $scope.createNewCandidateSiteTaskResult !== 'NCP cancel required');
                                        }
                                    }
                                });
                            }
                        });
                    }
                    return error;
                } catch (e) {
                    console.log(e);
                }
                return false;
            }
        }]);
    </script>
    <div class="form-group">
        <label class="col-sm-12 control-label">
            <p/> <b>Business key: </b>{{businessKey}}
        </label>
    </div>
    <leasing-detail leasing-info="leasingInfo"></leasing-detail>
    <tabset class="my-tab-head my-tab" justified="true" id="jobRequestId">
        <tab>
            <tab-heading ng-class="{'error' : isError('candidateInformation')}"><span class="glyphicon glyphicon-check"></span> Candidate Information</tab-heading>
            <div class="col-sm-12">
                <br>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Sitename:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="siteName" name="siteName" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                               ng-model="candidate.siteName">
                        <label class="error"
                               ng-show="kcell_form.siteName.$error.required && ( kcell_form.siteName.$touched || view.submitted)">Required
                            field</label>
                    </div>

                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Site type:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="siteType" name="siteType" disabled
                               ng-model="siteType.name">
                        <label class="error"
                               ng-show="kcell_form.siteName.$error.required && ( kcell_form.siteType.$touched || view.submitted)">Required
                            field</label>
                    </div>

                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Date of visit:</label>
                    <div class="col-sm-5">
                        <div class="input-group">
                            <input type="text" ng-model="candidate.dateOfVisit" name="dateOfVisit" class="form-control"
                                   datepicker-popup="dd.MM.yyyy" is-open="dateOfVisitFieldOpened" id="dateOfVisit" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"/>
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="dateOfVisitFieldOpened = true">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                        <label class="error"
                               ng-show="kcell_form.dateOfVisit.$error.required && ( kcell_form.dateOfVisit.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Latitude, N:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="latitude" name="latitude" ng-pattern="latitudePattern" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                               ng-model="candidate.latitude" maxlength="11">
                        <label class="error"
                               ng-show="kcell_form.latitude.$error.required && ( kcell_form.latitude.$touched || view.submitted)">Required
                            field</label>
                        <label class="error"
                               ng-if="kcell_form.latitude.$error.pattern && ( kcell_form.latitude.$touched || view.submitted)">Expected: 40.568000 <- Latitude <- 55.440000</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Longitude, E:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="longitude" name="longitude" ng-pattern="longitudePattern"  ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                               ng-model="candidate.longitude" maxlength="11">
                        <label class="error"
                               ng-show="kcell_form.longitude.$error.required && ( kcell_form.longitude.$touched || view.submitted)">Required
                            field</label>
                        <label class="error"
                               ng-if="kcell_form.longitude.$error.pattern && ( kcell_form.longitude.$touched || view.submitted)">Expected: 46.493000 <- Longitude <- 87.315000</label>

                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Altitude</label>
                    <div class="col-sm-5">
                        <input type="number" class="form-control" id="cn_altitude" name="cn_altitude"
                               ng-model="candidate.cn_altitude" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                        <label class="error"
                               ng-show="kcell_form.cn_altitude.$error.required && ( kcell_form.cn_altitude.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Сonstruction type:</label>
                    <div class="col-sm-5">
                        <select class="form-control" id="constructionType" name="constructionType"
                                ng-model="candidate.constructionType"
                                ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                            <option ng-repeat="c in dictionary.constructionType" ng-value="c">{{c.name}}</option>
                        </select>
                        <label class="error"
                               ng-show="kcell_form.constructionType.$error.required && ( kcell_form.constructionType.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Transmission type:</label>
                    <div class="col-sm-5">
                        <select class="form-control" id="transmissionType" name="transmissionType"
                                ng-model="candidate.transmissionType" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'" ng-selected="transmissionTypeChanged()">
                            <option ng-repeat="c in dictionary.transmissionType" value="{{c.name}}">{{c.name}}</option>
                        </select>
                        <label class="error" ng-show="kcell_form.transmissionType.$error.required && ( kcell_form.transmissionType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*BCS/RNC:</label>
                    <div class="col-sm-5">
                        <input type="text" name="candidateBsc" ng-model="candidate.bscSelectedName"
                               typeahead="s.name as s.name for s in getFilteredBSC($viewValue)" class="form-control"
                               typeahead-on-select="candidate.bsc = $item"
                               placeholder="Start typing..." ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                        <label class="error"
                               ng-show="kcell_form.candidateBsc.$error.required && ( kcell_form.candidateBsc.$touched || view.submitted)">Required
                            field</label>
                        <label class="error"
                               ng-show="!kcell_form.candidateBsc.$error.required && createNewCandidateSiteTaskResult !== 'NCP cancel required' && !candidate.bsc.name && ( kcell_form.candidateBsc.$touched || view.submitted)">Please select from list</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Square:</label>
                    <div class="col-sm-5">
                        <input type="number" class="form-control" id="square" name="square" ng-model="candidate.square"
                               ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                        <label class="error"
                               ng-show="kcell_form.square.$error.required && ( kcell_form.square.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*RBS Type:</label>
                    <div class="col-sm-8">
                        {{candidate.rbsType}}
                        <label class="error"
                               ng-show="kcell_form.rbsType.$error.required && ( kcell_form.rbsType.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Band:</label>
                    <div class="col-sm-8">
                        <span ng-repeat="band in bands">{{$index == 0?' ': ' + ' }}{{band.title}}</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">*RBS Location:</label>
                    <div class="col-sm-6">
                        <!-- <div class="form-check" style="display:inline-block; padding:0 !important; margin-right: 10px;" -->
                        <!-- ng-repeat="l in candidate.rbsLocation track by $index"> -->
                        <!-- <input type="checkbox" name="rbsLocation" ng-required="rbsLocationChecked < 1" -->
                        <!-- ng-click="checkRbsLocation($index, l.value)" ng-model="l.value" -->
                        <!-- class="form-check-input" id="{{'check' + $index}}"> -->
                        <!-- <label class="form-check-label" for="{{'check' + $index}}">{{ l.title }}</label> -->
                        <!-- </div> -->

                        <label class="form-check" ng-repeat="rl in dictionary.rbsLocation" style="display:inline-block; padding:0 !important; margin-right: 10px;"><input type="radio" name="rbsLocation" ng-value="rl" ng-model="candidate.rbsLocation" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">{{rl.title}}</label>
<!--                        <label class="form-check" style="display:inline-block; padding:0 !important; margin-right: 10px;"><input type="radio" name="rbsLocation" ng-value="{title:'Container', value:true, id:6}" ng-checked="candidate.rbsLocation.title == 'Container'" ng-model="candidate.rbsLocation" required>Container</label>-->
<!--                        <label class="form-check" style="display:inline-block; padding:0 !important; margin-right: 10px;"><input type="radio" name="rbsLocation" ng-value="{title:'Other', value:true, id:7}" ng-checked="candidate.rbsLocation.title == 'Other'" ng-model="candidate.rbsLocation" required>Other</label>-->
<!--                        <label class="form-check" style="display:inline-block; padding:0 !important; margin-right: 10px;"><input type="radio" name="rbsLocation" ng-value="{title:'Outdoor', value:true, id:8}" ng-checked="candidate.rbsLocation.title == 'Outdoor'" ng-model="candidate.rbsLocation" required>Outdoor</label>-->
                        <label class="error" ng-show="kcell_form.rbsLocation.$error.required && ( checkRbsLocationTouched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Height of construction</label>
                    <div class="col-sm-5">
                        <input type="number" class="form-control" id="cn_height_constr" name="cn_height_constr"
                               ng-model="candidate.cn_height_constr">
                    </div>
                </div>
                <div class="form-group" style="margin-bottom:15px;">
                    <label class="col-sm-3 control-label">Comments:</label>
                    <div class="col-sm-5">
                        <textarea class="form-control" ng-model="createNewCandidateSiteTaskComment"
                                  name="createNewCandidateSiteTaskComment" placeholder="Comments..." maxlength="500"
                                  rows="4" style="resize:none" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && candidate.rbsLocation.title == 'Other'"></textarea>
                        <label class="error"
                               ng-show="kcell_form.createNewCandidateSiteTaskComment.$error.required && ( kcell_form.createNewCandidateSiteTaskComment.$touched || view.submitted || candidate.rbsLocation.title == 'Other')">Required
                            field</label>
                    </div>
                </div>
                <accordion class="content-visible-accordion background-yellow-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            <span ng-class="{'error' : isError('address')}">Address <i class="pull-right glyphicon"
                                                                                       ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                        </accordion-heading>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{(address.cn_addr_city === 'г. Нур-Султан' || address.cn_addr_city === 'г. Алматы' || address.cn_addr_city === 'г. Шымкент') ? '' : '*'}}Oblast:</label>
                            <div class="col-sm-8" class="form-check">
                                <select class="form-control" id="cn_addr_oblast" name="cn_addr_oblast" ng-model="address.cn_addr_oblast" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                                        ng-change="filterDistrictAfterSelectObl(address.cn_addr_oblast)">
                                    <option ng-repeat="oblast in oblastList" ng-value="oblast.name">{{oblast.name}}</option>
                                </select>
                                <label class="error" ng-show="kcell_form.cn_addr_oblast.$error.required && ( cn_addr_oblast || view.submitted )">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">District:</label>
                            <div class="col-sm-8" class="form-check">
                                <select class="form-control" id="cn_addr_district" name="cn_addr_district" ng-model="address.cn_addr_district" ng-disabled="!address.cn_addr_oblast">
                                    <option ng-repeat="district in filteredDistricts" ng-value="district.name">{{district.name}}</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">City / Village:</label>
                            <div class="col-sm-8">
                                <input type="text" ng-model="address.cn_addr_city" name="cn_addr_city" typeahead="city as city.name for city in getCity($viewValue)" typeahead-on-select="addressCitySelected($item,$model,$label)" class="form-control" placeholder="Start typing...">
                                <input type="hidden"  ng-model="address.cn_addr_city_id" name="cn_addr_city_id" />
                                <label class="error" ng-show="kcell_form.cn_addr_city.$error.required && ( kcell_form.cn_addr_city.$touched || view.submitted)">Required field</label>
                                <label class="error" ng-if="kcell_form.cn_addr_city_id.$error.required && ( kcell_form.cn_addr_city.$touched || view.submitted)">Необходимо выбрать населенный пункт из списка</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-12">
                                <div class="form-check">
                                    <input type="checkbox" ng-model="address.ca_not_full_addres" class="form-check-input" id="ca_not_full_addres">
                                    <label class="form-check-label" for="ca_not_full_addres">Object without address</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{!address.ca_not_full_addres ? '*' : ''}}Street/Microdistrict:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_street" name="cn_addr_street" ng-model="address.cn_addr_street" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && !address.ca_not_full_addres" ng-disabled="address.ca_not_full_addres">
                                <label class="error" ng-show="kcell_form.cn_addr_street.$error.required && ( kcell_form.cn_addr_street.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{!address.ca_not_full_addres ? '*' : ''}}Building:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_building" name="cn_addr_building" ng-model="address.cn_addr_building" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && !address.ca_not_full_addres" ng-disabled="address.ca_not_full_addres">
                                <label class="error" ng-show="kcell_form.cn_addr_building.$error.required && ( kcell_form.cn_addr_building.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Cadastral number:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_cadastral_number" name="cn_addr_cadastral_number" ng-model="address.cn_addr_cadastral_number">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{address.ca_not_full_addres ? '*' : ''}}Note to the address:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_note" name="cn_addr_note" ng-model="address.cn_addr_note" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && address.ca_not_full_addres">
                                <label class="error" ng-show="kcell_form.cn_addr_note.$error.required && ( kcell_form.cn_addr_note.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                    </accordion-group>
                </accordion>

                <accordion class="content-visible-accordion background-yellow-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            <span ng-class="{'error' : isError('cellAntennaInformation')}">Cell antenna information<i class="pull-right glyphicon"
                                                                                                                      ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                        </accordion-heading>
                        <br>
                        <div class="form-group col-sm-3">
                            <div class="col-sm-12">
                                <div class="form-check">
                                    <input type="checkbox" ng-model="cellAntenna.address.ca_diff_address" ng-change="cellAntennaDiffAddressChecked(cellAntenna.address.ca_diff_address)" class="form-check-input" id="check1">
                                    <label class="form-check-label" for="check1">Different address</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-9">
                            <accordion class="content-visible-accordion">
                                <accordion-group is-open="false" >
                                    <accordion-heading>
                                        <span ng-class="{'error' : isError('cellAntennaAddress')}">Cell Antenna Address <i class="pull-right glyphicon"
                                                                                                                       ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                                    </accordion-heading>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{cellAntenna.address.ca_diff_address ? '*' : ''}}Oblast:</label>
                                        <div class="col-sm-8" class="form-check">
                                            <select class="form-control" id="cai_addr_oblast" ng-disabled="!cellAntenna.address.ca_diff_address" name="cai_addr_oblast" ng-model="cellAntenna.address.cn_addr_oblast"
                                                    ng-change="filterDistrictAfterSelectOblInCAI(cellAntenna.address.cn_addr_oblast)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && cellAntenna.address.ca_diff_address">
                                                <option ng-repeat="oblast in oblastList" ng-value="oblast.name">{{oblast.name}}</option>
                                            </select>
                                            <label class="error" ng-show="kcell_form.cai_addr_oblast.$error.required && ( kcell_form.cai_addr_oblast.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">District:</label>
                                        <div class="col-sm-8" class="form-check">
                                            <select class="form-control" id="cai_addr_district" ng-disabled="!cellAntenna.address.ca_diff_address || !cellAntenna.address.cn_addr_oblast" name="cai_addr_district" ng-model="cellAntenna.address.cn_addr_district">
                                                <option ng-repeat="district in filteredDistrictsInCAI" ng-value="district.name">{{district.name}}</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">City / Village:</label>
                                        <div class="col-sm-8">
                                            <input type="text" ng-model="cellAntenna.address.cn_addr_city" name="cai_addr_city" ng-disabled="!cellAntenna.address.ca_diff_address" typeahead="city.name for city in getCity($viewValue)" typeahead-on-select="cellInfoAddressCitySelected($item,$model,$label)" class="form-control" placeholder="Start typing...">
                                            <label class="error" ng-show="kcell_form.cai_addr_city.$error.required && ( kcell_form.cai_addr_city.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-12">
                                            <div class="form-check">
                                                <input type="checkbox" ng-model="cellAntenna.address.cn_not_full_addres" class="form-check-input" ng-disabled="!cellAntenna.address.ca_diff_address" id="cell_antenna_not_full_addres">
                                                <label class="form-check-label" for="cell_antenna_not_full_addres">Object without address</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{(cellAntenna.address.ca_diff_address && !cellAntenna.address.cn_not_full_addres) ? '*' : ''}}Street/Microdistrict:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cai_addr_street" name="cai_addr_street" ng-model="cellAntenna.address.cn_addr_street"
                                                   ng-disabled="!cellAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && cellAntenna.address.ca_diff_address && !cellAntenna.address.cn_not_full_addres"
                                            >
                                            <label class="error" ng-show="kcell_form.cai_addr_street.$error.required && ( kcell_form.cai_addr_street.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{(cellAntenna.address.ca_diff_address && !cellAntenna.address.cn_not_full_addres) ? '*' : ''}}Building:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cai_addr_building" name="cai_addr_building" ng-model="cellAntenna.address.cn_addr_building"
                                                   ng-disabled="!cellAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && cellAntenna.address.ca_diff_address && !cellAntenna.address.cn_not_full_addres"
                                            >
                                            <label class="error" ng-show="kcell_form.cai_addr_building.$error.required && ( kcell_form.cai_addr_building.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Cadastral number:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cai_addr_cadastral_number" name="cai_addr_cadastral_number" ng-model="cellAntenna.address.cn_addr_cadastral_number" ng-disabled="!cellAntenna.address.ca_diff_address">
                                            <label class="error" ng-show="kcell_form.cai_addr_cadastral_number.$error.required && ( kcell_form.cn_addr_cadastral_number.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{(cellAntenna.address.ca_diff_address && cellAntenna.address.cn_not_full_addres) ? '*' : ''}}Note to the address:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cai_addr_note" name="cai_addr_note" ng-model="cellAntenna.address.cn_addr_note"
                                                   ng-disabled="!cellAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && cellAntenna.address.ca_diff_address && cellAntenna.address.cn_not_full_addres">
                                            <label class="error" ng-show="kcell_form.cai_addr_note.$error.required && ( kcell_form.cai_addr_note.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                </accordion-group>
                            </accordion>
                        </div>
                        <div class="form-group">
                            <!--                            <div class="col-sm-12">-->
                            <!--                                <p>cellAntenna.cn_du: {{cellAntenna.cn_du}}</p>-->
                            <!--                                <p>caDUforAdd: {{caDUforAdd}}</p>cellAntenna.cn_du-->
                            <!--                            </div>-->
                            <label class="col-sm-2 control-label">DU type:</label>
                            <div class="col-sm-2">
                                <select class="form-control col-sm-2" id="dUnit" name="dUnit" ng-model="caDUforAdd" >
                                    <option ng-repeat="a in dictionary.dUnit" ng-value="a">{{a.name}}</option>
                                </select>
                            </div>
                            <div class="col-sm-8">
                                <input type="button" ng-disabled="!caDUforAdd || caDUforAdd === ''" ng-click="cellAntenna.cn_du.push(caDUforAdd); caDUforAdd=''; " value="Add to list" class="btn btn-primary">
                            </div>
                            <label class="col-sm-2 control-label">DU type list ({{cellAntenna.cn_du ? cellAntenna.cn_du.length : 0}}):</label>
                            <div class="col-sm-10" stydimensionle="margin-top: 5px">
                                <p>
                                    <span style="margin-right: 5px; margin-top: 5px" class="label label-warning" ng-repeat="du in cellAntenna.cn_du track by $index" ng-show="du">
                                        {{ du.name }} <a ng-click="cellAntenna.cn_du.splice($index, 1)">x</a>
                                    </span>
                                </p>
                            </div>
                        </div>
                        <tabset class="my-tab" justified="true" id="cellAntenna.sectors" >
                            <tab ng-click="tabStepLeft()">
                                <tab-heading height="50px"><b><</b></tab-heading>
                            </tab>
                            <tab ng-repeat="(tabIndex, s) in cellAntenna.sectors" id="sectorTab{{$index}} " ng-click="selectAntennaSector($index)" ng-show="$index >= minTab && $index < maxTab" active="s.active">
                                <tab-heading>
                                    <div>
                                        <p>Sector&nbsp;{{$index+1}}-Cell&nbsp;{{alphabet[$index].toUpperCase()}}
                                            <a ng-click="cellAntenna.sectors.splice($index,1); tabStepLeft();" class="pull-right"><span class="glyphicon glyphicon-remove"></span></a></p>
                                    </div>
                                </tab-heading>
                                <br>
                                <div class="col-sm-12">
                                    <div class="form-group" ng-repeat="(antennaInd, ant) in s.antennas">
                                        <div class="row" style="margin-top:10px">
                                            <br>
                                            <div style="background-color: whitesmoke;" class="col-sm-12">
                                                <label class="control-label"><b>Cell Antenna {{$index+1}}</b></label>
                                                <a ng-click="s.antennas.splice($index,1)" class="pull-right">
                                                    <span style="margin-top: 5px" class="glyphicon glyphicon-remove"></span>
                                                </a>
                                            </div>
                                            <div class="col-sm-12" style="background-color: white;">
                                                <br>
                                                <table class="table table-condensed">
                                                    <thead>
                                                    <tr>
                                                        <td>*Antenna name:</td>
                                                        <td class="col-sm-1">*Quantity:</td>
                                                        <td>*Dimensions:</td>
                                                        <td class="col-sm-1">*Weight (kg):</td>
                                                        <td class="col-sm-1">*Azimuth:</td>
                                                        <td>*Suspension height (m):</td>
                                                        <td>*Antenna Location:</td>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <td class="col-sm-3">
                                                            <select class="form-control" id="antennaNameInSector_{{$parent.$index}}_{{$index}}" name="antennaNameInSector_{{$parent.$index}}_{{$index}}" ng-change="antennaNameSelected($parent.$index, $index, ant.antennaName)" ng-model="ant.antennaName"  ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                                                <option ng-repeat="a in antennasList" ng-value="a.antenna">{{a.antenna}}</option>
                                                            </select>
                                                            <label class="error" ng-show="kcell_form.antennaNameInSector_{{$parent.$index}}_{{$index}}.$error.required && ( kcell_form.antennaNameInSector_{{$parent.$index}}_{{$index}}.$touched || view.submitted)">Required field</label>
                                                        </td>
                                                        <td class="col-sm-1">
                                                            <input type="number" ng-change="changedAntennaQuantity($index, $parent.$index)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'" class="form-control" id="quantity_{{$parent.$index}}_{{$index}}"
                                                                   name="quantity_{{$parent.$index}}_{{$index}}" ng-model="ant.quantity" placeholder="">
                                                            <label class="error"
                                                                   ng-show="kcell_form.quantity_{{$parent.$index}}_{{$index}}.$error.required && ( kcell_form.quantity_{{$parent.$index}}_{{$index}}.$touched || view.submitted)">Required
                                                                field</label>

                                                        </td>
                                                        <td class="col-sm-2">
                                                            <input class="form-control" id="dimensions_{{$parent.$index}}_{{$index}}"
                                                                   name="dimensions_{{$parent.$index}}_{{$index}}" ng-model="ant.dimension"
                                                                   placeholder="1000x100x100" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                                            <label class="error"
                                                                   ng-show="kcell_form.dimensions_{{$parent.$index}}_{{$index}}.$error.required && ( kcell_form.dimensions_{{$parent.$index}}_{{$index}}.$touched || view.submitted)">Required
                                                                field</label>
                                                        </td>
                                                        <td>
                                                            <input class="form-control" id="weight_{{$parent.$index}}_{{$index}}" name="weight_{{$parent.$index}}_{{$index}}"
                                                                   ng-model="ant.weight" placeholder="10" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                                            <label class="error"
                                                                   ng-show="kcell_form.weight_{{$parent.$index}}_{{$index}}.$error.required && ( kcell_form.weight_{{$parent.$index}}_{{$index}}.$touched || view.submitted)">Required
                                                                field</label>

                                                        </td>
                                                        <td class="col-sm-1">
                                                            <input class="form-control" id="azimuth_{{$parent.$index}}_{{$index}}"
                                                                   name="azimuth_{{$parent.$index}}_{{$index}}" type="number"
                                                                   ng-change="checkAzimuth(ant.azimuth, $index)" ng-model="ant.azimuth"
                                                                   ng-pattern="azimuthPattern"
                                                                   placeholder="(0-360)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                                            <label class="error"
                                                                   ng-show="kcell_form.azimuth_{{$parent.$index}}_{{$index}}.$error.pattern && ( kcell_form.azimuth_{{$parent.$index}}_{{$index}}.$touched || view.submitted)">Неверный формат</label>
                                                            <label class="error"
                                                                   ng-show="kcell_form.azimuth_{{$parent.$index}}_{{$index}}.$error.required && ( kcell_form.azimuth_{{$parent.$index}}_{{$index}}.$touched || view.submitted)">Required
                                                                field</label>
                                                        </td>
                                                        <td class="col-sm-2">
                                                            <input class="form-control" id="suspensionHeight_{{$parent.$index}}_{{$index}}"
                                                                   name="suspensionHeight_{{$parent.$index}}_{{$index}}" ng-model="ant.suspensionHeight"
                                                                   placeholder="" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                                            <label class="error"
                                                                   ng-show="kcell_form.suspensionHeight_{{$parent.$index}}_{{$index}}.$error.required && ( kcell_form.suspensionHeight_{{$parent.$index}}_{{$index}}.$touched || view.submitted)">Required
                                                                field</label>
                                                        </td>
                                                        <td class="col-sm-2">
                                                            <select class="form-control" name="{{'antennaLocation_' + $parent.$index + '_' + $index}}" id="{{'antennaLocation_' + $parent.$index + '_' + $index}}" ng-model="ant.cn_antenna_loc" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'" ng-change="antennaLocationSelected($parent.$index, $index, ant.cn_antenna_loc)">
                                                                <option ng-repeat="a in dictionary.antennaLocation" ng-value="a.name">{{a.name}}</option>
                                                            </select>
                                                            <label class="error" ng-show="kcell_form.{{'antennaLocation_' + $parent.$index + '_' + $index}}.$error.required && ( kcell_form.{{'antennaLocation_' + $parent.$index + '_' + $index}}.$touched || view.submitted)">Required field</label>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                                <div class="form-group col-sm-12" style="background-color: white;">
                                                    <table>
                                                        <tbody>
                                                        <tr>
                                                            <td class="col-sm-3">
                                                                <label><b>*Antenna type</b></label>
                                                            </td>
                                                            <td  ng-repeat="(locIndex, a) in filteredAntennaTypesBySiteType" style="padding-right: 10px">
                                                                <div class="form-check">
                                                                    <input type="checkbox" ng-change="countAntennaQuantity(a, $parent.$parent.$index, ant)" ng-model="ant.antennaType[a]" class="form-check-input" name="{{'antennaType_check_' + tabIndex + '_' + antennaInd + '_' + locIndex}}" id="{{'antennaType_check_' + tabIndex + '_' + antennaInd + '_' + locIndex}}" >
                                                                    <label class="form-check-label" for="{{'antennaType_check_' + tabIndex + '_' + antennaInd + '_' + locIndex}}">{{a}}</label>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td></td>
                                                            <td colspan="filteredAntennaTypesBySiteType.length">
                                                                <label class="error" ng-show="!ant.sectorAntennaBandsChecked && view.submitted && createNewCandidateSiteTaskResult !== 'NCP cancel required'">Required field</label>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <br>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="col-sm-12" style=" margin-bottom: 15px">
                                        <input type="button" ng-click="s.antennas.push({})" value="Add Cell Antenna" class="btn btn-primary pull-right">
                                    </div>
                                    <br>
                                    <div class="col-sm-12">
                                        <table class="table table-condensed">
                                            <tbody>
                                            <tr>
                                                <td>Band:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">{{a.name}}</td>
                                            </tr>
                                            <tr>
                                                <td>Antenna Quantity:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <input ng-disabled="true" class="form-control" type="text" name="cn_gsm_antenna_quantity_{{$parent.$parent.$index}}_{{a.name}}" id="cn_gsm_antenna_quantity_{{$parent.$parent.$index}}_{{a.name}}"
                                                           ng-model="s.bands[a.name].cn_gsm_antenna_quantity">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Required TRX:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <input class="form-control" ng-disabled="!s.bands[a.name].active || (a.name !== 'G900' && a.name !== 'G1800')" type="text" name="cn_trx_{{$parent.$parent.$index}}_{{a.name}}" id="cn_trx_{{$parent.$parent.$index}}_{{a.name}}"
                                                           ng-model="s.bands[a.name].cn_trx">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>WCDMA Carrier:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <input ng-disabled="!s.bands[a.name].active || (a.name !== 'U900' && a.name !== 'U1800')" class="form-control" type="text" name="cn_wcdma_carrier_{{$parent.$parent.$index}}_{{a.name}}" id="cn_wcdma_carrier_{{$parent.$parent.$index}}_{{a.name}}"
                                                           ng-model="s.bands[a.name].cn_wcdma_carrier">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Tilt [deg] mechanical:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <input class="form-control" ng-disabled="!s.bands[a.name].active" type="text" name="cn_tilt_mech_{{$parent.$parent.$index}}_{{a.name}}" id="cn_tilt_mech_{{$parent.$parent.$index}}_{{a.name}}"
                                                           ng-model="s.bands[a.name].cn_tilt_mech">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Tilt [deg] electrical:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <input class="form-control" ng-disabled="!s.bands[a.name].active" type="text" name="cn_tilt_electr_{{$parent.$parent.$index}}_{{a.name}}" id="cn_tilt_electr_{{$parent.$parent.$index}}_{{a.name}}"
                                                           ng-model="s.bands[a.name].cn_tilt_electr">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Direction [deg:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <input class="form-control" ng-disabled="!s.bands[a.name].active" type="text" name="cn_direction_{{$parent.$parent.$index}}_{{a.name}}" id="cn_direction_{{$parent.$parent.$index}}_{{a.name}}"
                                                           ng-model="s.bands[a.name].cn_direction">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Height (top of ant) [m]:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <input class="form-control" ng-disabled="!s.bands[a.name].active" type="text" name="cn_height_{{$parent.$parent.$index}}_{{a.name}}" id="cn_height_{{$parent.$parent.$index}}_{{a.name}}"
                                                           ng-model="s.bands[a.name].cn_height">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Duplex Filter:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active" ng-model="s.bands[a.name].cn_duplex" class="form-check-input" id="cn_duplex_{{$parent.$parent.$index}}_{{a.name}}" name="cn_duplex_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_duplex_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Diversity:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active" ng-model="s.bands[a.name].cn_diversity" class="form-check-input" id="cn_diversity_{{$parent.$parent.$index}}_{{a.name}}" name="cn_diversity_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_diversity_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Power Splitter:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active" ng-model="s.bands[a.name].cn_power_splitter" class="form-check-input" id="cn_power_splitter_{{$parent.$parent.$index}}_{{a.name}}" name="cn_power_splitter_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_power_splitter_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Hybrid Combiner Unit:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active" ng-model="s.bands[a.name].cn_hcu" class="form-check-input" id="cn_hcu_{{$parent.$parent.$index}}_{{a.name}}" name="cn_hcu_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_hcu_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>ASC:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active" ng-model="s.bands[a.name].cn_asc" class="form-check-input" id="cn_asc_{{$parent.$parent.$index}}_{{a.name}}" name="cn_asc_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_asc_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Remote Electrical Tilt:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active" ng-model="s.bands[a.name].cn_ret" class="form-check-input" id="cn_ret_{{$parent.$parent.$index}}_{{a.name}}" name="cn_ret_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_ret_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>TMA:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active" ng-model="s.bands[a.name].cn_tma" class="form-check-input" id="cn_tma_{{$parent.$parent.$index}}_{{a.name}}" name="cn_tma_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_tma_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>TCC:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active || (a.name !== 'G900' && a.name !== 'G1800')" ng-model="s.bands[a.name].cn_tcc" class="form-check-input" id="cn_tcc_{{$parent.$parent.$index}}_{{a.name}}" name="cn_tcc_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_tcc_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Extended range:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <div class="form-check">
                                                        <input type="checkbox" ng-disabled="!s.bands[a.name].active || (a.name !== 'G900' && a.name !== 'G1800')" ng-model="s.bands[a.name].cn_gsm_range" class="form-check-input" id="cn_gsm_range_{{$parent.$parent.$index}}_{{a.name}}" name="cn_gsm_range_{{$parent.$parent.$index}}_{{a.name}}">
                                                        <label class="form-check-label" for="cn_gsm_range_{{$parent.$parent.$index}}_{{a.name}}">Yes</label>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>Radio Unit type:</td>
                                                <td  ng-repeat="a in dictionary.antennaTypes" style="padding-right: 10px">
                                                    <select class="form-control col-sm-2" ng-disabled="!s.bands[a.name].active" name="radioUnit_{{$parent.$parent.$index}}_{{a.name}}" id="radioUnit_{{$parent.$parent.$index}}_{{a.name}}" ng-model="s.bands[a.name].cn_radio_unit" >
                                                        <option ng-repeat="a in dictionary.radioUnit" ng-value="a">{{a.name}}</option>
                                                    </select>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <!--                                    <br>-->
                                    <!--                                    <br>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">GSM 900:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_gsm900_{{$index}}" id="cn_gsm900_{{$index}}_1" ng-model="s.cn_gsm900"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_gsm900_{{$index}}" id="cn_gsm900_{{$index}}_2" ng-model="s.cn_gsm900"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">LTE 800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_lte800_{{$index}}" id="cn_lte800_{{$index}}_1" ng-model="s.cn_lte800"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_lte800_{{$index}}" id="cn_lte800_{{$index}}_2" ng-model="s.cn_lte800"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">DCS 1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_dcs1800_{{$index}}" id="cn_dcs1800_{{$index}}_1" ng-model="s.cn_dcs1800"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_dcs1800_{{$index}}" id="cn_dcs1800_{{$index}}_2" ng-model="s.cn_dcs1800"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">RET LTE 800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_lte800_{{$index}}" id="cn_ret_lte800_{{$index}}_1" ng-model="s.cn_ret_lte800"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_lte800_{{$index}}" id="cn_ret_lte800_{{$index}}_2" ng-model="s.cn_ret_lte800"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">WCDMA 2100:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_wcdma2100_{{$index}}" id="cn_wcdma2100_{{$index}}_1" ng-model="s.cn_wcdma2100"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_wcdma2100_{{$index}}" id="cn_wcdma2100_{{$index}}_2" ng-model="s.cn_wcdma2100"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">LTE 1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_lte1800_{{$index}}" id="cn_lte1800_{{$index}}_1" ng-model="s.cn_lte1800"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_lte1800_{{$index}}" id="cn_lte1800_{{$index}}_2" ng-model="s.cn_lte1800"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">UMTS 900:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_umts900_{{$index}}" id="cn_umts900_{{$index}}_1" ng-model="s.cn_umts900"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_umts900_{{$index}}" id="cn_umts900_{{$index}}_2" ng-model="s.cn_umts900"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">RET LTE 1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_lte1800_{{$index}}" id="cn_ret_lte1800_{{$index}}_1" ng-model="s.cn_ret_lte1800"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_lte1800_{{$index}}" id="cn_ret_lte1800_{{$index}}_2" ng-model="s.cn_ret_lte1800" ng-checked="true"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Required TRX 900/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_trx_{{$index}}" id="cn_trx_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_trx">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">LTE 2100:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_lte2100_{{$index}}" id="cn_lte2100_{{$index}}_1" ng-model="s.cn_lte2100" ng-change="s.cn_ret_lte2100 = s.cn_lte2100"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_lte2100_{{$index}}" id="cn_lte2100_{{$index}}_2" ng-model="s.cn_lte2100" ng-change="s.cn_ret_lte2100 = s.cn_lte2100"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">WCDMA Carrier:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_wcdma_carrier_{{$index}}" id="cn_wcdma_carrier_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_wcdma_carrier">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">RET LTE 2100:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_lte2100_{{$index}}" id="cn_ret_lte2100_{{$index}}_1" ng-model="s.cn_ret_lte2100"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_lte2100_{{$index}}" id="cn_ret_lte2100_{{$index}}_2" ng-model="s.cn_ret_lte2100" ng-checked="true"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Antenna Quantity 900/1800/WCDMA:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_gsm_antenna_quantity_{{$index}}" id="cn_gsm_antenna_quantity_{{$index}}"v-->
                                    <!--                                                   ng-model="s.cn_gsm_antenna_quantity">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">Antenna Quantity LTE 800/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_lte_antenna_quantity_{{$index}}" id="cn_lte_antenna_quantity_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_lte_antenna_quantity">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Tilt [deg] mechanical 900/1800/WCDMA:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_tilt_mech_gsm_{{$index}}_{{$index}}" id="cn_tilt_mech_gsm_{{$index}}_{{$index}}"-->
                                    <!--                                                   ng-model="s.square">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">Tilt [deg] mechanical LTE 800/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_tilt_mech_lte_{{$index}}" id="cn_tilt_mech_lte_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_tilt_mech_lte">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Tilt [deg] electrical 900/1800/WCDMA:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_tilt_electr_gsm_{{$index}}" id="cn_tilt_electr_gsm_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_tilt_electr_gsm">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">Tilt [deg] electrical LTE 800/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_tilt_electr_lte_{{$index}}" id="cn_tilt_electr_lte_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_tilt_electr_lte">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Direction [deg] 900/1800/WCDMA:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_direction_gsm_{{$index}}" id="cn_direction_gsm_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_direction_gsm">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">Direction [deg] LTE 800/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_direction_lte_{{$index}}" id="cn_direction_lte_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_direction_lte">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Height (top of ant) [m] 900/1800/WCDMA:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_height_gsm_{{$index}}" id="cn_height_gsm_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_height_gsm">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">Height (top of ant) [m] LTE 800/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_height_lte_{{$index}}" id="cn_height_lte_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_height_lte">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <br>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Duplex Filter 900/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_duplex_gsm_{{$index}}" id="cn_duplex_gsm_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_duplex_gsm">-->
                                    <!--                                        </div>-->
                                    <!--                                        <label class="col-sm-4 control-label">Radio Unit type:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <select class="form-control col-sm-2" name="radioUnit_{{$index}}" id="radioUnit_{{$index}}" ng-model="s.cn_radio_unit" >-->
                                    <!--                                                <option ng-repeat="a in dictionary.radioUnit" ng-value="a.name">{{a.name}}</option>-->
                                    <!--                                            </select>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Diversity 900/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" name="cn_diversity_{{$index}}" id="cn_diversity_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_diversity">-->
                                    <!--                                        </div>-->
                                    <!--&lt;!&ndash;                                        <label class="col-sm-4 control-label">DU type:</label>&ndash;&gt;-->
                                    <!--&lt;!&ndash;                                        <div class="col-sm-2">&ndash;&gt;-->
                                    <!--&lt;!&ndash;                                            <select class="form-control col-sm-2" id="dUnit_{{$index}}" name="dUnit_{{$index}}" ng-model="s.cn_du" >&ndash;&gt;-->
                                    <!--&lt;!&ndash;                                                <option ng-repeat="a in dictionary.dUnit" ng-value="a.name">{{a.name}}</option>&ndash;&gt;-->
                                    <!--&lt;!&ndash;                                            </select>&ndash;&gt;-->
                                    <!--&lt;!&ndash;                                        </div>&ndash;&gt;-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Power Splitter 900/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" id="cn_power_splitter_{{$index}}" name="cn_power_splitter_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_power_splitter">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Hybrid Combiner Unit (HCU) 900/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" id="cn_hcu_{{$index}}" name="cn_hcu_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_hcu">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">ASC:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_asc_{{$index}}" id="cn_asc_{{$index}}_1" ng-model="s.cn_asc"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_asc_{{$index}}" id="cn_asc_{{$index}}_2" ng-model="s.cn_asc"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Remote Electrical Tilt (RET):</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_{{$index}}" id="cn_ret_{{$index}}_1" ng-model="s.cn_ret"-->
                                    <!--                                                       value="Yes"> Yes-->
                                    <!--                                            </label>-->
                                    <!--                                            <label class="radio-inline">-->
                                    <!--                                                <input type="radio" name="cn_ret_{{$index}}" id="cn_ret_{{$index}}_2" ng-model="s.cn_ret"-->
                                    <!--                                                       value="No"> No-->
                                    <!--                                            </label>-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">TMA 900/1800/WCDMA::</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" id="cn_tma_gsm_{{$index}}" name="cn_tma_gsm_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_tma_gsm">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">TCC 900/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" id="cn_tcc_{{$index}}" name="cn_tcc_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_tcc">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                    <!--                                    <div class="form-group">-->
                                    <!--                                        <label class="col-sm-4 control-label">Extended range 900/1800:</label>-->
                                    <!--                                        <div class="col-sm-2">-->
                                    <!--                                            <input class="form-control" type="text" id="cn_gsm_range_{{$index}}" name="cn_gsm_range_{{$index}}"-->
                                    <!--                                                   ng-model="s.cn_gsm_range">-->
                                    <!--                                        </div>-->
                                    <!--                                    </div>-->
                                </div>
                            </tab>
                            <tab ng-click="newSector();">
                                <tab-heading height="50px"><b>+</b></tab-heading>
                            </tab>
                            <tab ng-click="tabStepRight()">
                                <tab-heading height="50px"><b>></b></tab-heading>
                            </tab>
                        </tabset>
                        <br>
                        <!-- <p>from {{minTab}} to {{maxTab}}</p> -->
                    </accordion-group>
                </accordion>


                <accordion class="content-visible-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            <span ng-class="{'error' : isError('renterCompany')}">Renter Company <i class="pull-right glyphicon"
                                                                                                    ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                        </accordion-heading>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">*Legal type:</label>
                            <div class="col-sm-6">
                                <select class="form-control" id="legalType" name="legalType"
                                        ng-model="renterCompany.legalType"
                                        ng-options="type.id as type.desc for type in dictionary.legalType"
                                        ng-selected="defineSiteObjectType()"
                                        ng-change="changeLegalType()">
                                </select>
                            </div>
                        </div>
                        <div class="form-group"
                             ng-if="confirmSendingRequestReceiveTsKZT && renterCompany.legalType==='national_kazakhtelecom'">
                            <label class="col-sm-3 control-label">*Branch of Kazakhtelecom:</label>
                            <div class="col-sm-6">
                                {{confirmSendingRequestReceiveTsKZT.branchKT}}
                                <label class="error" ng-show="kcell_form.confirmSendingRequestReceiveTsKZT.$error.required && ( kcell_form.confirmSendingRequestReceiveTsKZT.$touched || view.submitted || renterCompany.legalType === 'national_kazakhtelecom')">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">*Legal name:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="RClegalName" name="RClegalName"
                                       ng-model="renterCompany.legalName" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                <label class="error"
                                       ng-show="kcell_form.RClegalName.$error.required && ( kcell_form.RClegalName.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal address:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="legalAddress" name="legalAddress"
                                       ng-model="renterCompany.legalAddress">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">*Tel./Fax:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="telFax" name="telFax" ng-model="renterCompany.telFax">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="firstLeaderName" name="firstLeaderName"
                                       ng-model="renterCompany.firstLeaderName" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="firstLeaderPos" name="firstLeaderPos" ng-model="renterCompany.firstLeaderPos" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Email:</label>
                            <div class="col-sm-6">
                                <input class="form-control email" id="email" name="email" ng-model="renterCompany.email" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><h4>Contact Person</h4></label>
                            <div class="col-sm-6"></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">*Name:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="contactName" name="contactName" ng-model="renterCompany.contactName" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                <label class="error"
                                       ng-show="kcell_form.contactName.$error.required && ( kcell_form.contactName.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">LastName:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="contactLastName" name="contactLastName" ng-model="renterCompany.contactLastName" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Position:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="position" name="position" ng-model="renterCompany.contactPosition">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Contact Information:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="contractInfo" name="contractInfo" ng-model="renterCompany.contactInfo" />
                            </div>
                        </div>
                    </accordion-group>
                </accordion>


                <accordion class="content-visible-accordion" ng-show="candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider'">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            <span ng-class="{'error' : isError('nearEndInformation')}">Near End Information <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                        </accordion-heading>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">TR Antenna type:</label>
                            <div class="col-sm-6">
                                <select class="form-control" id="antennaType" name="antennaType"
                                        ng-model="transmissionAntenna.antennaType"
                                        ng-change="defineByAntennaType(transmissionAntenna.antennaType, 'transmission')"
                                        ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                    <option value="">-</option>
                                    <option ng-repeat="a in dictionary.antennaType" value="{{a.name}}">{{a.name}}
                                    </option>
                                </select>
                                <label class="error" ng-show="kcell_form.antennaType.$error.required && ( kcell_form.antennaType.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">TR Antenna quantity:</label>
                            <div class="col-sm-6">
                                <input type="number" class="form-control" id="antennaQuantity" name="antennaQuantity"
                                       ng-model="transmissionAntenna.antennaQuantity"
                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                <label class="error" ng-show="kcell_form.antennaQuantity.$error.required && ( antennaQuantity || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Frequency Band:</label>
                            <div class="col-sm-6">
                                <select class="form-control" id="frequencyBand" name="frequencyBand"
                                        ng-disabled="!frequenciesByAntennaType"
                                        ng-model="transmissionAntenna.frequencyBand"
                                        ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                    <option ng-repeat="freq in frequenciesByAntennaType.frequencies">{{freq}}</option>
                                </select>
                                <label class="error" ng-show="kcell_form.frequencyBand.$error.required && ( kcell_form.frequencyBand.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">Diameter (m):</label>
                            <div class="col-sm-6">{{transmissionAntenna.diameter}}</div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Weight (kg):</label>
                            <div class="col-sm-6">{{transmissionAntenna.weight}}</div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Suspension height of antennas (m):</label>
                            <div class="col-sm-6">
                                <input type="number" class="form-control" id="TRSuspensionHeight" name="TRSuspensionHeight" ng-model="transmissionAntenna.suspensionHeight"
                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                <label class="error" ng-show="kcell_form.TRSuspensionHeight.$error.required && ( TRSuspensionHeight || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Azimuth:</label>
                            <div class="col-sm-3">
                                <input class="form-control" type="number" id="TRazimuth" name="TRazimuth"
                                       ng-model="transmissionAntenna.azimuth"
                                       placeholder="(0-360)"
                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                <label class="error" ng-show="kcell_form.TRazimuth.$error.required && ( kcell_form.TRazimuth.$touched || view.submitted)">Required field</label>
                                <label class="error"
                                       ng-show="kcell_form.TRazimuth.$error.pattern && ( kcell_form.TRazimuth.$touched || view.submitted)">Неверный формат</label>
                                <!--                                <label class="error"-->
                                <!--                                       ng-show="kcell_form.TRazimuth.$error.pattern && ( kcell_form.TRazimuth.$touched || view.submitted)">Введите все поля для расчета</label>-->
                            </div>
                            <div class="col-sm-3">
                                <button type="button" class="btn btn-default" ng-click="autoSetAzimuth()">
                                    Расчитать
                                </button>
                            </div>
                        </div>

                        <div class="form-group col-sm-3">
                            <div class="col-sm-12">
                                <div class="form-check">
                                    <input type="checkbox" ng-model="transmissionAntenna.address.ca_diff_address" ng-change="nearEndDiffAddressChecked(transmissionAntenna.address.ca_diff_address)" class="form-check-input" id="checkNE">
                                    <label class="form-check-label" for="checkNE">Different address</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-9">
                            <accordion class="content-visible-accordion">
                                <accordion-group is-open="false" >
                                    <accordion-heading>
                                        <span ng-class="{'error' : isError('nearEndAddress')}">Near End Address <i class="pull-right glyphicon"
                                                            ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                                    </accordion-heading>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{transmissionAntenna.address.ca_diff_address ? '*' : ''}}Oblast:</label>
                                        <div class="col-sm-8" class="form-check">
                                            <select class="form-control" id="nei_addr_oblast" ng-disabled="!transmissionAntenna.address.ca_diff_address"
                                                    name="nei_addr_oblast" ng-model="transmissionAntenna.address.cn_addr_oblast"
                                                    ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && transmissionAntenna.address.ca_diff_address"
                                                    ng-change="filterDistrictAfterSelectOblInNEI(transmissionAntenna.address.cn_addr_oblast)">
                                                <option ng-repeat="oblast in oblastList" ng-value="oblast.name">{{oblast.name}}</option>
                                            </select>
                                            <label class="error" ng-show="kcell_form.nei_addr_oblast.$error.required && ( kcell_form.nei_addr_oblast.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">District:</label>
                                        <div class="col-sm-8" class="form-check">
                                            <select class="form-control" id="nei_addr_district" ng-disabled="!transmissionAntenna.address.ca_diff_address || !transmissionAntenna.address.cn_addr_oblast" name="nei_addr_district" ng-model="transmissionAntenna.address.cn_addr_district">
                                                <option ng-repeat="district in filteredDistrictsInNEI" ng-value="district.name">{{district.name}}</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">City / Village: </label>
                                        <div class="col-sm-8">
                                            <input type="text" ng-model="transmissionAntenna.address.cn_addr_city" name="nei_addr_city" ng-disabled="!transmissionAntenna.address.ca_diff_address"
                                                   typeahead="city.name for city in getCity($viewValue)" typeahead-on-select="nearEndInfoAddressCitySelected($item,$model,$label)" class="form-control"
                                                   placeholder="Start typing...">
                                            <label class="error" ng-show="kcell_form.nei_addr_city.$error.required && ( kcell_form.nei_addr_city.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-12">
                                            <div class="form-check">
                                                <input type="checkbox" ng-model="transmissionAntenna.address.cn_not_full_addres" class="form-check-input" ng-disabled="!transmissionAntenna.address.ca_diff_address" id="nei_ca_not_full_addres">
                                                <label class="form-check-label" for="nei_ca_not_full_addres">Object without address</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{(transmissionAntenna.address.ca_diff_address && !transmissionAntenna.address.cn_not_full_addres) ? '*' : ''}}Street/Microdistrict:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="nei_addr_street" name="nei_addr_street" ng-model="transmissionAntenna.address.cn_addr_street"
                                                   ng-disabled="!transmissionAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && transmissionAntenna.address.ca_diff_address && !transmissionAntenna.address.cn_not_full_addres">
                                            <label class="error" ng-show="kcell_form.nei_addr_street.$error.required && ( kcell_form.nei_addr_street.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{(transmissionAntenna.address.ca_diff_address && !transmissionAntenna.address.cn_not_full_addres) ? '*' : ''}}Building:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="nei_addr_building" name="nei_addr_building" ng-model="transmissionAntenna.address.cn_addr_building" ng-disabled="!transmissionAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && transmissionAntenna.address.ca_diff_address && !transmissionAntenna.address.cn_not_full_addres">
                                            <label class="error" ng-show="kcell_form.nei_addr_building.$error.required && ( kcell_form.nei_addr_building.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Cadastral number:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="nei_addr_cadastral_number" name="nei_addr_cadastral_number" ng-model="transmissionAntenna.address.cn_addr_cadastral_number"
                                                   ng-disabled="!transmissionAntenna.address.ca_diff_address">
                                            <label class="error" ng-show="kcell_form.nei_addr_cadastral_number.$error.required && ( kcell_form.cn_addr_cadastral_number.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">{{(transmissionAntenna.address.ca_diff_address && transmissionAntenna.address.cn_not_full_addres) ? '*' : ''}}Note to the address:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="nei_addr_note" name="nei_addr_note" ng-model="transmissionAntenna.address.cn_addr_note"
                                                   ng-disabled="!transmissionAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && transmissionAntenna.address.ca_diff_address && transmissionAntenna.address.cn_not_full_addres">
                                            <label class="error" ng-show="kcell_form.nei_addr_note.$error.required && ( kcell_form.nei_addr_note.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">*Latitude:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="ne_latitude" placeholder="ХХ.ХХХХХХ" name="ne_latitude"
                                                   ng-pattern="latitudePattern" ng-disabled="!transmissionAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && transmissionAntenna.address.ca_diff_address"
                                                   ng-model="transmissionAntenna.address.latitude" maxlength="11">
                                            <label class="error"
                                                   ng-show="kcell_form.ne_latitude.$error.required && ( kcell_form.ne_latitude.$touched || view.submitted)">Required
                                                field</label>
                                            <!-- <label class="error" ng-show="invalidLatitude">Latitude must be in [40.568, 55.440] range</label>-->
                                            <label class="error"
                                                   ng-if="kcell_form.ne_latitude.$error.pattern && ( kcell_form.ne_latitude.$touched || view.submitted)">Expected: 40.568000 <- Latitude <- 55.440000</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">*Longitude:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="ne_longitude" placeholder="ХХ.ХХХХХХ" name="ne_longitude"
                                                   ng-pattern="longitudePattern" ng-disabled="!transmissionAntenna.address.ca_diff_address"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && transmissionAntenna.address.ca_diff_address"
                                                   ng-model="transmissionAntenna.address.longitude"
                                                   maxlength="11">
                                            <label class="error"
                                                   ng-show="kcell_form.ne_longitude.$error.required && ( kcell_form.ne_longitude.$touched || view.submitted)">Required
                                                field</label>
                                            <!--<label class="error" ng-show="invalidLongitude">Longitude must be in [46.493, 87.315] range</label>-->
                                            <label class="error"
                                                   ng-if="kcell_form.ne_longitude.$error.pattern && ( kcell_form.ne_longitude.$touched || view.submitted)">Expected: 46.493000 <- Longitude <-87.315000</label>

                                        </div>
                                    </div>
                                </accordion-group>
                            </accordion>
                        </div>

                    </accordion-group>
                </accordion>

                <accordion class="content-visible-accordion" ng-show="candidate.transmissionType==='Satellite' || candidate.transmissionType==='Provider' || candidate.transmissionType==='Microwave + Satellite or Provider'">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            <span ng-class="{'error' : isError('transmissionInfo')}">Transmission Information <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                        </accordion-heading>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Channel capacity (Mbps):</label>
                            <div class="col-sm-6">
                                <input type="number" class="form-control" id="channelCapacity" name="channelCapacity"
                                       ng-model="candidate.channelCapacity"
                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && (candidate.transmissionType==='Satellite' || candidate.transmissionType==='Provider' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                <label class="error"
                                       ng-show="kcell_form.channelCapacity.$error.required && ( kcell_form.channelCapacity.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Description:</label>
                            <div class="col-sm-6">
                                <textarea class="form-control" ng-model="candidate.transmissionDescription" name="transmissionDescription"
                                          maxlength="500" rows="4" style="resize:none"></textarea>
                            </div>
                        </div>
                    </accordion-group>
                </accordion>

                <accordion class="content-visible-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            <span ng-class="{'error' : isError('powerSource')}">Power Source <i class="pull-right glyphicon"
                                                                                                ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                        </accordion-heading>

                        <div class="form-group">
                            <label class="col-sm-4 control-label">Does renter agree to provide us 3 Phase/3.5kW of
                                electrical energy?</label>
                            <div class="col-sm-6">
                                <label class="radio-inline">
                                    <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase"
                                           value="Yes" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"> Yes
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase"
                                           value="No" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"> No
                                </label>
                                <label class="error" ng-show="kcell_form.provideUs3Phase.$error.required && ( provideUs3Phase || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Cable length to connection point (in meters):</label>
                            <div class="col-sm-6">
                                <input class="form-control" type="number" id="cableLength" name="cableLength"
                                       ng-model="powerSource.cableLength" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                <label class="error"
                                       ng-show="kcell_form.cableLength.$error.required && ( kcell_form.cableLength.$touched || view.submitted )">Required
                                    field
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Cable laying type:</label>
                            <div class="col-sm-6">
                                <div class="form-check col-sm-6"
                                     ng-repeat="t in powerSource.cableLayingType track by $index">
                                    <input type="checkbox" name="checkCableLTayingType" ng-model="t.value" class="form-check-input" ng-change="checkCableTypeSelected()"
                                           id="{{'checkCableLTayingType' + $index}}" >
                                    <label class="form-check-label" for="{{'checkCableLTayingType' + $index}}">{{ t.title }}</label>
                                </div>
                                <label class="error" ng-show=" !cableTypeChecked && view.submitted && createNewCandidateSiteTaskResult !== 'NCP cancel required' ">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Does renter agree to receive monthly payment for
                                consumed electrical energy according to our power counters displays buy the bank
                                transactions and give us invoices?</label>
                            <div class="col-sm-6">
                                <label class="radio-inline">
                                    <input type="radio" name="agreeToReceiveMonthlyPayment"
                                           ng-model="powerSource.agreeToReceiveMonthlyPayment" value="Yes" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"> Yes
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="agreeToReceiveMonthlyPayment"
                                           ng-model="powerSource.agreeToReceiveMonthlyPayment" value="No" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"> No
                                </label>
                                <label class="error" ng-show="kcell_form.agreeToReceiveMonthlyPayment.$error.required && ( agreeToReceiveMonthlyPayment || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-4 control-label">Closest public (RES) electrical line:</label>

                            <div class="col-sm-4">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon1">0,4 kV</span>
                                    <input class="form-control" type="number" id="closestPublic04" name="closestPublic04"
                                           ng-model="powerSource.closestPublic04" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                    <label class="error" ng-show="kcell_form.closestPublic04.$error.required && ( closestPublic04 || view.submitted)">Required field</label>

                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon2">10 kV</span>
                                    <input class="form-control" type="number" id="closestPublic10" name="closestPublic10"
                                           ng-model="powerSource.closestPublic10" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                    <label class="error" ng-show="kcell_form.closestPublic10.$error.required && ( closestPublic10 || view.submitted)">Required field</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-4 control-label">Transformer power substation:</label>
                            <div class="col-sm-5">
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cn_tps" ng-model="powerSource.cn_tps" ng-click="checkTPS(powerSource.cn_tps)"
                                               value="Available (LEP installation not required)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"> Available (LEP installation not required)
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cn_tps" ng-model="powerSource.cn_tps" ng-click="checkTPS(powerSource.cn_tps)"
                                               value="Available (LEP installation required)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"> Available (LEP installation required)
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cn_tps" ng-model="powerSource.cn_tps" ng-click="checkTPS(powerSource.cn_tps)"
                                               value="TPS installation required (TPS is missing)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"> TPS installation required (TPS is missing)
                                    </label>
                                    <label class="error" ng-show="kcell_form.cn_tps.$error.required && ( cn_tps || view.submitted)">Required field</label>
                                </div>
                            </div>
                        </div>

                        <div ng-if="checkTPSTouched" class="form-group">
                            <label class="col-md-4 control-label">TPS belongs:</label>
                            <div class="col-sm-3">
                                <div class="form-check">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cn_tps_belongs" ng-model="powerSource.cn_tps_belongs" ng-click="checkTPSB(powerSource.cn_tps_belongs)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                                               value="RES"> RES
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cn_tps_belongs" ng-model="powerSource.cn_tps_belongs" ng-click="checkTPSB(powerSource.cn_tps_belongs)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                                               value="Landlord"> Landlord
                                    </label>
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="radio" name="cn_tps_belongs" ng-model="powerSource.cn_tps_belongs" ng-click="checkTPSB(powerSource.cn_tps_belongs)" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                                               value="Other"> Other
                                    </label>
                                    <label class="error"
                                           ng-show="kcell_form.cn_tps_belongs.$error.required && (checkTPSTouched || view.submitted || powerSource.cn_tps === 'Available (LEP installation not required)' || powerSource.cn_tps === 'Available (LEP installation required)' )">Required
                                        field
                                    </label>
                                </div>
                            </div>
                            <div class="col-sm-5">
                                <label ng-if="checkTPSBTouched" class="form-check-label">
                                    <input type="text" class="form-check-input" id="cn_tps_belongs_commentary" name="cn_tps_belongs_commentary"
                                           ng-model="powerSource.cn_tps_belongs_commentary" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'">
                                </label>
                                <label class="error" ng-show="kcell_form.cn_tps_belongs_commentary.$error.required && (checkTPSTouched || view.submitted)">Required field</label>
                            </div>
                        </div>

                        <div ng-if="checkTPSTouched" class="form-group">
                            <label class="col-sm-4 control-label">Distance to candidate, m:</label>
                            <div class="col-sm-4">
                                <input type="number" class="form-control" id="cn_tps_distance" name="cn_tps_distance" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'"
                                       ng-model="powerSource.cn_tps_distance">
                                <label class="error" ng-show="kcell_form.cn_tps_distance.$error.required && (checkTPSTouched || view.submitted || powerSource.cn_tps === 'Available (LEP installation not required)' || powerSource.cn_tps === 'Available (LEP installation required)')">Required field</label>
                            </div>
                            </label>
                        </div>

                    </accordion-group>
                </accordion>
            </div>
        </tab>
        <tab ng-show="candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider'">
            <tab-heading ng-class="{'error' : isError('farEndInformation')}">
                <span class="glyphicon glyphicon-list"></span> Far End Information
            </tab-heading>
            <div style="margin-top: 20px;">
                <div class="col-sm-12">
                    <h4>Far Ends priority:</h4>
                    <div class="row col-sm-8">
                        <table class="table table-bordered col-sm-12">
                            <thead>
                            <td width="10%">№</td>
                            <td width="90%">Far End Name</td>
                            </thead>
                            <tbody ui-sortable="sortableOptions" ng-model="farEndInformation">

                            <tr ng-repeat="fe in farEndInformation">
                                <td>{{ $index + 1 }}</td>
                                <td>
                                    <div ng-click="openFarEndInformation($index)" class="far-end-info" ng-style="{'background-color': currentFarEnd===farEndInformation[$index] ? '#652d86' : '#f7f7f7', 'color': currentFarEnd===farEndInformation[$index] ? 'white' : 'black'}">{{fe.farEndName}}
                                        <div class="far-end-delete" ng-show="farEndInformation.length > 1" ng-click="deleteFE($index)">x</div>
                                    </div>
                                </td>

                                <!--<td><a ng-click="editFE($index)">Изменить</a><a class="glyphicon glyphicon-trash pull-right" ng-click="deleteFE($index)"></a></td>-->
                            </tr>
                            <tr>
                                <td>{{ farEndInformation.length + 1 }}</td>
                                <td>
                                    <input type="text" ng-model="newFe.farEndName" name="farEndName"
                                           ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && (((!threeFarEndNotNecessary.check && farEndInformation.length<3) || (threeFarEndNotNecessary.check && farEndInformation.length<1)) && candidate.transmissionType !== 'Provider' && candidate.transmissionType !== 'Satellite')"
                                           typeahead="site as sites.site_name for sites in getSite($viewValue)"
                                           typeahead-on-select="siteSelected($item,$model,$label)" class="form-control"
                                           autocomplete="on" placeholder="Far End Name">
                                    <input type="hidden" name="farEndId" ng-model="newFe.farEndId"  ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && (((!threeFarEndNotNecessary.check && farEndInformation.length<3) || (threeFarEndNotNecessary.check && farEndInformation.length<1)) && candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                    <label class="error"
                                           ng-show="kcell_form.farEndName.$error.required && (kcell_form.farEndName.$touched || view.submitted)">Required
                                        field<br>Select from list</label>
                                </td>

                                <!--<td><a ng-click="editFE($index)">Изменить</a><a class="glyphicon glyphicon-trash pull-right" ng-click="deleteFE($index)"></a></td>-->
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>

                <div class="form-group col-sm-12" style="padding-bottom: 17px;">
                    <div class="col-sm-12">
                        <input type="checkbox" ng-model="threeFarEndNotNecessary.check" class="form-check-input"
                               name="threeFarEndNotNecessaryCheck" id="threeFarEndNotNecessaryCheck">
                        <label class="form-check-label" style="font-weight:normal">The possibility of providing 3 FE is
                            not available</label>
                    </div>
                </div>
                <div class="form-group col-sm-12" ng-if="threeFarEndNotNecessary.check" style="margin-bottom:15px;">
                    <label class="col-sm-2 control-label">Description:</label>
                    <div class="col-sm-6">
                        <textarea class="form-control" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && threeFarEndNotNecessary.check"
                                  ng-model="threeFarEndNotNecessary.comment" name="threeFarEndNotNecessaryCheckComment"
                                  placeholder="Comments..." maxlength="500" rows="4" style="resize:none"></textarea>
                        <label class="error"
                               ng-show="kcell_form.threeFarEndNotNecessaryCheckComment.$error.required && (kcell_form.threeFarEndNotNecessaryCheckComment.$touched || view.submitted)">Required
                            field</label>

                    </div>
                </div>

                <div class="col-sm-12" ng-if="farEndInformation.length>0 && currentFarEnd">
                    <accordion class="content-visible-accordion background-yellow-accordion">
                        <accordion-group is-open="false">
                            <accordion-heading>
                                <span ng-class="{'error' : isError('farEndInformationAccordion')}">Far End Information <i class="pull-right glyphicon"
                                                                                                                          ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                            </accordion-heading>
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Far End name:</label>
                                    <label class="col-sm-8 control-label">{{currentFarEnd.farEndName}}</label>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Latitude:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" type="number" step="any" id="fe_latitude" placeholder="ХХ.ХХХХХХ" name="fe_latitude"
                                               ng-pattern="latitudePattern"
                                               ng-model="currentFarEnd.fe_latitude" maxlength="11"
                                               ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                        <label class="error"
                                               ng-show="kcell_form.fe_latitude.$error.required && ( kcell_form.fe_latitude.$touched || view.submitted)">Required
                                            field</label>
                                        <!-- <label class="error" ng-show="invalidLatitude">Latitude must be in [40.568, 55.440] range</label>-->
                                        <label class="error"
                                               ng-if="kcell_form.fe_latitude.$error.pattern && ( kcell_form.fe_latitude.$touched || view.submitted)">Expected: 40.568000 <- Latitude <- 55.440000</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Longitude:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" type="number" step="any" id="fe_longitude" placeholder="ХХ.ХХХХХХ" name="fe_longitude"
                                               ng-pattern="longitudePattern"
                                               ng-model="currentFarEnd.fe_longitude"
                                               maxlength="11"
                                               ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                        <label class="error"
                                               ng-show="kcell_form.fe_longitude.$error.required && ( kcell_form.fe_longitude.$touched || view.submitted)">Required
                                            field</label>
                                        <!--<label class="error" ng-show="invalidLongitude">Longitude must be in [46.493, 87.315] range</label>-->
                                        <label class="error"
                                               ng-if="kcell_form.fe_longitude.$error.pattern && ( kcell_form.fe_longitude.$touched || view.submitted)">Expected: 46.493000 <- Longitude <-87.315000</label>

                                    </div>
                                </div>
                                <accordion class="content-visible-accordion background-yellow-accordion">
                                    <accordion-group is-open="false">
                                        <accordion-heading>
                                            <span ng-class="{'error' : isError('farEndAddress')}">Far End Address <i class="pull-right glyphicon"
                                                                                                                     ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i></span>
                                        </accordion-heading>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Oblast:</label>
                                            <div class="col-sm-8" class="form-check">
                                                <select class="form-control" id="FarEnd_cn_addr_oblast" name="fe_form_FarEnd_cn_addr_oblast" ng-model="currentFarEnd.address.cn_addr_oblast"
                                                        ng-change="filterDistrictAfterSelectFarEndObl(currentFarEnd.address.cn_addr_oblast)"
                                                        ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                <option ng-repeat="oblast in oblastList" ng-value="oblast.name">{{oblast.name}}</option>
                                                </select>
                                                <label class="error" ng-show="kcell_form.fe_form_FarEnd_cn_addr_oblast.$error.required && ( fe_form_FarEnd_cn_addr_oblast || view.submitted)">Required field</label>

                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">District:</label>
                                            <div class="col-sm-8" class="form-check">
                                                <select class="form-control" id="FarEnd_cn_addr_district" name="fe_form_FarEnd_cn_addr_district" ng-model="currentFarEnd.address.cn_addr_district" ng-disabled="!currentFarEnd.address.cn_addr_oblast">
                                                    <option ng-repeat="district in currentFarEnd.dictionary.filteredDistricts" ng-value="district.name">{{district.name}}</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">City / Village:</label>
                                            <div class="col-sm-8">
                                                <input type="text" ng-model="currentFarEnd.address.cn_addr_city" ng-value='city.name' name="fe_form_FarEnd_cn_addr_city" typeahead="city.name for city in getFarEndCity($viewValue)" typeahead-on-select="farEndAddressCitySelected($item,$model,$label)" class="form-control" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'" placeholder="Start typing...">
                                                <label class="error" ng-show="kcell_form.fe_form_FarEnd_cn_addr_city.$error.required && ( kcell_form.fe_form_FarEnd_cn_addr_city.$touched || view.submitted)">Required field</label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="col-sm-12">
                                                <div class="form-check">
                                                    <input type="checkbox" ng-model="currentFarEnd.address.ca_not_full_addres" class="form-check-input" id="fe_not_full_addres">
                                                    <label class="form-check-label" for="ca_not_full_addres">Object without address</label> {{currentFarEnd.address.ca_not_full_addres}}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">{{!currentFarEnd.address.ca_not_full_addres ? '*' : ''}}Street/Microdistrict:</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" id="FarEnd_cn_addr_street" name="fe_form_FarEnd_cn_addr_street" ng-model="currentFarEnd.address.cn_addr_street" ng-disabled="currentFarEnd.address.ca_not_full_addres" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && !currentFarEnd.address.ca_not_full_addres">
                                                <label class="error" ng-show="kcell_form.fe_form_FarEnd_cn_addr_street.$error.required && ( kcell_form.fe_form_FarEnd_cn_addr_street.$touched || view.submitted)">Required field</label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">{{!currentFarEnd.address.ca_not_full_addres ? '*' : ''}}Building:</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" id="FarEnd_cn_addr_building" name="fe_form_FarEnd_cn_addr_building" ng-model="currentFarEnd.address.cn_addr_building" ng-disabled="currentFarEnd.address.ca_not_full_addres" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && !currentFarEnd.address.ca_not_full_addres">
                                                <label class="error" ng-show="kcell_form.fe_form_FarEnd_cn_addr_building.$error.required && ( kcell_form.fe_form_FarEnd_cn_addr_building.$touched || view.submitted)">Required field</label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">{{currentFarEnd.address.ca_not_full_addres ? '*' : ''}}Cadastral number:</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" id="FarEnd_cn_addr_cadastral_number" name="fe_form_FarEnd_cn_addr_cadastral_number" ng-model="currentFarEnd.address.cn_addr_cadastral_number"  ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && currentFarEnd.address.ca_not_full_addres">
                                                <label class="error" ng-show="kcell_form.fe_form_FarEnd_cn_addr_cadastral_number.$error.required && ( kcell_form.fe_form_FarEnd_cn_addr_cadastral_number.$touched || view.submitted)">Required field</label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">{{currentFarEnd.address.ca_not_full_addres ? '*' : ''}}Note to the address:</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" id="FarEnd_cn_addr_note" name="fe_form_FarEnd_cn_addr_note" ng-model="currentFarEnd.address.cn_addr_note" ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required' && currentFarEnd.address.ca_not_full_addres">
                                                <label class="error" ng-show="kcell_form.fe_form_FarEnd_cn_addr_note.$error.required && ( kcell_form.fe_form_FarEnd_cn_addr_note.$touched || view.submitted)">Required field</label>
                                            </div>
                                        </div>
                                    </accordion-group>
                                </accordion>
                                <!-- <div class="form-group">
                                    <label class="col-sm-3 control-label">Far End address:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="farEndAddress" name="fe_form_farEndAddress"
                                               ng-model="currentFarEnd.farEndAddress">
                                    </div>
                                </div> -->
                                <!--                                <div class="form-group">-->
                                <!--                                    <label class="col-sm-3 control-label">Contract Information:</label>-->
                                <!--                                    <div class="col-sm-8">-->
                                <!--                                        <input class="form-control" id="contractInformation"-->
                                <!--                                               name="fe_form_contractInformation"-->
                                <!--                                               ng-model="currentFarEnd.contractInformation">-->
                                <!--                                        <label class="error"-->
                                <!--                                               ng-show="kcell_form.fe_form_contractInformation.$error.required && ( kcell_form.fe_form_contractInformation.$touched || view.submitted)">Required-->
                                <!--                                            field</label>-->
                                <!--                                    </div>-->
                                <!--                                </div>-->
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Square:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" type="number" id="FeSquare" name="fe_form_FeSquare"
                                               ng-model="currentFarEnd.square">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FeSquare.$error.required && ( kcell_form.fe_form_FeSquare.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Equipment type:</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" id="equipmentType" name="fe_form_equipmentType"
                                                ng-model="currentFarEnd.equipmentType"
                                                ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                        <option value="" disabled ng-selected="currentFarEnd.equipmentType===''" hidden>Select Equipment Type</option>
                                            <option ng-repeat="e in dictionary.equipmentType" ng-value="e.name">{{e.name}}</option>
                                        </select>
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_equipmentType.$error.required && ( kcell_form.fe_form_equipmentType.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <table class="table table-condensed">
                                        <thead>
                                        <tr>
                                            <td class="col-sm-2">*Antenna type:</td>
                                            <td class="col-sm-1">*Quantity:</td>
                                            <td class="col-sm-1">*Frequency band:</td>
                                            <td>*Diameter:</td>
                                            <td class="col-sm-1">*Weight (kg):</td>
                                            <td>*Azimuth:</td>
                                            <td>*Suspension height (m):</td>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td class="col-sm-2">
                                                <select class="form-control" id="feAntennaType" name="fe_form_feAntennaType"
                                                        ng-model="currentFarEnd.feAntennaType"
                                                        ng-change="defineByAntennaType(currentFarEnd.feAntennaType, 'farend')"
                                                        ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                <option value="" disabled ng-selected="currentFarEnd.feAntennaType===''" hidden>Select Antenna Type</option>
                                                    <option ng-repeat="a in dictionary.antennaType" value="{{a.name}}">
                                                        {{a.name}}
                                                    </option>
                                                </select>
                                                <label class="error" ng-show="kcell_form.fe_form_feAntennaType.$error.required && ( kcell_form.fe_form_feAntennaType.$touched || view.submitted)">Required field</label>
                                            </td>
                                            <td class="col-sm-1" style="padding-right: 0;">
                                                <input type="number" class="form-control" id="FeAntennasQuantity"
                                                       name="fe_form_FeAntennasQuantity" ng-model="currentFarEnd.antennasQuantity"
                                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                <label class="error" ng-show="kcell_form.fe_form_FeAntennasQuantity.$error.required && ( fe_form_FeAntennasQuantity || view.submitted)">Required field</label>
                                            </td>
                                            <td class="col-sm-1" style="padding-right: 0;">
                                                <select class="form-control" id="FeFrequencyBand" name="fe_form_FeFrequencyBand"
                                                        ng-disabled="!frequenciesFeByAntennaType"
                                                        ng-model="currentFarEnd.frequencyBand"
                                                        ng-options="freq for freq in frequenciesFeByAntennaType.frequencies"
                                                        ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                </select>
                                                <label class="error"
                                                       ng-show="kcell_form.fe_form_FeFrequencyBand.$error.required && ( kcell_form.fe_form_FeFrequencyBand.$touched || view.submitted)">Required
                                                    field</label>
                                            </td>
                                            <td class="col-sm-1" style="padding-right: 0;">
                                                <input class="form-control" id="FeDiameter" name="fe_form_FeDiameter" disabled
                                                       ng-model="currentFarEnd.diameter"
                                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                <label class="error" ng-show="kcell_form.fe_form_FeDiameter.$error.required && ( fe_form_FeDiameter || view.submitted)">Required field</label>
                                            </td>

                                            <td class="col-sm-1" style="padding-right: 0;">
                                                <input class="form-control" type="number" step="any" id="FeWeight" name="fe_form_FeWeight"
                                                       ng-model="currentFarEnd.weight"
                                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                <label class="error" ng-show="kcell_form.fe_form_FeWeight.$error.required && ( fe_form_FeWeight || view.submitted)">Required field</label>
                                            </td>
                                            <td class="col-sm-1" style="padding-right: 0;">
                                                <input class="form-control" type="number" step="any" id="FeAzimuth" name="fe_form_FeAzimuth"
                                                       ng-model="currentFarEnd.azimuth"
                                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                <label class="error" ng-show="kcell_form.fe_form_FeAzimuth.$error.required && ( fe_form_FeAzimuth || view.submitted)">Required field</label>
                                            </td>
                                            <td class="col-sm-2"  style="padding-right: 30px;">
                                                <input class="form-control" type="number" min="0" step="1" id="FeSuspensionHeight"
                                                       name="fe_form_FeSuspensionHeight" ng-model="currentFarEnd.suspensionHeight"
                                                       ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                                <label class="error" ng-show="kcell_form.fe_form_FeSuspensionHeight.$error.required && ( fe_form_FeSuspensionHeight || view.submitted)">Required field</label>
                                                <label class="error"
                                                       ng-show="kcell_form.fe_form_FeSuspensionHeight.$invalid">Integer only</label>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Сonstruction type:</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" id="FeConstructionType"
                                                name="fe_form_FeConstructionType"
                                                ng-model="currentFarEnd.constructionType"
                                                ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                        <option value="" disabled ng-selected="currentFarEnd.constructionType===''" hidden>Select Construction Type
                                            </option>
                                            <option ng-repeat="c in dictionary.FarEndConstructiontype" ng-value="c">{{c.name}}</option>
                                        </select>
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FeConstructionType.$error.required && ( kcell_form.fe_form_FeConstructionType.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Survey Date:</label>
                                    <div class="col-sm-8">

                                        <div class="input-group">
                                            <input type="text" ng-model="currentFarEnd.surveyDate" name="fe_form_surveyDate"
                                                   class="form-control" datepicker-popup="dd.MM.yyyy"
                                                   is-open="surveyDateFieldOpened" id="surveyDate"
                                                   ng-required="createNewCandidateSiteTaskResult !== 'NCP cancel required'&& (candidate.transmissionType==='Microwave' || candidate.transmissionType==='Microwave + Satellite or Provider')">
                                            <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-click="surveyDateFieldOpened = true">
                                <i class="glyphicon glyphicon-calendar"></i>
                            </button>
                                     </span>
                                        </div>

                                        <label class="error"
                                               ng-show="kcell_form.fe_form_surveyDate.$error.required && ( kcell_form.fe_form_surveyDate.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Results of visit of objects:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="ResultsOfVisit" name="fe_form_ResultsOfVisit"
                                               ng-model="currentFarEnd.resultsOfVisit">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_ResultsOfVisit.$error.required && ( kcell_form.fe_form_ResultsOfVisit.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Comments:</label>
                                    <div class="col-sm-8">
                                        <textarea class="form-control" ng-model="currentFarEnd.comments"
                                                  name="fe_form_FeComments" maxlength="500" rows="4"
                                                  style="resize:none"></textarea>
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FeComments.$error.required && ( kcell_form.fe_form_FeComments.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <h4><b>Renter Company</b></h4>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Legal type:</label>
                                    <div class="col-sm-8">
                                        <select class="form-control" id="farEndLegalType" name="fe_form_farEndLegalType"
                                                ng-model="currentFarEnd.legalType"
                                                ng-options="type.id as type.desc for type in dictionary.legalType"
                                                ng-change="changeFarEndLegalType()">
                                        </select>
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_farEndLegalType.$error.required && ( kcell_form.fe_form_farEndLegalType.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Legal name:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERClegalName" name="fe_form_FERClegalName"
                                               ng-model="currentFarEnd.renterCompany.legalName">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERClegalName.$error.required && ( kcell_form.fe_form_FERClegalName.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Legal address:</label>
                                    <div class="col-sm-8">
                                        <textarea class="form-control" id="FERCLegalAddress" name="fe_form_FERCLegalAddress"
                                                  ng-model="currentFarEnd.renterCompany.legalAddress"
                                                  maxlength="500" rows="4" style="resize:none"></textarea>
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERCLegalAddress.$error.required && ( kcell_form.fe_form_FERCLegalAddress.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Tel./Fax:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERCTelFax" name="fe_form_FERCTelFax"
                                               ng-model="currentFarEnd.renterCompany.telFax">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERCTelFax.$error.required && ( kcell_form.fe_form_FERCTelFax.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERCFirstLeaderName"
                                               name="fe_form_FERCFirstLeaderName"
                                               ng-model="currentFarEnd.renterCompany.firstLeaderName">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERCFirstLeaderName.$error.required && ( kcell_form.fe_form_FERCFirstLeaderName.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERCFirstLeaderPosition"
                                               name="fe_form_FERCFirstLeaderPosition"
                                               ng-model="currentFarEnd.renterCompany.firstLeaderPosition">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERCFirstLeaderPosition.$error.required && ( kcell_form.fe_form_FERCFirstLeaderPosition.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Email:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERCemail" name="fe_form_FERCemail"
                                               ng-model="currentFarEnd.renterCompany.email">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERCemail.$error.required && ( kcell_form.fe_form_FERCemail.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <h4><b>Contact Person:</b></h4>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Name:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERC_Name" name="fe_form_FERC_Name"
                                               ng-model="currentFarEnd.renterCompany.name">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERC_Name.$error.required && ( kcell_form.fe_form_FERC_Name.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Position:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERC_Position" name="fe_form_FERC_Position"
                                               ng-model="currentFarEnd.renterCompany.position">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERC_Position.$error.required && ( kcell_form.fe_form_FERC_Position.$touched || view.submitted)">Required
                                            field</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Contact Information:</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="FERC_ContactInformation"
                                               name="fe_form_FERC_ContractInformation"
                                               ng-model="currentFarEnd.renterCompany.contactInformation">
                                        <label class="error"
                                               ng-show="kcell_form.fe_form_FERC_ContractInformation.$error.required && ( kcell_form.fe_form_FERC_ContractInformation.$touched || view.submitted )">Required
                                            field</label>
                                    </div>
                                </div>
                                <br>
                            </div>
                        </accordion-group>
                    </accordion>

                </div>
            </div>
        </tab>
    </tabset>
    <div class="form-group">
        <label class="col-sm-3 control-label">Resolution</label>
        <div class="col-sm-9">
            <label class="radio-inline">
                <input type="radio" name="createNewCandidateSiteTaskResult" ng-model="createNewCandidateSiteTaskResult" value="Confirm candidate"> Confirm candidate
            </label>
            <label class="radio-inline">
                <input type="radio" name="createNewCandidateSiteTaskResult" ng-model="createNewCandidateSiteTaskResult" value="NCP cancel required"> NCP cancel required
            </label>
            <label class="error" ng-show="kcell_form.createNewCandidateSiteTaskResult.$error.required && ( kcell_form.createNewCandidateSiteTaskResult.$touched || view.submitted)">Required field</label>
        </div>
    </div>

    <leasing-attachments leasing-files="leasingFiles" deleted-files="deletedFiles" task-key="taskKey" modify="'true'"></leasing-attachments>
    <iframe id="fileDownloadIframe" style="display:none;"></iframe>
    <div class="form-group">
        <label class="col-sm-3 control-label"></label>
        <div class="col-sm-9">
            <ng-form name="kcell_material_file_form">
                <input type="file" class="form-control" id="createNewCandidateSiteFiles"
                       name="createNewCandidateSiteFiles" ng-model="file.file"
                       onchange="angular.element(this).scope().fileSelected(this, 'createNewCandidateSiteFiles')"/>
                <label class="has-error" ng-show="kcell_material_file_form.createNewCandidateSiteFiles.$error.validFile && (kcell_material_file_form.createNewCandidateSiteFiles.$touched || view.submitted)">File is required</label>
            </ng-form>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-3 control-label">Comments:</label>
        <div class="col-sm-9">
            <textarea class="form-control" ng-model="candidate.comments" name="newCandidateComments" ng-required="createNewCandidateSiteTaskResult === 'NCP cancel required'"
                      maxlength="500" rows="4" style="resize:none"></textarea>
            <label class="error" ng-show="kcell_form.newCandidateComments.$error.required && ( kcell_form.newCandidateComments.$touched || view.submitted)">Required field</label>
        </div>
    </div>
</form>
