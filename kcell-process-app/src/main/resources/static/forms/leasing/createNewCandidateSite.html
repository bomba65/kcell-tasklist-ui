<form role="form" class="form-horizontal" name="kcell_form" novalidate>
    <script cam-script type="text/form-script">
        inject(['$scope', '$http', 'Uri', '$rootScope', '$q', '$timeout', function ($scope, $http, Uri, $rootScope, $q, $timeout) {
            var variables = [
                'resolutions',
                'ncpID',
                'siteType',
                'regionName',
                'latitude',
                'longitude',
                'initiator',
                'project',
                'reason',
                'part',
                'plannedCabinetType',
                'targetCoverage',
                'rbsType',
                'bands',
                'newCandidateRRFiles'
            ];

            var variablesToCreate = [
                {
                    name: 'siteName',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'dateOfVisit',
                    type: Date,
                    value: undefined
                },
                {
                    name: 'constructionType',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'BSC',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'square',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'rbsType',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'bands',
                    type: 'Json',
                    value: []
                },
                {
                    name: 'rbsLocation',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'cellAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'renterCompany',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'transmissionAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'powerSource',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'farEndInformation',
                    type: 'Json',
                    value: []
                }
            ];

            $scope.form = {};
            $scope.editableForm = false;
            $scope.newFe = {};
            $scope.selectedAntennas = [];

            camForm.on('form-loaded', function () {
                variables.forEach(function (el) {
                    camForm.variableManager.fetchVariable(el);
                });
                $http.get('/camunda/api/engine/engine/default/task/' + camForm.taskId).then(
                        function (result) {
                            $scope.processInstanceId = result.data.processInstanceId;
                        },
                        function (error) {
                            console.log(error.data);
                        }
                );
                $scope.leasingInfo = [];
                $scope.leasingInfo.files = [];
                $scope.dictionary = {};
                $scope.cellAntenna = {
                    selectedAntennas: []
                };
                $scope.renterCompany = {};
                $scope.powerSource = {};
                $scope.dictionary = {};
                $scope.transmissionAntenna = {};
                $scope.availableBands = [{'title': 'G900', 'value': false}, {
                    'title': 'G1800',
                    'value': false
                }, {'title': 'U900', 'value': false}, {'title': 'U2100', 'value': false}, {
                    'title': 'L800',
                    'value': false
                }, {'title': 'L1800', 'value': false}, {'title': 'L2100', 'value': false}, {
                    'title': 'L2600',
                    'value': false
                }];
                $scope.rbsLocation = $scope.dictionary.rbsLocation = [{'title': 'Room'}, {'title': 'Container'}, {'title': 'Other'}, {'title': 'Outdoor'}];
                $scope.dictionary.constructionType = ['Beeline', 'Kcell', 'New', 'Tower', 'Other'];
                $scope.dictionary.equipmentType = ['-', 'FH', 'FH XC', 'MLE', 'MLHC', 'ML/TN', 'Our cable', 'Rented Channel', 'Satellite', 'TN2P', 'TN20P', 'TN6P'];
                $scope.dictionary.antennaDiameter = [
                    {'diameter':'0,3', 'weight':'13'},
                    {'diameter':'0,6', 'weight':'15'},
                    {'diameter':'1,2', 'weight':'65'},
                    {'diameter':'1,8', 'weight':'95'},
                    {'diameter':'2,4', 'weight':'158'},
                    {'diameter':'3,0', 'weight':'188'},
                    {'diameter':'3,7', 'weight':''}];

                $scope.antennasList = $scope.dictionary.antennas = [{
                    'antenna': 'ADU4518R10',
                    'description': 'LTE',
                    'dimension': '',
                    'weight': ''
                }, {'antenna': 'ADU4518R11', 'description': 'LTE', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'ADU4518R11v06',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'ADU4518R12',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'ADU4518R12v06', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'AQU4517R4',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'AQU4517R4v06',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'AQU4518R5', 'description': 'LTE', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'AQU4518R5v06',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'ATR4517R1',
                        'description': 'LTE',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'ATR4517R3v06', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'ATR4518R4',
                        'description': 'LTE',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'ATR4518R6v06',
                        'description': 'ATR4518R6v06',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'ATR4518R7', 'description': 'LTE', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'CELLMAX-O-CPUSE_VERTICAL_01DT',
                        'description': 'LTE',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'DBXLH-6565A-A2M',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'DBXLH-6565A-VTM', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'DBXLH-6565C-A2M',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'DBXLH-6565C-R2M',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'DBXLH-6565C-VTM', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'default',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'HBXX-6516DS-A2M',
                        'description': 'Andrew',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'HBX-6516DS-A1M', 'description': 'Andrew', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'HBX-6516DS-R2M',
                        'description': 'HBX-6516DS-R2M',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'HBX-6516DS-T2M',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'HBX-6516DS-VTM', 'description': 'Andrew antenna', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'HBX-6517DS-A1M',
                        'description': '1710-2180, 65 HBW, RET compatible',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'indoor', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K730376',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'K730376', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K73922',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K739489', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K739622',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'K739623', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'k739623',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K739630', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K739684',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'k739684', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K7396884',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K739785', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K741215',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'k741215', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K741316',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K741322', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'k741322',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {
                        'antenna': 'K741571',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'K741571K742149',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K741572', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K741785',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'k741785', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'k742149', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742211',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'k742211', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742215',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'k742215', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742223',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'k742223', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742224',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K7422270', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742236',
                        'description': 'Kathrain, Double, 1800-2100, 18dBi, 1,3m',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'K742264', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742270',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K742322', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K742351',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    },
                    {'antenna': 'k742515', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'k749684',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'K80010173',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K80010203', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'K80010248',
                        'description': 'IndoorMULTIBAND ,806-960MHz, 1710-2500MHz',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'K80010303',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'K80010305', 'description': '', 'dimension': '', 'weight': ''},
                    {'antenna': 'k80010305', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'K80010306',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'K80010504',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'k80010504', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'LBX-6515DS-VTM',
                        'description': 'ZTE',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'LDX-6513DS-VTM',
                        'description': 'Andrew, Single Band,OF-760to960MHz, D 132х1294х269,W-9.3Kg',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'LDX-6515DS-VTM',
                        'description': '790–960 MHz, 65°/ 17 dBi',
                        'dimension': '',
                        'weight': ''
                    },
                    {
                        'antenna': 'LDX-6516DS-VTM',
                        'description': '790-960 MHz, 65 HBW, RET compatible',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'OMNI', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'omni',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'sector', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'TBXLHA-6565B-A3M',
                        'description': '1 x 824–960 MHz and 2 x 1710–2180 MHz, 65°/ AISG 2.0 Actuator',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': 'TBXLHB-6565A-A3M',
                        'description': 'Andrew',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'TBXLHB-6565A-R2M', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': 'TBXLHB-6565A-VTM',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': 'UNKNOW', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': 'UNKNOWN',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': '1710-2500', 'description': '', 'dimension': '', 'weight': ''},
                    {'antenna': '2K742215', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': '2xK742215',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': '2xk742215',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {'antenna': '3x742223', 'description': '', 'dimension': '', 'weight': ''},
                    {'antenna': '379-623', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': '639684',
                        'description': '',
                        'dimension': '',
                        'weight': ''
                    }, {
                        'antenna': '730-376',
                        'description': '',
                        'dimension': '2574x258x103',
                        'weight': '12'
                    }, {'antenna': '730376', 'description': '', 'dimension': '', 'weight': ''},
                    {
                        'antenna': '730-382',
                        'description': '',
                        'dimension': '2254x258x103',
                        'weight': '10,5'
                    }, {'antenna': '730382', 'description': '', 'dimension': '', 'weight': ''}, {
                        'antenna': '732-448',
                        'description': '',
                        'dimension': '1294x258x103',
                        'weight': '6'
                    }, {'antenna': '732448', 'description': '', 'dimension': '', 'weight': ''},
                    {'antenna': '735-727', 'description': '', 'dimension': '492x992x190', 'weight': '10'}];
                $scope.dictionary.antennaType = [
                    {'name':'ML 0.3', 'diameter':'0,3', 'weight':'13'},
                    {'name':'ML 0.6', 'diameter':'0,6', 'weight':'15'},
                    {'name':'ML 1.2', 'diameter':'1,2', 'weight':'65'},
                    {'name':'ML 1.8', 'diameter':'1,8', 'weight':'95'},
                    {'name':'ML 2.4', 'diameter':'2,4', 'weight':'158'},
                    {'name':'ML 3.0', 'diameter':'3,0', 'weight':'188'},
                    {'name':'ML 3.7', 'diameter':'3,7', 'weight':''}];
                $scope.cableLayingType = $scope.dictionary.cableLayingType = [{'title': 'Airline'}, {'title': 'By the poles'}, {'title': 'By the walls'}, {'title': 'Under ground'}, {'title': 'Other'}];
                $scope.dictionary.legalType = ['КСК', 'ИП', 'ТОО', 'АО', 'OO', 'СПК', 'Национальный оператор  АО  "Казахтелеком"', 'Национальный оператор  АО "Казтелерадио"',
                            'Национальный оператор  АО "Казпочта"', 'Общественный фонд', 'Представительство (foreign)', 'ЭСО', 'Терком', 'Собственность Кселл',
                            'ГПК', 'Beeline', 'Физическое лицо', 'Tele2'];
                $scope.dictionary.BSC = ['AKTA_B1', 'AKTA_B2', 'AKTB_B1', 'AKTO_B1', 'AKTO_B2', 'AKTZ_B1', 'AKTZ_B2', 'ALMA_B1', 'ALMA_B2', 'ALMA_B3', 'ALMA_B4', 'ALMA_B5', 'ALMA_B6', 'ALMA_B7', 'ALMA_B8',
                    'ALMA_B9', 'ALM_B10', 'ASTA_B1', 'ASTA_B2', 'ASTA_B3', 'ASTA_B4', 'ASTA_B5', 'ATYR_B1', 'ATYR_B2', 'ATYR_B3', 'ATYR_B4', 'CHIM_B1', 'CHIM_B2', 'CHIM_B3', 'CHIM_B4', 'CHIM_B5', 'CHIM_B6',
                    'EKIB_B1', 'Ekib_b1', 'EKIB_B2', 'KARA_B1', 'KARA_B3', 'KARG_B1', 'KARG_B2', 'KARG_B3', 'KOKBSC2', 'KOKS_B1', 'KOST_B1', 'KOST_B2', 'KOST_B3', 'KZYL_B1', 'KZYL_B2',
                    'PAVBSC1', 'PAVBSC3', 'PAVL_B1', 'PETBSC1', 'PETBSC2', 'PETR_B1', 'SARY_B1', 'SEM_BSC', 'SEME_B1', 'TALD_B1', 'TARA_B1', 'TARA_B2', 'TEMR_B1', 'TURK_B1', 'URAL_B1', 'URAL_B2',
                    'USTBSC1', 'USTBSC2', 'USTK_B1', 'ZHAN_B1', 'ZHET_B1', 'ZHET_B'];
                $scope.farEndInformation = [];
            });

            camForm.on('variables-fetched', function () {
                variables.forEach(function (el) {
                    if (el === 'resolutions') {
                        if (camForm.variableManager.variables[el].value) {
                            $scope.resolutions = angular.copy(camForm.variableManager.variables[el].value);
                            $q.all($scope.resolutions.map(function (resolution) {
                                return $http.get("/camunda/api/engine/engine/default/user/" + resolution.assignee + "/profile");
                            })).then(function (profiles) {
                                profiles.forEach(function (e, index) {
                                    $scope.resolutions[index].assigneeName = (e.data.firstName ? e.data.firstName : "") + " " + (e.data.lastName ? e.data.lastName : "");
                                });
                            });
                            $q.all($scope.resolutions.map(function (resolution) {
                                return $http.get("/camunda/api/engine/engine/default/history/task?processInstanceId=" + resolution.processInstanceId + "&taskId=" + resolution.taskId);
                            })).then(function (tasks) {
                                tasks.forEach(function (e, index) {
                                    if (e.data.length > 0) {
                                        $scope.resolutions[index].taskName = e.data[0].name;
                                        try {
                                            $scope.resolutions[index].taskEndDate = new Date(e.data[0].endTime);
                                        } catch (e) {
                                            console.log(e);
                                        }
                                    }
                                });
                            });
                        } else {
                            camForm.variableManager.destroyVariable('resolutions');
                            camForm.variableManager.createVariable({
                                name: 'resolutions',
                                type: 'Json',
                                value: ''
                            });
                        }
                    } else if (el === 'applicationScanCopyFileName' || el === 'contractScanCopyFileName') {
                        $scope[el] = camForm.variableManager.variables[el].value;
                        $scope.leasingInfo.files.push(camForm.variableManager.variables[el].value);
                    } else {
                        $scope[el] = camForm.variableManager.variables[el].value;
                        $scope.leasingInfo[el] = camForm.variableManager.variables[el].value;
                    }

                    if ($scope.bands) {
                        angular.forEach($scope.availableBands, function (b) {
                            b.value = _.some($scope.bands, function (selected) {
                                return b.title === selected.title;
                            });
                        });
                    }
                });
                if(!$scope.newCandidateRRFiles){
                    $scope.newCandidateRRFiles = [];
                }


                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskResult',
                    type: 'String',
                    value: ''
                });

                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskComment',
                    type: 'String',
                    value: ''
                });

                $scope.createNewCandidateSiteTaskResult = 'Completed';
            });

            camForm.on('submit', function () {
                try {
                    if (!$scope.resolutions) {
                        $scope.resolutions = [];
                    }
                    camForm.variableManager.variableValue('createNewCandidateSiteTaskResult', $scope.createNewCandidateSiteTaskResult);
                    camForm.variableManager.variableValue('createNewCandidateSiteTaskComment', $scope.createNewCandidateSiteTaskComment);
                    camForm.variableManager.variableValue('lattitude', $scope.lattitude);
                    camForm.variableManager.variableValue('longitude', $scope.longitude);

                    $scope.resolutions.push({
                        processInstanceId: $scope.processInstanceId,
                        assignee: $rootScope.authentication.name,
                        resolution: $scope.createNewCandidateSiteTaskResult,
                        comment: $scope.createNewCandidateSiteTaskComment,
                        taskId: camForm.taskId
                    });
                    camForm.variableManager.variableValue('resolutions', $scope.resolutions);

                    angular.forEach(variablesToCreate, function (el) {
                        camForm.variableManager.createVariable({
                            name: el.name,
                            type: el.type,
                            value: $scope[el]
                        });
                    });


                } catch (e){
                    console.log(e);
                }
                console.log('submitted');
            });

            $scope.$watch('availableBands', function (availableBands) {
                $scope.selectedBands = [];
                availableBands.forEach(function (b) {
                    if (b.value) {
                        $scope.selectedBands.push(b)
                    }
                })
            }, true);

            $scope.addFE = function () {
                // if ($scope.farEndInformation.length == 0 || $scope.farEndInformation[$scope.farEndInformation.length - 1].saved ) {
                //     $scope.farEndInformation.push({});
                //     $scope.currentFE = $scope.farEndInformation.length - 1;
                // }
                $scope.newFe = {};
                $scope.currentFE = $scope.farEndInformation.length;
                $scope.editableForm = true;
            };

            $scope.editFE = function (index) {
                // if ($scope.farEndInformation.length == 0 || $scope.farEndInformation[$scope.farEndInformation.length - 1].saved) {
                //     $scope.currentFE = index;
                // }
                $scope.newFe = $scope.farEndInformation[index];
                $scope.currentFE = index;
                $scope.editableForm = true;
            };
            $scope.deleteFE = function (index) {
                $scope.farEndInformation.splice(index, 1);
            };
            $scope.saveFE = function (index) {
                console.log('test: ' + $scope.form.fe_form);

                if ($scope.form.fe_form.$valid) {
                    delete $scope.newFe.submitted;
                    $scope.farEndInformation[index] = $scope.newFe;
                    $scope.newFe = {};
                    $scope.editableForm = false;
                } else {
                    $scope.newFe.submitted = true;
                }
            };
            $scope.cancelFE = function () {
                $scope.editableForm = false;
            };

            var currentDate = new Date();

            $scope.datepickerOptions = {
                minDate: currentDate
            };

            $scope.fromFirstToSecondWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.cellAntenna.selectedAntennas.push($scope.antennasList[index]);
                        $scope.antennasList.splice(index, 1);
                    });
                }
                $scope.firstMultiselect = [];
            };

            $scope.fromSecondToFirstWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.antennasList.push($scope.antennasList[index]);
                        $scope.cellAntenna.selectedAntennas.splice(index, 1);
                    });
                }
                $scope.secondMultiselect = [];
            };


            $scope.getSite = function (val) {
                return $http.get('/asset-management/api/sites/search/findByNameIgnoreCaseContaining?name=' + val).then(
                        function (response) {
                            var sites = _.flatMap(response.data._embedded.sites, function (s) {
                                if (s.params.site_name) {
                                    return s.params.site_name.split(',').map(function (sitename) {
                                        return {
                                            name: s.name,
                                            id: s._links.self.href.substring(s._links.self.href.lastIndexOf('/') + 1),
                                            site_name: sitename
                                        };
                                    })
                                } else {
                                    return [];
                                }
                            });
                            return sites;
                        }
                );
            };

            $scope.siteSelected = function ($item) {
                $scope.newFe.farEndName = $item.site_name;
                $scope.newFe.farEndId = $item.name;
                $scope.newFe.farEndSequence = $item.id;
            };

            $scope.preSubmit = function () {
                var deferred = $q.defer();
                if($scope.farEndInformation && $scope.farEndInformation.length < 3){
                    deferred.reject('At least 3 Far End Information should be added!!!');
                } else {
                    deferred.resolve();
                }
                return deferred.promise;
            }

            $scope.defineByAntennaType = function (antennaType) {
                if(antennaType){
                    angular.forEach($scope.dictionary.antennaType, function (type) {
                        if(type.name === antennaType){
                            $scope.transmissionAntenna.diameter = type.diameter;
                            $scope.transmissionAntenna.weight = type.weight;
                        }
                    });
                } else {
                    $scope.transmissionAntenna.diameter = undefined;
                    $scope.transmissionAntenna.weight = undefined;
                }
            };

            $scope.defineWeightByAntennaDiameter = function (antennaDiameter) {
                if(antennaDiameter){
                    angular.forEach($scope.dictionary.antennaDiameter, function (d) {
                        if(d.diameter === antennaDiameter){
                            $scope.newFe.weight = d.weight;
                        }
                    });
                } else {
                    $scope.newFe.weight = undefined;
                }
            };

            $scope.fileSelected = function (el, fileName) {
                $timeout(function () {
                    $scope.$apply(function () {
                        uploadFileToMinio(el.files[0], fileName);
                    });
                })
            };

            function uploadFileToMinio(file, fileName) {
                var fileIndex = $scope[fileName].length;

                var fileToUpload = {
                    name: file.name.replace(/[/\\?%*:|"<>]/g, '-'),
                    isNew: true,
                    path: $scope.processInstanceId + '/' + camForm.taskId + '/' + file.name.replace(/[/\\?%*:|"<>]/g, '-')
                };
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/put/' + fileToUpload.path,
                    transformResponse: []
                }).then(function (response) {
                    $http.put(response.data, file, {headers: {'Content-Type': undefined}}).then(
                        function () {
                            $scope[fileName].push(fileToUpload);
                            angular.element(document.querySelector('#' + fileName + '_' + fileIndex)).val(null);
                        },
                        function (error) {
                            console.log(error.data);
                        }
                    );
                }, function(error){
                    console.log(error.data);
                });
            }

            $scope.clearFile = function (list, fileIndex) {
                $scope[list].splice(fileIndex, 1);
            }

            $scope.fileDownload = function (file) {
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/get/' + file.path,
                    transformResponse: []
                }).then(function (response) {
                    document.getElementById('fileDownloadIframe').src = response.data;
                }, function(error){
                    console.log(error.data);
                });
            }
        }]);
    </script>
    <leasing-detail leasing-info="leasingInfo"></leasing-detail>

    <tabset class="my-tab-head my-tab" justified="true" id="jobRequestId">
        <tab>
            <tab-heading><span class="glyphicon glyphicon-check"></span> Candidate Information </tab-heading>
            <div class="col-sm-12">
                <br>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Site name:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="siteName" name="siteName" required ng-model="siteName" cam-variable-name="siteName" cam-variable-type="String">
                        <label class="error" ng-show="kcell_form.siteName.$error.required && ( kcell_form.siteName.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Date of Visit:</label>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <input required type="text" ng-model="dateOfVisit" name="dateOfVisit" class="form-control" datepicker-popup="dd.MM.yyyy" is-open="dateOfVisitFieldOpened" id="dateOfVisit" />
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="dateOfVisitFieldOpened = true">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                        <label class="error" ng-show="kcell_form.dateOfVisit.$error.required && ( kcell_form.dateOfVisit.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Latitude:</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="latitude" name="latitude" required ng-model="latitude">
                        <label class="error" ng-show="kcell_form.latitude.$error.required && ( kcell_form.latitude.$touched || view.submitted)">Required field</label>
                    </div>
                    <label class="col-sm-4 control-label">E.g. "N 12 34 56,7" or "N 12,345678"</label>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Longitude:</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="longitude" name="longitude" required ng-model="longitude">
                        <label class="error" ng-show="kcell_form.longitude.$error.required && ( kcell_form.longitude.$touched || view.submitted)">Required field</label>
                    </div>
                    <label class="col-sm-4 control-label">E.g. "E 12 34 56,7" or "E 12,345678"</label>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Сonstruction type:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="constructionType" name="constructionType"
                                cam-variable-name="constructionType" cam-variable-type="String"
                                ng-model="constructionType"
                                required>
                            <option ng-repeat="c in dictionary.constructionType">{{c}}</option>
                        </select>
                        <label class="error" ng-show="kcell_form.constructionType.$error.required && ( kcell_form.constructionType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">BSC:</label>
                    <div class="col-sm-8">
                        <input type="text" ng-model="BSC" typeahead="s for s in dictionary.BSC | filter:$viewValue" class="form-control" placeholder="Start typing...">
                        <label class="error" ng-show="kcell_form.BSC.$error.required && ( kcell_form.BSC.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Square:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="square" name="square" ng-model="square" cam-variable-name="square" cam-variable-type="String">
                        <label class="error" ng-show="kcell_form.square.$error.required && ( kcell_form.square.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">RBS Type:</label>
                    <div class="col-sm-8">
                        {{rbsType}}
                        <label class="error" ng-show="kcell_form.rbsType.$error.required && ( kcell_form.rbsType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Bands:</label>
                    <div class="col-sm-8">
                        <span ng-repeat="band in selectedBands">{{$index == 0?' ': ' + ' }}{{band.title}}</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">RBS Location:</label>
                    <div class="col-sm-8">
                        <div class="form-check col-sm-6" ng-repeat="l in rbsLocation track by $index">
                            <input type="checkbox" ng-model="l.value" class="form-check-input" id="{{'check' + $index}}">
                            <label class="form-check-label" for="{{'check' + $index}}">{{ l.title }}</label>
                        </div>
                    </div>
                </div>
                <h4>Cell antenna information</h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Antennas:</label>
                    <div class="col-sm-8">
                        <div class="form-check col-sm-5">
                            <select multiple style="overflow-y: scroll; height: 20vh" ng-model="firstMultiselect" class="form-control" id="sel3">
                                <option ng-repeat="d in antennasList" value="{{$index}}">{{d.antenna}}</option>
                            </select>
                        </div>
                        <div class="form-check col-sm-2">
                            <div class="btn-group-vertical btn-group-xs pull-right col-sm-pull-5">
                                <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right" ng-click="fromFirstToSecondWindow(firstMultiselect)"></span></button>
                                <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left" ng-click="fromSecondToFirstWindow(secondMultiSelect)"></span></button>
                            </div>
                        </div>
                        <div class="form-check col-sm-5">
                            <select multiple class="form-control" style="overflow-y: scroll; height: 20vh" ng-model="secondMultiSelect" id="sel4">
                                <option ng-repeat="a in cellAntenna.selectedAntennas">{{a.antenna}}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Cell Antenna quantity:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="antennasQuantity" name="antennasQuantity" ng-model="cellAntenna.quantity">
                        <label class="error" ng-show="kcell_form.antennasQuantity.$error.required && ( kcell_form.antennasQuantity.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Dimensions And Weight:</label>
                    <div class="col-sm-8">
                        <table class="table table-condensed" ng-show="cellAntenna.selectedAntennas && cellAntenna.selectedAntennas.length>0">
                            <thead>
                                <tr>
                                    <td>Antenna name</td>
                                    <td>Dimensions</td>
                                    <td>Weigth</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="s in cellAntenna.selectedAntennas">
                                    <td>{{s.antenna}}</td>
                                    <td ng-show="s.dimension">
                                        {{s.dimension}}
                                    </td>
                                    <td ng-hide="s.dimension">
                                        <input class="form-control" id="dimensions_{{$index}}" name="dimensions_{{$index}}" ng-model="s.newDimension" placeholder="1000x100x100">
                                    </td>
                                    <td ng-show="s.weight">
                                        {{s.weight}}
                                    </td>
                                    <td ng-hide="s.weight">
                                        <input class="form-control" id="weight_{{$index}}" name="weight_{{$index}}" ng-model="s.newWeight" placeholder="10">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Suspension height of antennas:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="suspensionHeight" name="suspensionHeight"  ng-model="cellAntenna.suspensionHeight">
                        <label class="error" ng-show="kcell_form.suspensionHeight.$error.required && ( kcell_form.suspensionHeight.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Azimuth:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="azimuth" name="azimuth"  ng-model="cellAntenna.azimuth">
                        <label class="error" ng-show="kcell_form.azimuth.$error.required && ( kcell_form.azimuth.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Address</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" ng-model="cellAntenna.address" name="address" maxlength="500" rows="3" style="resize:none"></textarea>
                        <label class="error" ng-show="kcell_form.address.$error.required && ( kcell_form.address.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <h4>Renter Company</h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Legal type:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="legalType" name="legalType"
                                ng-model="renterCompany.legalType">
                            <option ng-repeat="l in dictionary.legalType">{{l}}</option>
                        </select>
                        <label class="error" ng-show="kcell_form.legalType.$error.required && ( kcell_form.legalType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Legal name:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="RClegalName" name="RClegalName"  ng-model="renterCompany.legalName">
                        <label class="error" ng-show="kcell_form.RClegalName.$error.required && ( kcell_form.RClegalName.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Legal address:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="legalAddress" name="legalAddress"  ng-model="renterCompany.legalAddress" >
                        <label class="error" ng-show="kcell_form.legalAddress.$error.required && ( kcell_form.legalAddress.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Tel./Fax:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="telFax" name="telFax"  ng-model="renterCompany.telFax">
                        <label class="error" ng-show="kcell_form.telFax.$error.required && ( kcell_form.telFax.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="firstLeaderName" name="firstLeaderName"  ng-model="renterCompany.firstLeaderName" >
                        <label class="error" ng-show="kcell_form.firstLeaderName.$error.required && ( kcell_form.firstLeaderName.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="firstLeaderPos" name="firstLeaderPos"  ng-model="renterCompany.firstLeaderPos" >
                        <label class="error" ng-show="kcell_form.firstLeaderPos.$error.required && ( kcell_form.firstLeaderPos.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Email:</label>
                    <div class="col-sm-8">
                        <input class="form-control email" id="email" name="azimuth"  ng-model="renterCompany.email" >
                        <label class="error" ng-show="kcell_form.email.$error.required && ( kcell_form.email.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Contract Person:</label>
                    <div class="col-sm-8"></div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <label class="col-sm-1 control-label">Name:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="name" name="name"  ng-model="renterCompany.name" >
                        <label class="error" ng-show="kcell_form.name.$error.required && ( kcell_form.name.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <label class="col-sm-1 control-label">Position:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="position" name="position"  ng-model="renterCompany.position" >
                        <label class="error" ng-show="kcell_form.position.$error.required && ( kcell_form.position.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Contract Information:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="contractInfo" name="contractInfo"  ng-model="renterCompany.contractInfo" >
                        <label class="error" ng-show="kcell_form.contractInfo.$error.required && ( kcell_form.contractInfo.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <h4>Transmission Antenna</h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">TR Antenna type:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="antennaType" name="antennaType"
                                ng-model="transmissionAntenna.antennaType"
                                ng-change="defineByAntennaType(transmissionAntenna.antennaType)">
                            <option value="">-</option>
                            <option ng-repeat="a in dictionary.antennaType" value="{{a.name}}">{{a.name}}</option>
                        </select>
                        <label class="error" ng-show="kcell_form.antennaType.$error.required && ( kcell_form.antennaType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">TR Antenna quantity:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="antennaQuantity" name="antennaQuantity"  ng-model="transmissionAntenna.antennaQuantity">
                        <label class="error" ng-show="kcell_form.antennaQuantity.$error.required && ( kcell_form.antennaQuantity.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Frequency Band:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="frequencyBand" name="frequencyBand"  ng-model="transmissionAntenna.frequencyBand" >
                        <label class="error" ng-show="kcell_form.frequencyBand.$error.required && ( kcell_form.frequencyBand.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Diameter:</label>
                    <div class="col-sm-8">{{transmissionAntenna.diameter}}</div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Weight:</label>
                    <div class="col-sm-8">{{transmissionAntenna.weight}}</div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Suspension height of antennas:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="TRSuspensionHeight" name="TRSuspensionHeight"  ng-model="transmissionAntenna.suspensionHeight" >
                        <label class="error" ng-show="kcell_form.TRSuspensionHeight.$error.required && ( kcell_form.TRSuspensionHeight.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Azimuth:</label>
                    <div class="col-sm-8">
                        <input class="form-control email" id="TRazimuth" name="TRazimuth"  ng-model="transmissionAntenna.azimuth" >
                        <label class="error" ng-show="kcell_form.TRazimuth.$error.required && ( kcell_form.TRazimuth.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <h4>Power Source</h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Does renter agree to provide us 3 Phase/3.5kWof electrical energy?:</label>
                    <div class="col-sm-8">
                        <label class="radio-inline">
                            <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase" value="Yes"> Yes
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase" value="No"> No
                        </label>
                        <label class="error" ng-show="kcell_form.provideUs3Phase.$error.required && ( kcell_form.provideUs3Phase.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Cable length to connection point (in meters):</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="cableLength" name="cableLength"  ng-model="powerSource.cableLength" >
                        <label class="error" ng-show="kcell_form.cableLength.$error.required && ( kcell_form.cableLength.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Cable laying type:</label>
                    <div class="col-sm-8">
                        <div class="form-check col-sm-6" ng-repeat="t in cableLayingType track by $index">
                            <input type="checkbox" ng-model="t.value" class="form-check-input" id="{{'check' + $index}}">
                            <label class="form-check-label" for="{{'check' + $index}}">{{ t.title }}</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Does renter agree to receive monthly paymentfor consumed electrical energy according to ourpower counters displays buy the bank transactionsand give us invoices?</label>
                    <div class="col-sm-8">
                        <label class="radio-inline">
                            <input type="radio" name="agreeToReceiveMonthlyPayment" ng-model="powerSource.agreeToReceiveMonthlyPayment" value="Yes"> Yes
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="agreeToReceiveMonthlyPayment" ng-model="powerSource.agreeToReceiveMonthlyPayment" value="No"> No
                        </label>
                        <label class="error" ng-show="kcell_form.agreeToReceiveMonthlyPayment.$error.required && ( kcell_form.agreeToReceiveMonthlyPayment.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Closest public (RES) electrical line:</label>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon1">0,4 kV</span>
                            <input class="form-control" id="closestPublic04" name="closestPublic04"  ng-model="powerSource.closestPublic04" >
                        </div>
                        <label class="error" ng-show="kcell_form.closestPublic04.$error.required && ( kcell_form.closestPublic04.$touched || view.submitted)">Required field</label>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon2">10 kV</span>
                            <input class="form-control" id="closestPublic10" name="closestPublic10"  ng-model="powerSource.closestPublic10" >
                        </div>
                        <label class="error" ng-show="kcell_form.closestPublic10.$error.required && ( kcell_form.closestPublic10.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Download RR:</label>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Upload RR:</label>
                    <div class="col-sm-8">
                        <div ng-show="newCandidateRRFiles.length > 0" class="input-group" ng-repeat="file in newCandidateRRFiles">
                            {{$index + 1}}.
                            <a ng-click="fileDownload(file)">{{file.name}}</a> | <a ng-click="clearFile('newCandidateRRFiles', $index)"><i class="glyphicon glyphicon-trash"></i></a>
                        </div>
                        <input type="file" class="form-control" id="newCandidateRRFiles_{{newCandidateRRFiles.value.length}}" name="newCandidateRRFiles_{{newCandidateRRFiles.value.length}}" ng-model="file.file" onchange="angular.element(this).scope().fileSelected(this, 'newCandidateRRFiles')"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Comments related to New Candidate:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" ng-model="newCandidateComments" name="newCandidateComments" maxlength="500" rows="4" style="resize:none"
                                  cam-variable-name="newCandidateComments" cam-variable-type="String"></textarea>
                    </div>
                </div>
            </div>
        </tab>
        <tab>
            <tab-heading>
                <span class="glyphicon glyphicon-list"></span> Far End Information
            </tab-heading>
            <div class="col-sm-12">
                <br>
                <div class="col-sm-10">
                    <table class="table table-bordered ">
                        <thead>
                            <td width="10%">ПН</td>
                            <td width="60%">Far End Name</td>
                            <td width="30%">Действие</td>
                        </thead>
                        <tbody>
                        <tr ng-repeat="fe in farEndInformation">
                            <td>{{ $index + 1 }}</td>
                            <td>{{ fe.farEndName}}</td>
                            <td><a ng-click="editFE($index)">Изменить</a><a class="glyphicon glyphicon-trash pull-right" ng-click="deleteFE($index)"></a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-default" ng-click="addFE()"> <span class="glyphicon glyphicon-plus"></span> add FE</button>
                </div>
                <ng-form name="form.fe_form">
                    <div class="form-group-lg col-sm-12" ng-if="editableForm">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Far End Name:</label>
                            <div class="col-sm-8">
                                <input type="text" ng-model="newFe.farEndName" name="farEndName" typeahead="site as sites.site_name for sites in getSite($viewValue) | filter:$viewValue" typeahead-on-select="siteSelected($item,$model,$label)" class="form-control" required autocomplete="off" placeholder="Far End Name">
                                <input type="hidden" ng-model="newFe.farEndId" name="farEndId" required/>
                                <label class="error" ng-if="form.fe_form.farEndName.$error.required && ( form.fe_form.farEndName.$touched || newFe.submitted)">Required field</label>
                                <label class="error" ng-if="form.fe_form.farEndId.$error.required && ( form.fe_form.farEndName.$touched || newFe.submitted)">Please select from list</label>
                            </div>
                        </div>
                        <div class="form-group-lg">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Far End Address:</label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" ng-model="newFe.farEndAddress" name="farEndAddress" maxlength="500" rows="4" style="resize:none"></textarea>
                                    <label class="error" ng-show="form.fe_form.farEndAddress.$error.required && ( form.fe_form.farEndAddress.$touched || newFe.submitted)">Required field</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Contact Information:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="contractInformation" name="contractInformation"  ng-model="newFe.contractInformation" >
                                <label class="error" ng-show="form.fe_form.contractInformation.$error.required && ( form.fe_form.contractInformation.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Square:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeSquare" name="FeSquare"  ng-model="newFe.square" >
                                <label class="error" ng-show="form.fe_form.FeSquare.$error.required && ( form.fe_form.FeSquare.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Equipment type:</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="equipmentType" name="equipmentType"
                                        ng-model="newFe.equipmentType">
                                    <option ng-repeat="e in dictionary.equipmentType">{{e}}</option>
                                </select>
                                <label class="error" ng-show="form.fe_form.equipmentType.$error.required && ( form.fe_form.equipmentType.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Antennas quantity:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeAntennasQuantity" name="FeAntennasQuantity"  ng-model="newFe.antennasQuantity" >
                                <label class="error" ng-show="form.fe_form.FeAntennasQuantity.$error.required && ( form.fe_form.FeAntennasQuantity.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Antenna diameter:</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="antennaDiameter" name="antennaDiameter"
                                        ng-model="newFe.antennaDiameter" 
                                        ng-change="defineWeightByAntennaDiameter(newFe.antennaDiameter)">
                                    <option ng-repeat="d in dictionary.antennaDiameter" value="{{d.diameter}}">{{d.diameter}}</option>
                                </select>
                                <label class="error" ng-show="form.fe_form.antennaDiameter.$error.required && ( form.fe_form.antennaDiameter.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Weight:</label>
                            <div class="col-sm-8">
                                {{newFe.weight}}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">TX Frequency:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="TXFrequency" name="TXFrequency"  ng-model="newFe.TXFrequency" >
                                <label class="error" ng-show="form.fe_form.TXFrequency.$error.required && ( form.fe_form.TXFrequency.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">RX Frequency:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="RXFrequency" name="RXFrequency"  ng-model="newFe.RXFrequency" >
                                <label class="error" ng-show="form.fe_form.RXFrequency.$error.required && ( form.fe_form.RXFrequency.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Suspension height of antennas:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeSuspensionHeight" name="FeSuspensionHeight"  ng-model="newFe.suspensionHeight" >
                                <label class="error" ng-show="form.fe_form.FeSuspensionHeight.$error.required && ( form.fe_form.FeSuspensionHeight.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Azimuth:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeAzimuth" name="FeAzimuth"  ng-model="newFe.azimuth" >
                                <label class="error" ng-show="form.fe_form.FeAzimuth.$error.required && ( form.fe_form.FeAzimuth.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Сonstruction type:</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="FeConstructionType" name="FeConstructionType"
                                        ng-model="newFe.constructionType">
                                    <option ng-repeat="c in dictionary.constructionType">{{c}}</option>
                                </select>
                                <label class="error" ng-show="form.fe_form.FeConstructionType.$error.required && ( form.fe_form.FeConstructionType.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Results of visit of objects:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="ResultsOfVisit" name="ResultsOfVisit"  ng-model="newFe.ResultsOfVisit" >
                                <label class="error" ng-show="form.fe_form.ResultsOfVisit.$error.required && ( form.fe_form.ResultsOfVisit.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Survey Date:</label>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <input type="text" ng-model="newFe.surveyDate" name="surveyDate" class="form-control" datepicker-popup="dd.MM.yyyy" is-open="surveyDateFieldOpened" id="surveyDate" />
                                    <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="surveyDateFieldOpened = true">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </button>
                                </span>
                                </div>
                                <label class="error" ng-show="form.fe_form.surveyDate.$error.required && ( form.fe_form.surveyDate.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group-lg">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Comments:</label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" ng-model="newFe.comments" name="FeComments" maxlength="500" rows="4" style="resize:none"></textarea>
                                    <label class="error" ng-show="form.fe_form.FeComments.$error.required && ( form.fe_form.FeComments.$touched || newFe.submitted)">Required field</label>
                                </div>
                            </div>
                        </div>
                        <h4>Far End Renter Company</h4>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal name:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERClegalName" name="FERClegalName"  ng-model="newFe.renterCompany.legalName" >
                                <label class="error" ng-show="form.fe_form.FERClegalName.$error.required && ( form.fe_form.FERClegalName.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal address:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCLegalAddress" name="FERCLegalAddress"  ng-model="newFe.renterCompany.legalAddress" >
                                <label class="error" ng-show="form.fe_form.FERCLegalAddress.$error.required && ( form.fe_form.FERCLegalAddress.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tel./Fax:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCTelFax" name="FERCTelFax"  ng-model="newFe.renterCompany.telFax" >
                                <label class="error" ng-show="form.fe_form.FERCTelFax.$error.required && ( form.fe_form.FERCTelFax.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCFirstLeaderName" name="FERCFirstLeaderName"  ng-model="newFe.renterCompany.firstLeaderName" >
                                <label class="error" ng-show="form.fe_form.FERCFirstLeaderName.$error.required && ( form.fe_form.FERCFirstLeaderName.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCFirstLeaderPosition" name="FERCFirstLeaderPosition"  ng-model="newFe.renterCompany.firstLeaderPosition" >
                                <label class="error" ng-show="form.fe_form.FERCFirstLeaderPosition.$error.required && ( form.fe_form.FERCFirstLeaderPosition.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Email:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCemail" name="FERCemail"  ng-model="newFe.renterCompany.email" >
                                <label class="error" ng-show="form.fe_form.FERCemail.$error.required && ( form.fe_form.FERCemail.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Contract Person:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERC_ContractPerson" name="FERC_ContractPerson"  ng-model="newFe.FERC_ContractPerson.contractPerson" >
                                <label class="error" ng-show="form.fe_form.FERC_ContractPerson.$error.required && ( form.fe_form.FERC_ContractPerson.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Name:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERC_Name" name="FERC_Name"  ng-model="newFe.renterCompany.name" >
                                <label class="error" ng-show="form.fe_form.FERC_Name.$error.required && ( form.fe_form.FERC_Name.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Position:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERC_Position" name="FERC_Position"  ng-model="newFe.renterCompany.position" >
                                <label class="error" ng-show="form.fe_form.FERC_Position.$error.required && ( form.fe_form.FERC_Position.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Contract Information:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERC_ContractInformation" name="FERC_ContractInformation"  ng-model="newFe.renterCompany.contractInformation" >
                                <label class="error" ng-show="form.fe_form.FERC_ContractInformation.$error.required && ( form.fe_form.FERC_ContractInformation.$touched || newFe.submitted )">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Far End Comments:</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" ng-model="farEndComments" name="farEndComments" maxlength="500" rows="4" style="resize:none"
                                          cam-variable-name="farEndComments" cam-variable-type="String"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success btn-sm" ng-click="saveFE(currentFE);">Done</button>
                        <button type="button" class="btn btn-primary btn-sm" ng-click="cancelFE();">Cancel</button>
                        <br>
                    </div>
                </ng-form>
            </div>
        </tab>
    </tabset>

    <div class="form-group">
        <label class="col-sm-3 control-label">Task Comments</label>
        <div class="col-sm-9">
            <textarea class="form-control" ng-model="createNewCandidateSiteTaskComment" name="createNewCandidateSiteTaskComment" placeholder="Comments..." maxlength="500" rows="4" style="resize:none"></textarea>
            <label class="error" ng-show="kcell_form.createNewCandidateSiteTaskComment.$error.required && ( kcell_form.createNewCandidateSiteTaskComment.$touched || view.submitted)">Required field</label>
        </div>
    </div>
    <accordion>
        <accordion-group is-open="isHistoryOpen">
            <accordion-heading>
                History <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
            </accordion-heading>
            <table class="table">
                <thead>
                <tr>
                    <th>Activity</th>
                    <th>Assignee</th>
                    <th>Resolution</th>
                    <th>Date</th>
                    <th>Comment</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="resolution in resolutions">
                    <td>{{resolution.taskName}}</td>
                    <td>{{resolution.assigneeName}}</td>
                    <td>{{'task.resolution.'+resolution.resolution | translate}}</td>
                    <td>{{resolution.taskEndDate | date: 'dd.MM.yyyy HH:mm'}}</td>
                    <td>{{resolution.comment}}</td>
                </tr>
                </tbody>
            </table>
        </accordion-group>
    </accordion>
</form>
