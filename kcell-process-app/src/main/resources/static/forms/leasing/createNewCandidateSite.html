<form role="form" class="form-horizontal" name="kcell_form" novalidate>
    <script cam-script type="text/form-script">
        inject(['$scope', '$http', 'Uri', '$rootScope', '$q', '$timeout', function ($scope, $http, Uri, $rootScope, $q, $timeout) {
            var variables = [
                'resolutions',
                'ncpID',
                'siteType',
                'regionName',
                'latitude',
                'longitude',
                'initiator',
                'project',
                'reason',
                'part',
                'plannedCabinetType',
                'targetCoverage',
                'rbsType',
                'bands',
                'candidate',
                'cellAntenna',
                'renterCompany',
                'transmissionAntenna',
                'powerSource',
                'farEndInformation'
            ];

            var variablesToCreate = [
                {
                    name: 'candidate',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'cellAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'renterCompany',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'transmissionAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'powerSource',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'farEndInformation',
                    type: 'Json',
                    value: []
                },
                {
                    name: 'siteObjectType',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'legalType',
                    type: 'String',
                    value: 'other'
                },
                {
                    name: 'newCandidateRRFiles',
                    type: 'Json',
                    value: []
                }
            ];

            $scope.candidate = {};
            $scope.form = {};
            $scope.editableForm = false;
            $scope.newFe = {};
            $scope.selectedAntennas = [];

            camForm.on('form-loaded', function () {
                variables.forEach(function (el) {
                    camForm.variableManager.fetchVariable(el);
                });
                $http.get('/camunda/api/engine/engine/default/task/' + camForm.taskId).then(
                    function (result) {
                        $scope.processInstanceId = result.data.processInstanceId;
                    },
                    function (error) {
                        console.log(error.data);
                    }
                );
                $scope.leasingInfo = [];
                $scope.leasingInfo.files = [];
                $scope.dictionary = {};
                $scope.cellAntenna = {
                    selectedAntennas: []
                };
                $scope.renterCompany = {};
                $scope.powerSource = {};
                $scope.dictionary = {};
                $scope.transmissionAntenna = {};

                $http.get('/api/leasingCatalogs?version=1').then(
                    function(result){
                        angular.extend($scope.dictionary, result.data);
                        $scope.candidate.rbsLocation = $scope.dictionary.rbsLocation;
                        $scope.antennasList = $scope.dictionary.antennas;
                        $scope.powerSource.cableLayingType = $scope.dictionary.cableLayingType;
                        $scope.availableBands = $scope.dictionary.bands;
                    },
                    function(error){
                        console.log(error);
                    }
                );
                $scope.farEndInformation = [];
            });

            camForm.on('variables-fetched', function () {
                variables.forEach(function (el) {
                    if(camForm.variableManager.variables[el].value){
                        $scope[el] = camForm.variableManager.variables[el].value;
                        $scope.leasingInfo[el] = camForm.variableManager.variables[el].value;
                    }

                    if ($scope.bands) {
                        angular.forEach($scope.availableBands, function (b) {
                            b.value = _.some($scope.bands, function (selected) {
                                return b.title === selected.title;
                            });
                        });
                    }
                });
                if(!$scope.newCandidateRRFiles){
                    $scope.newCandidateRRFiles = [];
                }

                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskResult',
                    type: 'String',
                    value: ''
                });

                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskComment',
                    type: 'String',
                    value: ''
                });

                $scope.createNewCandidateSiteTaskResult = 'Completed';
                $scope.candidate.longitude = $scope.longitude;
                $scope.candidate.latitude = $scope.latitude;
                $scope.candidate.rbsType = $scope.rbsType;
            });

            camForm.on('submit', function () {
                camForm.variableManager.variableValue('createNewCandidateSiteTaskResult', $scope.createNewCandidateSiteTaskResult);
                camForm.variableManager.variableValue('createNewCandidateSiteTaskComment', $scope.createNewCandidateSiteTaskComment);

                angular.forEach(variablesToCreate, function (el) {
                    if(camForm.variableManager.variables[el].type){
                        camForm.variableManager.variableValue(el.name, $scope[el.name]);
                    } else {
                        camForm.variableManager.createVariable({
                            name: el.name,
                            type: el.type,
                            value: $scope[el.name]
                        });
                    }
                });
            });

            $scope.$watch('availableBands', function (availableBands) {
                $scope.candidate.selectedBands = [];
                if (availableBands){
                    availableBands.forEach(function (b) {
                        if (b.value) {
                            $scope.candidate.selectedBands.push(b);
                        }
                    })
                }
            }, true);

            $scope.addFE = function () {

                $scope.newFe = {};
                $scope.currentFE = $scope.farEndInformation.length;
                $scope.editableForm = true;
            };

            $scope.editFE = function (index) {
                // if ($scope.farEndInformation.length == 0 || $scope.farEndInformation[$scope.farEndInformation.length - 1].saved) {
                //     $scope.currentFE = index;
                // }
                $scope.newFe = $scope.farEndInformation[index];
                $scope.currentFE = index;
                $scope.editableForm = true;
            };
            $scope.deleteFE = function (index) {
                $scope.farEndInformation.splice(index, 1);
            };
            $scope.saveFE = function (index) {
                if ($scope.form.fe_form.$valid) {
                    delete $scope.newFe.submitted;
                    $scope.farEndInformation[index] = $scope.newFe;
                    $scope.newFe = {};
                    $scope.editableForm = false;
                } else {
                    $scope.newFe.submitted = true;
                }
            };
            $scope.cancelFE = function () {
                $scope.editableForm = false;
            };

            var currentDate = new Date();

            $scope.datepickerOptions = {
                minDate: currentDate
            };

            $scope.fromFirstToSecondWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.cellAntenna.selectedAntennas.push($scope.antennasList[index]);
                        $scope.antennasList.splice(index, 1);
                    });
                }
                $scope.firstMultiselect = [];
            };

            $scope.fromSecondToFirstWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.antennasList.push($scope.antennasList[index]);
                        $scope.cellAntenna.selectedAntennas.splice(index, 1);
                    });
                }
                $scope.secondMultiselect = [];
            };


            $scope.getSite = function (val) {
                return $http.get('/asset-management/api/sites/search/findByNameIgnoreCaseContaining?name=' + val).then(
                        function (response) {
                            var sites = _.flatMap(response.data._embedded.sites, function (s) {
                                if (s.params.site_name) {
                                    return s.params.site_name.split(',').map(function (sitename) {
                                        return {
                                            name: s.name,
                                            id: s._links.self.href.substring(s._links.self.href.lastIndexOf('/') + 1),
                                            site_name: sitename
                                        };
                                    })
                                } else {
                                    return [];
                                }
                            });
                            return sites;
                        }
                );
            };

            $scope.siteSelected = function ($item) {
                $scope.newFe.farEndName = $item.site_name;
                $scope.newFe.farEndId = $item.name;
                $scope.newFe.farEndSequence = $item.id;
            };

            $scope.defineByAntennaType = function (antennaType) {
                if(antennaType){
                    angular.forEach($scope.dictionary.antennaType, function (type) {
                        if(type.name === antennaType){
                            $scope.transmissionAntenna.diameter = type.diameter;
                            $scope.transmissionAntenna.weight = type.weight;
                        }
                    });
                } else {
                    $scope.transmissionAntenna.diameter = undefined;
                    $scope.transmissionAntenna.weight = undefined;
                }
            };

            $scope.defineWeightByAntennaDiameter = function (antennaDiameter) {
                if(antennaDiameter){
                    angular.forEach($scope.dictionary.antennaDiameter, function (d) {
                        if(d.diameter === antennaDiameter){
                            $scope.newFe.weight = d.weight;
                        }
                    });
                } else {
                    $scope.newFe.weight = undefined;
                }
            };

            $scope.fileSelected = function (el, fileName) {
                $timeout(function () {
                    $scope.$apply(function () {
                        uploadFileToMinio(el.files[0], fileName);
                    });
                })
            };

            function uploadFileToMinio(file, fileName) {
                var fileIndex = $scope[fileName].length;

                var fileToUpload = {
                    name: file.name.replace(/[/\\?%*:|"<>]/g, '-'),
                    isNew: true,
                    path: $scope.processInstanceId + '/' + camForm.taskId + '/' + file.name.replace(/[/\\?%*:|"<>]/g, '-')
                };
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/put/' + fileToUpload.path,
                    transformResponse: []
                }).then(function (response) {
                    $http.put(response.data, file, {headers: {'Content-Type': undefined}}).then(
                        function () {
                            $scope[fileName].push(fileToUpload);
                            angular.element(document.querySelector('#' + fileName)).val(null);
                        },
                        function (error) {
                            console.log(error.data);
                        }
                    );
                }, function(error){
                    console.log(error.data);
                });
            }

            $scope.clearFile = function (list, fileIndex) {
                $scope[list].splice(fileIndex, 1);
            }

            $scope.fileDownload = function (file) {
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/get/' + file.path,
                    transformResponse: []
                }).then(function (response) {
                    document.getElementById('fileDownloadIframe').src = response.data;
                }, function(error){
                    console.log(error.data);
                });
            }

            function prepareRRCreatedata(){
                var data = {
                    processInstanceId: $scope.processInstanceId,
                    taskId: camForm.taskId,
                    ncpID: $scope.ncpID,
                    cellAntennaAddress:$scope.cellAntenna.address? $scope.cellAntenna.address: '',
                    contactName: $scope.renterCompany.contactName?$scope.renterCompany.contactName:'',
                    contactPosition: $scope.renterCompany.contactPosition? $scope.renterCompany.contactPosition: '',
                    contactInfo: $scope.renterCompany.contactInfo? $scope.renterCompany.contactInfo: '',
                    rcLegalName:$scope.renterCompany.legalName?$scope.renterCompany.legalName:'',
                    rcLegalAddress:$scope.renterCompany.legalAddress?$scope.renterCompany.legalAddress:'',
                    rcTelFax: $scope.renterCompany.telFax?$scope.renterCompany.telFax:'',
                    rcFirstLeaderName:$scope.renterCompany.firstLeaderName?$scope.renterCompany.firstLeaderName:'',
                    rcFirstLeaderPos:$scope.renterCompany.firstLeaderPos?$scope.renterCompany.firstLeaderPos:'',
                    rcEmail:$scope.renterCompany.email?$scope.renterCompany.email:''
                };

                if($scope.candidate){
                    data.siteName = $scope.candidate.siteName? $scope.candidate.siteName : '';
                    data.latitude = $scope.candidate.latitude?$scope.candidate.latitude:'';
                    data.longitude = $scope.candidate.longitude?$scope.candidate.longitude:'';
                    data.constructionType = $scope.candidate.constructionType?$scope.candidate.constructionType:'';
                    data.square = $scope.candidate.square?$scope.candidate.square:'';
                    data.rbsType = $scope.candidate.rbsType?$scope.candidate.rbsType:'';
                    data.newCandidateComments = $scope.candidate.comments?$scope.candidate.comments:'';

                    if($scope.candidate.dateOfVisit){
                        var dateOfVisit = new Date($scope.candidate.dateOfVisit);
                        data.dateOfVisit = (dateOfVisit.getDate()>9?dateOfVisit.getDate():'0'+dateOfVisit.getDate()) + '-' + (dateOfVisit.getMonth()>9?dateOfVisit.getMonth()+1:'0'+(dateOfVisit.getMonth()+1)) + '-' + dateOfVisit.getFullYear();
                    }
                    if ($scope.candidate.selectedBands){
                        var selectedBands = '';
                        angular.forEach($scope.candidate.selectedBands, function (b) {
                            selectedBands += (selectedBands===''?b.title:'+'+b.title);
                        });
                        data.selectedBands = selectedBands;
                    }
                    if($scope.candidate.rbsLocation){
                        var rbsLocation = '';
                        angular.forEach($scope.candidate.rbsLocation, function (l) {
                            if(l.value){
                                rbsLocation += (rbsLocation===''?l.title:', '+l.title);
                            }
                        });
                        data.rbsLocation = rbsLocation;
                    }
                }
                if($scope.cellAntenna){
                    if($scope.cellAntenna.selectedAntennas){
                        var selectedCellAntennas = '';
                        var selectedCellAntennaDimensions = '';
                        var selectedCellAntennaWeight = '';

                        angular.forEach($scope.cellAntenna.selectedAntennas, function (a) {
                            selectedCellAntennas += (selectedCellAntennas===''?a.antenna:', '+a.antenna);
                            if(a.dimension){
                                selectedCellAntennaDimensions += (selectedCellAntennas===''?a.dimension:', '+a.dimension);
                            }
                            if(a.dimension){
                                selectedCellAntennaWeight += (selectedCellAntennas===''?a.weight:', '+a.weight);
                            }
                        });
                        data.selectedCellAntennas=selectedCellAntennas;
                        data.cellAntennaDimensions=selectedCellAntennaDimensions;
                        data.cellAntennaWeight=selectedCellAntennaWeight;
                    }
                    data.cellAntennaQuantity = $scope.cellAntenna.quantity?$scope.cellAntenna.quantity:'';
                    data.cellAntennaSuspensionHeight = $scope.cellAntenna.suspensionHeight?$scope.cellAntenna.suspensionHeight:'';
                    data.cellAntennaAzimuth = $scope.cellAntenna.azimuth?$scope.cellAntenna.azimuth:'';
                }
                if($scope.transmissionAntenna){
                    data.transmissionAntennaAntennaType = $scope.transmissionAntenna.antennaType?$scope.transmissionAntenna.antennaType:'';
                    data.transmissionAntennaAntennaQuantity = $scope.transmissionAntenna.antennaQuantity?$scope.transmissionAntenna.antennaQuantity:'';
                    data.transmissionAntennaAntennaFrequencyBand = $scope.transmissionAntenna.frequencyBand?$scope.transmissionAntenna.frequencyBand:'';
                    data.transmissionAntennaAntennaDiameter = $scope.transmissionAntenna.diameter?$scope.transmissionAntenna.diameter:'';
                    data.transmissionAntennaAntennaWeight = $scope.transmissionAntenna.weight?$scope.transmissionAntenna.weight:'';
                    data.transmissionAntennaAntennaSuspensionHeight = $scope.transmissionAntenna.suspensionHeight?$scope.transmissionAntenna.suspensionHeight:'';
                    data.transmissionAntennaAntennaAzimuth = $scope.transmissionAntenna.azimuth?$scope.transmissionAntenna.azimuth:'';
                }
                if($scope.powerSource){
                    data.landlord = $scope.powerSource.provideUs3Phase?$scope.powerSource.provideUs3Phase:'';
                    data.cableLength = $scope.powerSource.cableLength?$scope.powerSource.cableLength:'';
                    data.monthlyPC = $scope.powerSource.agreeToReceiveMonthlyPayment?$scope.powerSource.agreeToReceiveMonthlyPayment:'';
                    data.res4 = $scope.powerSource.closestPublic04?$scope.powerSource.closestPublic04:'';
                    data.res10 = $scope.powerSource.closestPublic10?$scope.powerSource.closestPublic10:'';
                    var cableLayingType = '';
                    angular.forEach($scope.powerSource.cableLayingType, function (t) {
                        if(t.value){
                            cableLayingType += (cableLayingType===''?t.title:', '+t.title);
                        }
                    });
                    data.cableLayingType = cableLayingType;
                }
                if($scope.farEndInformation && $scope.farEndInformation.length > 0){
                    var index = 0;
                    angular.forEach($scope.farEndInformation, function (fe, i) {
                        if(fe.priority === true){
                            index = i;
                        }
                    });

                    data.farEndSitename = $scope.farEndInformation[index].farEndName?$scope.farEndInformation[index].farEndName:'';
                    data.farEndAdress = $scope.farEndInformation[index].farEndAddress?$scope.farEndInformation[index].farEndAddress:'';
                    data.farEndContact = $scope.farEndInformation[index].contractInformation?$scope.farEndInformation[index].contractInformation:'';
                    data.farEndSquare = $scope.farEndInformation[index].square?$scope.farEndInformation[index].square:'';
                    data.farEndEquipment = $scope.farEndInformation[index].equipmentType?$scope.farEndInformation[index].equipmentType:'';
                    data.farEndAntennasQuantity = $scope.farEndInformation[index].antennasQuantity?$scope.farEndInformation[index].antennasQuantity:'';
                    data.farEndAntennaDiameter = $scope.farEndInformation[index].antennaDiameter?$scope.farEndInformation[index].antennaDiameter:'';
                    data.farEndTXFrequency = $scope.farEndInformation[index].TXFrequency?$scope.farEndInformation[index].TXFrequency:'';
                    data.farEndRXFrequency = $scope.farEndInformation[index].RXFrequency?$scope.farEndInformation[index].RXFrequency:'';
                    data.farEndWeight = $scope.farEndInformation[index].weight?$scope.farEndInformation[index].weight:'';
                    data.farEndSuspensionHeight = $scope.farEndInformation[index].suspensionHeight?$scope.farEndInformation[index].suspensionHeight:'';
                    data.farEndAzimuth = $scope.farEndInformation[index].azimuth?$scope.farEndInformation[index].azimuth:'';
                    data.farEndConstructionType = $scope.farEndInformation[index].constructionType?$scope.farEndInformation[index].constructionType:'';
                    data.farEndComments = $scope.farEndInformation[index].comments?$scope.farEndInformation[index].comments:'';
                    data.farEndResultsOfVisit = $scope.farEndInformation[index].resultsOfVisit?$scope.farEndInformation[index].resultsOfVisit:'';
                    //newFe.surveyDate

                    if($scope.farEndInformation[index].renterCompany){
                        data.farEndRcLegalName = $scope.farEndInformation[index].renterCompany.legalName?$scope.farEndInformation[index].renterCompany.legalName:'';
                        data.farEndRcLegalAddress = $scope.farEndInformation[index].renterCompany.legalAddress?$scope.farEndInformation[index].renterCompany.legalAddress:'';
                        data.farEndRcTelFax = $scope.farEndInformation[index].renterCompany.telFax?$scope.farEndInformation[index].renterCompany.telFax:'';
                        data.farEndRcFirstLeaderName = $scope.farEndInformation[index].renterCompany.firstLeaderName?$scope.farEndInformation[index].renterCompany.firstLeaderName:'';
                        data.farEndRcFirstLeaderPosition = $scope.farEndInformation[index].renterCompany.firstLeaderPosition?$scope.farEndInformation[index].renterCompany.firstLeaderPosition:'';
                        data.farEndRcEmail = $scope.farEndInformation[index].renterCompany.email?$scope.farEndInformation[index].renterCompany.email:'';
                        data.farEndRcContactName = $scope.farEndInformation[index].renterCompany.name?$scope.farEndInformation[index].renterCompany.name:'';
                        data.farEndRcContactPosition = $scope.farEndInformation[index].renterCompany.position?$scope.farEndInformation[index].renterCompany.position:'';
                        data.farEndRcContactInformation = $scope.farEndInformation[index].renterCompany.contactInformation?$scope.farEndInformation[index].renterCompany.contactInformation:'';
                    }
                }

                return data;
            }

            $scope.downloadRRfile = function(){
                $http.post('/camunda/leasing/rrfile/create',prepareRRCreatedata()).then(function (res) {
                    $http({
                        method: 'GET',
                        url: '/camunda/uploads/get/' + res.data,
                        transformResponse: []
                    }).then(function (response) {
                        document.getElementById('fileDownloadIframe').src = response.data;
                    }, function(error){
                        console.log(error.data);
                    });
                }, function (error) {
                    console.log(error);
                });
            }

            $scope.defineSiteObjectType = function () {
                if($scope.renterCompany && ($scope.renterCompany.legalType === 'national_kazakhtelecom' || $scope.renterCompany.legalType === 'national_kazteleradio' || $scope.renterCompany.legalType === 'national_kazpost')){
                    $scope.siteObjectType = 'national';
                } else {
                    $scope.siteObjectType = 'other';
                }
                $scope.legalType = $scope.renterCompany.legalType;
            }

            $scope.preSubmit = function() {
                var deferred = $q.defer();
                if($scope.farEndInformation && $scope.farEndInformation.length < 3){
                    deferred.reject('At least 3 Far End Information should be added!!!');
                    return deferred.promise;
                } else {
                    return $http.post('/camunda/leasing/rrfile/create',prepareRRCreatedata()).then(function (results) {
                        console.log('RR file Updated');
                    },
                    function(error){
                        toasty.error(error.data.message);
                    });
                }
            };

            $scope.uncheckOthers = function(index){
                console.log('test');
                angular.forEach($scope.farEndInformation, function (fe, i) {
                    if(i !== index){
                        fe.priority = false;
                    }
                })
            }
        }]);
    </script>
    <leasing-detail leasing-info="leasingInfo"></leasing-detail>

    <tabset class="my-tab-head my-tab" justified="true" id="jobRequestId">
        <tab>
            <tab-heading><span class="glyphicon glyphicon-check"></span> Candidate Information </tab-heading>
            <div class="col-sm-12">
                <br>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Site name:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="siteName" name="siteName" required ng-model="candidate.siteName">
                        <label class="error" ng-show="kcell_form.siteName.$error.required && ( kcell_form.siteName.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Date of Visit:</label>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <input type="text" ng-model="candidate.dateOfVisit" name="dateOfVisit" class="form-control" datepicker-popup="dd.MM.yyyy" is-open="dateOfVisitFieldOpened" id="dateOfVisit" required />
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="dateOfVisitFieldOpened = true">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                        <label class="error" ng-show="kcell_form.dateOfVisit.$error.required && ( kcell_form.dateOfVisit.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Latitude:</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="latitude" name="latitude" required ng-model="candidate.latitude">
                        <label class="error" ng-show="kcell_form.latitude.$error.required && ( kcell_form.latitude.$touched || view.submitted)">Required field</label>
                    </div>
                    <label class="col-sm-4 control-label">E.g. "N 12 34 56,7" or "N 12,345678"</label>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Longitude:</label>
                    <div class="col-sm-4">
                        <input class="form-control" id="longitude" name="longitude" required ng-model="candidate.longitude">
                        <label class="error" ng-show="kcell_form.longitude.$error.required && ( kcell_form.longitude.$touched || view.submitted)">Required field</label>
                    </div>
                    <label class="col-sm-4 control-label">E.g. "E 12 34 56,7" or "E 12,345678"</label>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">*Сonstruction type:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="constructionType" name="constructionType"
                                ng-model="candidate.constructionType"
                                required>
                            <option ng-repeat="c in dictionary.constructionType">{{c}}</option>
                        </select>
                        <label class="error" ng-show="kcell_form.constructionType.$error.required && ( kcell_form.constructionType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">BSC:</label>
                    <div class="col-sm-8">
                        <input type="text" ng-model="candidate.bsc" typeahead="s for s in dictionary.BSC | filter:$viewValue" class="form-control" placeholder="Start typing...">
                        <label class="error" ng-show="kcell_form.BSC.$error.required && ( kcell_form.BSC.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Square:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="square" name="square" ng-model="candidate.square">
                        <label class="error" ng-show="kcell_form.square.$error.required && ( kcell_form.square.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">RBS Type:</label>
                    <div class="col-sm-8">
                        {{candidate.rbsType}}
                        <label class="error" ng-show="kcell_form.rbsType.$error.required && ( kcell_form.rbsType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Bands:</label>
                    <div class="col-sm-8">
                        <span ng-repeat="band in candidate.selectedBands">{{$index == 0?' ': ' + ' }}{{band.title}}</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">RBS Location:</label>
                    <div class="col-sm-8">
                        <div class="form-check col-sm-6" ng-repeat="l in candidate.rbsLocation track by $index">
                            <input type="checkbox" ng-model="l.value" class="form-check-input" id="{{'check' + $index}}">
                            <label class="form-check-label" for="{{'check' + $index}}">{{ l.title }}</label>
                        </div>
                    </div>
                </div>
                <h4><b>Cell antenna information</b></h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Antennas:</label>
                    <div class="col-sm-8">
                        <div class="form-check col-sm-5">
                            <select multiple style="overflow-y: scroll; height: 20vh" ng-model="firstMultiselect" class="form-control" id="sel3">
                                <option ng-repeat="d in antennasList" value="{{$index}}">{{d.antenna}}</option>
                            </select>
                        </div>
                        <div class="form-check col-sm-2">
                            <div class="btn-group-vertical btn-group-xs pull-right col-sm-pull-5">
                                <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right" ng-click="fromFirstToSecondWindow(firstMultiselect)"></span></button>
                                <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left" ng-click="fromSecondToFirstWindow(secondMultiSelect)"></span></button>
                            </div>
                        </div>
                        <div class="form-check col-sm-5">
                            <select multiple class="form-control" style="overflow-y: scroll; height: 20vh" ng-model="secondMultiSelect" id="sel4">
                                <option ng-repeat="a in cellAntenna.selectedAntennas">{{a.antenna}}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Cell Antenna quantity:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="antennasQuantity" name="antennasQuantity" ng-model="cellAntenna.quantity">
                        <label class="error" ng-show="kcell_form.antennasQuantity.$error.required && ( kcell_form.antennasQuantity.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Dimensions And Weight:</label>
                    <div class="col-sm-8">
                        <table class="table table-condensed" ng-show="cellAntenna.selectedAntennas && cellAntenna.selectedAntennas.length>0">
                            <thead>
                                <tr>
                                    <td>Antenna name</td>
                                    <td>Dimensions</td>
                                    <td>Weigth</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="s in cellAntenna.selectedAntennas">
                                    <td>{{s.antenna}}</td>
                                    <td ng-show="s.dimension">
                                        {{s.dimension}}
                                    </td>
                                    <td ng-hide="s.dimension">
                                        <input class="form-control" id="dimensions_{{$index}}" name="dimensions_{{$index}}" ng-model="s.newDimension" placeholder="1000x100x100">
                                    </td>
                                    <td ng-show="s.weight">
                                        {{s.weight}}
                                    </td>
                                    <td ng-hide="s.weight">
                                        <input class="form-control" id="weight_{{$index}}" name="weight_{{$index}}" ng-model="s.newWeight" placeholder="10">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Suspension height of antennas:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="suspensionHeight" name="suspensionHeight"  ng-model="cellAntenna.suspensionHeight">
                        <label class="error" ng-show="kcell_form.suspensionHeight.$error.required && ( kcell_form.suspensionHeight.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Azimuth:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="azimuth" name="azimuth"  ng-model="cellAntenna.azimuth">
                        <label class="error" ng-show="kcell_form.azimuth.$error.required && ( kcell_form.azimuth.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Address</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" ng-model="cellAntenna.address" name="address" maxlength="500" rows="3" style="resize:none"></textarea>
                        <label class="error" ng-show="kcell_form.address.$error.required && ( kcell_form.address.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <h4><b>Renter Company</b></h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Legal type:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="legalType" name="legalType"
                                ng-model="renterCompany.legalType" ng-options="type.id as type.desc for type in dictionary.legalType" ng-selected="defineSiteObjectType()" required>
                        </select>
                        <label class="error" ng-show="kcell_form.legalType.$error.required && ( kcell_form.legalType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Legal name:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="RClegalName" name="RClegalName"  ng-model="renterCompany.legalName">
                        <label class="error" ng-show="kcell_form.RClegalName.$error.required && ( kcell_form.RClegalName.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Legal address:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="legalAddress" name="legalAddress"  ng-model="renterCompany.legalAddress" >
                        <label class="error" ng-show="kcell_form.legalAddress.$error.required && ( kcell_form.legalAddress.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Tel./Fax:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="telFax" name="telFax"  ng-model="renterCompany.telFax">
                        <label class="error" ng-show="kcell_form.telFax.$error.required && ( kcell_form.telFax.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="firstLeaderName" name="firstLeaderName"  ng-model="renterCompany.firstLeaderName" >
                        <label class="error" ng-show="kcell_form.firstLeaderName.$error.required && ( kcell_form.firstLeaderName.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="firstLeaderPos" name="firstLeaderPos"  ng-model="renterCompany.firstLeaderPos" >
                        <label class="error" ng-show="kcell_form.firstLeaderPos.$error.required && ( kcell_form.firstLeaderPos.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Email:</label>
                    <div class="col-sm-8">
                        <input class="form-control email" id="email" name="azimuth"  ng-model="renterCompany.email" >
                        <label class="error" ng-show="kcell_form.email.$error.required && ( kcell_form.email.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Contact Person:</label>
                    <div class="col-sm-8"></div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <label class="col-sm-1 control-label">Name:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="contactName" name="contactName"  ng-model="renterCompany.contactName" >
                        <label class="error" ng-show="kcell_form.contactName.$error.required && ( kcell_form.contactName.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <label class="col-sm-1 control-label">Position:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="position" name="position"  ng-model="renterCompany.contactPosition" >
                        <label class="error" ng-show="kcell_form.position.$error.required && ( kcell_form.position.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label"></label>
                    <label class="col-sm-2 control-label">Contact Information:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="contractInfo" name="contractInfo"  ng-model="renterCompany.contactInfo" >
                        <label class="error" ng-show="kcell_form.contractInfo.$error.required && ( kcell_form.contractInfo.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <h4><b>Transmission Antenna</b></h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">TR Antenna type:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="antennaType" name="antennaType"
                                ng-model="transmissionAntenna.antennaType"
                                ng-change="defineByAntennaType(transmissionAntenna.antennaType)">
                            <option value="">-</option>
                            <option ng-repeat="a in dictionary.antennaType" value="{{a.name}}">{{a.name}}</option>
                        </select>
                        <label class="error" ng-show="kcell_form.antennaType.$error.required && ( kcell_form.antennaType.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">TR Antenna quantity:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="antennaQuantity" name="antennaQuantity"  ng-model="transmissionAntenna.antennaQuantity">
                        <label class="error" ng-show="kcell_form.antennaQuantity.$error.required && ( kcell_form.antennaQuantity.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Frequency Band:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="frequencyBand" name="frequencyBand"  ng-model="transmissionAntenna.frequencyBand" >
                        <label class="error" ng-show="kcell_form.frequencyBand.$error.required && ( kcell_form.frequencyBand.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Diameter:</label>
                    <div class="col-sm-8">{{transmissionAntenna.diameter}}</div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Weight:</label>
                    <div class="col-sm-8">{{transmissionAntenna.weight}}</div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Suspension height of antennas:</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="TRSuspensionHeight" name="TRSuspensionHeight"  ng-model="transmissionAntenna.suspensionHeight" >
                        <label class="error" ng-show="kcell_form.TRSuspensionHeight.$error.required && ( kcell_form.TRSuspensionHeight.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Azimuth:</label>
                    <div class="col-sm-8">
                        <input class="form-control email" id="TRazimuth" name="TRazimuth"  ng-model="transmissionAntenna.azimuth" >
                        <label class="error" ng-show="kcell_form.TRazimuth.$error.required && ( kcell_form.TRazimuth.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <h4><b>Power Source</b></h4>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Does renter agree to provide us 3 Phase/3.5kWof electrical energy?:</label>
                    <div class="col-sm-8">
                        <label class="radio-inline">
                            <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase" value="Yes"> Yes
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase" value="No"> No
                        </label>
                        <label class="error" ng-show="kcell_form.provideUs3Phase.$error.required && ( kcell_form.provideUs3Phase.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Cable length to connection point (in meters):</label>
                    <div class="col-sm-8">
                        <input class="form-control" id="cableLength" name="cableLength"  ng-model="powerSource.cableLength" >
                        <label class="error" ng-show="kcell_form.cableLength.$error.required && ( kcell_form.cableLength.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Cable laying type:</label>
                    <div class="col-sm-8">
                        <div class="form-check col-sm-6" ng-repeat="t in powerSource.cableLayingType track by $index">
                            <input type="checkbox" ng-model="t.value" class="form-check-input" id="{{'check' + $index}}">
                            <label class="form-check-label" for="{{'check' + $index}}">{{ t.title }}</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Does renter agree to receive monthly paymentfor consumed electrical energy according to ourpower counters displays buy the bank transactionsand give us invoices?</label>
                    <div class="col-sm-8">
                        <label class="radio-inline">
                            <input type="radio" name="agreeToReceiveMonthlyPayment" ng-model="powerSource.agreeToReceiveMonthlyPayment" value="Yes"> Yes
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="agreeToReceiveMonthlyPayment" ng-model="powerSource.agreeToReceiveMonthlyPayment" value="No"> No
                        </label>
                        <label class="error" ng-show="kcell_form.agreeToReceiveMonthlyPayment.$error.required && ( kcell_form.agreeToReceiveMonthlyPayment.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Closest public (RES) electrical line:</label>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon1">0,4 kV</span>
                            <input class="form-control" id="closestPublic04" name="closestPublic04"  ng-model="powerSource.closestPublic04" >
                        </div>
                        <label class="error" ng-show="kcell_form.closestPublic04.$error.required && ( kcell_form.closestPublic04.$touched || view.submitted)">Required field</label>
                    </div>
                    <div class="col-sm-4">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon2">10 kV</span>
                            <input class="form-control" id="closestPublic10" name="closestPublic10"  ng-model="powerSource.closestPublic10" >
                        </div>
                        <label class="error" ng-show="kcell_form.closestPublic10.$error.required && ( kcell_form.closestPublic10.$touched || view.submitted)">Required field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Download RR:</label>
                    <div class="col-sm-8">
                        <a ng-click="downloadRRfile()">RR file</a>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-3 control-label">Upload RR:</label>
                    <div class="col-sm-8">
                        <div ng-show="newCandidateRRFiles.length > 0" class="input-group" ng-repeat="file in newCandidateRRFiles">
                            {{$index + 1}}.
                            <a ng-click="fileDownload(file)">{{file.name}}</a> | <a ng-click="clearFile('newCandidateRRFiles', $index)"><i class="glyphicon glyphicon-trash"></i></a>
                        </div>
                        <input type="file" class="form-control" id="newCandidateRRFiles" name="newCandidateRRFiles" ng-model="file.file" onchange="angular.element(this).scope().fileSelected(this, 'newCandidateRRFiles')"/>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Goals:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" ng-model="candidate.goals" name="newCandidateGoals" maxlength="200" rows="2" style="resize:none"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Comments related to New Candidate:</label>
                    <div class="col-sm-8">
                        <textarea class="form-control" ng-model="candidate.comments" name="newCandidateComments" maxlength="500" rows="4" style="resize:none"></textarea>
                    </div>
                </div>
            </div>
        </tab>
        <tab>
            <tab-heading>
                <span class="glyphicon glyphicon-list"></span> Far End Information
            </tab-heading>
            <div style="margin-top: 20px;">
                <div class="col-sm-10">
                    <table class="table table-bordered ">
                        <thead>
                            <td width="10%">ПН</td>
                            <td width="50%">Far End Name</td>
                            <td width="10%">Priority</td>
                            <td width="30%">Действие</td>
                        </thead>
                        <tbody>
                        <tr ng-repeat="fe in farEndInformation">
                            <td>{{ $index + 1 }}</td>
                            <td>{{ fe.farEndName}}</td>
                            <td>
                                <input type="checkbox" name="{{'priority'+$index}}" ng-model="fe.priority" ng-change="uncheckOthers($index)">
                            </td>
                            <td><a ng-click="editFE($index)">Изменить</a><a class="glyphicon glyphicon-trash pull-right" ng-click="deleteFE($index)"></a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-default" ng-click="addFE()"> <span class="glyphicon glyphicon-plus"></span> add FE</button>
                </div>
                <ng-form name="form.fe_form">
                    <div ng-if="editableForm" class="col-sm-12">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Far End Name:</label>
                            <div class="col-sm-8">
                                <input type="text" ng-model="newFe.farEndName" name="farEndName" typeahead="site as sites.site_name for sites in getSite($viewValue)" typeahead-on-select="siteSelected($item,$model,$label)" class="form-control" required autocomplete="off" placeholder="Far End Name">
                                <input type="hidden" ng-model="newFe.farEndId" name="farEndId" required/>
                                <label class="error" ng-if="form.fe_form.farEndName.$error.required && ( form.fe_form.farEndName.$touched || newFe.submitted)">Required field</label>
                                <label class="error" ng-if="form.fe_form.farEndId.$error.required && ( form.fe_form.farEndName.$touched || newFe.submitted)">Please select from list</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal type:</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="farEndLegalType" name="farEndLegalType"
                                        ng-model="newFe.legalType" ng-options="type.id as type.desc for type in dictionary.legalType" required>
                                </select>
                                <label class="error" ng-show="kcell_form.farEndLegalType.$error.required && ( kcell_form.farEndLegalType.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group-lg">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Far End Address:</label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" ng-model="newFe.farEndAddress" name="farEndAddress" maxlength="500" rows="4" style="resize:none"></textarea>
                                    <label class="error" ng-show="form.fe_form.farEndAddress.$error.required && ( form.fe_form.farEndAddress.$touched || newFe.submitted)">Required field</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Contract Information:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="contractInformation" name="contractInformation"  ng-model="newFe.contractInformation" >
                                <label class="error" ng-show="form.fe_form.contractInformation.$error.required && ( form.fe_form.contractInformation.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Square:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeSquare" name="FeSquare"  ng-model="newFe.square" >
                                <label class="error" ng-show="form.fe_form.FeSquare.$error.required && ( form.fe_form.FeSquare.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Equipment type:</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="equipmentType" name="equipmentType"
                                        ng-model="newFe.equipmentType">
                                    <option ng-repeat="e in dictionary.equipmentType">{{e}}</option>
                                </select>
                                <label class="error" ng-show="form.fe_form.equipmentType.$error.required && ( form.fe_form.equipmentType.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Antennas quantity:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeAntennasQuantity" name="FeAntennasQuantity"  ng-model="newFe.antennasQuantity" >
                                <label class="error" ng-show="form.fe_form.FeAntennasQuantity.$error.required && ( form.fe_form.FeAntennasQuantity.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Antenna diameter:</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="antennaDiameter" name="antennaDiameter"
                                        ng-model="newFe.antennaDiameter" 
                                        ng-change="defineWeightByAntennaDiameter(newFe.antennaDiameter)">
                                    <option ng-repeat="d in dictionary.antennaDiameter" value="{{d.diameter}}">{{d.diameter}}</option>
                                </select>
                                <label class="error" ng-show="form.fe_form.antennaDiameter.$error.required && ( form.fe_form.antennaDiameter.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Weight:</label>
                            <div class="col-sm-8">
                                {{newFe.weight}}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">TX Frequency:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="TXFrequency" name="TXFrequency"  ng-model="newFe.TXFrequency" >
                                <label class="error" ng-show="form.fe_form.TXFrequency.$error.required && ( form.fe_form.TXFrequency.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">RX Frequency:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="RXFrequency" name="RXFrequency"  ng-model="newFe.RXFrequency" >
                                <label class="error" ng-show="form.fe_form.RXFrequency.$error.required && ( form.fe_form.RXFrequency.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Suspension height of antennas:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeSuspensionHeight" name="FeSuspensionHeight"  ng-model="newFe.suspensionHeight" >
                                <label class="error" ng-show="form.fe_form.FeSuspensionHeight.$error.required && ( form.fe_form.FeSuspensionHeight.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Azimuth:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FeAzimuth" name="FeAzimuth"  ng-model="newFe.azimuth" >
                                <label class="error" ng-show="form.fe_form.FeAzimuth.$error.required && ( form.fe_form.FeAzimuth.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Сonstruction type:</label>
                            <div class="col-sm-8">
                                <select class="form-control" id="FeConstructionType" name="FeConstructionType"
                                        ng-model="newFe.constructionType">
                                    <option ng-repeat="c in dictionary.constructionType">{{c}}</option>
                                </select>
                                <label class="error" ng-show="form.fe_form.FeConstructionType.$error.required && ( form.fe_form.FeConstructionType.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Results of visit of objects:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="ResultsOfVisit" name="ResultsOfVisit"  ng-model="newFe.resultsOfVisit" >
                                <label class="error" ng-show="form.fe_form.ResultsOfVisit.$error.required && ( form.fe_form.ResultsOfVisit.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Survey Date:</label>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <input type="text" ng-model="newFe.surveyDate" name="surveyDate" class="form-control" datepicker-popup="dd.MM.yyyy" is-open="surveyDateFieldOpened" id="surveyDate" />
                                    <span class="input-group-btn">
                                    <button type="button" class="btn btn-default" ng-click="surveyDateFieldOpened = true">
                                        <i class="glyphicon glyphicon-calendar"></i>
                                    </button>
                                </span>
                                </div>
                                <label class="error" ng-show="form.fe_form.surveyDate.$error.required && ( form.fe_form.surveyDate.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group-lg">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Comments:</label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" ng-model="newFe.comments" name="FeComments" maxlength="500" rows="4" style="resize:none"></textarea>
                                    <label class="error" ng-show="form.fe_form.FeComments.$error.required && ( form.fe_form.FeComments.$touched || newFe.submitted)">Required field</label>
                                </div>
                            </div>
                        </div>
                        <h4><b>Far End Renter Company</b></h4>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal name:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERClegalName" name="FERClegalName"  ng-model="newFe.renterCompany.legalName" >
                                <label class="error" ng-show="form.fe_form.FERClegalName.$error.required && ( form.fe_form.FERClegalName.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal address:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCLegalAddress" name="FERCLegalAddress"  ng-model="newFe.renterCompany.legalAddress" >
                                <label class="error" ng-show="form.fe_form.FERCLegalAddress.$error.required && ( form.fe_form.FERCLegalAddress.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tel./Fax:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCTelFax" name="FERCTelFax"  ng-model="newFe.renterCompany.telFax" >
                                <label class="error" ng-show="form.fe_form.FERCTelFax.$error.required && ( form.fe_form.FERCTelFax.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCFirstLeaderName" name="FERCFirstLeaderName"  ng-model="newFe.renterCompany.firstLeaderName" >
                                <label class="error" ng-show="form.fe_form.FERCFirstLeaderName.$error.required && ( form.fe_form.FERCFirstLeaderName.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCFirstLeaderPosition" name="FERCFirstLeaderPosition"  ng-model="newFe.renterCompany.firstLeaderPosition" >
                                <label class="error" ng-show="form.fe_form.FERCFirstLeaderPosition.$error.required && ( form.fe_form.FERCFirstLeaderPosition.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Email:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERCemail" name="FERCemail"  ng-model="newFe.renterCompany.email" >
                                <label class="error" ng-show="form.fe_form.FERCemail.$error.required && ( form.fe_form.FERCemail.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Contact Person:</label>
                            <div class="col-sm-8"></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label"></label>
                            <label class="col-sm-1 control-label">Name:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERC_Name" name="FERC_Name"  ng-model="newFe.renterCompany.name" >
                                <label class="error" ng-show="form.fe_form.FERC_Name.$error.required && ( form.fe_form.FERC_Name.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label"></label>
                            <label class="col-sm-1 control-label">Position:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERC_Position" name="FERC_Position"  ng-model="newFe.renterCompany.position" >
                                <label class="error" ng-show="form.fe_form.FERC_Position.$error.required && ( form.fe_form.FERC_Position.$touched || newFe.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-1 control-label"></label>
                            <label class="col-sm-2 control-label">Contact Information:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="FERC_ContractInformation" name="FERC_ContractInformation"  ng-model="newFe.renterCompany.contactInformation" >
                                <label class="error" ng-show="form.fe_form.FERC_ContractInformation.$error.required && ( form.fe_form.FERC_ContractInformation.$touched || newFe.submitted )">Required field</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success btn-sm" ng-click="saveFE(currentFE);">Done</button>
                        <button type="button" class="btn btn-primary btn-sm" ng-click="cancelFE();">Cancel</button>
                        <br>
                    </div>
                </ng-form>
            </div>
        </tab>
    </tabset>

    <div class="form-group">
        <label class="col-sm-3 control-label" style="padding-left: 33px;">Task Comments</label>
        <div class="col-sm-8" style="padding-left: 22px; padding-right: 27px;">
            <textarea class="form-control" ng-model="createNewCandidateSiteTaskComment" name="createNewCandidateSiteTaskComment" placeholder="Comments..." maxlength="500" rows="4" style="resize:none"></textarea>
            <label class="error" ng-show="kcell_form.createNewCandidateSiteTaskComment.$error.required && ( kcell_form.createNewCandidateSiteTaskComment.$touched || view.submitted)">Required field</label>
        </div>
    </div>
    <accordion>
        <accordion-group is-open="isHistoryOpen">
            <accordion-heading>
                History <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
            </accordion-heading>
            <table class="table">
                <thead>
                <tr>
                    <th>Activity</th>
                    <th>Assignee</th>
                    <th>Resolution</th>
                    <th>Date</th>
                    <th>Comment</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="resolution in resolutions track by $index">
                    <td>{{resolution.taskName}}</td>
                    <td>{{resolution.assigneeName}}</td>
                    <td>{{'task.resolution.'+resolution.resolution | translate}}</td>
                    <td>{{resolution.taskEndDate | date: 'dd.MM.yyyy HH:mm'}}</td>
                    <td>{{resolution.comment}}</td>
                </tr>
                </tbody>
            </table>
        </accordion-group>
    </accordion>
</form>
