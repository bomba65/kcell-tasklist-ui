<form role="form" class="form-horizontal" name="kcell_form" novalidate>
    <style>
        .background-yellow-accordion .panel-body {
            background-color: #ffffcc;
            border: 1px solid #b3b3b3;
            color: #333;
        }

        .far-end-info {
            background: #f7f7f7;
            padding: 3px;
            border-radius: 10px;
            border: solid 1px;
            font-weight: bold;
            cursor: pointer;
        }

        .far-end-delete {
            float: right;
            margin-right: 3px;
        }

        tr.far-end-antennas td {
            padding-top: 12px;
        }
    </style>
    <script cam-script type="text/form-script">
        inject(['$scope', '$http', 'Uri', '$rootScope', '$q', '$timeout', 'toasty', 'exModal', function ($scope, $http, Uri, $rootScope, $q, $timeout, toasty, exModal) {
            var variables = [
                'resolutions',
                'ncpID',
                'siteType',
                'regionName',
                'latitude',
                'longitude',
                'initiator',
                'project',
                'reason',
                'part',
                'plannedCabinetType',
                'targetCoverage',
                'rbsType',
                'bands',
                'candidate',
                'cellAntenna',
                'renterCompany',
                'transmissionAntenna',
                'powerSource',
                'farEndInformation',
                'createNewCandidateSiteFiles',
                'threeFarEndNotNecessary',
                'confirmSendingRequestReceiveTsKZT',
            ];

            var variablesToCreate = [
                {
                    name: 'candidate',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'cellAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'renterCompany',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'transmissionAntenna',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'powerSource',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'farEndInformation',
                    type: 'Json',
                    value: []
                },
                {
                    name: 'siteObjectType',
                    type: 'String',
                    value: ''
                },
                {
                    name: 'legalType',
                    type: 'String',
                    value: 'other'
                },
                {
                    name: 'threeFarEndNotNecessary',
                    type: 'Json',
                    value: []
                },
                {
                    name: 'cellAntennaInformation',
                    type: 'Json',
                    value: {}
                },
                {
                    name: 'address',
                    type: 'Json',
                    value: []
                }
            ];

            $scope.candidate = {};
            $scope.form = {};
            $scope.editableForm = false;
            $scope.newFe = {};
            $scope.selectedAntennas = [];
            $scope.trFrequencyBands = '';
            $http.get('/camunda/api/engine/engine/default/task/' + camForm.taskId).then(
                    function(result){
                        $scope.taskAssignee = result.data.assignee;
                    },
                    function (error) {
                        console.log(error.data);
                    }
            );
            camForm.on('form-loaded', function () {
                variables.forEach(function (el) {
                    camForm.variableManager.fetchVariable(el);
                });
                $http.get('/camunda/api/engine/engine/default/task/' + camForm.taskId).then(
                    function (result) {
                        $scope.processInstanceId = result.data.processInstanceId;
                    },
                    function (error) {
                        console.log(error.data);
                    }
                );
                $scope.leasingInfo = [];
                $scope.leasingInfo.files = [];
                $scope.dictionary = {};
                $scope.cellAntenna = {
                    selectedAntennas: []
                };
                $scope.cellAntennaInformation = {
                    ca_diff_address:false
                };
                $scope.renterCompany = {};
                $scope.threeFarEndNotNecessary= {};
                $scope.powerSource = {};
                $scope.dictionary = {};
                $scope.transmissionAntenna = {};
                if (!$scope.rbsLocationChecked) $scope.rbsLocationChecked = 0;
                $scope.checkRbsLocationTouched = false;
                $scope.deletedFarEnd = false;
                $scope.oblastList=[];
                $scope.cityList=[];
                $scope.addressesList = [];
                $scope.address = {};
                $scope.cai_addr_oblast = '';



                $http.get('/api/leasingCatalogs?version=1').then(
                    function(result){
                        angular.extend($scope.dictionary, result.data);
                        if (!$scope.candidate.rbsLocation) $scope.candidate.rbsLocation = $scope.dictionary.rbsLocation;
                        $scope.antennasList = $scope.dictionary.antennas;
                        if (!$scope.powerSource.cableLayingType) $scope.powerSource.cableLayingType = $scope.dictionary.cableLayingType;
                        $scope.availableBands = $scope.dictionary.bands;
                        $scope.BSC = $scope.dictionary.BSC;
                        $scope.frequencyBand = $scope.dictionary.frequencyBand;
                        $scope.addressesList = $scope.dictionary.addresses;
                        $scope.oblastList = _.uniqBy($scope.dictionary.addresses, 'oblast').map( (e, index) => { return {"name" : e.oblast, "id" : index} });
                        $scope.cityList = _.uniqBy($scope.dictionary.addresses, 'city').map( (e, index) => { return {"name" : e.city, "id" : index} });
                        $scope.districtList = _.uniqBy($scope.dictionary.addresses, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                        $scope.filteredDistricts = $scope.districtList;
                        $scope.filteredDistrictsInCAI = $scope.districtList;

                    },
                    function(error){
                        console.log(error);
                    }
                );
                $scope.farEndInformation = [];
            });

            $scope.$watch('transmissionAntenna.antennaType', function (antennaType) {
                $scope.frequenciesByAntennaType = {};
                $scope.frequenciesByAntennaType = _.find($scope.dictionary.antennaType, function (p) {
                    return p.name === antennaType;
                })
            }, true);

            $scope.$watch('currentFarEnd.feAntennaType', function (antennaType) {
                $scope.frequenciesFeByAntennaType = {};
                $scope.frequenciesFeByAntennaType = _.find($scope.dictionary.antennaType, function (p) {
                    return p.name === antennaType;
                })
            }, true);

            camForm.on('variables-fetched', function () {
                $scope.createNewCandidateSiteFiles = [];
                variables.forEach(function (el) {
                    if(camForm.variableManager.variables[el].value){
                        $scope[el] = camForm.variableManager.variables[el].value;
                        $scope.leasingInfo[el] = camForm.variableManager.variables[el].value;
                    }
                });
                $scope.candidate.selectedBands = [];
                    if ($scope.bands) {
                        angular.forEach($scope.availableBands, function (b) {
                            b.value = _.some($scope.bands, function (selected) {
                                return b.title === selected.title;
                            });
                            if (b.value) {
                            $scope.candidate.selectedBands.push(b);
                            }
                        });
                    }
                if ($scope.candidate) $scope.candidate.transmissionType = "Microwave";
                if(!$scope.newCandidateRRFiles){
                    $scope.newCandidateRRFiles = [];
                }

                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskResult',
                    type: 'String',
                    value: ''
                });
                camForm.variableManager.createVariable({
                    name: 'createNewCandidateSiteTaskComment',
                    type: 'String',
                    value: ''
                });
                camForm.variableManager.createVariable({
                    name: 'rbsLocationChecked',
                    type: 'Integer',
                    value: $scope.rbsLocationChecked
                });
                $scope.createNewCandidateSiteTaskResult = 'Completed';
                $scope.candidate.longitude = $scope.longitude;
                $scope.candidate.latitude = $scope.latitude;
                $scope.candidate.rbsType = $scope.rbsType;
                if($scope.candidate.dateOfVisit){
                    $scope.candidate.dateOfVisit = new Date($scope.candidate.dateOfVisit);
                }
                if ($scope.farEndInformation) {
                     angular.forEach($scope.farEndInformation, function (fe) {
                            if (fe.surveyDate) {
                                fe.surveyDate = new Date(fe.surveyDate);
                            }
                     });

                }
                if($scope.candidate.rbsLocation){
                    angular.forEach($scope.candidate.rbsLocation, function (l) {
                        if(l.value){
                           $scope.rbsLocationChecked+=1;
                        }
                    });
                }
            });

            camForm.on('submit', function (evt) {
                //evt.submitPrevented = true;
                /*angular.forEach($scope.farEndInformation, function (fe, i) {
                        if (i==0) fe.priority=true;
                        else fe.priority=false;
                });*/


                camForm.variableManager.variableValue('createNewCandidateSiteTaskResult', $scope.createNewCandidateSiteTaskResult);
                camForm.variableManager.variableValue('createNewCandidateSiteTaskComment', $scope.createNewCandidateSiteTaskComment);
                if(!camForm.variableManager.variables['createNewCandidateSiteFiles'].type){
                    camForm.variableManager.destroyVariable('createNewCandidateSiteFiles');
                    camForm.variableManager.createVariable({
                        name: 'createNewCandidateSiteFiles',
                        type: 'Json',
                        value: $scope.createNewCandidateSiteFiles
                    });
                } else {
                    camForm.variableManager.variableValue('createNewCandidateSiteFiles', $scope.createNewCandidateSiteFiles);
                }
                angular.forEach(variablesToCreate, function (el) {
                    if(!camForm.variableManager.variables[el.name] || (camForm.variableManager.variables[el.name] && !camForm.variableManager.variables[el.name].type)){
                        if(camForm.variableManager.variables[el.name] && !camForm.variableManager.variables[el.name].type){
                            camForm.variableManager.destroyVariable(el.name);
                        }
                        camForm.variableManager.createVariable({
                            name: el.name,
                            type: el.type,
                            value: $scope[el.name]
                        });
                    } else {
                        camForm.variableManager.variableValue(el.name, $scope[el.name]);
                    }
                });
                if($scope.candidate.siteName){
                    camForm.variableManager.createVariable({
                        name: 'siteName',
                        type: 'String',
                        value: $scope.candidate.siteName
                    });
                }
                camForm.variableManager.destroyVariable('resolutions');
            });
            $scope.$watch('availableBands', function (availableBands) {
                $scope.candidate.selectedBands = [];
                if (availableBands){
                    availableBands.forEach(function (b) {
                        if (b.value) {
                            $scope.candidate.selectedBands.push(b);
                        }
                    })
                }
            }, true);
            $scope.sortableOptions = {
                'ui-preserve-size': true,
                stop: function(e, ui) {
                    $scope.farEndInformation[0].priority = true;
                    angular.forEach($scope.farEndInformation, function (fe, i) {
                        if(i !== 0) fe.priority = false;
                    });
                }
            };
            $scope.checkFrequency = function(val, index) {
                var yes = false;
                var temp = String(val);
                angular.forEach($scope.frequencyBand, function (freq, i) {
                        if (freq.substring(0, temp.length) === temp) {
                         yes = true;
                         $scope.frequencyBandValid = true;
                        }
                    });
                    if (!yes) {
                        $scope.cellAntenna.selectedAntennas[index].frequencyBand = '';
                        $scope.frequencyBandValid = false;
                    }
            };
            $scope.checkAzimuth = function(val, index) {
                if (!(val>=0 && val <=360)) $scope.cellAntenna.selectedAntennas[index].azimuth = '';
            };

            $scope.deleteFE = function (index) {
                exModal.open({
                    scope: {
                        //farEndInformation : $scope.farEndInformation,
                        //index: index,
                        validate: function(index) {
                            $scope.currentFarEnd = undefined;
                            $scope.farEndInformation.splice(index, 1);
                        },
                    },
                    templateUrl: './js/partials/deleteFarEndValidation.html',
                    size: 'sm'
                }).then(function (results) {
                });
                /*
                if ($scope.currentFarEnd == $scope.farEndInformation[index]) {
                $scope.farEndInformation.splice(index, 1);
                var feLength = $scope.farEndInformation.length;
                if (feLength>0 && feLength>index-1) {
                    if (index!=0) $scope.currentFarEnd = $scope.farEndInformation[index-1];
                    else $scope.currentFarEnd = $scope.farEndInformation[index];
                }
                } else $scope.farEndInformation.splice(index, 1);
                $scope.currentFarEnd = undefined;
                $scope.farEndInformation.splice(index, 1);
                */

            };
            $scope.openFarEndInformation = function(index) {
                $scope.currentFarEnd = $scope.farEndInformation[index];
                if ($scope.currentFarEnd.surveyDate) {
                    $scope.currentFarEnd.surveyDate = new Date($scope.currentFarEnd.surveyDate);
                }
            }

            var currentDate = new Date();
            $scope.datepickerOptions = {
                minDate: currentDate
            };

            $scope.fromFirstToSecondWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.cellAntenna.selectedAntennas.push($scope.antennasList[index]);
                        $scope.antennasList.splice(index, 1);
                    });
                }
                $scope.firstMultiselect = [];
            };

            $scope.fromSecondToFirstWindow = function (indexes) {
                if (indexes.length > 0) {
                    indexes.forEach(function (index) {
                        $scope.antennasList.push($scope.antennasList[index]);
                        $scope.cellAntenna.selectedAntennas.splice(index, 1);
                    });
                }
                $scope.secondMultiselect = [];
            };

            $scope.getCity = function (val) {
                if (val.length < 2) {
                    return []
                }
                return _.filter($scope.cityList, function(o) { return o.name.toLowerCase().includes(val.toLowerCase()); })
            };

            $scope.filterDistrictAfterSelectObl = function (cn_addr_oblast) {
                console.log(cn_addr_oblast)
                $scope.address.cn_addr_oblast = cn_addr_oblast
                $scope.address.cn_addr_district = ''
                $scope.address.cn_addr_city = ''
                if($scope.address.cn_addr_oblast && $scope.address.cn_addr_oblast !== ''){
                    $scope.filteredByOblast = $scope.dictionary.addresses.filter(a => {return a.oblast === $scope.address.cn_addr_oblast});
                    $scope.filteredDistricts = _.uniqBy($scope.filteredByOblast, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                    $scope.cityList = _.uniqBy($scope.filteredByOblast, 'city').map( (e, index) => { return {"name" : e.city, "id" : index} });
                } else {
                    $scope.filteredDistricts = $scope.districtList;
                }
            }

            $scope.filterDistrictAfterSelectOblInCAI = function (cai_addr_oblast) {
                $scope.cellAntennaInformation.cai_addr_oblast = cai_addr_oblast
                $scope.cellAntennaInformation.cai_addr_district = ''
                $scope.address.cai_addr_city = ''
                if($scope.cellAntennaInformation.cai_addr_oblast && $scope.cellAntennaInformation.cai_addr_oblast !== ''){
                    $scope.filteredByOblast = $scope.dictionary.addresses.filter(a => {return a.oblast === $scope.cellAntennaInformation.cai_addr_oblast});
                    $scope.filteredDistrictsInCAI = _.uniqBy($scope.filteredByOblast, 'district').map( (e, index) => { return {"name" : e.district, "id" : index} });
                    $scope.cityList = _.uniqBy($scope.filteredByOblast, 'city').map( (e, index) => { return {"name" : e.city, "id" : index} });
                } else {
                    $scope.filteredDistrictsInCAI = $scope.districtList;
                }
            }

            $scope.getSite = function (val) {
                return $http.get('/asset-management/api/sites/search/findByNameIgnoreCaseContaining?name=' + val).then(
                        function (response) {
                            var sites = _.flatMap(response.data._embedded.sites, function (s) {
                                if (s.params.site_name) {
                                    return s.params.site_name.split(',').map(function (sitename) {
                                        return {
                                            name: s.name,
                                            id: s._links.self.href.substring(s._links.self.href.lastIndexOf('/') + 1),
                                            site_name: sitename
                                        };
                                    })
                                } else {
                                    return [];
                                }
                            });
                            return sites;
                        }
                );
            };

            $scope.siteSelected = function ($item) {
                $scope.newFe.farEndName = $item.site_name;
                $scope.newFe.farEndId = $item.name;
                $scope.newFe.farEndSequence = $item.id;
                $scope.newFe.index = $scope.farEndInformation.length;
                $scope.newFe.priority = false;
                if($scope.newFe.index===0) $scope.newFe.priority = true;
                $scope.farEndInformation.push($scope.newFe);
                $scope.currentFarEnd = $scope.newFe;
                $scope.newFe = {};

            };

            $scope.cellAntennaDiffAddressChecked = function (checkedStatus) {
                if(!checkedStatus) {
                    $scope.cellAntennaInformation = $scope.address
                }
                $scope.address.cn_addr_district = _.find($scope.dictionary.addresses, {'city': $item.name, 'oblast': $scope.address.cn_addr_oblast}).district;
            };

            $scope.addressCitySelected = function ($item) {
                $scope.address.cn_addr_district = _.find($scope.dictionary.addresses, {'city': $item.name, 'oblast': $scope.address.cn_addr_oblast}).district;
            };
            
            $scope.cellInfoAddressCitySelected = function ($item) {
                $scope.cellAntennaInformation.cn_addr_district = _.find($scope.dictionary.addresses, {'city': $item.name, 'oblast': $scope.cellAntennaInformation.cn_addr_oblast}).district;
            };

            $scope.checkRbsLocation  = function($index, val) {
                if (val) $scope.rbsLocationChecked +=1;
                else $scope.rbsLocationChecked -=1;
                $scope.checkRbsLocationTouched = true;
            };

            $scope.defineByAntennaType = function (antennaType, type) {
                if(antennaType){
                    if (type==='transmission') {
                    angular.forEach($scope.dictionary.antennaType, function (type) {
                        if(type.name === antennaType){
                            $scope.transmissionAntenna.diameter = type.diameter;
                            $scope.transmissionAntenna.weight = type.weight;
                        }
                    });
                    }
                    else {
                    angular.forEach($scope.dictionary.antennaType, function (type) {
                        if(type.name === antennaType){
                            $scope.currentFarEnd.diameter = type.diameter;
                            $scope.currentFarEnd.weight = type.weight;
                        }
                    });

                    }
                } else {
                    if (type==='transmission') {
                        $scope.transmissionAntenna.diameter = undefined;
                        $scope.transmissionAntenna.weight = undefined;
                    } else {
                        $scope.currentFarEnd.diameter = undefined;
                        $scope.currentFarEnd.weight = undefined;
                    }
                }
            };

            $scope.defineWeightByAntennaDiameter = function (antennaDiameter) {
                if(antennaDiameter){
                    angular.forEach($scope.dictionary.antennaDiameter, function (d) {
                        if(d.diameter === antennaDiameter){
                            $scope.currentFarEnd.weight = d.weight;
                        }
                    });
                } else {
                    $scope.currentFarEnd.weight = undefined;
                }
            };
            $scope.$watch('project', function (project) {
                $scope.reasonsByProject = [];
                $scope.reasonsByProject = _.filter($scope.dictionary.reasons, function (r) {
                    if (_.find(r.project, function (p) {return p === project; }) ) { return true} else return false;
                })
            }, true);

            $scope.fileSelected = function (el, fileName) {
                $timeout(function () {
                    $scope.$apply(function () {
                        uploadFileToMinio(el.files[0], fileName);
                    });
                })
            };

            function uploadFileToMinio(file, fileName) {
                var fileIndex = $scope[fileName].length;

                var fileToUpload = {
                    date: new Date(),
                    author:  $scope.taskAssignee,
                    name: file.name.replace(/[/\\?%*:|"<>]/g, '-'),
                    path: $scope.processInstanceId + '/' + camForm.taskId + '/' + file.name.replace(/[/\\?%*:|"<>]/g, '-')
                };
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/put/' + fileToUpload.path,
                    transformResponse: []
                }).then(function (response) {
                    $http.put(response.data, file, {headers: {'Content-Type': undefined}}).then(
                        function () {
                            $scope[fileName].push(fileToUpload);
                            angular.element(document.querySelector('#' + fileName)).val(null);
                        },
                        function (error) {
                            console.log(error.data);
                        }
                    );
                }, function(error){
                    console.log(error.data);
                });
            }

            $scope.clearFile = function (list, fileIndex) {
                $scope[list].splice(fileIndex, 1);
            }

            $scope.fileDownload = function (file) {
                $http({
                    method: 'GET',
                    url: '/camunda/uploads/get/' + file.path,
                    transformResponse: []
                }).then(function (response) {
                    document.getElementById('fileDownloadIframe').src = response.data;
                }, function(error){
                    console.log(error.data);
                });
            }

            function prepareRRCreatedata(){
                var data = {
                    processInstanceId: $scope.processInstanceId,
                    taskId: camForm.taskId,
                    ncpID: $scope.ncpID,
                    cellAntennaAddress:$scope.cellAntenna.address? $scope.cellAntenna.address: '',
                    contactName: $scope.renterCompany.contactName?$scope.renterCompany.contactName:'',
                    contactPosition: $scope.renterCompany.contactPosition? $scope.renterCompany.contactPosition: '',
                    contactInfo: $scope.renterCompany.contactInfo? $scope.renterCompany.contactInfo: '',
                    rcLegalName:$scope.renterCompany.legalName?$scope.renterCompany.legalName:'',
                    rcLegalAddress:$scope.renterCompany.legalAddress?$scope.renterCompany.legalAddress:'',
                    rcTelFax: $scope.renterCompany.telFax?$scope.renterCompany.telFax:'',
                    rcFirstLeaderName:$scope.renterCompany.firstLeaderName?$scope.renterCompany.firstLeaderName:'',
                    rcFirstLeaderPos:$scope.renterCompany.firstLeaderPos?$scope.renterCompany.firstLeaderPos:'',
                    rcEmail:$scope.renterCompany.email?$scope.renterCompany.email:''
                };

                if($scope.candidate){
                    data.siteName = $scope.candidate.siteName? $scope.candidate.siteName : '';
                    data.latitude = $scope.candidate.latitude?$scope.candidate.latitude:'';
                    data.longitude = $scope.candidate.longitude?$scope.candidate.longitude:'';
                    data.constructionType = $scope.candidate.constructionType?$scope.candidate.constructionType:'';
                    data.square = $scope.candidate.square?$scope.candidate.square:'';
                    data.rbsType = $scope.candidate.rbsType?$scope.candidate.rbsType:'';
                    data.newCandidateComments = $scope.candidate.comments?$scope.candidate.comments:'';

                    if($scope.candidate.dateOfVisit){
                        var dateOfVisit = new Date($scope.candidate.dateOfVisit);
                        data.dateOfVisit = (dateOfVisit.getDate()>9?dateOfVisit.getDate():'0'+dateOfVisit.getDate()) + '-' + (dateOfVisit.getMonth()>9?dateOfVisit.getMonth()+1:'0'+(dateOfVisit.getMonth()+1)) + '-' + dateOfVisit.getFullYear();
                    }
                    if ($scope.bands){
                        var selectedBands = '';
                        angular.forEach($scope.bands, function (b) {
                            selectedBands += (selectedBands===''?b.title:'+'+b.title);
                        });
                        data.selectedBands = selectedBands;
                    }
                    if($scope.candidate.rbsLocation){
                        var rbsLocation = '';
                        angular.forEach($scope.candidate.rbsLocation, function (l) {
                            if(l.value){
                                rbsLocation += (rbsLocation===''?l.title:', '+l.title);
                            }
                        });
                        data.rbsLocation = rbsLocation;
                    }
                }
                if($scope.cellAntenna){
                    if($scope.cellAntenna.selectedAntennas){
                        var selectedCellAntennas = '';
                        var selectedCellAntennaDimensions = '';
                        var selectedCellAntennaWeight = '';
                        var selectedCellAntennaQuantity = '';
                        var selectedCellAntennaFrequencyBand = '';
                        var selectedCellAntennaAzimuth = '';
                        var selectedCellAntennaSuspensionHeight='';

                        angular.forEach($scope.cellAntenna.selectedAntennas, function (a) {
                            selectedCellAntennas += (selectedCellAntennas===''?a.antenna:', '+a.antenna);
                            if(a.dimension){
                                selectedCellAntennaDimensions += (selectedCellAntennas===''?a.dimension:', '+a.dimension);
                            }
                            if(a.weight){
                                selectedCellAntennaWeight += (selectedCellAntennas===''?a.weight:', '+a.weight);
                            }
                            if (a.quantity) selectedCellAntennaQuantity += (selectedCellAntennas===''?a.quantity:', '+a.quantity);
                            if (a.frequencyBand) selectedCellAntennaFrequencyBand += (selectedCellAntennas===''?a.frequencyBand:', '+a.frequencyBand);
                            if (a.azimuth) selectedCellAntennaAzimuth += (selectedCellAntennas===''?a.azimuth:', '+a.azimuth);
                            if (a.suspensionHeight)  selectedCellAntennaSuspensionHeight += (selectedCellAntennas===''?a.suspensionHeight:', '+a.suspensionHeight);

                        });
                        data.selectedCellAntennas=selectedCellAntennas;
                        data.cellAntennaDimensions=selectedCellAntennaDimensions;
                        data.cellAntennaWeight=selectedCellAntennaWeight;
                        data.cellAntennaQuantity = selectedCellAntennaQuantity;
                        data.cellAntennaFrequencyBand = selectedCellAntennaFrequencyBand;
                        data.cellAntennaSuspensionHeight =selectedCellAntennaSuspensionHeight;
                        data.cellAntennaAzimuth = selectedCellAntennaAzimuth;
                    }

                }
                if($scope.transmissionAntenna){
                    data.transmissionAntennaAntennaType = $scope.transmissionAntenna.antennaType?$scope.transmissionAntenna.antennaType:'';
                    data.transmissionAntennaAntennaQuantity = $scope.transmissionAntenna.antennaQuantity?$scope.transmissionAntenna.antennaQuantity:'';
                    data.transmissionAntennaAntennaFrequencyBand = $scope.transmissionAntenna.frequencyBand?$scope.transmissionAntenna.frequencyBand:'';
                    data.transmissionAntennaAntennaDiameter = $scope.transmissionAntenna.diameter?$scope.transmissionAntenna.diameter:'';
                    data.transmissionAntennaAntennaWeight = $scope.transmissionAntenna.weight?$scope.transmissionAntenna.weight:'';
                    data.transmissionAntennaAntennaSuspensionHeight = $scope.transmissionAntenna.suspensionHeight?$scope.transmissionAntenna.suspensionHeight:'';
                    data.transmissionAntennaAntennaAzimuth = $scope.transmissionAntenna.azimuth?$scope.transmissionAntenna.azimuth:'';
                }
                if($scope.powerSource){
                    data.landlord = $scope.powerSource.provideUs3Phase?$scope.powerSource.provideUs3Phase:'';
                    data.cableLength = $scope.powerSource.cableLength?$scope.powerSource.cableLength:'';
                    data.monthlyPC = $scope.powerSource.agreeToReceiveMonthlyPayment?$scope.powerSource.agreeToReceiveMonthlyPayment:'';
                    data.res4 = $scope.powerSource.closestPublic04?$scope.powerSource.closestPublic04:'';
                    data.res10 = $scope.powerSource.closestPublic10?$scope.powerSource.closestPublic10:'';
                    var cableLayingType = '';
                    angular.forEach($scope.powerSource.cableLayingType, function (t) {
                        if(t.value){
                            cableLayingType += (cableLayingType===''?t.title:', '+t.title);
                        }
                    });
                    data.cableLayingType = cableLayingType;
                }
                if($scope.farEndInformation && $scope.farEndInformation.length > 0){
                    var index = 0;
                    angular.forEach($scope.farEndInformation, function (fe, i) {
                        if(fe.priority === true){
                            index = i;
                        }
                    });

                    data.farEndSitename = $scope.farEndInformation[index].farEndName?$scope.farEndInformation[index].farEndName:'';
                    data.farEndAdress = $scope.farEndInformation[index].farEndAddress?$scope.farEndInformation[index].farEndAddress:'';
                    data.farEndContact = $scope.farEndInformation[index].contractInformation?$scope.farEndInformation[index].contractInformation:'';
                    data.farEndSquare = $scope.farEndInformation[index].square?$scope.farEndInformation[index].square:'';
                    data.farEndEquipment = $scope.farEndInformation[index].equipmentType?$scope.farEndInformation[index].equipmentType:'';
                    data.farEndAntennasQuantity = $scope.farEndInformation[index].antennasQuantity?$scope.farEndInformation[index].antennasQuantity:'';
                    data.farEndAntennaDiameter = $scope.farEndInformation[index].antennaDiameter?$scope.farEndInformation[index].antennaDiameter:'';
                    //data.farEndTXFrequency = $scope.farEndInformation[index].TXFrequency?$scope.farEndInformation[index].TXFrequency:'';
                    //data.farEndRXFrequency = $scope.farEndInformation[index].RXFrequency?$scope.farEndInformation[index].RXFrequency:'';
                    data.farEndWeight = $scope.farEndInformation[index].weight?$scope.farEndInformation[index].weight:'';
                    data.farEndFrequencyBand = $scope.farEndInformation[index].frequencyBand? $scope.farEndInformation[index].frequencyBand:'';
                    data.farEndSuspensionHeight = $scope.farEndInformation[index].suspensionHeight?$scope.farEndInformation[index].suspensionHeight:'';
                    data.farEndAzimuth = $scope.farEndInformation[index].azimuth?$scope.farEndInformation[index].azimuth:'';
                    data.farEndConstructionType = $scope.farEndInformation[index].constructionType?$scope.farEndInformation[index].constructionType:'';
                    data.farEndComments = $scope.farEndInformation[index].comments?$scope.farEndInformation[index].comments:'';
                    data.farEndResultsOfVisit = $scope.farEndInformation[index].resultsOfVisit?$scope.farEndInformation[index].resultsOfVisit:'';
                    //newFe.surveyDate

                    if($scope.farEndInformation[index].renterCompany){
                        data.farEnleasingCandidatedRcLegalName = $scope.farEndInformation[index].renterCompany.legalName?$scope.farEndInformation[index].renterCompany.legalName:'';
                        data.farEndRcLegalAddress = $scope.farEndInformation[index].renterCompany.legalAddress?$scope.farEndInformation[index].renterCompany.legalAddress:'';
                        data.farEndRcTelFax = $scope.farEndInformation[index].renterCompany.telFax?$scope.farEndInformation[index].renterCompany.telFax:'';
                        data.farEndRcFirstLeaderName = $scope.farEndInformation[index].renterCompany.firstLeaderName?$scope.farEndInformation[index].renterCompany.firstLeaderName:'';
                        data.farEndRcFirstLeaderPosition = $scope.farEndInformation[index].renterCompany.firstLeaderPosition?$scope.farEndInformation[index].renterCompany.firstLeaderPosition:'';
                        data.farEndRcEmail = $scope.farEndInformation[index].renterCompany.email?$scope.farEndInformation[index].renterCompany.email:'';
                        data.farEndRcContactName = $scope.farEndInformation[index].renterCompany.name?$scope.farEndInformation[index].renterCompany.name:'';
                        data.farEndRcContactPosition = $scope.farEndInformation[index].renterCompany.position?$scope.farEndInformation[index].renterCompany.position:'';
                        data.farEndRcContactInformation = $scope.farEndInformation[index].renterCompany.contactInformation?$scope.farEndInformation[index].renterCompany.contactInformation:'';
                    }
                }

                return data;
            }

            $scope.downloadRRfile = function(){
                $http.post('/camunda/leasing/rrfile/create',prepareRRCreatedata()).then(function (res) {
                    $http({
                        method: 'GET',
                        url: '/camunda/uploads/get/' + res.data,
                        transformResponse: []
                    }).then(function (response) {
                        document.getElementById('fileDownloadIframe').src = response.data;
                    }, function(error){
                        console.log(error.data);
                    });
                }, function (error) {
                    console.log(error);
                });
            }

            $scope.defineSiteObjectType = function () {
                if($scope.renterCompany && ($scope.renterCompany.legalType === 'national_kazakhtelecom' || $scope.renterCompany.legalType === 'national_kazteleradio' || $scope.renterCompany.legalType === 'national_kazpost')){
                    $scope.siteObjectType = 'national';
                } else {
                    $scope.siteObjectType = 'other';
                }
                $scope.legalType = $scope.renterCompany.legalType;
            }

            $scope.preSubmit = function() {
                var deferred = $q.defer();
                if($scope.farEndInformation.length < 3 && !$scope.threeFarEndNotNecessary.check){
                    deferred.reject('At least 3 Far End Information should be added!!!');
                    return deferred.promise;
                }
                /*
                else {
                    return $http.post('/camunda/leasing/rrfile/create',prepareRRCreatedata()).then(function (result) {
                        console.log(result.data);
                    },
                    function(error){
                        toasty.error(error.data.message);
                    });
                }*/
                var tempLat;
                var tempLong;
                var validLat = false;
                var validLong = false;
                if(!isNaN($scope.candidate.latitude)){
                    tempLat = $scope.candidate.latitude;
                    if (Number.isInteger(tempLat)) {
                        tempLat = parseInt(tempLat);
                        if (!(tempLat>40 && tempLat <=55)) {
                            deferred.reject('Latitude must be in [40.568, 55.440] range');
                            return deferred.promise;
                        } else validLat = true;
                    } else {
                        tempLat = parseFloat(tempLat);
                        if (!(tempLat>=40.568 && tempLat <=55.440)) {
                            deferred.reject('Latitude must be in [40.568, 55.440] range');
                            return deferred.promise;
                        } else validLat = true;
                    }
                } else {
                    deferred.reject('Latitude must be in [40.568, 55.440] range');
                    return deferred.promise;
                }

                // longitude check
                if(!isNaN($scope.candidate.longitude)){
                    tempLong = $scope.candidate.longitude;
                    if (Number.isInteger(tempLong)) {
                        tempLong = parseInt(tempLong);
                        if (!(tempLong>46 && tempLong <=87)) {
                            deferred.reject('Longitude must be in [46.493, 87.315] range');
                            return deferred.promise;
                        } else validLong = true;
                    } else {
                        tempLong = parseFloat(tempLong);
                        if (!(tempLong>=46.493 && tempLong <=87.315)) {
                            deferred.reject('Longitude must be in [46.493, 87.315] range');
                            return deferred.promise;
                        } else validLong = true;
                    }
                } else {
                    deferred.reject('Longitude must be in [46.493, 87.315] range');
                    return deferred.promise;
                }
                if (validLat && validLong) {
                  deferred.resolve();
                  return deferred.promise;
                }
            };
        }]);
    </script>
    <leasing-detail leasing-info="leasingInfo"></leasing-detail>

    <tabset class="my-tab-head my-tab" justified="true" id="jobRequestId">
        <tab>
            <tab-heading><span class="glyphicon glyphicon-check"></span> Candidate Information</tab-heading>
            <div class="col-sm-12">
                <br>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Sitename:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="siteName" name="siteName" required
                               ng-model="candidate.siteName">
                        <label class="error"
                               ng-show="kcell_form.siteName.$error.required && ( kcell_form.siteName.$touched || view.submitted)">Required
                            field</label>
                    </div>

                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Date of visit:</label>
                    <div class="col-sm-5">
                        <div class="input-group">
                            <input type="text" ng-model="candidate.dateOfVisit" name="dateOfVisit" class="form-control"
                                   datepicker-popup="dd.MM.yyyy" is-open="dateOfVisitFieldOpened" id="dateOfVisit"/>
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="dateOfVisitFieldOpened = true">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                            </span>
                        </div>
                        <label class="error"
                               ng-show="kcell_form.dateOfVisit.$error.required && ( kcell_form.dateOfVisit.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Latitude:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="latitude" name="latitude" required
                               ng-model="candidate.latitude" maxlength="7">
                        <label class="error"
                               ng-show="kcell_form.latitude.$error.required && ( kcell_form.latitude.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Longitude:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="longitude" name="longitude" required
                               ng-model="candidate.longitude" maxlength="7">
                        <label class="error"
                               ng-show="kcell_form.longitude.$error.required && ( kcell_form.longitude.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Сonstruction type:</label>
                    <div class="col-sm-5">
                        <select class="form-control" id="constructionType" name="constructionType"
                                ng-model="candidate.constructionType"
                                required>
                            <option value="" disabled selected hidden>Select Construction Type</option>
                            <option ng-repeat="c in dictionary.constructionType">{{c}}</option>
                        </select>
                        <label class="error"
                               ng-show="kcell_form.constructionType.$error.required && ( kcell_form.constructionType.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Transmission type:</label>
                    <div class="col-sm-5">
                        <input class="form-control" id="transmissionType" name="transmissionType"
                               ng-model="candidate.transmissionType" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">BSC:</label>
                    <div class="col-sm-5">
                        <input type="text" ng-model="candidate.bsc"
                               typeahead="s for s in dictionary.BSC | filter:$viewValue" class="form-control"
                               placeholder="Start typing...">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Square:</label>
                    <div class="col-sm-5">
                        <input type="number" class="form-control" id="square" name="square" ng-model="candidate.square"
                               required>
                        <label class="error"
                               ng-show="kcell_form.square.$error.required && ( kcell_form.square.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">RBS Type:</label>
                    <div class="col-sm-8">
                        {{candidate.rbsType}}
                        <label class="error"
                               ng-show="kcell_form.rbsType.$error.required && ( kcell_form.rbsType.$touched || view.submitted)">Required
                            field</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Band:</label>
                    <div class="col-sm-8">
                        <span ng-repeat="band in bands">{{$index == 0?' ': ' + ' }}{{band.title}}</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-sm-3 control-label">RBS Location:</label>
                    <div class="col-sm-6">
                        <div class="form-check" style="display:inline-block; padding:0 !important; margin-right: 10px;"
                             ng-repeat="l in candidate.rbsLocation track by $index">
                            <input type="checkbox" name="rbsLocation" ng-required="rbsLocationChecked < 1"
                                   ng-click="checkRbsLocation($index, l.value)" ng-model="l.value"
                                   class="form-check-input" id="{{'check' + $index}}">
                            <label class="form-check-label" for="{{'check' + $index}}">{{ l.title }}</label>
                        </div>
                        <label class="error"
                               ng-show="kcell_form.rbsLocation.$error.required && ( checkRbsLocationTouched || view.submitted)">Required
                            field</label>

                    </div>
                </div>
                <div class="form-group" style="margin-bottom:15px;">
                    <label class="col-sm-3 control-label">Comments:</label>
                    <div class="col-sm-5">
                        <textarea class="form-control" ng-model="createNewCandidateSiteTaskComment"
                                  name="createNewCandidateSiteTaskComment" placeholder="Comments..." maxlength="500"
                                  rows="4" style="resize:none"></textarea>
                    </div>
                </div>
                <accordion class="content-visible-accordion background-yellow-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            Address <i class="pull-right glyphicon"
                                                        ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
                        </accordion-heading>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Oblast:</label>
                            <div class="col-sm-8" class="form-check">
                                <select class="form-control" id="cn_addr_oblast" name="cn_addr_oblast" ng-model="address.cn_addr_oblast"
                                     ng-change="filterDistrictAfterSelectObl(address.cn_addr_oblast)" required>
                                    <option ng-repeat="oblast in oblastList" ng-value="oblast.name">{{oblast.name}}</option>
                                </select>
                                <label class="error" ng-show="kcell_form.cn_addr_oblast.$error.required && ( kcell_form.cn_addr_oblast.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">District:</label>
                            <div class="col-sm-8" class="form-check">
                                <select class="form-control" id="cn_addr_district" name="cn_addr_district" ng-model="address.cn_addr_district" ng-disabled="!address.cn_addr_oblast">
                                    <option ng-repeat="district in filteredDistricts" ng-value="district.name">{{district.name}}</option>
                                </select>
                                <label class="error" ng-show="kcell_form.cn_addr_district.$error.required && ( kcell_form.cn_addr_district.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
        
                        <div class="form-group">
                            <label class="col-sm-3 control-label">City / Village:</label>
                            <div class="col-sm-8">
                                <input type="text" ng-model="address.cn_addr_city" ng-value='city.name' name="cn_addr_city" typeahead="city.name for city in getCity($viewValue)" typeahead-on-select="addressCitySelected($item,$model,$label)" class="form-control" required ng-disabled="!address.cn_addr_oblast" placeholder="Start typing...">
                                <label class="error" ng-show="kcell_form.cn_addr_city.$error.required && ( kcell_form.cn_addr_city.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-12">
                                <div class="form-check">
                                    <input type="checkbox" ng-model="address.ca_not_full_addres" class="form-check-input" id="ca_not_full_addres">
                                    <label class="form-check-label" for="ca_not_full_addres">Not full address</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{!address.ca_not_full_addres ? '*' : ''}}Street:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_street" name="cn_addr_street" ng-model="address.cn_addr_street" ng-required="!address.ca_not_full_addres">
                                <label class="error" ng-show="kcell_form.cn_addr_street.$error.required && ( kcell_form.cn_addr_street.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{!address.ca_not_full_addres ? '*' : ''}}Building:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_building" name="cn_addr_building" ng-model="address.cn_addr_building" ng-required="!address.ca_not_full_addres">
                                <label class="error" ng-show="kcell_form.cn_addr_building.$error.required && ( kcell_form.cn_addr_building.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{address.ca_not_full_addres ? '*' : ''}}Cadastral number:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_cadastral_number" name="cn_addr_cadastral_number" ng-model="address.cn_addr_cadastral_number" ng-required="address.ca_not_full_addres">
                                <label class="error" ng-show="kcell_form.cn_addr_cadastral_number.$error.required && ( kcell_form.cn_addr_cadastral_number.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">{{address.ca_not_full_addres ? '*' : ''}}Note to the address:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="cn_addr_note" name="cn_addr_note" ng-model="cn_addr_note" ng-required="address.ca_not_full_addres">
                                <label class="error" ng-show="kcell_form.cn_addr_note.$error.required && ( kcell_form.cn_addr_note.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>        
                    </accordion-group>
                </accordion>

                <accordion class="content-visible-accordion background-yellow-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            Cell antenna information<i class="pull-right glyphicon"
                                                        ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
                        </accordion-heading>
                        <div class="form-group col-sm-3">
                            <div class="col-sm-12">
                                <div class="form-check">
                                    <input type="checkbox" ng-model="cellAntennaInformation.ca_diff_address" ng-change="cellAntennaDiffAddressChecked(cellAntennaInformation.ca_diff_address)" class="form-check-input" id="check1">
                                    <label class="form-check-label" for="check1">Different address</label>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-9">
                            <accordion class="content-visible-accordion">
                                <accordion-group is-open="false" >
                                    <accordion-heading>
                                        Cell Antenna Address <i class="pull-right glyphicon"
                                                                    ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
                                    </accordion-heading>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Oblast:</label>
                                        <div class="col-sm-8" class="form-check">
                                            <select class="form-control" id="cai_addr_oblast" ng-disabled="!cellAntennaInformation.ca_diff_address" name="cai_addr_oblast" ng-model="cellAntennaInformation.cn_addr_oblast"
                                                    ng-change="filterDistrictAfterSelectOblInCAI(cellAntennaInformation.cn_addr_oblast)">
                                                <option ng-repeat="oblast in oblastList" ng-value="oblast.name">{{oblast.name}}</option>
                                            </select>
                                            <label class="error" ng-show="kcell_form.cai_addr_oblast.$error.required && ( kcell_form.cai_addr_oblast.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">District:</label>
                                        <div class="col-sm-8" class="form-check">
                                            <select class="form-control" id="cai_addr_district" ng-disabled="!cellAntennaInformation.ca_diff_address || !cellAntennaInformation.cn_addr_oblast" name="cai_addr_district" ng-model="cellAntennaInformation.cn_addr_district">
                                                <option ng-repeat="district in filteredDistrictsInCAI" ng-value="district.name">{{district.name}}</option>
                                            </select>
                                            <label class="error" ng-show="kcell_form.cai_addr_district.$error.required && ( kcell_form.cai_addr_district.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                    
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">City / Village:</label>
                                        <div class="col-sm-8">
                                            <input type="text" ng-model="cellAntennaInformation.cn_addr_city" name="cn_addr_city" ng-disabled="!cellAntennaInformation.ca_diff_address || !cellAntennaInformation.cn_addr_oblast" typeahead="city.name for city in getCity($viewValue)" typeahead-on-select="cellInfoAddressCitySelected($item,$model,$label)" class="form-control" placeholder="Start typing...">
                                            <label class="error" ng-show="kcell_form.cn_addr_city.$error.required && ( kcell_form.cn_addr_city.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-12">
                                            <div class="form-check">
                                                <input type="checkbox" ng-model="cellAntennaInformation.cai_not_full_addres" class="form-check-input" ng-disabled="!cellAntennaInformation.ca_diff_address" id="ca_not_full_addres">
                                                <label class="form-check-label" for="ca_not_full_addres">Not full address</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Street:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cai_addr_street" name="cai_addr_street" ng-model="cellAntennaInformation.cn_addr_street" ng-disabled="!cellAntennaInformation.ca_diff_address" >
                                            <label class="error" ng-show="kcell_form.cai_addr_street.$error.required && ( kcell_form.cai_addr_street.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Building:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cai_addr_building" name="cai_addr_building" ng-model="cellAntennaInformation.cn_addr_building" ng-disabled="!cellAntennaInformation.ca_diff_address">
                                            <label class="error" ng-show="kcell_form.cai_addr_building.$error.required && ( kcell_form.cai_addr_building.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Cadastral number:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cai_addr_cadastral_number" name="cai_addr_cadastral_number" ng-model="cellAntennaInformation.cn_addr_cadastral_number" ng-disabled="!cellAntennaInformation.ca_diff_address">
                                            <label class="error" ng-show="kcell_form.cai_addr_cadastral_number.$error.required && ( kcell_form.cn_addr_cadastral_number.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Note to the address:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="cn_addr_note" name="cai_addr_note" ng-model="cellAntennaInformation.cn_addr_note" ng-disabled="!cellAntennaInformation.ca_diff_address" >
                                            <label class="error" ng-show="kcell_form.cai_addr_note.$error.required && ( kcell_form.cai_addr_note.$touched || view.submitted)">Required field</label>
                                        </div>
                                    </div>        
                                </accordion-group>
                            </accordion>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Antennas:</label>
                            <div class="col-sm-8">
                                <div class="form-check col-sm-5">
                                    <select multiple style="overflow-y: scroll; height: 20vh"
                                            ng-model="firstMultiselect" class="form-control" id="sel3">
                                        <option ng-repeat="d in antennasList" value="{{$index}}">{{d.antenna}}</option>
                                    </select>
                                </div>
                                <div class="form-check col-sm-2">
                                    <div class="btn-group-vertical btn-group-xs pull-right col-sm-pull-5">
                                        <button type="button" class="btn btn-default"><span
                                                class="glyphicon glyphicon-chevron-right"
                                                ng-click="fromFirstToSecondWindow(firstMultiselect)"></span></button>
                                        <button type="button" class="btn btn-default"><span
                                                class="glyphicon glyphicon-chevron-left"
                                                ng-click="fromSecondToFirstWindow(secondMultiSelect)"></span></button>
                                    </div>
                                </div>
                                <div class="form-check col-sm-5">
                                    <select multiple class="form-control" style="overflow-y: scroll; height: 20vh"
                                            ng-model="secondMultiSelect" id="sel4" name="selectedAntennas" ng-required="cellAntenna.selectedAntennas.length<1">
                                        <option ng-repeat="a in cellAntenna.selectedAntennas">{{a.antenna}}</option>
                                    </select>
                                    <label class="error" ng-show="kcell_form.selectedAntennas.$error.required && ( kcell_form.selectedAntennas.$touched || view.submitted)">Required field</label>

                                </div>
                            </div>
                        </div>
                        <!--<div class="form-group">
                            <label class="col-sm-3 control-label">Cell Antenna quantity:</label>
                            <div class="col-sm-8">
                                <input class="form-control" id="antennasQuantity" name="antennasQuantity" ng-model="cellAntenna.quantity">
                                <label class="error" ng-show="kcell_form.antennasQuantity.$error.required && ( kcell_form.antennasQuantity.$touched || view.submitted)">Required field</label>
                            </div>
                        </div>-->
                        <div class="form-group">
                            <label class="col-sm-1 control-label"></label>
                            <div class="col-sm-11">
                                <table class="table table-condensed"
                                       ng-show="cellAntenna.selectedAntennas && cellAntenna.selectedAntennas.length>0">
                                    <thead>
                                    <tr>
                                        <td>Antenna name:</td>
                                        <td class="col-sm-1">Quantity:</td>
                                        <td>Dimensions:</td>
                                        <td class="col-sm-2">Frequency band:</td>
                                        <td class="col-sm-1">Weight (kg):</td>
                                        <td>Azimuth:</td>
                                        <td>Suspension height (m):</td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat="s in cellAntenna.selectedAntennas">
                                        <td class="col-sm-3">{{s.antenna}}</td>
                                        <td class="col-sm-1">
                                            <input type="number" required class="form-control" id="quantity_{{$index}}"
                                                   name="quantity_{{$index}}" ng-model="s.quantity" placeholder="">
                                            <label class="error"
                                                   ng-show="kcell_form.quantity_{{$index}}.$error.required && ( kcell_form.quantity_{{$index}}.$touched || view.submitted)">Required
                                                field</label>

                                        </td>
                                        <td class="col-sm-2">
                                            <input class="form-control" id="dimensions_{{$index}}"
                                                   name="dimensions_{{$index}}" ng-model="s.dimension"
                                                   placeholder="1000x100x100" required>
                                            <label class="error"
                                                   ng-show="kcell_form.dimensions_{{$index}}.$error.required && ( kcell_form.dimensions_{{$index}}.$touched || view.submitted)">Required
                                                field</label>
                                        </td>
                                        <td class="col-sm-2">
                                            <input class="form-control" type="number" id="frequencyBand_{{$index}}"
                                                   name="frequencyBand_{{$index}}" ng-model="s.frequencyBand"
                                                   ng-change="checkFrequency(s.frequencyBand, $index)" placeholder=""
                                                   required>
                                            <label class="error"
                                                   ng-show="kcell_form.frequencyBand_{{$index}}.$error.required && ( kcell_form.frequencyBand_{{$index}}.$touched || view.submitted)">Required
                                                field</label>
                                        </td>
                                        <td class="col-sm-1">
                                            <input class="form-control" id="weight_{{$index}}" name="weight_{{$index}}"
                                                   ng-model="s.weight" placeholder="10" required>
                                            <label class="error"
                                                   ng-show="kcell_form.weight_{{$index}}.$error.required && ( kcell_form.weight_{{$index}}.$touched || view.submitted)">Required
                                                field</label>

                                        </td>
                                        <td class="col-sm-2">
                                            <input class="form-control" id="azimuth_{{$index}}"
                                                   name="azimuth_{{$index}}" type="number"
                                                   ng-change="checkAzimuth(s.azimuth, $index)" ng-model="s.azimuth"
                                                   placeholder="(0-360)" required>
                                            <label class="error"
                                                   ng-show="kcell_form.azimuth_{{$index}}.$error.required && ( kcell_form.azimuth_{{$index}}.$touched || view.submitted)">Required
                                                field</label>
                                        </td>
                                        <td class="col-sm-2">
                                            <input class="form-control" id="suspensionHeight_{{$index}}"
                                                   name="suspensionHeight_{{$index}}" ng-model="s.suspensionHeight"
                                                   placeholder="" required>
                                            <label class="error"
                                                   ng-show="kcell_form.suspensionHeight_{{$index}}.$error.required && ( kcell_form.suspensionHeight_{{$index}}.$touched || view.submitted)">Required
                                                field</label>

                                        </td>

                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Address:</label>
                            <div class="col-sm-8" style="padding-left:30px">
                                <textarea class="form-control" ng-model="cellAntenna.address" name="address"
                                          maxlength="500" rows="3" style="resize:none" required></textarea>
                                <label class="error"
                                       ng-show="kcell_form.address.$error.required && ( kcell_form.address.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                    </accordion-group>
                </accordion>


                <accordion class="content-visible-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            Renter Company <i class="pull-right glyphicon"
                                              ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
                        </accordion-heading>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal type:</label>
                            <div class="col-sm-6">
                                <select class="form-control" id="legalType" name="legalType"
                                        ng-model="renterCompany.legalType"
                                        ng-options="type.id as type.desc for type in dictionary.legalType"
                                        ng-selected="defineSiteObjectType()" required>
                                </select>
                                <label class="error"
                                       ng-show="kcell_form.legalType.$error.required && ( kcell_form.legalType.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group"
                             ng-if="confirmSendingRequestReceiveTsKZT && renterCompany.legalType==='national_kazakhtelecom'">
                            <label class="col-sm-3 control-label">Branch of Kazakhtelecom:</label>
                            <div class="col-sm-6">
                                {{confirmSendingRequestReceiveTsKZT.branchKT}}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal name:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="RClegalName" name="RClegalName"
                                       ng-model="renterCompany.legalName" required>
                                <label class="error"
                                       ng-show="kcell_form.RClegalName.$error.required && ( kcell_form.RClegalName.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Legal address:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="legalAddress" name="legalAddress"
                                       ng-model="renterCompany.legalAddress" required>
                                <label class="error"
                                       ng-show="kcell_form.legalAddress.$error.required && ( kcell_form.legalAddress.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Tel./Fax:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="telFax" name="telFax" ng-model="renterCompany.telFax"
                                       required>
                                <label class="error"
                                       ng-show="kcell_form.telFax.$error.required && ( kcell_form.telFax.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="firstLeaderName" name="firstLeaderName"
                                       ng-model="renterCompany.firstLeaderName" required>
                                <label class="error"
                                       ng-show="kcell_form.firstLeaderName.$error.required && ( kcell_form.firstLeaderName.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="firstLeaderPos" name="firstLeaderPos"
                                       ng-model="renterCompany.firstLeaderPos" required>
                                <label class="error"
                                       ng-show="kcell_form.firstLeaderPos.$error.required && ( kcell_form.firstLeaderPos.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Email:</label>
                            <div class="col-sm-6">
                                <input class="form-control email" id="email" name="email" ng-model="renterCompany.email"
                                       required>
                                <label class="error"
                                       ng-show="kcell_form.email.$error.required && ( kcell_form.email.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><h4>Contact Person</h4></label>
                            <div class="col-sm-6"></div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Name:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="contactName" name="contactName"
                                       ng-model="renterCompany.contactName" required>
                                <label class="error"
                                       ng-show="kcell_form.contactName.$error.required && ( kcell_form.contactName.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Position:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="position" name="position"
                                       ng-model="renterCompany.contactPosition" required>
                                <label class="error"
                                       ng-show="kcell_form.position.$error.required && ( kcell_form.position.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Contact Information:</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="contractInfo" name="contractInfo"
                                       ng-model="renterCompany.contactInfo" required>
                                <label class="error"
                                       ng-show="kcell_form.contractInfo.$error.required && ( kcell_form.contractInfo.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>

                    </accordion-group>
                </accordion>


                <accordion class="content-visible-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            Near End Information <i class="pull-right glyphicon"
                                                    ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
                        </accordion-heading>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">TR Antenna type:</label>
                            <div class="col-sm-6">
                                <select class="form-control" id="antennaType" name="antennaType"
                                        ng-model="transmissionAntenna.antennaType"
                                        ng-change="defineByAntennaType(transmissionAntenna.antennaType, 'transmission')">
                                    <option value="">-</option>
                                    <option ng-repeat="a in dictionary.antennaType" value="{{a.name}}">{{a.name}}
                                    </option>
                                </select>
                                <label class="error"
                                       ng-show="kcell_form.antennaType.$error.required && ( kcell_form.antennaType.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">TR Antenna quantity:</label>
                            <div class="col-sm-6">
                                <input type="number" class="form-control" id="antennaQuantity" name="antennaQuantity"
                                       ng-model="transmissionAntenna.antennaQuantity">
                                <label class="error"
                                       ng-show="kcell_form.antennaQuantity.$error.required && ( kcell_form.antennaQuantity.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Frequency Band:</label>
                            <div class="col-sm-6">
                                <select class="form-control" id="frequencyBand" name="frequencyBand"
                                        ng-disabled="!frequenciesByAntennaType"
                                        ng-model="transmissionAntenna.frequencyBand">
                                    <option ng-repeat="freq in frequenciesByAntennaType.frequencies">{{freq}}</option>
                                </select>
                                <label class="error"
                                       ng-show="kcell_form.frequencyBand.$error.required && ( kcell_form.frequencyBand.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">Diameter (m):</label>
                            <div class="col-sm-6">{{transmissionAntenna.diameter}}</div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Weight (kg):</label>
                            <div class="col-sm-6">{{transmissionAntenna.weight}}</div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Suspension height of antennas (m):</label>
                            <div class="col-sm-6">
                                <input type="number" class="form-control" id="TRSuspensionHeight"
                                       name="TRSuspensionHeight" ng-model="transmissionAntenna.suspensionHeight">
                                <label class="error"
                                       ng-show="kcell_form.TRSuspensionHeight.$error.required && ( kcell_form.TRSuspensionHeight.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Azimuth:</label>
                            <div class="col-sm-6">
                                <input class="form-control email" id="TRazimuth" name="TRazimuth"
                                       ng-model="transmissionAntenna.azimuth">
                                <label class="error"
                                       ng-show="kcell_form.TRazimuth.$error.required && ( kcell_form.TRazimuth.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>

                    </accordion-group>
                </accordion>

                <accordion class="content-visible-accordion">
                    <accordion-group is-open="false">
                        <accordion-heading>
                            Power Source <i class="pull-right glyphicon"
                                            ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
                        </accordion-heading>

                        <div class="form-group">
                            <label class="col-sm-4 control-label">Does renter agree to provide us 3 Phase/3.5kWof
                                electrical energy?</label>
                            <div class="col-sm-6">
                                <label class="radio-inline">
                                    <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase"
                                           value="Yes"> Yes
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="provideUs3Phase" ng-model="powerSource.provideUs3Phase"
                                           value="No"> No
                                </label>
                                <label class="error"
                                       ng-show="kcell_form.provideUs3Phase.$error.required && ( kcell_form.provideUs3Phase.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Cable length to connection point (in meters):</label>
                            <div class="col-sm-6">
                                <input class="form-control" id="cableLength" name="cableLength"
                                       ng-model="powerSource.cableLength">
                                <label class="error"
                                       ng-show="kcell_form.cableLength.$error.required && ( kcell_form.cableLength.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Cable laying type:</label>
                            <div class="col-sm-6">
                                <div class="form-check col-sm-6"
                                     ng-repeat="t in powerSource.cableLayingType track by $index">
                                    <input type="checkbox" ng-model="t.value" class="form-check-input"
                                           id="{{'check' + $index}}">
                                    <label class="form-check-label" for="{{'check' + $index}}">{{ t.title }}</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Does renter agree to receive monthly paymentfor
                                consumed electrical energy according to ourpower counters displays buy the bank
                                transactionsand give us invoices?</label>
                            <div class="col-sm-6">
                                <label class="radio-inline">
                                    <input type="radio" name="agreeToReceiveMonthlyPayment"
                                           ng-model="powerSource.agreeToReceiveMonthlyPayment" value="Yes"> Yes
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="agreeToReceiveMonthlyPayment"
                                           ng-model="powerSource.agreeToReceiveMonthlyPayment" value="No"> No
                                </label>
                                <label class="error"
                                       ng-show="kcell_form.agreeToReceiveMonthlyPayment.$error.required && ( kcell_form.agreeToReceiveMonthlyPayment.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-md-4 control-label">Closest public (RES) electrical line:</label>

                            <div class="col-sm-4">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon1">0,4 kV</span>
                                    <input class="form-control" id="closestPublic04" name="closestPublic04"
                                           ng-model="powerSource.closestPublic04">
                                </div>
                                <label class="error"
                                       ng-show="kcell_form.closestPublic04.$error.required && ( kcell_form.closestPublic04.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon2">10 kV</span>
                                    <input class="form-control" id="closestPublic10" name="closestPublic10"
                                           ng-model="powerSource.closestPublic10">
                                </div>
                                <label class="error"
                                       ng-show="kcell_form.closestPublic10.$error.required && ( kcell_form.closestPublic10.$touched || view.submitted)">Required
                                    field</label>
                            </div>
                        </div>
                    </accordion-group>
                </accordion>


                <div class="form-group">
                    <label class="col-md-3 control-label">Attachments:</label>
                    <div class="col-sm-9">
                        <ng-form name="kcell_material_file_form">
                            <input type="file" class="form-control" id="createNewCandidateSiteFiles"
                                   name="createNewCandidateSiteFiles" ng-model="file.file"
                                   onchange="angular.element(this).scope().fileSelected(this, 'createNewCandidateSiteFiles')"/>
                        </ng-form>
                        <table ng-show="createNewCandidateSiteFiles.length > 0"
                               class="col-sm-12 table-hover uploads-table">
                            <tr>
                                <th col-sm-6>File Name</th>
                                <th col-sm-3>Created Date</th>
                                <th col-sm-3>Created by</th>
                            </tr>
                            <tr ng-repeat="file in createNewCandidateSiteFiles">
                                <td><a ng-click="fileDownload(file)">{{file.name}}</a> | <a
                                        ng-click="clearFile('createNewCandidateSiteFiles', $index)"><i
                                        class="glyphicon glyphicon-trash"></i></a></td>
                                <td>{{file.date | date:'dd.MM.yyyy'}}</td>
                                <td>{{file.author}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Comments:</label>
                    <div class="col-sm-9">
                        <textarea class="form-control" ng-model="candidate.comments" name="newCandidateComments"
                                  maxlength="500" rows="4" style="resize:none"></textarea>
                    </div>
                </div>
            </div>
        </tab>
        <tab>
            <tab-heading>
                <span class="glyphicon glyphicon-list"></span> Far End Information
            </tab-heading>
            <div style="margin-top: 20px;">
                <div class="col-sm-12">

                    <h4>Far Ends priority:</h4>
                    <div class="row col-sm-8">
                        <table class="table table-bordered col-sm-12">
                            <thead>
                            <td width="10%">№</td>
                            <td width="90%">Far End Name</td>
                            </thead>
                            <tbody ui-sortable="sortableOptions" ng-model="farEndInformation">

                            <tr ng-repeat="fe in farEndInformation">
                                <td>{{ $index + 1 }}</td>
                                <td>
                                    <div ng-click="openFarEndInformation($index)" class="far-end-info">{{fe.farEndName}}
                                        <div class="far-end-delete" ng-click="deleteFE($index)">x</div>
                                    </div>
                                </td>

                                <!--<td><a ng-click="editFE($index)">Изменить</a><a class="glyphicon glyphicon-trash pull-right" ng-click="deleteFE($index)"></a></td>-->
                            </tr>
                            <tr>
                                <td>{{ farEndInformation.length + 1 }}</td>
                                <td>
                                    <input type="text" ng-model="newFe.farEndName" name="farEndName"
                                           ng-required="!threeFarEndNotNecessary.check && farEndInformation.length<3"
                                           typeahead="site as sites.site_name for sites in getSite($viewValue)"
                                           typeahead-on-select="siteSelected($item,$model,$label)" class="form-control"
                                           autocomplete="on" placeholder="Far End Name">
                                    <label class="error"
                                           ng-show="kcell_form.farEndName.$error.required && (kcell_form.farEndName.$touched || view.submitted)">Required
                                        field</label>

                                </td>

                                <!--<td><a ng-click="editFE($index)">Изменить</a><a class="glyphicon glyphicon-trash pull-right" ng-click="deleteFE($index)"></a></td>-->
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>

                <div class="form-group col-sm-12" style="padding-bottom: 17px;">
                    <div class="col-sm-12">
                        <input type="checkbox" ng-model="threeFarEndNotNecessary.check" class="form-check-input"
                               name="threeFarEndNotNecessaryCheck" id="threeFarEndNotNecessaryCheck">
                        <label class="form-check-label" style="font-weight:normal">The possibility of providing 3 FE is
                            not available</label>
                    </div>
                </div>
                <div class="form-group col-sm-12" ng-show="threeFarEndNotNecessary.check" style="margin-bottom:15px;">
                    <label class="col-sm-2 control-label">Description:</label>
                    <div class="col-sm-6">
                        <textarea class="form-control" ng-required="threeFarEndNotNecessary.check"
                                  ng-model="threeFarEndNotNecessary.comment" name="threeFarEndNotNecessaryCheckComment"
                                  placeholder="Comments..." maxlength="500" rows="4" style="resize:none"></textarea>
                        <label class="error"
                               ng-show="kcell_form.threeFarEndNotNecessaryCheckComment.$error.required && (kcell_form.threeFarEndNotNecessaryCheckComment.$touched || view.submitted)">Required
                            field</label>

                    </div>
                </div>

                <div class="col-sm-12" ng-if="farEndInformation.length>0 && currentFarEnd">
                    <accordion class="content-visible-accordion background-yellow-accordion">
                        <accordion-group is-open="false">
                            <accordion-heading>
                                Far End Information <i class="pull-right glyphicon"
                                                       ng-class="{'glyphicon-chevron-up': status.isCustomHeaderOpen, 'glyphicon-chevron-down': !status.isCustomHeaderOpen}"></i>
                            </accordion-heading>
                            <ng-form name="form.fe_form">
                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Far End name:</label>
                                        <label class="col-sm-8 control-label">{{currentFarEnd.farEndName}}</label>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Far End address:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="farEndAddress" name="farEndAddress"
                                                   ng-model="currentFarEnd.farEndAddress">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Contract Information:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="contractInformation"
                                                   name="contractInformation"
                                                   ng-model="currentFarEnd.contractInformation">
                                            <label class="error"
                                                   ng-show="form.fe_form.contractInformation.$error.required && ( form.fe_form.contractInformation.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Square:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FeSquare" name="FeSquare"
                                                   ng-model="currentFarEnd.square">
                                            <label class="error"
                                                   ng-show="form.fe_form.FeSquare.$error.required && ( form.fe_form.FeSquare.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Equipment type:</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="equipmentType" name="equipmentType"
                                                    ng-model="currentFarEnd.equipmentType">
                                                <option value="" disabled ng-selected="currentFarEnd.equipmentType===''" hidden>Select Equipment Type</option>
                                                <option ng-repeat="e in dictionary.equipmentType">{{e}}</option>
                                            </select>
                                            <label class="error"
                                                   ng-show="form.fe_form.equipmentType.$error.required && ( form.fe_form.equipmentType.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Antenna type:</label>
                                        <label class="col-sm-1 control-label">Quantity:</label>
                                        <label class="col-sm-2 control-label">Frequency band:</label>
                                        <label class="col-sm-2 control-label">Diameter (m):</label>
                                        <label class="col-sm-1 control-label">Weight (kg):</label>
                                        <label class="col-sm-1 control-label">Azimuth:</label>
                                        <label class="col-sm-2 control-label">Suspension height (m):</label>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-3">
                                            <select class="form-control" id="feAntennaType" name="feAntennaType"
                                                    ng-model="currentFarEnd.feAntennaType"
                                                    ng-change="defineByAntennaType(currentFarEnd.feAntennaType, 'farend')">
                                                <option value="" disabled ng-selected="currentFarEnd.feAntennaType===''" hidden>Select Antenna Type</option>
                                                <option ng-repeat="a in dictionary.antennaType" value="{{a.name}}">
                                                    {{a.name}}
                                                </option>
                                            </select>
                                        </div>
                                        <div class="col-sm-1">
                                            <input type="number" class="form-control" id="FeAntennasQuantity"
                                                   name="FeAntennasQuantity" ng-model="currentFarEnd.antennasQuantity">
                                        </div>
                                        <div class="col-sm-2">
                                            <select class="form-control" id="FeFrequencyBand" name="FeFrequencyBand"
                                                    ng-disabled="!frequenciesFeByAntennaType"
                                                    ng-model="currentFarEnd.frequencyBand"
                                                    ng-options="freq for freq in frequenciesFeByAntennaType.frequencies">
                                            </select>
                                            <label class="error"
                                                   ng-show="kcell_form.FeFrequencyBand.$error.required && ( kcell_form.FeFrequencyBand.$touched || view.submitted)">Required
                                                field</label>
                                        </div>
                                        <div class="col-sm-2">
                                            <input class="form-control" id="FeDiameter" name="FeDiameter"
                                                   ng-model="currentFarEnd.diameter">
                                        </div>

                                        <div class="col-sm-1">
                                            <input class="form-control" id="FeWeight" name="FeWeight"
                                                   ng-model="currentFarEnd.weight">
                                        </div>
                                        <div class="col-sm-1">
                                            <input class="form-control" id="FeAzimuth" name="FeAzimuth"
                                                   ng-model="currentFarEnd.azimuth">
                                        </div>
                                        <div class="col-sm-2">
                                            <input class="form-control" id="FeSuspensionHeight"
                                                   name="FeSuspensionHeight" ng-model="currentFarEnd.suspensionHeight">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Сonstruction type:</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="FeConstructionType"
                                                    name="FeConstructionType"
                                                    ng-model="currentFarEnd.constructionType">
                                                <option value="" disabled ng-selected="currentFarEnd.constructionType===''" hidden>Select Construction Type
                                                </option>
                                                <option ng-repeat="c in dictionary.constructionType">{{c}}</option>
                                            </select>
                                            <label class="error"
                                                   ng-show="form.fe_form.FeConstructionType.$error.required && ( form.fe_form.FeConstructionType.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Survey Date:</label>
                                        <div class="col-sm-8">

                                            <div class="input-group">
                                                <input type="text" ng-model="currentFarEnd.surveyDate" name="surveyDate"
                                                       class="form-control" datepicker-popup="dd.MM.yyyy"
                                                       is-open="surveyDateFieldOpened" id="surveyDate"/>
                                                <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="surveyDateFieldOpened = true">
                                    <i class="glyphicon glyphicon-calendar"></i>
                                </button>
                                         </span>
                                            </div>

                                            <label class="error"
                                                   ng-show="form.fe_form.surveyDate.$error.required && ( form.fe_form.surveyDate.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Results of visit of objects:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="ResultsOfVisit" name="ResultsOfVisit"
                                                   ng-model="currentFarEnd.resultsOfVisit">
                                            <label class="error"
                                                   ng-show="form.fe_form.ResultsOfVisit.$error.required && ( form.fe_form.ResultsOfVisit.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Comments:</label>
                                        <div class="col-sm-8">
                                            <textarea class="form-control" ng-model="currentFarEnd.comments"
                                                      name="FeComments" maxlength="500" rows="4"
                                                      style="resize:none"></textarea>
                                            <label class="error"
                                                   ng-show="form.fe_form.FeComments.$error.required && ( form.fe_form.FeComments.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <h4><b>Renter Company</b></h4>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Legal type:</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="farEndLegalType" name="farEndLegalType"
                                                    ng-model="currentFarEnd.legalType"
                                                    ng-options="type.id as type.desc for type in dictionary.legalType">
                                            </select>
                                            <label class="error"
                                                   ng-show="form.fe_form.farEndLegalType.$error.required && ( form.fe_form.farEndLegalType.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Legal name:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERClegalName" name="FERClegalName"
                                                   ng-model="currentFarEnd.renterCompany.legalName">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERClegalName.$error.required && ( form.fe_form.FERClegalName.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Legal address:</label>
                                        <div class="col-sm-8">
                                            <textarea class="form-control" id="FERCLegalAddress" name="FERCLegalAddress"
                                                      ng-model="currentFarEnd.renterCompany.legalAddress"
                                                      maxlength="500" rows="4" style="resize:none"></textarea>
                                            <label class="error"
                                                   ng-show="form.fe_form.FERCLegalAddress.$error.required && ( form.fe_form.FERCLegalAddress.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Tel./Fax:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERCTelFax" name="FERCTelFax"
                                                   ng-model="currentFarEnd.renterCompany.telFax">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERCTelFax.$error.required && ( form.fe_form.FERCTelFax.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Name of the 1st Leader:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERCFirstLeaderName"
                                                   name="FERCFirstLeaderName"
                                                   ng-model="currentFarEnd.renterCompany.firstLeaderName">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERCFirstLeaderName.$error.required && ( form.fe_form.FERCFirstLeaderName.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Position of the 1st Leader:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERCFirstLeaderPosition"
                                                   name="FERCFirstLeaderPosition"
                                                   ng-model="currentFarEnd.renterCompany.firstLeaderPosition">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERCFirstLeaderPosition.$error.required && ( form.fe_form.FERCFirstLeaderPosition.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Email:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERCemail" name="FERCemail"
                                                   ng-model="currentFarEnd.renterCompany.email">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERCemail.$error.required && ( form.fe_form.FERCemail.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <h4><b>Contact Person:</b></h4>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Name:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERC_Name" name="FERC_Name"
                                                   ng-model="currentFarEnd.renterCompany.name">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERC_Name.$error.required && ( form.fe_form.FERC_Name.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Position:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERC_Position" name="FERC_Position"
                                                   ng-model="currentFarEnd.renterCompany.position">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERC_Position.$error.required && ( form.fe_form.FERC_Position.$touched || currentFarEnd.submitted)">Required
                                                field</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-3 control-label">Contact Information:</label>
                                        <div class="col-sm-8">
                                            <input class="form-control" id="FERC_ContractInformation"
                                                   name="FERC_ContractInformation"
                                                   ng-model="currentFarEnd.renterCompany.contactInformation">
                                            <label class="error"
                                                   ng-show="form.fe_form.FERC_ContractInformation.$error.required && ( form.fe_form.FERC_ContractInformation.$touched || currentFarEnd.submitted )">Required
                                                field</label>
                                        </div>
                                    </div>

                                    <br>
                                </div>
                            </ng-form>
                        </accordion-group>
                    </accordion>

                </div>
            </div>
        </tab>
    </tabset>
</form>
