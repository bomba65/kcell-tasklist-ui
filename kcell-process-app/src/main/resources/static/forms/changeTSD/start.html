<style>
  .background-yellow-accordion .panel-body {
    background-color: #ffffcc;
    border: 1px solid #b3b3b3;
    color: #333;
  }

  .start-table tbody {
    max-height: 470px;
    overflow-y: overlay;
    width: 100%;
  }

  .start-table thead,
  .start-table tbody,
  .start-table tr,
  .start-table td,
  .start-table th {
    display: block;
  }

  .start-table tbody tr td,
  .start-table thead tr th {
    float: left;
  }

  .my-group .form-control {
    width: 50%;
  }

  .modal-lg.modal-dialog {
    width: 60%;
  }

  input[type="number"]::-webkit-inner-spin-button,
  input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .modal {
    overflow: auto !important;
  }

  .animate-if {
    background: white;
    overflow: hidden;
    transition: 0.4s;
    padding: 13px;
    margin-bottom: 0px;
    color: #b3b3b3;
    background-color: #fff;
    border: 2px solid #b3b3b3;
    border-radius: 0;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .animate-if.ng-enter,
  .animate-if.ng-leave {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .animate-if.ng-enter,
  .animate-if.ng-leave.ng-leave-active {
    opacity: 0;
    max-height: 0;
    padding-top: 0px;
    padding-bottom: 0px;
  }

  .animate-if.ng-leave,
  .animate-if.ng-enter.ng-enter-active {
    opacity: 1;
    max-height: 500px;
    padding-top: 13px;
    padding-bottom: 13px;
  }
</style>

<form role="form" class="form-horizontal" name="kcell_form" novalidate>
  <script cam-script type="text/form-script" type="text/javascript">
    <!--         <script>-->
          inject(['$scope', '$http', 'Uri', '$rootScope', '$q', '$timeout', function ($scope, $http, Uri, $rootScope, $q, $timeout) {
                var variables = [
                    'region_name',
                    'ne_sitename',
                    'fe_sitename',
                    'date_of_visit',
                    'ne_construction_type',
                    'fe_construction_type',
                    'protection_mode',
                    'ne_diameter',
                    'fe_diameter',
                    'hop_link_capacity',
                    'ne_address',
                    'fe_address',
                    'ne_latitude',
                    'ne_longitude',
                    'fe_latitude',
                    'fe_longitude',
                    'ne_altitude',
                    'fe_altitude',
                    'ne_azimuth',
                    'fe_azimuth',
                    'path_distance',
                    'ne_construction_height',
                    'fe_construction_height',
                    'ne_suspension_height_antennas',
                    'fe_suspension_height',
                    'hop_link_nxe1',
                    'hop_modulation_type',
                    'hop_channel_bandwidth',
                    'tnuTsdNumber',
                    'ne_terminal_id',
                    'fe_terminal_id',
                    'ne_protection_rau_subband',
                    'fe_protection_rau_subband',
                    'ne_protection_suspension_height',
                    'fe_protection_suspension_height',
                    'ne_protection_antenna_diameter',
                    'fe_protection_antenna_diameter',
                ];

                camForm.on('form-loaded', function () {
                    variables.forEach(function (el) {
                        camForm.variableManager.fetchVariable(el);
                    });

                    camForm.variableManager.createVariable({
                        name: 'tnutsd_fill_tsd_by_centerTaskResult',
                        type: 'String',
                        value: ''
                    });
                });

                $scope.titles = {};
                $scope.regionsTitle = {
                    'alm': 'Alm',
                    'astana': 'Astana',
                    'nc': 'N&C',
                    'east': 'East',
                    'south': 'South',
                    'west': 'West'
                };
                $scope.catalogToRegion = {
                    '1': 'alm',
                    '2': 'astana',
                    '3': 'nc',
                    '4': 'east',
                    '5': 'south',
                    '6': 'west'
                };

                $scope.result = [];

                $scope.protectionModeSetted = false;
                $scope.antenaSetted = false;
                $scope.linkCapacitySetted = false;
                $scope.variablesFetched = false;
                $scope.suspensionPattern = '([1-9]|[1-9][0-9]|[1-9][0-9][0-9])';
                $scope.heightPattern = '[-]?[0-9]+';
                $scope.altitudePattern = '(-[1-9]{1}[0-9]{0,1}[0-9]{0,1}|-[1-9]{1}[0-9]{0,1}[0-9]{0,1}\\.[0-9]{1}|[1-9]{1}[0-9]?[0-9]{0,1}[0-9]{0,1}|[1-9]{1}[0-9]?[0-9]{0,1}[0-9]{0,1}\\.[0-9]{1}|0)';
                $scope.latitudePattern = '(4([1-9]{1}\\.[0-9]{6}|0\\.([6-9]{1}[0-9]{5}|5([7-9]{1}[0-9]{4}|6(9[0-9]{3}|8[0-9]{3}))))|5([0-4]{1}\\.[0-9]{6}|5\\.([0-3]{1}[0-9]{5}|4([0-3]{1}[0-9]{4}|40000))))';
                $scope.longitudePattern = '([5-7]{1}[0-9]{1}\\.[0-9]{6}|4([7-9]{1}\\.[0-9]{6}|6\\.([5-9]{1}[0-9]{5}|49([4-9]{1}|3)[0-9]{3}))|8([0-6]{1}\\.[0-9]{6}|7\\.([0-2]{1}[0-9]{5}|3(0[0-9]{4}|1([0-4]{1}[0-9]{3}|5000)))))';
                $scope.ne_power_level_txPattern = '(-)?[0-9]{1,2}';
                $scope.ne_power_level_rxPattern = '(-){1}[0-9]{1,2}';
                $scope.fe_power_level_txPattern = '(-)?[0-9]{1,2}';
                $scope.fe_power_level_rxPattern = '(-){1}[0-9]{1,2}';
                $scope.linkNxePattern = '([0-9]{1}|[1-9]{1}[0-9]{1}|1[0-4]{1}[0-9]{1}|15[0-5]{1})';
                $scope.protection_mode_fetched = false;

                $scope.antennaDiameter = function () {
                    if($scope.selectedTsd.fe_antenna_diameter_id){
                        $scope.selectedTsd.fe_antenna_diameter_id = {}
                    }
                    $scope.selectedTsd.fe_antenna_diameter_id.id = $scope.selectedTsd.ne_antenna_diameter_id.id
                };
                $scope.protectionAntennaDiameter = function () {
                    if($scope.selectedTsd.fe_antenna_diameter_protect_id == null){
                        $scope.selectedTsd.fe_antenna_diameter_protect_id = {}
                    }
                    if($scope.selectedTsd.ne_antenna_diameter_protect_id == null){
                        $scope.selectedTsd.ne_antenna_diameter_protect_id = {}
                    }
                    $scope.selectedTsd.fe_antenna_diameter_protect_id.id = $scope.selectedTsd.ne_antenna_diameter_protect_id.id
                };


                $scope.setValues = function () {
                    if ($scope.selectedTsd && $scope.selectedTsd.protection_mode_id && (!$scope.protectionModeSetted && $scope.variablesFetched && $scope.protectionModeList)) {
                        var i = $scope.protectionModeList.findIndex(function (e) {
                            $scope.protectionModeSetted = true;
                            return e.id.toString() === $scope.selectedTsd.protection_mode_id.id
                        });

                        if (i > -1) {
                            $scope.selectedTsd.protection_mode_id.id = $scope.protectionModeList[i].id;
                            if ($scope.selectedTsd.protection_mode_id.id === 2) {
                                $scope.selectedTsd.polarization_id.id = 3;
                            }
                            $scope.protectionMode();

                        }
                    }

                    if ($scope.selectedTsd && $scope.selectedTsd.capacity_id && (!$scope.linkCapacitySetted && $scope.variablesFetched && $scope.linkCapacityList)) {
                        var i = $scope.linkCapacityList.findIndex(function (e) {
                            $scope.linkCapacitySetted = true;
                            return e.id.toString() === $scope.selectedTsd.capacity_id.id
                        });

                        if ($scope.selectedTsd && $scope.selectedTsd.capacity_id && (i > -1)) {
                            $scope.selectedTsd.capacity_id.id = $scope.linkCapacityList[i].id;
                        }
                    }

                    if ($scope.selectedTsd && $scope.selectedTsd.ne_antenna_diameter_id && (!$scope.antenaSetted && $scope.variablesFetched && $scope.trAntennasTypeList)) {
                        var neI = $scope.trAntennasTypeList.findIndex(function (e) {
                            $scope.antenaSetted = true;
                            return e.id.toString() === $scope.selectedTsd.ne_antenna_diameter_id.id
                        });
                        var feI = $scope.trAntennasTypeList.findIndex(function (e) {
                            $scope.antenaSetted = true;
                            return e.id.toString() === $scope.selectedTsd.fe_antenna_diameter_id.id
                        });

                        if ($scope.selectedTsd && (neI > -1)) {
                            $scope.selectedTsd.ne_antenna_diameter_id.id = $scope.trAntennasTypeList[neI].id
                        }
                        if (feI > -1) {
                            $scope.selectedTsd.fe_antenna_diameter_id.id = $scope.trAntennasTypeList[feI].id
                        }

                        var nePI = $scope.trAntennasTypeList.findIndex(function (e) {
                            $scope.antenaSetted = true;
                            return e.id.toString() === $scope.selectedTsd.ne_antenna_diameter_protect_id.id
                        });
                        var fePI = $scope.trAntennasTypeList.findIndex(function (e) {
                            $scope.antenaSetted = true;
                            return e.id.toString() === $scope.selectedTsd.fe_antenna_diameter_protect_id.id
                        });

                        if (nePI > -1) {
                            $scope.selectedTsd.ne_antenna_diameter_protect_id.id = $scope.trAntennasTypeList[nePI].id
                        }
                        if (fePI > -1) {
                            $scope.selectedTsd.fe_antenna_diameter_protect_id.id = $scope.trAntennasTypeList[fePI].id
                        }
                    }
                    if($scope.selectedTsd && ($scope.selectedTsd.nearend_id.facility_id.latitude)){
                        $scope.ne_latitude_dms = $scope.calculateDMS($scope.selectedTsd.nearend_id.facility_id.latitude);
                    }
                    if($scope.selectedTsd && ($scope.selectedTsd.nearend_id.facility_id.longitude)){
                        $scope.ne_longitude_dms = $scope.calculateDMS($scope.selectedTsd.nearend_id.facility_id.longitude);
                    }

                    if($scope.selectedTsd && ($scope.selectedTsd.farend_id.facility_id.latitude)){
                        $scope.fe_latitude_dms = $scope.calculateDMS($scope.selectedTsd.farend_id.facility_id.latitude);
                    }
                    if($scope.selectedTsd && ($scope.selectedTsd.farend_id.facility_id.longitude)){
                        $scope.fe_longitude_dms = $scope.calculateDMS($scope.selectedTsd.farend_id.facility_id.longitude);
                    }
                };

                $scope.protectionModeClicked = false;
                $scope.protectionModeClickedAndChanged = false;
                $scope.onProtectionModeClick = function() {
                  $scope.protectionModeClicked = true;
                }
                $scope.protectionMode = function () {
                    if ($scope.protectionModeClicked) {
                        $scope.protectionModeClickedAndChanged = true;
                    }
                    if ($scope.selectedTsd.protection_mode_id  && ($scope.selectedTsd.protection_mode_id.id === 0 || $scope.selectedTsd.protection_mode_id.id === 1 || $scope.selectedTsd.protection_mode_id.id === 2 || $scope.selectedTsd.protection_mode_id.id === 3)) {
                        $scope.protection_mode_fetched = true
                        $scope.selectedTsd.ne_antenna_diameter_protect_id = undefined
                        $scope.selectedTsd.fe_antenna_diameter_protect_id = undefined
                        $scope.selectedTsd.ne_height_susp_antenna_protect = undefined
                        $scope.selectedTsd.fe_height_susp_antenna_protect = undefined
                        $scope.selectedTsd.ne_power_levels_tx_protect = undefined
                        $scope.selectedTsd.ne_power_levels_rx_protect = undefined
                        $scope.selectedTsd.fe_power_levels_tx_protect = undefined
                        $scope.selectedTsd.fe_power_levels_rx_protect = undefined
                    } else {
                        $scope.protection_mode_fetched = false
                    }

                    const pm = _.find($scope.protectionModeList, el => el.id === $scope.selectedTsd.protection_mode_id.id);

                    if (!pm) return;

                    $scope.hop_polarization_obj = _.find($scope.polarizationList, e => e.id === pm.Polarization?.value);
                    $scope.selectedTsd.polarization_id.id = $scope.hop_polarization_obj?.id;

                    $scope.protectionRauSubbandActive = !!pm.protectionRauSubbandActive?.value;
                    if (!$scope.protectionRauSubbandActive && $scope.ne_protection_rau_subband && $scope.fe_protection_rau_subband) {
                      $scope.selectedTsd.ne_rau_subband_protect_id = undefined;
                      $scope.selectedTsd.fe_rau_subband_protect_id = undefined;
                      $scope.selectedTsd.ne_txrx_frequencies_protect = undefined;
                      $scope.selectedTsd.fe_txrx_frequencies_protect = undefined;
                    }
                };

                $scope.changeParams = function () {
                    if($scope.selectedTsd && ($scope.selectedTsd.nearend_id.facility_id.latitude && $scope.selectedTsd.nearend_id.facility_id.longitude && $scope.selectedTsd.farend_id.facility_id.latitude && $scope.selectedTsd.farend_id.facility_id.longitude)) {
                        $scope.selectedTsd.path_distance = parseFloat((6372795 * Math.acos(Math.sin($scope.selectedTsd.nearend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.sin($scope.selectedTsd.farend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) + Math.cos($scope.selectedTsd.nearend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) *  Math.cos($scope.selectedTsd.farend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.cos(Math.abs($scope.selectedTsd.nearend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180) - $scope.selectedTsd.farend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180)))) / 1000).toFixed(3))
                        $scope.selectedTsd.ne_azimuth = parseFloat((180 * (Math.atan2(Math.sin($scope.selectedTsd.farend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180) - $scope.selectedTsd.nearend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180)) * Math.cos($scope.selectedTsd.farend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)), Math.cos($scope.selectedTsd.nearend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.sin($scope.selectedTsd.farend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) - Math.cos($scope.selectedTsd.farend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.sin($scope.selectedTsd.nearend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.cos(Math.abs($scope.selectedTsd.nearend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180) - $scope.selectedTsd.farend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180)))) % (2 * 3.14159265358979) / 3.14159265358979)).toFixed(2))
                        if($scope.selectedTsd.ne_azimuth < 0) {
                           $scope.selectedTsd.ne_azimuth = 360 - $scope.selectedTsd.ne_azimuth * -1
                        }
                        $scope.selectedTsd.ne_azimuth = parseFloat($scope.selectedTsd.ne_azimuth.toFixed(2))
                        $scope.selectedTsd.fe_azimuth = parseFloat((180 * (Math.atan2(Math.sin($scope.selectedTsd.nearend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180) - $scope.selectedTsd.farend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180)) * Math.cos($scope.selectedTsd.nearend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)), Math.cos($scope.selectedTsd.farend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.sin($scope.selectedTsd.nearend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) - Math.cos($scope.selectedTsd.nearend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.sin($scope.selectedTsd.farend_id.facility_id.latitude.replace(",", '.') * (3.14159265358979/180)) * Math.cos(Math.abs($scope.selectedTsd.nearend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180) - $scope.selectedTsd.farend_id.facility_id.longitude.replace(",", '.') * (3.14159265358979/180)))) % (2 * 3.14159265358979) / 3.14159265358979)).toFixed(2))
                        if($scope.selectedTsd.fe_azimuth < 0) {
                           $scope.selectedTsd.fe_azimuth = 360 - $scope.selectedTsd.fe_azimuth * -1
                        }
                        $scope.selectedTsd.fe_azimuth = parseFloat($scope.selectedTsd.fe_azimuth.toFixed(2))
                    }

                    if($scope.selectedTsd && ($scope.selectedTsd.nearend_id.facility_id.latitude)){
                        $scope.ne_latitude_dms = $scope.calculateDMS($scope.selectedTsd.nearend_id.facility_id.latitude);
                    }
                    if($scope.selectedTsd && ($scope.selectedTsd.nearend_id.facility_id.longitude)){
                        $scope.ne_longitude_dms = $scope.calculateDMS($scope.selectedTsd.nearend_id.facility_id.longitude);
                    }

                    if($scope.selectedTsd && ($scope.selectedTsd.farend_id.facility_id.latitude)){
                        $scope.fe_latitude_dms = $scope.calculateDMS($scope.selectedTsd.farend_id.facility_id.latitude);
                    }
                    if($scope.selectedTsd && ($scope.selectedTsd.farend_id.facility_id.longitude)){
                        $scope.fe_longitude_dms = $scope.calculateDMS($scope.selectedTsd.farend_id.facility_id.longitude);
                    }
                }

                $scope.selectedTsd = undefined;

                $scope.calculateDMS = function(degree) {
                    let deg = degree.replace(/,/g, '.')
                    var totalSeconds = deg * 3600;
                    var degrees = Math.floor(deg);
                    totalSeconds -= degrees * 3600;
                    var minutes = Math.floor(totalSeconds / 60);
                    totalSeconds -= (minutes * 60);
                    return degrees+"-"+minutes+"-"+totalSeconds.toFixed(2);
                }

                $scope.checkSite = async function(){
                    let arrPromise = []
                    arrPromise.push($http.get('/camunda/tsd_mw?nearend_id=' + $scope.site).then(r => r.data).catch(e => console.log('111', e)))
                    arrPromise.push($http.get('/camunda/tsd_mw?farend_id=' + $scope.site).then(r => r.data).catch(e => console.log('111', e)))
                    let array = []
                    await Promise.all(arrPromise).then((data) => {
                        let temp2 = data.filter(i => i !== undefined).map(x => x)
                        for(let i=0;i<temp2.length;i++){
                            for(let j=0;j<temp2[i].length;j++){
                                array.push(temp2[i][j])
                            }
                        }
                    })
                    $scope.$apply(function() {
                        $scope.result = array
                    })
                }

                $scope.addTsd = function(e){
                    $scope.result.forEach(item => {
                        if($scope.selectedTsd && item.id === $scope.selectedTsd.id) {
                            item.selected = false;
                        }
                    })
                    e.selected = true;
                    $scope.selectedTsd = e;
                    $scope.oldTsd = angular.copy($scope.selectedTsd)
                    $scope.hopLinkCapacitySelected();

                    if($scope.selectedTsd && ($scope.selectedTsd.nearend_id.facility_id.latitude)){
                        $scope.ne_latitude_dms = $scope.calculateDMS($scope.selectedTsd.nearend_id.facility_id.latitude);
                    }
                    if($scope.selectedTsd && ($scope.selectedTsd.nearend_id.facility_id.longitude)){
                        $scope.ne_longitude_dms = $scope.calculateDMS($scope.selectedTsd.nearend_id.facility_id.longitude);
                    }

                    if($scope.selectedTsd && ($scope.selectedTsd.farend_id.facility_id.latitude)){
                        $scope.fe_latitude_dms = $scope.calculateDMS($scope.selectedTsd.farend_id.facility_id.latitude);
                    }
                    if($scope.selectedTsd && ($scope.selectedTsd.farend_id.facility_id.longitude)){
                        $scope.fe_longitude_dms = $scope.calculateDMS($scope.selectedTsd.farend_id.facility_id.longitude);
                    }

                }
                $scope.removeTsd = function(id){
                    $scope.result.forEach(item => {
                        if(item.id === id) {
                             item.selected = false;
                        }
                    })
                    $scope.selectedTsd = undefined;
                }

                $scope.getSites = function(val) {
                    return $http.get('/camunda/sites/name/contains/'+val).then(
                        function(response){
                            response.data.forEach(function(e){
                                e.name = e.site_name;
                    });
                    return response.data;
                    });
                };
                $scope.siteSelected = function($item){
                    $scope.siteName = $item.name;
                    $scope.site = $item.id;
                    $scope.site_name = $item.site_name;
                    $http.get('/camunda/sites/id/'+$scope.site).then(
                        function(response){
                            if(response.data.facility_id && response.data.facility_id.address_id && response.data.facility_id.address_id.region_id){
                                $scope.region = response.data.facility_id.address_id.region_id.name;
                                $scope.regionId = response.data.facility_id.address_id.region_id.id;
                            }
                        }
                    );
                };

                camForm.on('store', function () {
                });

                camForm.on('variables-fetched', function () {
                    variables.forEach(function (el) {
                        if (camForm.variableManager.variables[el].type === 'Date') {
                            $scope[el] = new Date(camForm.variableManager.variables[el].value);
                        } else {
                            $scope[el] = camForm.variableManager.variables[el].value;
                        }
                    });
                    $scope.variablesFetched = true;
                    $scope.setValues();

                   $http.get('/camunda/api/engine/engine/default/user/' + $rootScope.authentication.name + '/profile').then(
                        function (result) {
                              $scope.initiatorFull = result.data;
                          $scope.initiatorEmail = result.data.email;
                        }, function (error) {
                   });
                   $scope.isRegion = true;
                   angular.forEach($rootScope.authUser.groups, function (group) {
                       if(group.id === 'hq_tn_engineer'){
                          $scope.isRegion = false;
                       }
                   });
                });

                $scope.populateSelectFromCatalog = function (containers, id) {
                    $http.get('/camunda/catalogs/api/get/id/' + id).then(function (result) {
                        if (result && result.data && result.data.data && result.data.data.$list) {
                            angular.forEach(containers, function (container) {
                                $scope[container] = [...result.data.data.$list];
                            });
                            angular.forEach(result.data.data.$list, function (item) {
                                if (!$scope.titles[containers[0]]) {
                                    $scope.titles[containers[0]] = {};
                                }
                                $scope.titles[containers[0]][item.id] = item.value;
                            });
                        }
                        if ($scope.protectionModeList && !$scope.protectionModeSetted) {
                            $scope.setValues()
                        }
                        if ($scope.trAntennasTypeList && !$scope.antenaSetted) {
                            $scope.setValues()
                        }

                        if ($scope.linkCapacityList && !$scope.linkCapacitySetted) {
                            $scope.setValues()
                        }
                    });
                };
                $scope.populateSelectFromCatalog(['protectionModeList'], 44); // Protection mode
                $scope.populateSelectFromCatalog(['trAntennasTypeList'], 20); // TR Antennas Type
                $scope.populateSelectFromCatalog(['constructionTypeList'], 14); // Construction_type
                $scope.populateSelectFromCatalog(['linkCapacityList', 'filteredLinkCapacityList'], 45);   // Link capacity
                $scope.populateSelectFromCatalog(['polarizationList'], 48);   // Polarization
                $scope.populateSelectFromCatalog(['rauSubbandList', 'filteredRauSubbandList'], 46);     // Rau subband
                $scope.populateSelectFromCatalog(['rauTypeList'], 84);       // RAU Type


                $scope.ne_power_level_txChanged = function () {
                    $scope.selectedTsd.fe_power_levels_tx = $scope.selectedTsd.ne_power_levels_tx;
                };
                $scope.ne_power_level_rxChanged = function () {
                    $scope.selectedTsd.fe_power_levels_rx = $scope.selectedTsd.ne_power_levels_rx;
                };
                $scope.ne_protection_power_level_txChanged = function () {
                    $scope.selectedTsd.fe_power_levels_tx_protect = $scope.selectedTsd.ne_power_levels_tx_protect;
                };
                $scope.ne_protection_power_level_rxChanged = function () {
                    $scope.selectedTsd.fe_power_levels_rx_protect = $scope.selectedTsd.ne_power_levels_rx_protect;
                };

                $scope.hopLinkCapacitySelected = function () {
                    var obj = _.filter($scope.linkCapacityList, function (c) {
                        return c.id === $scope.selectedTsd.capacity_id.id;
                    });
                    if ($scope.selectedTsd && $scope.selectedTsd.capacity_id && (obj && obj.length > 0)) {
                        $scope.selectedTsd.capacity_id.modulation = obj[0]['Modulation'].value;
                    }
                };

                $scope.rauSubbandFreqRange = function () {
                    let res = {};
                    $scope.rauSubbandList.forEach(obj => {
                              res[obj.id] = {
                                'related': obj.Pair ? obj.Pair.value : '',
                                'minFrequency': obj["MIN_freq, MHz"].value,
                                'maxFrequency': obj["MAX_freq, MHz"].value,
                              }
                            }
                    );
                    return res;
                }

                $scope.$watch('rauSubbandList', function(newValue, oldValue) {
                     $scope.rauRelations = $scope.rauSubbandFreqRange();
                });

                $scope.rauTypeSelected = function () {
                  var obj = _.filter($scope.linkCapacityList, function (c) {
                    return c.RAU_type?.value === $scope.selectedTsd.rau_type.id;
                  });
                  if (obj && obj.length > 0) {
                    $scope['hopChannelBandwidthList'] = [...new Set(obj.map(el => el['Channel Bandwidth'].value))];
                  }

                  $scope['filteredRauSubbandList'] = _.filter($scope.rauSubbandList, function (r) {
                    return r.RAU_type?.value === $scope.selectedTsd.rau_type.id;
                  }).map( obj => {
                    obj.pairValue = _.find($scope.rauSubbandList, r => r.id === obj.Pair?.value)?.value;
                    return obj;
                  });
                }

                $scope.hopChannelBandwidthSelected = function() {
                  var obj = _.filter($scope.linkCapacityList, function (c) {
                    return c.RAU_type?.value === $scope.selectedTsd.rau_type.id && c['Channel Bandwidth']?.value === $scope.selectedTsd.capacity_id['channel bandwidth'];
                  });
                  if (obj && obj.length > 0) {
                    $scope['filteredLinkCapacityList'] = [...obj];
                  }
                }

                $scope.rauSubbandSelected = function () {
                    if($scope.selectedTsd.ne_rau_subband_id.id && $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_id.id]){
                        $scope.selectedTsd.fe_rau_subband_id = {
                            id: $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_id.id].related
                        };
                    }
                };
                $scope.protectRauSubbandSelected = function () {
                    if($scope.selectedTsd.ne_rau_subband_protect_id && ($scope.selectedTsd.ne_rau_subband_protect_id.id && $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_protect_id.id])){
                        if($scope.selectedTsd.fe_rau_subband_protect_id == null){
                            $scope.selectedTsd.fe_rau_subband_protect_id = {}
                        }
                        $scope.selectedTsd.fe_rau_subband_protect_id.id = $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_protect_id.id].related;
                    }
                };

                $scope.ne_txrx_frequinciesValuesCheck = function () {
                    if ($scope.selectedTsd.ne_txrx_frequencies && !isNaN($scope.selectedTsd.ne_txrx_frequencies) && $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_id.id].minFrequency <= $scope.selectedTsd.ne_txrx_frequencies && $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_id.id].maxFrequency >= $scope.selectedTsd.ne_txrx_frequencies) {
                        $scope.ne_txrx_frequinciesInvalid = false;
                    } else {
                        $scope.ne_txrx_frequinciesInvalid = true;
                    }
                }

                $scope.fe_txrx_frequinciesValuesCheck = function () {
                    if ($scope.selectedTsd.fe_txrx_frequencies && !isNaN($scope.selectedTsd.fe_txrx_frequencies) && $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_id.id].minFrequency <= $scope.selectedTsd.fe_txrx_frequencies && $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_id.id].maxFrequency >= $scope.selectedTsd.fe_txrx_frequencies) {
                        $scope.fe_txrx_frequinciesInvalid = false;
                    } else {
                        $scope.fe_txrx_frequinciesInvalid = true;
                    }
                }

                $scope.ne_protection_txrx_frequinciesValuesCheck = function () {
                    if ($scope.selectedTsd.ne_txrx_frequencies_protect && !isNaN($scope.selectedTsd.ne_txrx_frequencies_protect) && $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_protect_id.id].minFrequency <= $scope.selectedTsd.ne_txrx_frequencies_protect && $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_protect_id.id].maxFrequency >= $scope.selectedTsd.ne_txrx_frequencies_protect) {
                        $scope.ne_protection_txrx_frequinciesInvalid = false;
                    } else {
                        $scope.ne_protection_txrx_frequinciesInvalid = true;
                    }
                }

                $scope.fe_protection_txrx_frequinciesValuesCheck = function () {
                    if ($scope.selectedTsd.fe_txrx_frequencies_protect && !isNaN($scope.selectedTsd.fe_txrx_frequencies_protect) && $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_protect_id.id].minFrequency <= $scope.selectedTsd.fe_txrx_frequencies_protect && $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_protect_id.id].maxFrequency >= $scope.selectedTsd.fe_txrx_frequencies_protect) {
                        $scope.fe_protection_txrx_frequinciesInvalid = false;
                    } else {
                        $scope.fe_protection_txrx_frequinciesInvalid = true;
                    }
                }

                $scope.preSubmit = function () {
                    var deferred = $q.defer();

                    if ($scope.selectedTsd.ne_rau_subband_id && ($scope.selectedTsd.ne_rau_subband_id.id && $scope.selectedTsd.ne_txrx_frequencies && (isNaN($scope.selectedTsd.ne_txrx_frequencies) || $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_id.id].minFrequency > $scope.selectedTsd.ne_txrx_frequencies || $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_id.id].maxFrequency < $scope.selectedTsd.ne_txrx_frequencies))) {
                        deferred.reject('Please correct Tx/Rx frequencies, Mhz for Near End');
                    } else if ($scope.selectedTsd.fe_rau_subband_id && ($scope.selectedTsd.fe_rau_subband_id.id && $scope.selectedTsd.fe_txrx_frequencies && (isNaN($scope.selectedTsd.fe_txrx_frequencies) || $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_id.id].minFrequency > $scope.selectedTsd.fe_txrx_frequencies || $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_id.id].maxFrequency < $scope.selectedTsd.fe_txrx_frequencies))) {
                        deferred.reject('Please correct Tx/Rx frequencies, Mhz for Far End');
                    } else if ($scope.selectedTsd.ne_rau_subband_protect_id && ($scope.selectedTsd.ne_rau_subband_protect_id.id && $scope.selectedTsd.ne_txrx_frequencies_protect && (isNaN($scope.selectedTsd.ne_txrx_frequencies_protect) || $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_protect_id.id].minFrequency > $scope.selectedTsd.ne_txrx_frequencies_protect || $scope.rauRelations[$scope.selectedTsd.ne_rau_subband_protect_id.id].maxFrequency < $scope.selectedTsd.ne_txrx_frequencies_protect))) {
                        deferred.reject('Please correct Protection Tx/Rx frequencies, Mhz, Mhz for Near End');
                    } else if ($scope.selectedTsd.fe_rau_subband_protect_id && ($scope.selectedTsd.fe_rau_subband_protect_id.id && $scope.selectedTsd.fe_txrx_frequencies_protect && (isNaN($scope.selectedTsd.fe_txrx_frequencies_protect) || $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_protect_id.id].minFrequency > $scope.selectedTsd.fe_txrx_frequencies_protect || $scope.rauRelations[$scope.selectedTsd.fe_rau_subband_protect_id.id].maxFrequency < $scope.selectedTsd.fe_txrx_frequencies_protect))) {
                        deferred.reject('Please correct Protection Tx/Rx frequencies, Mhz, Mhz for Far End');
                    } else {
                        deferred.resolve();
                    }
                    return deferred.promise;
                }

                camForm.on('submit', function (e) {
                    if($scope.selectedTsd.nearend_id.facility_id.altitude){
                        $scope.selectedTsd.nearend_id.facility_id.altitude = parseFloat($scope.selectedTsd.nearend_id.facility_id.altitude.toFixed(1)) * 1.0;
                    }
                    if($scope.selectedTsd.farend_id.facility_id.altitude){
                        $scope.selectedTsd.farend_id.facility_id.altitude = parseFloat($scope.selectedTsd.farend_id.facility_id.altitude.toFixed(1)) * 1.0;
                    }
                  camForm.variableManager.createVariable({
                    name: 'initiatorEmail',
                    type: 'String',
                    value: $scope.initiatorEmail
                  });
                    camForm.variableManager.createVariable({
                        name: 'isRegion',
                        type: 'Boolean',
                        value: $scope.isRegion
                    });
                    camForm.variableManager.createVariable({
                        name: 'oldTsd',
                        type: 'Json',
                        value: $scope.oldTsd
                    });
                    camForm.variableManager.createVariable({
                        name: 'selectedTsd',
                        type: 'Json',
                        value: $scope.selectedTsd
                    });
                    var region = $scope.catalogToRegion[$scope.regionId];
                    camForm.variableManager.createVariable({
                        name: 'region',
                        type: 'Integer',
                        value: $scope.regionId
                    });
                    camForm.variableManager.createVariable({
                        name: 'regionName',
                        type: 'String',
                        value: region
                    });
                    camForm.variableManager.createVariable({
                        name: 'site_name',
                        type: 'String',
                        value: $scope.selectedTsd.nearend_id.site_name
                    });
                    var requestedDate = new Date();
                    camForm.variableManager.createVariable({
          				name: 'requestedDate',
          				type: 'Date',
         				value: requestedDate,
         				store: true
                    });

                    $scope.resolutions = [];
                    $scope.resolutions.push({processInstanceId: 'noProcessInstanceId', assignee: $rootScope.authentication.name, assigneeName: $rootScope.authentication.assigneeName, resolution: 'created', comment: $scope.startComment, taskId: 'noTaskId', taskName:'Change TSD Start', taskEndDate: requestedDate,  visibility: 'all'});
                    camForm.variableManager.createVariable({
          				name: 'resolutions',
          				type: 'Json',
         				value: $scope.resolutions,
         				store: true
                    });
                });
                $scope.disableButton = function(val) {
                    if(val && val.name === 'Dismantled'){
                        return true;
                    } else {
                        return false;
                    }
                }

                $scope.calculatePower = function(dbm) {
                    if(dbm !== undefined && dbm !== null && dbm !== ''){
                        var power = (dbm - 30) / 10;
                        return Number(Math.pow(10, power).toFixed(4)).toString();
                    }
                }

                $scope.filterRauTypeList = function (rt) {
                  if (!$scope.protectionModeList || !$scope.selectedTsd?.protection_mode_id?.id) return true;

                  const pm = _.find($scope.protectionModeList, el => el.id === $scope.selectedTsd.protection_mode_id.id);

                  if (pm) {
                    return pm.RAU_type?.value?.includes(rt.id);
                  } else {
                    return true;
                  }
                }
            }]);
  </script>
  <iframe id="fileDownloadIframe" style="display: none"></iframe>

  <div class="form-group">
    <div class="col-sm-6">
      <h4>Change Transmission Survey Data</h4>
    </div>
  </div>
  <div class="well">
    <div class="form-group">
      <div class="col-sm-4">
        <div class="input-group">
          <input
            type="text"
            ng-model="site_name"
            name="site_name"
            typeahead="site as sites.site_name for sites in getSites($viewValue)"
            typeahead-on-select="siteSelected($item,$model,$label)"
            class="form-control"
            required
            autocomplete="off"
            placeholder="Site Name"
          />
          <input type="hidden" ng-model="site" name="siteId" required />
          <span class="input-group-btn" ng-if="siteName">
            <button
              type="button"
              class="btn btn-default"
              ng-click="checkSite()"
            >
              Check
            </button>
          </span>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-8">
        <table
          class="table table-striped table-bordered"
          ng-if="result.length > 0"
        >
          <tr>
            <th>Region</th>
            <th>Near End Site</th>
            <th>Far End Site</th>
            <th>Business key</th>
            <th>NE Tx/Rx Freq</th>
            <th>FE Tx/Rx Freq</th>
            <th>RFS Status</th>
            <th>TSD Version</th>
            <th>TSD status</th>
            <th>Add to list</th>
          </tr>
          <tr ng-repeat="c in result">
            <td>
              {{c.nearend_id.facility_id.address_id.city_id.district_id.oblast_id.region_id.name}}
            </td>
            <td>{{c.nearend_id.site_name}}</td>
            <td>{{c.farend_id.site_name}}</td>
            <td>{{c.business_key}}</td>
            <td>{{c.ne_txrx_frequencies}}</td>
            <td>{{c.fe_txrx_frequencies}}</td>
            <td>{{c.rfs_status_id ? c.rfs_status_id.name : ''}}</td>
            <td>{{c.version}}</td>
            <td>{{c.tsd_status_id ? c.tsd_status_id.name : ''}}</td>
            <td>
              <button
                style="border: none; outline: none; background: inherit"
                ng-style="{'text-decoration' : disableButton(c.tsd_status_id) ? 'line-through' : ''}"
                ng-click="addTsd(c)"
                ng-if="!c.selected"
                ng-disabled="disableButton(c.tsd_status_id)"
              >
                add
              </button>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="row">
      <div class="col-md-8">
        <table class="table table-striped table-bordered" ng-show="selectedTsd">
          <tr>
            <th>Region</th>
            <th>Near End Site</th>
            <th>Far End Site</th>
            <th>Business key</th>
            <th>NE Tx/Rx Freq</th>
            <th>FE Tx/Rx Freq</th>
            <th>RFS Status</th>
            <th>TSD Version</th>
            <th>TSD status</th>
            <th>Remove from list</th>
          </tr>
          <tr>
            <td>
              {{selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.oblast_id.region_id.name}}
            </td>
            <td>{{selectedTsd.nearend_id.site_name}}</td>
            <td>{{selectedTsd.farend_id.site_name}}</td>
            <td>{{selectedTsd.business_key}}</td>
            <td>{{selectedTsd.ne_txrx_frequencies}}</td>
            <td>{{selectedTsd.fe_txrx_frequencies}}</td>
            <td>
              {{selectedTsd.rfs_status_id ? selectedTsd.rfs_status_id.name :
              ''}}
            </td>
            <td>{{selectedTsd.version}}</td>
            <td>
              {{selectedTsd.tsd_status_id ? selectedTsd.tsd_status_id.name :
              ''}}
            </td>
            <td>
              <i
                class="glyphicon glyphicon-trash"
                ng-click="removeTsd(selectedTsd.id)"
              ></i>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label"><b>TSD number:</b></label>
    <label class="col-sm-6 control-label">{{selectedTsd.business_key}}</label>
    <label class="col-sm-2 control-label"><b>Version:</b></label>
    <label class="col-sm-2 control-label">{{selectedTsd.version}}</label>
  </div>

  <div class="form-group">
    <label class="col-sm-2 control-label"><b>Region name:</b></label>
    <label class="col-sm-6 control-label"
      >{{selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.oblast_id.region_id.name}}</label
    >
    <label class="col-sm-2 control-label"><b>Date:</b></label>
    <div class="col-sm-2">
      <div class="input-group">
        <input
          type="text"
          ng-model="date_of_visit"
          ng-value="selectedTsd.date | date: 'dd.MM.yyyy'"
          name="dateOfVisit"
          class="form-control"
          datepicker-popup="dd.MM.yyyy"
          id="dateOfVisit"
          disabled
        />
      </div>
      <label
        class="error"
        ng-if="kcell_form.dateOfVisit.$error.required && ( kcell_form.dateOfVisit.$touched || view.submitted)"
        >Required field</label
      >
    </div>
  </div>

  <div class="form-group">
    <label class="col-sm-2 control-label">Sitename:</label>
    <label class="col-sm-3 control-label"
      >{{selectedTsd.nearend_id.site_name}}</label
    >
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">Site Address:</label>
    <div class="col-sm-10">
      <div
        class="form-control"
        style="background-color: #eee; width: 100%; height: 54px"
      >
        {{
        (selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.oblast_id.region_id.name
        ?
        selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.oblast_id.region_id.name:
        '') +
        (selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.oblast_id.name
        ? ', ' +
        selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.oblast_id.name
        : '') +
        (selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.name
        ? ', ' +
        selectedTsd.nearend_id.facility_id.address_id.city_id.district_id.name :
        '') + (selectedTsd.nearend_id.facility_id.address_id.city_id.name ? ', '
        + selectedTsd.nearend_id.facility_id.address_id.city_id.name : '') +
        (selectedTsd.nearend_id.facility_id.address_id.city_id.city_type_id.name
        ? ' (' +
        selectedTsd.nearend_id.facility_id.address_id.city_id.city_type_id.name
        + ')' : '') + (selectedTsd.nearend_id.facility_id.address_id.street ? ',
        ' + selectedTsd.nearend_id.facility_id.address_id.street : '') +
        (selectedTsd.nearend_id.facility_id.address_id.building ? ', ' +
        selectedTsd.nearend_id.facility_id.address_id.building : '')+
        (selectedTsd.nearend_id.facility_id.address_id.note ? ', ' +
        selectedTsd.nearend_id.facility_id.address_id.note : '')+
        (selectedTsd.nearend_id.facility_id.address_id.cadastral_number ? ', ' +
        selectedTsd.nearend_id.facility_id.address_id.cadastral_number : '') }}
      </div>
    </div>
  </div>

  <div class="form-group">
    <label class="col-sm-2 control-label">Farend name:</label>
    <label class="col-sm-3 control-label"
      >{{selectedTsd.farend_id.site_name}}</label
    >
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">Farend Address:</label>
    <div class="col-sm-10">
      <div
        class="form-control"
        style="background-color: #eee; width: 100%; height: 54px"
      >
        {{
        (selectedTsd.farend_id.facility_id.address_id.city_id.district_id.oblast_id.region_id.name
        ?
        selectedTsd.farend_id.facility_id.address_id.city_id.district_id.oblast_id.region_id.name
        : '') +
        (selectedTsd.farend_id.facility_id.address_id.city_id.district_id.oblast_id.name
        ? ', ' +
        selectedTsd.farend_id.facility_id.address_id.city_id.district_id.oblast_id.name
        : '') +
        (selectedTsd.farend_id.facility_id.address_id.city_id.district_id.name ?
        ', ' +
        selectedTsd.farend_id.facility_id.address_id.city_id.district_id.name :
        '') + (selectedTsd.farend_id.facility_id.address_id.city_id.name ? ', '
        + selectedTsd.farend_id.facility_id.address_id.city_id.name : '') +
        (selectedTsd.farend_id.facility_id.address_id.city_id.city_type_id.name
        ? ' (' +
        selectedTsd.farend_id.facility_id.address_id.city_id.city_type_id.name +
        ')' : '') + (selectedTsd.farend_id.facility_id.address_id.street ? ', '
        + selectedTsd.farend_id.facility_id.address_id.street : '') +
        (selectedTsd.farend_id.facility_id.address_id.building ? ', ' +
        selectedTsd.farend_id.facility_id.address_id.building : '') +
        (selectedTsd.farend_id.facility_id.address_id.note ? ', ' +
        selectedTsd.farend_id.facility_id.address_id.note : '') +
        (selectedTsd.farend_id.facility_id.address_id.cadastral_number ? ', ' +
        selectedTsd.farend_id.facility_id.address_id.cadastral_number : '') }}
      </div>
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-12">
      <table class="table table-bordered">
        <thead>
          <tr align="center">
            <td colspan="2">Position</td>
            <td colspan="4">Near End</td>
            <td colspan="4">Far End</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="right" colspan="2">Basic information</td>
            <td align="center" colspan="4">
              {{selectedTsd.nearend_id.site_name}}
            </td>
            <td align="center" colspan="4">
              {{selectedTsd.farend_id.site_name}}
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Coordinates (degree):</td>
            <td>N</td>
            <td align="center">
              <input
                type="text"
                class="form-control"
                ng-model="selectedTsd.nearend_id.facility_id.latitude"
                name="ne_latitude"
                required
                ng-pattern="latitudePattern"
                ng-change="changeParams()"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_latitude.$error.required && ( kcell_form.ne_latitude.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_latitude.$error.pattern && ( kcell_form.ne_latitude.$touched || view.submitted)"
                >Expected: 40.568000 <- Latitude <- 55.440000</label
              >
            </td>
            <td>E</td>
            <td align="center">
              <input
                type="text"
                class="form-control"
                ng-model="selectedTsd.nearend_id.facility_id.longitude"
                name="ne_longitude"
                required
                ng-pattern="longitudePattern"
                ng-change="changeParams()"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_longitude.$error.required && ( kcell_form.ne_longitude.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_longitude.$error.pattern && ( kcell_form.ne_longitude.$touched || view.submitted)"
                >Expected: 46.493000 <- Longtitude <- 87.315000</label
              >
            </td>
            <td>N</td>
            <td align="center">
              <input
                type="text"
                class="form-control"
                ng-model="selectedTsd.farend_id.facility_id.latitude"
                name="fe_latitude"
                required
                ng-pattern="latitudePattern"
                ng-change="changeParams()"
              />
              <label
                class="error"
                ng-if="kcell_form.fe_latitude.$error.required && ( kcell_form.fe_latitude.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_latitude.$error.pattern && ( kcell_form.fe_latitude.$touched || view.submitted)"
                >Expected: 40.568000 <- Latitude <- 55.440000</label
              >
            </td>
            <td>E</td>
            <td align="center">
              <input
                type="text"
                class="form-control"
                ng-model="selectedTsd.farend_id.facility_id.longitude"
                name="fe_longitude"
                required
                ng-pattern="longitudePattern"
                ng-change="changeParams()"
              />
              <label
                class="error"
                ng-if="kcell_form.fe_longitude.$error.required && ( kcell_form.fe_longitude.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_longitude.$error.pattern && ( kcell_form.fe_longitude.$touched || view.submitted)"
                >Expected: 46.493000 <- Longtitude <- 87.315000</label
              >
            </td>
          </tr>
          <!--                <tr>-->
          <!--                    <td align="right" colspan="2">Coordinates (Deg Min Sec):</td>-->
          <!--                    <td>N</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <input type="text" class="form-control" ng-model="ne_latitude_dms" readonly /> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>E</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <input type="text" class="form-control" ng-model="ne_longitude_dms" readonly /> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>N</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <input type="text" class="form-control" ng-model="fe_latitude_dms" readonly /> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>E</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <input type="text" class="form-control" ng-model="fe_longitude_dms" readonly /> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                </tr>-->
          <tr>
            <td align="right" colspan="2">Altitude (m):</td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.nearend_id.facility_id.altitude"
                name="ne_altitude"
                ng-pattern="altitudePattern"
                required
              />
              <label
                class="error"
                ng-if="kcell_form.ne_altitude.$error.required && ( kcell_form.ne_altitude.$touched || view.submitted)"
                >Required field(-xxx.y to +xxxx.y)</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_altitude.$error.pattern && ( kcell_form.ne_altitude.$touched || view.submitted)"
                >Uncorrect format(-xxx.y to +xxxx.y)</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_altitude.$error.number && ( kcell_form.ne_altitude.$touched || view.submitted)"
                >Uncorrect format(-xxx.y to +xxxx.y)</label
              >
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.farend_id.facility_id.altitude"
                name="fe_altitude"
                ng-pattern="altitudePattern"
                required
              />
              <label
                class="error"
                ng-if="kcell_form.fe_altitude.$error.required && ( kcell_form.fe_altitude.$touched || view.submitted)"
                >Required field(-xxx.y to +xxxx.y)</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_altitude.$error.pattern && ( kcell_form.fe_altitude.$touched || view.submitted)"
                >Uncorrect format(-xxx.y to +xxxx.y)</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_altitude.$error.number && ( kcell_form.fe_altitude.$touched || view.submitted)"
                >Uncorrect format(-xxx.y to +xxxx.y)</label
              >
            </td>
          </tr>

          <tr>
            <td align="right" colspan="2">Azimuth (degree):</td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.ne_azimuth"
                name="ne_azimuth"
                ng-pattern="azimuthPattern"
                required
              />
              <label
                class="error"
                ng-if="kcell_form.ne_azimuth.$error.required && ( kcell_form.ne_azimuth.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_azimuth.$error.pattern && ( kcell_form.ne_azimuth.$touched || view.submitted)"
                >Expected: 0 <- Azimuth(XXX.YY) <- 360</label
              >
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.fe_azimuth"
                name="fe_azimuth"
                ng-pattern="azimuthPattern"
                required
              />
              <label
                class="error"
                ng-if="kcell_form.fe_azimuth.$error.required && ( kcell_form.fe_azimuth.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_azimuth.$error.pattern && ( kcell_form.fe_azimuth.$touched || view.submitted)"
                >Expected: 0 <- Azimuth(XXX.YY) <- 360</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Path distance (km):</td>
            <td align="center" colspan="8">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.path_distance"
                name="path_distance"
                required
              />
              <label
                class="error"
                ng-if="kcell_form.path_distance.$error.required && ( kcell_form.path_distance.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>

          <tr>
            <td align="right" colspan="2">Type of construction:</td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="ne_construction_type"
                name="ne_construction_type"
                ng-model="selectedTsd.nearend_id.facility_id.construction_type_id.id"
              >
                <option
                  ng-repeat="ct in constructionTypeList"
                  ng-selected="ct.id.toString() === ne_construction_type"
                  ng-value="ct.id"
                >
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.ne_construction_type.$error.required && ( kcell_form.ne_construction_type.$touched || view.submitted)"
                >Required field</label
              >
            </td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="fe_construction_type"
                name="fe_construction_type"
                ng-model="selectedTsd.farend_id.facility_id.construction_type_id.id"
              >
                <option
                  ng-repeat="ct in constructionTypeList"
                  ng-selected="ct.id.toString() === fe_construction_type"
                  ng-value="ct.id"
                >
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.fe_construction_type.$error.required && ( kcell_form.fe_construction_type.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Height of construction (m):</td>
            <td align="center" colspan="4">
              <input
                type="text"
                class="form-control"
                ng-model="selectedTsd.nearend_id.facility_id.construction_height"
                name="ne_construction_height"
                required
                ng-pattern="heightPattern"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_construction_height.$error.required && ( kcell_form.ne_construction_height.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_construction_height.$error.pattern && ( kcell_form.ne_construction_height.$touched || view.submitted)"
                >Uncorrect format</label
              >
            </td>
            <td align="center" colspan="4">
              <input
                type="text"
                class="form-control"
                ng-model="selectedTsd.farend_id.facility_id.construction_height"
                name="fe_construction_height"
                required
                ng-pattern="heightPattern"
              />
              <label
                class="error"
                ng-if="kcell_form.fe_construction_height.$error.required && ( kcell_form.fe_construction_height.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_construction_height.$error.pattern && ( kcell_form.fe_construction_height.$touched || view.submitted)"
                >Uncorrect format</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Mode:</td>
            <td align="center" colspan="8">
              <select
                class="form-control"
                id="protection_mode"
                name="protection_mode"
                ng-model="selectedTsd.protection_mode_id.id"
                required
                ng-click="onProtectionModeClick()"
                ng-change="protectionMode()"
              >
                <option
                  ng-repeat="ct in protectionModeList"
                  ng-selected="ct.id.toString() === protection_mode"
                  value="{{ct.id}}"
                  ng-value="ct.id"
                >
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.protection_mode.$error.required && ( kcell_form.protection_mode.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Antenna diameter:</td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="ne_diameter"
                name="ne_diameter"
                ng-model="selectedTsd.ne_antenna_diameter_id.id"
                required
                ng-change="antennaDiameter()"
              >
                <option
                  ng-repeat="ct in trAntennasTypeList"
                  ng-selected="ct.id.toString() === ne_diameter"
                  ng-value="ct.id"
                >
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.ne_diameter.$error.required && ( kcell_form.ne_diameter.$touched || view.submitted)"
                >Required field</label
              >
            </td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="fe_diameter"
                name="fe_diameter"
                ng-model="selectedTsd.fe_antenna_diameter_id.id"
                required
              >
                <option
                  ng-repeat="ct in trAntennasTypeList"
                  ng-selected="ct.id.toString() === fe_diameter"
                  ng-value="ct.id"
                >
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.fe_diameter.$error.required && ( kcell_form.fe_diameter.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Protection antenna diameter:</td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="ne_protection_antenna_diameter"
                name="ne_protection_antenna_diameter"
                ng-model="selectedTsd.ne_antenna_diameter_protect_id.id"
                ng-change="protectionAntennaDiameter()"
                ng-disabled="protection_mode_fetched"
              >
                <option ng-repeat="ct in trAntennasTypeList" ng-value="ct.id">
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.ne_protection_antenna_diameter.$error.required && ( kcell_form.ne_protection_antenna_diameter.$touched || view.submitted)"
                >Required field</label
              >
            </td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="fe_protection_antenna_diameter"
                name="fe_protection_antenna_diameter"
                ng-model="selectedTsd.fe_antenna_diameter_protect_id.id"
                ng-disabled="protection_mode_fetched"
              >
                <option ng-repeat="ct in trAntennasTypeList" ng-value="ct.id">
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.fe_protection_antenna_diameter.$error.required && ( kcell_form.fe_protection_antenna_diameter.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">
              Height of suspension of MW ant (m):
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.ne_height_susp_antenna"
                name="ne_suspension_height_antennas"
                ng-pattern="suspensionPattern"
                required
                cam-variable-type="Integer"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_suspension_height_antennas.$error.required && ( kcell_form.ne_suspension_height_antennas.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_suspension_height_antennas.$error.pattern && ( kcell_form.ne_suspension_height_antennas.$touched || view.submitted)"
                >Expected: 1 <- Height of suspension of MW ant <- 999</label
              >
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.fe_height_susp_antenna"
                name="fe_suspension_height"
                ng-pattern="suspensionPattern"
                required
                cam-variable-type="Integer"
              />
              <label
                class="error"
                ng-if="kcell_form.fe_suspension_height.$error.required && ( kcell_form.fe_suspension_height.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_suspension_height.$error.pattern && ( kcell_form.fe_suspension_height.$touched || view.submitted)"
                >Expected: 1 <- Height of suspension of MW ant <- 999</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">
              Height of suspension of prot. MW ant (m).:
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.ne_height_susp_antenna_protect"
                name="ne_protection_suspension_height"
                ng-pattern="suspensionPattern"
                cam-variable-type="Integer"
                ng-disabled="protection_mode_fetched"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_protection_suspension_height.$error.required && ( kcell_form.ne_protection_suspension_height.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_protection_suspension_height.$error.pattern && ( kcell_form.ne_protection_suspension_height.$touched || view.submitted)"
                >Expected: 1 <- Height of suspension of prot. MW ant. <-
                999</label
              >
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                ng-model="selectedTsd.fe_height_susp_antenna_protect"
                name="fe_protection_suspension_height"
                ng-pattern="suspensionPattern"
                cam-variable-type="Integer"
                ng-disabled="protection_mode_fetched"
              />
              <label
                class="error"
                ng-if="kcell_form.fe_protection_suspension_height.$error.required && ( kcell_form.fe_protection_suspension_height.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_protection_suspension_height.$error.pattern && ( kcell_form.fe_protection_suspension_height.$touched || view.submitted)"
                >Expected: 1 <- Height of suspension of prot. MW ant. <-
                999</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Polarization:</td>
            <td align="center" colspan="8">
              <select class="form-control" id="hop_polarization" name="hop_polarization"
                      ng-model="selectedTsd.polarization_id.id" ng-disabled="true">
                <option ng-repeat="ct in polarizationList" ng-value="ct.id">{{ct.value}}</option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.hop_polarization.$error.required && ( kcell_form.hop_polarization.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">RAU type</td>
            <td align="center" colspan="8">
              <select class="form-control" id="rau_type" name="rau_type" ng-model="selectedTsd.rau_type.id" required ng-change="rauTypeSelected()">
                <option ng-repeat="rt in rauTypeList|filter:filterRauTypeList" ng-value="rt.id">{{rt.value}}</option>
              </select>
              <label class="error" ng-if="kcell_form.rau_type.$error.required && ( kcell_form.rau_type.$touched || view.submitted)">Required field</label>
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Channel bandwidth:</td>
            <td align="center" colspan="8">
              <select ng-if="hopChannelBandwidthList" ng-disabled="!selectedTsd.rau_type.id" class="form-control" name="hop_channel_bandwidth" ng-model="selectedTsd.capacity_id['channel bandwidth']" ng-change="hopChannelBandwidthSelected()" required>
                <option ng-repeat="cb in hopChannelBandwidthList" ng-value="cb">{{cb}}</option>
              </select>
              <span ng-if="!hopChannelBandwidthList">{{selectedTsd.capacity_id['channel bandwidth']}}</span>
              <label
                      class="error"
                      ng-if="kcell_form.hop_channel_bandwidth.$error.required && ( kcell_form.hop_channel_bandwidth.$touched || view.submitted)"
              >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Capacity</td>
            <td align="center" colspan="8">
              <select
                class="form-control"
                id="hop_link_capacity"
                name="hop_link_capacity"
                ng-model="selectedTsd.capacity_id.id"
                required
                ng-disabled="!selectedTsd.rau_type.id"
                ng-change="hopLinkCapacitySelected()"
              >
                <option ng-repeat="ct in filteredLinkCapacityList" ng-value="ct.id">
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.hop_link_capacity.$error.required && ( kcell_form.hop_link_capacity.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Modulation type:</td>
            <td align="center" colspan="8">
              <input
                type="text"
                class="form-control"
                name="hop_modulation_type"
                disabled
                ng-model="selectedTsd.capacity_id.modulation"
                required
              />
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">RAU subband:</td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="ne_rau_subband"
                name="ne_rau_subband"
                required
                ng-model="selectedTsd.ne_rau_subband_id.id"
                ng-disabled="!selectedTsd.rau_type.id"
                ng-change="rauSubbandSelected()"
              >
                <option ng-repeat="ct in filteredRauSubbandList" ng-value="ct.id">
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.selectedTsd.ne_rau_subband.$error.required && ( kcell_form.ne_rau_subband.$touched || view.submitted)"
                >Required field</label
              >
            </td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="fe_rau_subband"
                required
                name="fe_rau_subband"
                disabled
                ng-model="selectedTsd.fe_rau_subband_id.id"
              >
                <option ng-repeat="ct in rauSubbandList" ng-value="ct.id">
                  {{ct.value}}
                </option>
              </select>
              <label
                class="error"
                ng-if="kcell_form.fe_rau_subband.$error.required && ( kcell_form.fe_rau_subband.$touched || view.submitted)"
                >Required field</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">protection RAU subband:</td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="ne_protection_rau_subband"
                name="ne_protection_rau_subband"
                ng-model="selectedTsd.ne_rau_subband_protect_id.id"
                ng-disabled="!protectionRauSubbandActive"
                ng-change="protectRauSubbandSelected()"
              >
                <option ng-repeat="ct in filteredRauSubbandList" ng-value="ct.id">
                  {{ct.value}}
                </option>
              </select>
            </td>
            <td align="center" colspan="4">
              <select
                class="form-control"
                id="fe_protection_rau_subband"
                name="fe_protection_rau_subband"
                disabled
                ng-model="selectedTsd.fe_rau_subband_protect_id.id"
              >
                <option ng-repeat="ct in rauSubbandList" ng-value="ct.id">
                  {{ct.value}}
                </option>
              </select>
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Tx/Rx frequencies, Mhz:</td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                name="ne_txrx_frequincies"
                ng-model="selectedTsd.ne_txrx_frequencies"
                required
                ng-blur="ne_txrx_frequinciesValuesCheck()"
                ng-disabled="!selectedTsd.ne_rau_subband_id"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_txrx_frequincies.$error.required && ( kcell_form.ne_txrx_frequincies.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="selectedTsd.ne_rau_subband_id.id && ne_txrx_frequinciesInvalid"
                >Expected between
                {{rauRelations[selectedTsd.ne_rau_subband_id.id].minFrequency}}
                and
                {{rauRelations[selectedTsd.ne_rau_subband_id.id].maxFrequency}}</label
              >
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                name="fe_txrx_frequincies"
                ng-model="selectedTsd.fe_txrx_frequencies"
                required
                ng-blur="fe_txrx_frequinciesValuesCheck()"
                ng-disabled="!selectedTsd.fe_rau_subband_id"
              />
              <label
                class="error"
                ng-if="kcell_form.fe_txrx_frequincies.$error.required && ( kcell_form.fe_txrx_frequincies.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="selectedTsd.fe_rau_subband_id.id && fe_txrx_frequinciesInvalid"
                >Expected between
                {{rauRelations[selectedTsd.fe_rau_subband_id.id].minFrequency}}
                and
                {{rauRelations[selectedTsd.fe_rau_subband_id.id].maxFrequency}}</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">
              Protection Tx/Rx frequencies, Mhz:
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                name="ne_protection_txrx_frequincies"
                ng-model="selectedTsd.ne_txrx_frequencies_protect"
                ng-blur="ne_protection_txrx_frequinciesValuesCheck()"
                ng-disabled="protection_mode_fetched || !selectedTsd.ne_rau_subband_protect_id"
              />
              <label
                class="error"
                ng-if="selectedTsd.ne_rau_subband_protect_id.id && selectedTsd.ne_txrx_frequencies_protect && ne_protection_txrx_frequinciesInvalid"
                >Expected between
                {{rauRelations[selectedTsd.ne_rau_subband_protect_id.id].minFrequency}}
                and
                {{rauRelations[selectedTsd.ne_rau_subband_protect_id.id].maxFrequency}}</label
              >
            </td>
            <td align="center" colspan="4">
              <input
                type="number"
                class="form-control"
                name="fe_protection_txrx_frequincies"
                ng-model="selectedTsd.fe_txrx_frequencies_protect"
                ng-blur="fe_protection_txrx_frequinciesValuesCheck()"
                ng-disabled="!protectionRauSubbandActive"
              />
              <label
                class="error"
                ng-if="selectedTsd.fe_rau_subband_protect_id.id && selectedTsd.fe_txrx_frequencies_protect && fe_protection_txrx_frequinciesInvalid"
                >Expected between
                {{rauRelations[selectedTsd.fe_rau_subband_protect_id.id].minFrequency}}
                and
                {{rauRelations[selectedTsd.fe_rau_subband_protect_id.id].maxFrequency}}</label
              >
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Terminal ID:</td>
            <td align="center" colspan="4">
              <input
                type="text"
                class="form-control"
                name="ne_terminal_id"
                ng-model="selectedTsd.ne_terminalid"
              />
            </td>
            <td align="center" colspan="4">
              <input
                type="text"
                class="form-control"
                name="fe_terminal_id"
                ng-model="selectedTsd.fe_terminalid"
              />
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">Power levels:</td>
            <td>Tx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="ne_power_level_tx"
                ng-model="selectedTsd.ne_power_levels_tx"
                required
                ng-pattern="ne_power_level_txPattern"
                ng-change="ne_power_level_txChanged()"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_power_level_tx.$error.required && ( kcell_form.ne_power_level_tx.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_power_level_tx.$error.pattern && ( kcell_form.ne_power_level_tx.$touched || view.submitted)"
                >Invalid format (XX or -XX required)</label
              >
            </td>
            <td>Rx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="ne_power_level_rx"
                ng-model="selectedTsd.ne_power_levels_rx"
                required
                ng-pattern="ne_power_level_rxPattern"
                ng-change="ne_power_level_rxChanged()"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_power_level_rx.$error.required && ( kcell_form.ne_power_level_rx.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.ne_power_level_rx.$error.pattern && ( kcell_form.ne_power_level_rx.$touched || view.submitted)"
                >Invalid format (format -XX required)</label
              >
            </td>
            <td>Tx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="fe_power_level_tx"
                ng-model="selectedTsd.fe_power_levels_tx"
                required
              />
              <label
                class="error"
                ng-if="kcell_form.fe_power_level_tx.$error.required && ( kcell_form.fe_power_level_tx.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_power_level_tx.$error.pattern && ( kcell_form.fe_power_level_tx.$touched || view.submitted)"
                >Invalid format (XX or -XX required)</label
              >
            </td>
            <td>Rx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="fe_power_level_rx"
                ng-model="selectedTsd.fe_power_levels_rx"
                required
              />
              <label
                class="error"
                ng-if="kcell_form.fe_power_level_rx.$error.required && ( kcell_form.fe_power_level_rx.$touched || view.submitted)"
                >Required field</label
              >
              <label
                class="error"
                ng-if="kcell_form.fe_power_level_rx.$error.pattern && ( kcell_form.fe_power_level_rx.$touched || view.submitted)"
                >Invalid format (format -XX required)</label
              >
            </td>
          </tr>
          <!--                <tr>-->
          <!--                    <td align="right" colspan="2">Power levels (W):</td>-->
          <!--                    <td>Tx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.ne_power_levels_tx)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>Rx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.ne_power_levels_rx)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>Tx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.fe_power_levels_tx)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>Rx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.fe_power_levels_rx)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                </tr>-->
          <tr>
            <td align="right" colspan="2">Protection line power levels:</td>
            <td>Tx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="ne_protection_power_level_tx"
                ng-model="selectedTsd.ne_power_levels_tx_protect"
                ng-pattern="ne_power_level_txPattern"
                ng-change="ne_protection_power_level_txChanged()"
                ng-disabled="protection_mode_fetched"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_protection_power_level_tx.$error.pattern && ( kcell_form.ne_protection_power_level_tx.$touched || view.submitted)"
                >Invalid format (XX or -XX required)</label
              >
            </td>
            <td>Rx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="ne_protection_power_level_rx"
                ng-model="selectedTsd.ne_power_levels_rx_protect"
                ng-pattern="ne_power_level_rxPattern"
                ng-change="ne_protection_power_level_rxChanged()"
                ng-disabled="protection_mode_fetched"
              />
              <label
                class="error"
                ng-if="kcell_form.ne_protection_power_level_rx.$error.pattern && ( kcell_form.ne_protection_power_level_rx.$touched || view.submitted)"
                >Invalid format (format -XX required)</label
              >
            </td>
            <td>Tx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="fe_protection_power_level_tx"
                ng-pattern="fe_power_level_txPattern"
                ng-change="ne_protection_power_level_txChanged()"
                ng-model="selectedTsd.fe_power_levels_tx_protect"
                ng-disabled="protection_mode_fetched"
              />
            </td>
            <td>Rx</td>
            <td align="center">
              <input
                type="number"
                class="form-control"
                name="fe_protection_power_level_rx"
                ng-pattern="fe_power_level_rxPattern"
                ng-change="ne_protection_power_level_rxChanged()"
                ng-model="selectedTsd.fe_power_levels_rx_protect"
                ng-disabled="protection_mode_fetched"
              />
            </td>
          </tr>
          <tr>
            <td align="right" colspan="2">nxE1</td>
            <td align="center" colspan="8">
              <input
                      type="text"
                      class="form-control"
                      name="hop_link_nxe1"
                      ng-model="selectedTsd.nxe1"
                      ng-pattern="linkNxePattern"
              />
              <label
                      class="error"
                      ng-if="kcell_form.hop_link_nxe1.$error.pattern && ( kcell_form.hop_link_nxe1.$touched || view.submitted)"
              >Expected: 0 <- nxE1 <- 155</label
              >
            </td>
          </tr>
          <!--                <tr>-->
          <!--                    <td align="right" colspan="2">Protection line power levels (W):</td>-->
          <!--                    <td>Tx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.ne_power_levels_tx_protect)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>Rx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.ne_power_levels_rx_protect)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>Tx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.fe_power_levels_tx_protect)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                    <td>Rx</td>-->
          <!--                    <td align="center">-->
          <!--                        &lt;!&ndash; <div class="form-control disabled">{{calculatePower(selectedTsd.fe_power_levels_rx_protect)}}</div> &ndash;&gt;-->
          <!--                    </td>-->
          <!--                </tr>-->
        </tbody>
      </table>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">Comments</label>
    <div class="col-sm-10">
      <textarea
        class="form-control"
        name="startComment"
        cam-variable-name="startComment"
        cam-variable-type="String"
        maxlength="1500"
        rows="4"
      ></textarea>
    </div>
  </div>
</form>
