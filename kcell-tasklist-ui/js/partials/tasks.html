<style type="text/css">
th.sortable {
	cursor: pointer;
}
th.sortable:hover {
	background: #EEE;
}
</style>
<div class="row layout-row">
	<div class="col-md-2 no-float left">
		<div class="left-wrapper">
			<h4>Folders</h4>
			<ul id="filters">
				<li ng-repeat="filter in filters" ng-class="{active: filter.id == currentFilter.id}">
					<a ng-click="selectFilter(filter)">{{filter.name}} ({{filter.itemCount}})</a>
					<ul id="{{filter.id}}_regions" ng-if="isRegionFiltersVisible() && filter.id == currentFilter.id">
						<li ng-repeat="region in regionFilters | orderBy: 'name'" ng-class="{active: region.id == currentRegionFilter.id}">
							<a ng-click="selectRegionFilter(filter, region)">{{region.name}} ({{region.itemCount}})</a>
						</li>
					</ul>
				</li>
				<li ng-if="hasGroup('contractor_users')" ng-class = "{active: 'search' == currentFilter}">
					<a ng-click="selectFilter('search')">Search</a>
				</li>
			</ul>
			<span ng-if="processDefinitions && processDefinitions.length > 0">
				<h4>Processes</h4>
				<ul id="definitions">
					<li ng-repeat="pd in processDefinitions" ng-show="$root.isProcessVisible(pd.key)">
						<a ng-click="startProcess(pd.id)">Start <b>{{pd.name}}</b> process</a>
					</li>
				</ul>
			</span>
			<h4>Tasks</h4>
			<div class="scrollcontainer">
				<!--div class="scrollable">
					<ul id="tasks">
						<li ng-repeat="task in tasks" ui-sref="tasks.task({id:task.id})" ng-class="{active: task.id == currentTask.id}" 
						style="{{task.priority == 100? 'background-color: #fb8784;':''}}">
						  <div class="task">
					          <h5>{{ (task.name || task.id) }}</h5>
					          <div ng-if="task.description">{{ task.description }}</div>
					          <small class="text-muted" ng-if="task.assignee">{{ task.assigneeObject.firstName }} {{ task.assigneeObject.lastName }}</small>
					          <div ng-repeat="variable in task._embedded.variable" class="variable">
					          	{{ getVariableLabel(variable.name) }}: {{ variable.value }}
					          </div>
				          </div>
				        </li>
					</ul>
					<div style="padding-left: 10px;">
						<br/>
						<a ng-click="prevTasks()" ng-disabled="view.page <= 1" class="btn btn-xs btn-default">Previous</a> <a ng-click="nextTasks()" ng-disabled="!tasks.length || tasks.length < view.maxResults" class="btn btn-xs btn-default">Next</a>
					</div>
				</div-->				
				<div class="scrollable">
					<ul id="taskProcesses">
						<li ng-repeat="process in currentProcesses">
							<h5 ng-click="setSelectedProcessKey(process.key)">
								<i class="glyphicon" ng-class="process.key == selectedProcessKey?'glyphicon-minus-sign':'glyphicon-plus-sign'"></i> 
								{{process.name}} ({{process.taskCount}})
							</h5>
							<ul id="taskDefinitions" ng-show="selectedProcessKey == process.key">
								<li ng-repeat="taskGroup in process.taskGroups" ng-class="{active: taskGroup.name == currentTaskGroup.name}">
									<h5 ng-click="setSelectedTaskGroupName(taskGroup, process.name)">
										{{taskGroup.name}} ({{taskGroup.tasks.length}})
									</h5>
								</li>
							</ul>
						</li>
					</ul>					
				</div>
			</div>
		</div>
	</div>
	<div class="col-md-10 no-float right">
		<div class="currentTask">
			<div class="scrollcontainer">
				<div  class="scrollable">
					<div ng-show="selectedView == 'task'">
						<div ui-view></div>
					</div>
					<div ng-show="selectedView == 'search'">
					    <h4>Task Search</h4>
					    <div class="col-sm-12">
					        <div class="row">
					            <table class="table">
					                <thead>
					                <tr>
					                    <th width="20%">Site Name</th>
					                    <th width="25%">Task Type</th>
					                    <th width="20%">Priority</th>
					                    <th width="25%">Bussiness Key</th>
					                    <th width="10%"></th>
					                </tr>
					                </thead>
					                <tbody>
					                <tr>
					                    <ng-form name="workForm">
					                        <td>
									            <input type="text" ng-model="site_name" name="site_name" typeahead="site as sites.site_name for sites in getSite($viewValue) | filter:$viewValue" typeahead-on-select="siteSelected($item,$model,$label)" class="form-control" autocomplete="off" placeholder="Site Name">
									            <input type="hidden" ng-model="site" name="siteId"/>
					                        </td>
					                        <td ng-init="taskId = taskId || 'all'">
									            <select class="form-control" name="taskId" ng-model="taskId" ng-options="task.id as task.label for task in taskIds" />
					                        </td>
					                        <td>
									            <select class="form-control" name="priority" ng-model="priority" ng-init="priority = priority || 'all'">
									                <option value="all">All</option>
									                <option value="emergency">Emergency</option>
									            </select>
					                        </td>
					                        <td>
				                                <input type="text" class="form-control" name="bussinessKey" ng-model="bussinessKey" />
					                        </td>
						                    <td><button type="button" class="btn btn-sm btn-primary" ng-click="searchTasks()"><i class="glyphicon glyphicon-search"></i> Search</button></td>
					                    </ng-form>
					                </tr>
					                </tbody>
					            </table>
					        </div>
					        <div class="row">
					            <table class="table" ng-if="searchResults.length>0">
					                <thead>
					                <tr>
					                    <th></th>
					                    <th>Priority</th>
					                    <th>JR Number</th>
					                    <th>Site name</th>
					                    <th>Name</th>
					                    <th>Description</th>
					                    <th>Create Date</th>
					                    <th>Validity Date</th>
					                </tr>
					                </thead>
					                <tbody>
						                <tr ng-repeat="task in searchResults">
					                        <td><a ui-sref="tasks.task({id:task.id})" target="_blank">{{$index+1}}.</a></td>
					                        <td><a ui-sref="tasks.task({id:task.id})" target="_blank">{{task.priority == 100 ? 'Emergency' : 'Regular'}}</a></td>
					                        <td><a ui-sref="tasks.task({id:task.id})" target="_blank">{{task.jrNumber}}</a></td>
					                        <td><a ui-sref="tasks.task({id:task.id})" target="_blank">{{task.site_name}}</a></td>
					                        <td><a ui-sref="tasks.task({id:task.id})" target="_blank">{{task.name}}</a></td>
					                        <td><a ui-sref="tasks.task({id:task.id})" target="_blank">{{task.description}}</a></td>
					                        <td>{{task.created | date:'dd.MM.yyyy HH:mm'}}</td>
					                        <td>{{task.validityDate | date:'dd.MM.yyyy HH:mm'}}</td>
						                </tr>
					                </tbody>
					            </table>
					        </div>
					    </div>
					</div>
					<div ng-show="selectedView == 'tasks' && selectedProcessKey && currentTaskGroup">
						<h4>Project: {{getCurrentProjectDisplay()}}</h4>
						<h4>Process: {{currentTaskGroup.selectedProcessDisplay}}</h4>
						<h4>Task: {{currentTaskGroup.name}}</h4>
			            <table class="table table-bordered">
			                <thead>
			                	<tr>
			                    	<th>#</th>
									<th class="sortable">Bussiness key 
										<i ng-click="orderByFieldName('processBusinessKey')" class="glyphicon" ng-class="fieldName != 'processBusinessKey' ? 'glyphicon-sort' : reverseOrder?'glyphicon-chevron-down':'glyphicon-chevron-up'"></i>
										<span class="pull-right">
											<input type="text" ng-model="fieldFilter['processBusinessKey']" ng-show="visibilityFilter['processBusinessKey']">
											<i ng-click="setVisibilityFilter('processBusinessKey')" class="glyphicon" ng-class="visibilityFilter['processBusinessKey']?'glyphicon-remove':'glyphicon-filter'"></i>
										</span>
									</th>
									<th ng-if="selectedProcessKey === 'Revision'" class="sortable">Site name
										<i ng-click="orderByFieldName('site_name')" class="glyphicon" ng-class="fieldName != 'site_name' ? 'glyphicon-sort' : reverseOrder?'glyphicon-chevron-down':'glyphicon-chevron-up'"></i>
										<span class="pull-right">
											<input type="text" ng-model="fieldFilter['site_name']" ng-show="visibilityFilter['site_name']">
											<i ng-click="setVisibilityFilter('site_name')" class="glyphicon" ng-class="visibilityFilter['site_name']?'glyphicon-remove':'glyphicon-filter'"></i>
										</span>
									</th>
									<th class="sortable">Initiator
										<i ng-click="orderByFieldName('processStartUserId')" class="glyphicon" ng-class="fieldName != 'processStartUserId' ? 'glyphicon-sort' : reverseOrder?'glyphicon-chevron-down':'glyphicon-chevron-up'"></i>
										<span class="pull-right">
											<input type="text" ng-model="fieldFilter['processStartUserId']" ng-show="visibilityFilter['processStartUserId']">
											<i ng-click="setVisibilityFilter('processStartUserId')" class="glyphicon" ng-class="visibilityFilter['processStartUserId']?'glyphicon-remove':'glyphicon-filter'"></i>
										</span>
									</th>
									<th class="sortable">Date
										<i ng-click="orderByFieldName('processStartTime')" class="glyphicon" ng-class="fieldName != 'processStartTime' ? 'glyphicon-sort' : reverseOrder?'glyphicon-chevron-down':'glyphicon-chevron-up'"></i></th>
									<th class="sortable">Priority
										<i ng-click="orderByFieldName('priority')" class="glyphicon" ng-class="fieldName != 'priority' ? 'glyphicon-sort' : reverseOrder?'glyphicon-chevron-down':'glyphicon-chevron-up'"></i>
									</th>
			                	</tr>
			             	</thead>
			             	<tbody>
								<tr ng-repeat="task in currentTaskGroup.tasks | filter : filterByFields() | orderBy : fieldName : reverseOrder">
			             			<td><a ng-click="openTask(task.id)">{{$index+1}}</a></td>
			             			<td><a ng-click="openTask(task.id)">{{task.processBusinessKey}}</a></td>
			             			<td ng-if="selectedProcessKey === 'Revision'"><a ng-click="openTask(task.id)">{{task.site_name}}</a></td>
			             			<td><a ng-click="openTask(task.id)">{{task.processStartUserId}}</a></td>
			             			<td><a ng-click="openTask(task.id)">{{task.processStartTime | date: 'dd.MM.yyyy HH:mm'}}</a></td>
									<td><a ng-click="openTask(task.id)">{{task.priority == 100 ? 'Emergency' : 'Regular'}}</a></td>
			             		</tr>
			             	</tbody>
			             </table>
					</div>
				</div>
			</div>
		</div>
	</div>