<div class="row">
    <div class=" form-group col-sm-8" style="margin-bottom:25px !important;" ng-show="KWMSProcessesCount>1">
        <div class="col-sm-2"><h4>Processes:</h4></div>
        <div class="col-sm-10" style="padding-left:10px !important;">
            <div class="d-inline" ng-repeat="(key, process) in KWMSProcesses">
                <button type="button" class="btn btn-default" ng-class="process.value? 'active': ''"
                        ng-click="toggleProcess(key)">{{process.title}}
                </button>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="form-group col-sm-4">
        <div class="col-sm-12 checkbox-inline custom-checkbox">
            <input type="checkbox" value="true" ng-model="filter.unfinished" ng-disabled="filter.finished"
                   name="show_active">show only Active
            <div style="display: inline-block;width: 25px;"></div>
            <input type="checkbox" value="true" ng-model="filter.finished" ng-disabled="filter.unfinished"
                   name="show_closed">show only Closed
        </div>

    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4">
        <label class="col-sm-4 control-label">Year:</label>
        <div class="col-sm-4">
            <select ng-model="filter.beginYear" class="form-control selectpicker" select-picker title=""
                    ng-options="y as y for y in years"></select>
        </div>
        <div class="col-sm-4">
            <select ng-model="filter.endYear" class="form-control selectpicker" select-picker title=""
                    ng-options="y as y for y in years"></select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-hide="onlyProcessActive==='Invoice'">
        <label class="col-sm-4 control-label">Sitename:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.sitename" name="site_name"
                   typeahead="site as sites.site_name for sites in getSite($viewValue)"
                   typeahead-on-select="siteSelected($item,$model,$label)" class="form-control" autocomplete="off"
                   placeholder="Site Name">
        </div>
    </div>

    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Invoice'">
        <label class="col-sm-4 control-label">Period:</label>
        <div class="col-sm-4">
            <select class="form-control selectpicker" select-picker title="" select-model="months"
                    name="monthOfFormalPeriod" ng-model="filter.monthOfFormalPeriod">
                <option value=""></option>
                <option ng-repeat="m in InvoicePeriodMonths" value="{{m.label}}">{{m.label}}</option>
            </select>
        </div>
        <div class="col-sm-4">
            <select class="form-control selectpicker" select-picker title="" select-model="years"
                    name="yearOfFormalPeriod" ng-model="filter.yearOfFormalPeriod">
                <option value=""></option>
                <option value="{{y}}" ng-repeat="y in InvoicePeriodYears">{{y}}</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4"
         ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='CreatePR' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Requested Date:</label>
        <div class="col-sm-8">
            <div class="input-group">
                <input type="text" ng-model="filter.requestedDateRange" name="requestedDate"
                       class="form-control calendar-range-readonly" readonly/>
                <span class="input-group-btn">
                    <button type="button" calendar-range class="btn btn-default" id="calendarRangeButton"
                            name="requestedDate">
                        <i class="glyphicon glyphicon-calendar"></i>
                    </button>
                </span>
            </div>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-if="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Candidate Legal Type:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingCandidateLegalType" name="leasingCandidateLegalType"
                    ng-model="filter.leasingCandidateLegalType"
                    ng-options="type.id as type.desc for type in leasingCatalogs.legalType">
                <option value="" selected>Select candidate Legal Type</option>
            </select>
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4"
         ng-if="hasGroup('head_kcell_users') || hasGroup('revision_managers') || hasGroup('revision_audit') || (onlyProcessActive==='leasing' && hasGroup('kcellUsers'))">
        <label class="col-sm-4 control-label">Region:</label>
        <div class="col-sm-8">
            <select ng-model="filter.region" class="form-control selectpicker" select-picker title=""
                    select-model="regionsMap" ng-init="filter.region = 'all'">
                <option value="all">All</option>
                <option value="{{key}}" ng-repeat="(key, value) in regionsMap" ng-selected="{{key == filter.region}}">
                    {{value}}
                </option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Invoice'">
        <label class="col-sm-4 control-label">Initiator:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.initiator" name="initiator"
                   typeahead="users as users.name for users in getUsers($viewValue)"
                   typeahead-on-select="userSelected($item,$model,$label)" typeahead-min-length="2" class="form-control"
                   required autocomplete="off"></div>
    </div>
    <div class="form-group col-sm-4"
         ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='CreatePR'">
        <label class="col-sm-4 control-label">Site Id:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.siteId" name="site_id"
                   typeahead="site as sites.name for sites in getSiteId($viewValue)"
                   typeahead-on-select="siteIdSelected($item,$model,$label)" class="form-control" autocomplete="off"
                   placeholder="Site Id">
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Near-end site:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.nearend" name="nearend"
                   typeahead="site as sites.site_name for sites in getSites($viewValue)"
                   typeahead-on-select="nearEndSelected($item,$model,$label)" class="form-control" required
                   autocomplete="off" placeholder="Nearend">
        </div>
    </div>
    <div class="form-group col-sm-4"
         ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='CreatePR' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Requestor:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.requestor" class="form-control" placeholder="Name.Surname@kcell.kz"/>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
        <label class="col-sm-4 control-label">Validity Date:</label>
        <div class="col-sm-8">
            <div class="input-group">
                <input type="text" ng-model="filter.validityDateRange" name="validityDate"
                       class="form-control calendar-range-readonly" readonly/>
                <span class="input-group-btn">
                    <button type="button" calendar-range class="btn btn-default" id="calendarRangeButton"
                            name="validityDate">
                        <i class="glyphicon glyphicon-calendar"></i>
                    </button>
                </span>
            </div>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Dismantle'">
        <label class="col-sm-4 control-label">Initiator of Dismantling:</label>
        <div class="col-sm-8">
            <select ng-model="filter.dismantlingInitiator" class="form-control selectpicker" select-picker title="">
                <option value="">select initiator</option>
                <option value="optimization">Optimization Unit</option>
                <option value="transmission">Transmission Unit</option>
                <option value="infrastructure">Infrastructure Unit</option>
                <option value="operation">Operation Unit</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Replacement'">
        <label class="col-sm-4 control-label">Initiator of Replacement:</label>
        <div class="col-sm-8">
            <select ng-model="filter.replacementInitiator" class="form-control selectpicker" select-picker title="">
                <option value="">select initiator</option>
                <option value="optimization">Optimization Unit</option>
                <option value="transmission">Transmission Unit</option>
                <option value="infrastructure">Infrastructure Unit</option>
                <option value="operation">Operation Unit</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">RBS Type:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingRbsType" name="leasingRbsType" ng-model="filter.leasingRbsType">
                <option value="" selected>Select RBS type</option>
                <option ng-repeat="r in leasingCatalogs.rbsTypes | orderBy: types">{{r}}</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-if="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Far End Legal Type:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingFarEndLegalType" name="leasingFarEndLegalType"
                    ng-model="filter.leasingFarEndLegalType"
                    ng-options="type.id as type.desc for type in leasingCatalogs.legalType">
                <option value="" selected>Select far End Legal Type</option>
            </select>
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Process type:</label>
        <div class="col-sm-8">
            <select ng-model="filter.contractor" class="form-control selectpicker" select-picker title=""
                    ng-init="filter.contractor = 'All'">
                <option ng-repeat="ct in tnuProcessTypeList"
                        value="{{ct.id}}" ng-value="ct.id">{{ct.value}}
                </option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4"
         ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='CreatePR'">
        <label class="col-sm-4 control-label">{{(onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR') ?
            'JR' : (onlyProcessActive==='Dismantle' ? 'SDR' : 'SRR')}} Number:</label>
        <div class="col-sm-3">
            <select ng-model="filter.businessKeyFilterType" class="form-control selectpicker" select-picker title=""
                    ng-init="filter.businessKeyFilterType = 'eq'">
                <option value="eq">=</option>
                <option value="like">like</option>
            </select>
        </div>
        <div class="col-sm-5">
            <input type="text" ng-model="filter.businessKey" class="form-control"
                   placeholder="{{(onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR') ? 'Alm-XXX-P&O-20-4025' : (onlyProcessActive==='Dismantle' ? 'SDR-ALM-2020-0023' : 'SRR-ALM-2020-0023')}}"/>
        </div>
    </div>
    <div class="form-group col-sm-4"
         ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Current Assignee:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.currentAssignee" name="currentAssignee"
                   typeahead="users as users.name for users in getUsers($viewValue)"
                   typeahead-on-select="taskUserSelected($item,$model,$label)" typeahead-min-length="2"
                   class="form-control"
                   required autocomplete="off">
        </div>
    </div>
    <div class="form-group col-sm-4"
         ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Participation:</label>
        <div class="col-sm-8">
            <select ng-model="filter.participation" class="form-control selectpicker" select-picker title=""
                    ng-change="putCurrentUserAsRequestor()">
                <option value="">Select participation</option>
                <option value="initiator">Initiator</option>
                <option value="participant">Participant</option>
                <option value="iaminitiator">I am Initiator</option>
                <option value="iamparticipant">I am Participant</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
        <label class="col-sm-4 control-label">Priority:</label>
        <div class="col-sm-8">
            <select ng-model="filter.priority" class="form-control selectpicker" select-picker title="">
                <option></option>
                <option value="regular">Regular</option>
                <option value="emergency">Emergency</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement'">
        <label class="col-sm-4 control-label">Current activity:</label>
        <div class="col-sm-8">
            <select ng-model="filter.dismantleActivityId" class="form-control selectpicker" select-picker title=""
                    select-model="dismantleUserTasks">
                <option></option>
                <option value="{{task.id}}" ng-repeat="task in dismantleUserTasks | orderBy: 'name'"
                        ng-selected="{{task.id == filter.dismantleActivityId}}">{{task.name}}
                </option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Process Number:</label>
        <div class="col-sm-2">
            <select ng-model="filter.businessKeyFilterType" class="form-control selectpicker" select-picker title=""
                    ng-init="filter.businessKeyFilterType = 'eq'">
                <option value="eq">=</option>
                <option value="like">like</option>
            </select>
        </div>
        <div class="col-sm-6">
            <input type="text" ng-model="filter.businessKey" class="form-control" placeholder="Alm-XXX-P&O-20-4025"/>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">NCP ID:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.ncpId" class="form-control" placeholder="12345"/>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Cabinet Type:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingCabinetType" name="leasingCabinetType"
                    ng-model="filter.leasingCabinetType">
                <option value="" selected>Select Cabinet type</option>
                <option value="Indoor">Indoor</option>
                <option value="Outdoor">Outdoor</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4"
         ng-if="onlyProcessActive==='leasing' && filter.leasingCandidateLegalType==='national_kazakhtelecom'">
        <label class="col-sm-4 control-label">Branch of Kazakhtelecom:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingKazakhtelecomBranch" name="leasingKazakhtelecomBranch"
                    ng-model="filter.leasingKazakhtelecomBranch">
                <option value="{{branch.id}}" ng-repeat="branch in leasingCatalogs.branchesKT">
                    {{branch.name}}
                </option>
            </select>
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4"
         ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR' || onlyProcessActive ==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <label class="col-sm-4 control-label">Current activity:</label>
        <div class="col-sm-8">
            <select ng-model="filter.activityId" class="form-control selectpicker" select-picker title=""
                    select-model="includedUserTasks">
                <option></option>
                <option value="{{task.id}}" ng-repeat="task in includedUserTasks | orderBy: 'name'"
                        ng-selected="{{task.id == filter.activity}}">{{task.name}}
                </option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4"
         ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='Invoice' || onlyProcessActive==='CreatePR'">
        <label class="col-sm-4 control-label">Work Type:</label>
        <div class="col-sm-8">
            <select ng-model="filter.workType" class="form-control selectpicker" select-picker title=""
                    select-model="reasons">
                <option></option>
                <option value="{{r.id}}" ng-repeat="r in reasons" ng-selected="{{r.id == filter.workType}}">{{r.name}}
                </option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Invoice'">
        <label class="col-sm-4 control-label">MA Number:</label>
        <div class="col-sm-3">
            <select ng-model="filter.businessKeyFilterType" class="form-control selectpicker" select-picker title=""
                    ng-init="filter.businessKeyFilterType = 'eq'">
                <option value="eq">=</option>
                <option value="like">like</option>
            </select>
        </div>
        <div class="col-sm-5">
            <input type="text" ng-model="filter.businessKey" class="form-control" placeholder="Alm-XXX-P&O-20-0025"/>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
        <label class="col-sm-4 control-label">Contains work:</label>
        <div class="col-sm-8">
            <select ng-model="filter.workName" class="form-control selectpicker" select-picker title=""
                    select-model="works">
                <option></option>
                <option ng-repeat="work in works" ng-selected="{{filter.workName == work.sapPOServiceName}}"
                        value="{{work.sapPOServiceName}}">{{work.sapPOServiceName}}
                </option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Site Type:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingSiteType" name="leasingSiteType" ng-model="filter.leasingSiteType">
                <option value="" selected>Select Site type</option>
                <option ng-repeat="type in leasingCatalogs.siteType" ng-value="type.id">{{type.name}}</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Bands:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingBand" name="leasingBand" ng-model="filter.leasingBand">
                <option value="">Select band</option>
                <option ng-repeat="band in leasingCatalogs.bands" ng-value="band.title">{{band.title}}</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Contract type:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingContractType" name="leasingContractType"
                    ng-model="filter.leasingContractType"
                    ng-options="type.id as type.name for type in leasingCatalogs.contract">
            </select>
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
        <label class="col-sm-4 control-label">Contract:</label>
        <div class="col-sm-8">
            <select ng-model="filter.mainContract" class="form-control selectpicker" select-picker title=""
                    ng-init="filter.mainContract = 'All'">
                <option value="All">All</option>
                <option value="Revision">Revision</option>
                <option value="Roll-out">Roll-out</option>
                <option value="Roll-outRevision2020">Roll-out and Revision 2020</option>
            </select>
        </div>
    </div>

    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Initiator:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingInitiator" name="leasingInitiator"
                    ng-model="filter.leasingInitiator">
                <option value="" selected>Select Initiator</option>
                <option ng-repeat="i in leasingCatalogs.initiators" ng-value="i.id">{{i.name}}</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">General status:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingGeneralStatus" name="leasingGeneralStatus"
                    ng-model="filter.leasingGeneralStatus">
                <option value="" selected>Select general status</option>
                <option value="Planning in progress">Planning in progress</option>
                <option value="Provisional approval by Power, Transmission & Leasing">Provisional approval by Power,
                    Transmission & Leasing
                </option>
                <option value="Leasing in progress">Leasing in progress</option>
                <option value="Contract approval in progress">Contract approval in progress</option>
                <option value="Power in progress">Power in progress</option>
                <option value="Waiting TSD, RSD, VSD">Waiting TSD, RSD, VSD</option>
                <option value="Installation in progress">Installation in progress</option>
                <option value="On-Air">On-Air</option>
                <option value="NCP rejected">NCP rejected</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Contract Executor:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingContractExecutor" name="leasingContractExecutor"
                    ng-model="filter.leasingContractExecutor"
                    ng-options="type.name for type in leasingCatalogs.contractExecuter">
            </select>
        </div>
    </div>
</div>
<div class="row" ng-show="onlyProcessActive==='Revision'">
    <div class="form-group col-sm-4">
        <label class="col-sm-4 control-label">Contractor:</label>
        <div class="col-sm-8">
            <select ng-model="filter.contractor" class="form-control selectpicker" select-picker title=""
                    ng-init="filter.contractor = 'All'">
                <option value="All">All</option>
                <option value="4">Line System Engineering</option>
                <option value="5">Kcell_region</option>
                <option value="6">Алта Телеком</option>
                <option value="7">Логиком</option>
                <option value="8">Arlan SI</option>
            </select>
        </div>
    </div>
</div>

<div class="row">
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Project:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingProject" name="leasingProject" ng-model="filter.leasingProject">
                <option value="" selected>Select project</option>
                <option ng-repeat="pr in leasingCatalogs.allUnionProjects" ng-value="pr.id">{{pr.name}}</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Installation status:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingInstallationStatus" name="leasingInstallationStatus"
                    ng-model="filter.leasingInstallationStatus">
                <option value="" selected>Select installation status</option>
                <option value="Installation in progress">Installation in progress</option>
                <option value="SSID in progress">SSID in progress</option>
                <option value="Instalation problem">Instalation problem</option>
                <option value="Transmission problem">Transmission problem</option>
                <option value="Power problem">Power problem</option>
                <option value="Leasing problem">Leasing problem</option>
                <option value="Installation finish">Installation finish</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">IIN/BIN:</label>
        <div class="col-sm-8">
            <input class="form-control" type="number" id="ct_bin" name="ct_bin" ng-model="filter.bin">
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Reason:</label>
        <div class="col-sm-8">
            <select class="form-control" id="leasingReason" name="leasingReason" ng-model="filter.leasingReason">
                <option value="" selected>Select reason</option>
                <option ng-repeat="r in leasingCatalogs.reasons" ng-value="r.id">{{r.reason}}</option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Current activity:</label>
        <div class="col-sm-8">
            <select ng-model="filter.leasingActivityId" class="form-control selectpicker" select-picker title=""
                    select-model="leasingUserTasks">
                <option></option>
                <option value="{{task.id}}" ng-repeat="task in leasingUserTasks | orderBy: 'name'"
                        ng-selected="{{task.id == filter.leasingActivityId}}">{{task.name}}
                </option>
            </select>
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Assignee:</label>
        <div class="col-sm-8">
            <input type="text" ng-model="filter.curreentAssignee" name="currentAssignee"
                   typeahead="users as users.name for users in getUsers($viewValue)"
                   typeahead-on-select="taskUserSelected($item,$model,$label)" typeahead-min-length="2"
                   class="form-control" autocomplete="off">
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Contract ID:</label>
        <div class="col-sm-8">
            <input class="form-control" type="text" id="contractsForSearch" name="contractsForSearch"
                   ng-model="filter.contractsForSearch">
        </div>
    </div>
    <div class="form-group col-sm-4" ng-show="onlyProcessActive==='leasing'">
        <label class="col-sm-4 control-label">Transmission type:</label>
        <div class="col-sm-8">
            <select class="form-control" id="transmissionType" name="transmissionType"
                    ng-model="filter.transmissionType">
                <option value="" selected>Select Site type</option>
                <option ng-repeat="type in leasingCatalogs.transmissionType" ng-value="type.name">{{type.name}}</option>
            </select>
        </div>
    </div>
</div>
<div class="row">
    <div class="form-group col-sm-4">
        <a class="btn btn-default active" ng-click="setCustomField()"
           ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Select custom columns</a>
    </div>

    <div class="form-group col-sm-4">
        <div class="col-sm-12">
            <center>
                <a class="btn btn-default" ng-click="clearFilters()">Clear filters</a>
                <a class="btn btn-primary" ng-click="search(true)"><i class="glyphicon glyphicon-search"></i>
                    Search ({{processInstancesTotal}})</a>
            </center>
        </div>
    </div>
    <div class="col-sm-4" ng-hide="onlyProcessActive!=='tnu_tsd_db' || onlyProcessActive!=='change-tsd' || onlyProcessActive!=='get-rfs-by-permit' || onlyProcessActive!=='hop-delete'">
        <a ng-if="lastSearchParamsRevision && (onlyProcessActive!=='tnu_tsd_db' || onlyProcessActive!=='change-tsd' || onlyProcessActive!=='get-rfs-by-permit' || onlyProcessActive!=='hop-delete')" class="btn btn-default" style="float: right" id="xlsxClick"
           ng-click="getXlsxProcessInstances()">{{xlsxPreparedRevision ? 'Export to Excel' : 'Prepare Excel'}}</a>
    </div>
    <div class="col-sm-4" ng-if="onlyProcessActive==='Revision'">
        <a ng-if="lastSearchParamsRevision" class="btn btn-default" style="float: right" id="xlsxClick"
           ng-click="getXlsxProcessInstances()">{{xlsxPreparedRevision ? 'Export to Excel' : 'Prepare Excel'}}</a>
    </div>
    <div class="col-sm-4" ng-show="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
        <a ng-if="lastSearchParamsTnu" class="btn btn-default" style="float: right" id="xlsxClick"
           ng-click="getXlsxProcessInstancesTnu()">{{xlsxPreparedTnu ? 'Export to Excel' : 'Prepare Excel'}}</a>
    </div>
</div>

<div collapse="!isCustomField" ng-show="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
    <div class="row">
        <div class="form-group col-sm-2">
            <table class="table table-bordered">
                <tbody>
                <tr ng-repeat="field in customFields | orderBy: 'order'">
                    <td>{{field.name}}</td>
                    <td><input type="checkbox" name="custom{{field.id}}" ng-model="field.selected"/></td>
                </tr>
                <tr ng-repeat="a in fillEmptyLines(customFields.length) track by $index">
                    <td colspan="2"><input style="visibility: hidden;" type="checkbox" name="hiddenC{{$index}}"/></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="form-group col-sm-1">
            <center>
                <a ng-show="customFields.length>0" ng-click="selectCustomField()">>></i></a><br/>
                <a ng-show="selectedCustomFields.length>0" ng-click="unSelectCustomField()"><<</i></a>
            </center>
        </div>
        <div class="form-group col-sm-2">
            <table class="table table-bordered">
                <tbody>
                <tr ng-repeat="field in selectedCustomFields | orderBy: 'order'">
                    <td>{{field.name}}</td>
                    <td><input type="checkbox" name="selcustom{{field.id}}" ng-model="field.selected"/></td>
                </tr>
                <tr ng-repeat="a in fillEmptyLines(selectedCustomFields.length) track by $index">
                    <td colspan="2"><input style="visibility: hidden;" type="checkbox" name="hiddenSC{{$index}}"/></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div style="margin-bottom: 20px;"></div>

<div ng-if="(onlyProcessActive!=='Revision' &&  onlyProcessActive!=='CreatePR' && onlyProcessActive!=='tnu_tsd_db' && onlyProcessActive!=='change-tsd' && onlyProcessActive!=='get-rfs-by-permit' && onlyProcessActive!=='hop-delete') || ((onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete') && selectedCustomFields.length === 0)">
    <table class="table table-condensed table-hover" ng-if="processInstances.length>0" id="revisionsTable"
           name="revisionsTable">
        <thead class="fixed-header">
        <tr>
            <th>#</th>
            <th width="12.5%" ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Process type
            </th>
            <th width="10%"
                ng-if="RevisionOrMonthlyAct || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='leasing' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Region
            </th>
            <th width="30%" ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Near-end/ Far-end
            </th>
            <th width="12.5%" ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Process number
            </th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='leasing' || onlyProcessActive==='CreatePR'">
                Sitename
            </th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR' || onlyProcessActive==='Invoice'">
                {{(onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR') ? 'JR Number' :
                onlyProcessActive==='Invoice'? 'MA Number' : 'Business Key' }}
            </th>
            <th ng-if="onlyProcessActive===''">Process Name</th>
            <th ng-if="RevisionOrMonthlyAct || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement'">
                Execution Time
            </th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingInitiator">Initiator</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingProject">Project</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingReason">Reason</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.ncpId">NCP ID</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingSiteType">Site type</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingRbsType">RBS type</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingCabinetType">Cabinet type</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingBand">Bands</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingInstallationStatus">Installation status</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingInstallationStatus">Installation status date</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingKazakhtelecomBranch">Branch of Kazakhtelecom</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingCandidateLegalType">Candidate Legal type</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingFarEndLegalType">Far End Legal type</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingContractType">Contract type</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.leasingContractExecutor">Contract Executor</th>
            <th ng-if="onlyProcessActive==='leasing' && filter.bin">BIN/IIN</th>
            <th ng-if="onlyProcessActive==='leasing'">Created Date</th>
            <th ng-if="onlyProcessActive==='leasing'">Closed Date</th>
            <th ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">Current Activity</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Contractor</th>
            <th ng-if="RevisionOrMonthlyAct">Reason</th>
            <th ng-if="onlyProcessActive!=='leasing' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">Requested By</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='leasing' || onlyProcessActive==='CreatePR' || onlyProcessActive ==='tnu_tsd_db' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Current Assignee
            </th>
            <th ng-if="onlyProcessActive!=='leasing' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">Requested Date</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Validity Date</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Jobs List</th>
            <th ng-if="onlyProcessActive==='leasing'">General status</th>
            <th ng-if="onlyProcessActive==='leasing'">General status date</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Monthly act #</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="pi in processInstances" class="pi-{{pi.state == 'EXTERNALLY_TERMINATED'?'COMPLETED':pi.state}}">
            <td>{{(filter.page-1)*20 + $index + 1}}</td>
            <td ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">{{processDefinitionKeys[pi.processDefinitionKey]}}</td>
            <td ng-if="RevisionOrMonthlyAct || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='leasing' || onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                {{regionsMap[pi.siteRegion]}}
            </td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='leasing' || onlyProcessActive==='CreatePR'">
                {{pi.site_name}}
            </td>
            <td ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                <a ng-click="toggleProcessViewRevision($index, pi.processDefinitionKey, pi.processDefinitionId, pi.businessKey)">
                    {{pi.businessKey}}
                </a>
            </td>
            <td>
                <a ng-if="pi.processDefinitionKey=='tnu_tsd_db' || pi.processDefinitionKey=='change-tsd' || pi.processDefinitionKey=='get-rfs-by-permit' || pi.processDefinitionKey=='hop-delete'"
                   ng-click="toggleProcessViewRevision($index, pi.processDefinitionKey, pi.processDefinitionId, pi.businessKey)">
                    {{pi.businessKey.split("(").pop().replace(")","")}}
                </a>
                <a ng-if="pi.processDefinitionKey=='Revision' || pi.processDefinitionKey=='Invoice' || pi.processDefinitionKey=='CreatePR'"
                   ng-click="toggleProcessViewRevision($index, pi.processDefinitionKey, pi.processDefinitionId, pi.businessKey)">
                    {{pi.businessKey}}
                </a>
                <a ng-if="pi.processDefinitionKey==='sdr_srr_request' && pi.requestType === 'dismantle'"
                   ng-click="toggleProcessViewDismantle($index, pi.processDefinitionKey, pi.processDefinitionId, pi.businessKey)">
                    {{pi.businessKey}}
                </a>
                <a ng-if="pi.processDefinitionKey==='sdr_srr_request' && pi.requestType === 'replacement'"
                   ng-click="toggleProcessViewReplacement($index, pi.processDefinitionKey, pi.processDefinitionId, pi.businessKey)">
                    {{pi.businessKey}}
                </a>
                <a ng-if="pi.processDefinitionKey=='leasing'"
                   ng-click="toggleProcessViewLeasing($index, pi.processDefinitionKey, pi.processDefinitionId, pi.businessKey)">
                    {{pi.businessKey}}
                </a>
            </td>
            <td ng-if="onlyProcessActive===''">{{pi.processDefinitionKey == 'sdr_srr_request'? (pi.requestType ===
                'dismantle' ? 'Dismantle' : 'Replacement') : pi.processDefinitionName}}
            </td>
            <td ng-if="RevisionOrMonthlyAct || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement'">
                {{pi.executionTime}} days
            </td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingInitiator">{{pi.initiator.name}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingProject">{{pi.project.name}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingReason">{{pi.reason.reason}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.ncpId">{{pi.ncpID}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingSiteType">{{pi.siteType.name}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingRbsType">{{pi.rbsType}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingCabinetType">{{pi.plannedCabinetType}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingBand">
                <span ng-repeat="b in pi.bands">{{b.title}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingInstallationStatus">{{pi.installationStatus}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingInstallationStatus">
                {{pi.installationStatusUpdatedDate}}
            </td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingKazakhtelecomBranch">{{pi.branchKT}}</td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingCandidateLegalType">
                {{leasingCatalogs.legalTypeTitle[pi.leasingCandidateLegalType]}}
            </td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingFarEndLegalType">
                <span ng-repeat="fe in pi.farEndInformation">{{leasingCatalogs.legalTypeTitle[fe.legaltype]}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingContractType">
                <span ng-repeat="ci in pi.contractInformations">{{ci.ct_contract_type}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive==='leasing' && filter.leasingContractExecutor">
                <span ng-repeat="ci in pi.contractInformations">{{ci.ct_executor.name}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive==='leasing' && filter.bin">
                <span ng-repeat="ci in pi.contractInformations">{{ci.bin}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive==='leasing'">
                {{pi.startTime | date:'dd.MM.yyyy'}}
            </td>
            <td ng-if="onlyProcessActive==='leasing'">
                {{pi.endTime | date:'dd.MM.yyyy'}}
            </td>
            <td style="max-width: 100px;">
                <span ng-if="!(hasGroup('revision_managers') || hasGroup('revision_audit'))"
                      ng-repeat="task in pi.tasks">{{$index+1}}. {{task.name}}<br/></span>
                <a ng-if="hasGroup('revision_managers') || hasGroup('revision_audit')" ng-repeat="task in pi.tasks"
                   ui-sref="tasks.task({id:task.id})" target="_blank">{{$index+1}}. {{task.name}}<br/></a>
                <span ng-repeat="act in pi.otherActivities">{{pi.tasks.length+$index+1}}. {{act.activityName}}<br/></span>
            </td>
            <td ng-if="RevisionOrMonthlyAct">
                {{pi.processDefinitionKey==='Invoice' ? reasonShortName[pi.workType]
                : reasonShortName[pi.reason] }}
            </td>
            <td ng-if="onlyProcessActive!=='leasing'">{{profiles[pi.startUserId] ?
                profiles[pi.startUserId].firstName :
                pi.startUserId}} {{profiles[pi.startUserId] ? profiles[pi.startUserId].lastName : ''}}
            </td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='Dismantle' || onlyProcessActive==='Replacement' || onlyProcessActive==='leasing' || onlyProcessActive==='CreatePR'">
                <a ng-click="showTaskDetail(task)" ng-repeat="task in pi.tasks">{{$index+1}}. {{task.assignee ?
                    (profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' +
                    profiles[task.assignee].lastName) : task.assignee) : 'Not claimed'}}<br/></a>
            </td>
            <td ng-if="onlyProcessActive ==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                <a ng-click="showTaskDetail(task)" ng-repeat="task in pi.tasks">{{$index+1}}. {{task.assignee ?
                    (profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' +
                    profiles[task.assignee].lastName) : task.assignee) : 'Not claimed'}}<br/></a>
            </td>
            <td ng-if="onlyProcessActive!=='leasing' || onlyProcessActive!=='tnu_tsd_db' || onlyProcessActive!=='change-tsd' || onlyProcessActive!=='get-rfs-by-permit' || onlyProcessActive!=='hop-delete'">
                {{(pi.processDefinitionKey==='Revision' || pi.processDefinitionKey==='CreatePR') ? (pi.requestedDate | date:'dd MMM yyyy') : pi.startTime |
                date:'dd MMM yyyy' }}
            </td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">{{pi.validityDate | date:'dd MMM yyyy'}}
            </td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'" style="max-width: 190px;">
                <a ng-click="showWorkDetail(pi.jobWorks)">
    				<span ng-repeat="work in pi.jobWorks" class="nowrapDots">
    					{{worksTitle[work.sapServiceNumber]}}, works qty: {{work.quantity}}, materials qty: {{work.materialQuantity}} {{work.materialUnit}}
    					<br/>
    				</span>
                </a>
            </td>
            <td ng-if="onlyProcessActive==='leasing'">{{pi.generalStatus}}</td>
            <td ng-if="onlyProcessActive==='leasing'">{{pi.generalStatusUpdatedDate}}</td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">{{pi.monthActNumber}}
                {{pi.invoiceRO1Number?pi.invoiceRO1Number+', ':''}} {{pi.invoiceRO2Number?pi.invoiceRO2Number+', ':''}}
                {{pi.invoiceRO3Number?pi.invoiceRO3Number+', ':''}}
            </td>
        </tr>

        </tbody>
        <tbody>
        <tr>
            <td colspan="13" style="text-align: center">
                <a ng-disabled="filter.page <= 1" ng-click="filter.page <= 1 || selectPage(1)"
                   class="btn btn-pagination"> << </a>
                <a ng-disabled="filter.page <= 1" ng-click="filter.page <= 1 || prevPage()" class="btn btn-pagination">
                    < </a>
                <a ng-repeat="page in getPages()" ng-disabled="filter.page == page"
                   ng-click="filter.page == page || selectPage(page)"
                   ng-class="filter.page == page? 'btn-pagination-active':''" class="btn btn-pagination">{{page}}</a>
                <a ng-disabled="filter.page >= processInstancesPages"
                   ng-click="filter.page >= processInstancesPages || nextPage()" class="btn btn-pagination"> > </a>
                <a ng-disabled="filter.page >= processInstancesPages"
                   ng-click="filter.page >= processInstancesPages || selectPage(processInstancesPages)"
                   class="btn btn-pagination"> >> </a>
            </td>
        </tr>
        </tbody>
    </table>

    <table id="xlsxRevisionsTable" name="xlsxRevisionsTable" id="xlsxRevisionsTable" style="display: none;">
        <thead class="fixed-header">
        <tr>
            <th>#</th>
            <th ng-if="RevisionOrMonthlyAct">Region</th>
            <th ng-if="onlyProcessActive==='Revision'">Sitename</th>
            <th>{{(onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR') ? 'JR Number' :
                onlyProcessActive==='Invoice'? 'MA Number' : 'Business Key' }}
            </th>
            <th ng-if="RevisionOrMonthlyAct">Execution Time</th>
            <th>Current Activity</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Contractor</th>
            <th ng-if="RevisionOrMonthlyAct">Reason</th>
            <th>Requested By</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Current Assignee</th>
            <th>Requested Date</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Validity Date</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Jobs List</th>
            <th ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">Explanation</th>
        </tr>
        </thead>
        <tbody ng-repeat="pi in xlsxProcessInstances">
        <tr>
            <td>{{$index + 1}}</td>
            <td ng-if="RevisionOrMonthlyAct">{{regionsMap[pi.siteRegion]}}</td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">{{pi.site_name}}</td>
            <td>{{pi.businessKey}}</td>
            <td ng-if="RevisionOrMonthlyAct">{{pi.executionTime}} days</td>
            <td>
                <span ng-repeat="task in pi.tasks">{{$index+1}}. {{task.name}}<br/></span>
                <span ng-repeat="act in pi.otherActivities">{{pi.tasks.length+$index+1}}. {{act.activityName}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
                {{contractorShortName[pi.contractor]}}
            </td>
            <td ng-if="RevisionOrMonthlyAct">{{reasonShortName[pi.reason]}}</td>
            <td>{{profiles[pi.startUserId].firstName}} {{profiles[pi.startUserId].lastName}}</td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
                <span ng-repeat="task in pi.tasks">{{$index+1}}. {{profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' + profiles[task.assignee].lastName) : 'Not claimed'}}<br/></span>
            </td>
            <td>{{pi.requestedDate | date:'dd MMM yyyy'}}</td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">{{pi.validityDate | date:'dd MMM yyyy'}}
            </td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">
				<span ng-repeat="work in pi.jobWorks">
					{{worksTitle[work.sapServiceNumber]}}, works qty: {{work.quantity}}, materials qty: {{work.materialQuantity}} {{work.materialUnit}}
					<br/>
				</span>
            </td>
            <td ng-if="onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR'">{{pi.explanation}}
            </td>
        </tr>
        </tbody>
    </table>
    <table id="xlsxTnuTable" name="xlsxTnuTable" style="display: none;">
        <thead class="fixed-header">
        <tr>
            <th>#</th>
            <th ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Process type
            </th>
            <th ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Region
            </th>
            <th ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Near-end/ Far-end
            </th>
            <th ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                Process number
            </th>
            <th ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">Current Activity</th>
            <th>Requested By</th>
            <th ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">Current Assignee</th>
            <th>Requested Date</th>
        </tr>
        </thead>
        <tbody ng-repeat="pi in xlsxProcessInstances">
        <tr>
            <td>{{$index + 1}}</td>
            <td ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">{{processDefinitionKeys[pi.processDefinitionKey]}}</td>
            <td ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">{{regionsMap[pi.siteRegion]}}</td>
            <td ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">{{pi.businessKey}}</td>
            <td ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">{{pi.businessKey.split("(").pop().replace(")","")}}</td>
            <td style="max-width: 100px;">
                <span ng-if="!(hasGroup('revision_managers') || hasGroup('revision_audit'))"
                      ng-repeat="task in pi.tasks">{{$index+1}}. {{task.name}}<br/></span>
                <a ng-if="hasGroup('revision_managers') || hasGroup('revision_audit')" ng-repeat="task in pi.tasks"
                   ui-sref="tasks.task({id:task.id})" target="_blank">{{$index+1}}. {{task.name}}<br/></a>
                <span ng-repeat="act in pi.otherActivities">{{pi.tasks.length+$index+1}}. {{act.activityName}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                <span ng-repeat="task in pi.tasks">{{$index+1}}. {{profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' + profiles[task.assignee].lastName) : 'Not claimed'}}<br/></span>
            </td>
            <td ng-if="onlyProcessActive ==='tnu_tsd_db' || onlyProcessActive==='change-tsd' || onlyProcessActive==='get-rfs-by-permit' || onlyProcessActive==='hop-delete'">
                <a ng-click="showTaskDetail(task)" ng-repeat="task in pi.tasks">{{$index+1}}. {{task.assignee ?
                    (profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' +
                    profiles[task.assignee].lastName) : task.assignee) : 'Not claimed'}}<br/></a>
            </td>
            <td ng-if="onlyProcessActive!=='leasing' || onlyProcessActive!=='tnu_tsd_db' || onlyProcessActive!=='change-tsd' || onlyProcessActive!=='get-rfs-by-permit' || onlyProcessActive!=='hop-delete'">
                {{(pi.processDefinitionKey==='Revision' ||
                pi.processDefinitionKey==='CreatePR') ? (pi.requestedDate | date:'dd MMM yyyy') : pi.startTime |
                date:'dd MMM yyyy' }}
            </td>
        </tr>
        </tbody>
    </table>
    <table class="table table-condensed table-hover" id="customXlsxTnuTable" name="customXlsxTnuTable"
           style="display: none;">
        <thead class="fixed-header">
        <tr>
            <th>#</th>
            <th ng-repeat="field in selectedCustomFields | orderBy: 'order'">{{field.name}}</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="pi in xlsxProcessInstances">
            <td>{{$index + 1}}</td>
            <td ng-repeat="field in selectedCustomFields | orderBy: 'order'">
                {{field.id= 'tnu_tsd_db' ? processDefinitionKeys[pi.processDefinitionKey] : ''}}
                {{field.id === 'region' ? regionsMap[pi.siteRegion] : ''}}
                {{field.id === 'jrNumber' ? pi.businessKey : ''}}
                <span ng-if="field.id === 'currentActivity' && !(hasGroup('revision_managers') || hasGroup('revision_audit'))"
                      ng-repeat="task in pi.tasks">{{$index+1}}. {{task.name}}<br/></span>
                <span ng-if="field.id === 'currentActivity'" ng-repeat="act in pi.otherActivities">{{pi.tasks.length+$index+1}}. {{act.activityName}}<br/></span>
                {{field.id === 'contractor' ? contractorShortName[pi.contractor] : ''}}
                {{field.id === 'requestedby' ? (profiles[pi.startUserId] ? profiles[pi.startUserId].firstName :
                pi.startUserId) + ' ' + (profiles[pi.startUserId] ? profiles[pi.startUserId].lastName : '') : ''}}
                <span ng-if="field.id === 'currentAssignee'" ng-repeat="task in pi.tasks">{{$index+1}}. {{profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' + profiles[task.assignee].lastName) : 'Not claimed'}}<br/></span>
                <span ng-if="field.id === 'requestedDate'">{{pi.requestedDate | date:'dd MMM yyyy'}}</span>
            </td>
        </tbody>
    </table>
</div>

<div ng-if="(onlyProcessActive==='Revision' || onlyProcessActive==='CreatePR') && selectedCustomFields.length > 0">
    <table class="table table-condensed table-hover" ng-if="processInstances.length>0" id="customRevisionsTable"
           name="customRevisionsTable">
        <thead class="fixed-header">
        <tr>
            <th>#</th>
            <th ng-repeat="field in selectedCustomFields | orderBy: 'order'">{{field.name}}</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="pi in processInstances" class="pi-{{pi.state == 'EXTERNALLY_TERMINATED'?'COMPLETED':pi.state}}">
            <td>{{(filter.page-1)*20 + $index + 1}}</td>
            <td ng-repeat="field in selectedCustomFields | orderBy: 'order'"
                ng-style="{'max-width': {true:'190px',false:'100%'}[field.id == 'jobsList']}">
                {{field.id === 'region' ? regionsMap[pi.siteRegion] : ''}}
                {{field.id === 'sitename' ? pi.site_name : ''}}
                {{field.id === 'jrNumber' ? pi.businessKey : ''}}
                {{field.id === 'executionTime' ? pi.executionTime + ' days' : ''}}
                <span ng-if="field.id === 'currentActivity' && !(hasGroup('revision_managers') || hasGroup('revision_audit'))"
                      ng-repeat="task in pi.tasks">{{$index+1}}. {{task.name}}<br/></span>
                <a ng-if="field.id === 'currentActivity' && (hasGroup('revision_managers') || hasGroup('revision_audit'))"
                   ng-repeat="task in pi.tasks" ui-sref="tasks.task({id:task.id})" target="_blank">{{$index+1}}.
                    {{task.name}}<br/></a>
                <span ng-if="field.id === 'currentActivity'" ng-repeat="act in pi.otherActivities">{{pi.tasks.length+$index+1}}. {{act.activityName}}<br/></span>

                {{field.id === 'contractor' ? contractorShortName[pi.contractor] : ''}}
                {{field.id === 'reason' ? reasonShortName[pi.reason] : ''}}
                {{field.id === 'requestedby' ? (profiles[pi.startUserId] ? profiles[pi.startUserId].firstName :
                pi.startUserId) + ' ' + (profiles[pi.startUserId] ? profiles[pi.startUserId].lastName : '') : ''}}
                <a ng-if="field.id === 'currentAssignee'" ng-click="showTaskDetail(task)" ng-repeat="task in pi.tasks">{{$index+1}}.
                    {{task.assignee ? (profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' +
                    profiles[task.assignee].lastName) : task.assignee) : 'Not claimed'}}<br/></a>

                <span ng-if="field.id === 'requestedDate'">{{pi.requestedDate | date:'dd MMM yyyy'}}</span>
                <span ng-if="field.id === 'validityDate'">{{pi.validityDate | date:'dd MMM yyyy'}}</span>

                <a ng-if="field.id === 'jobsList'" ng-click="showWorkDetail(pi.jobWorks)">
                    <span ng-repeat="work in pi.jobWorks" class="nowrapDots">
                        {{worksTitle[work.sapServiceNumber]}}, works qty: {{work.quantity}}, materials qty: {{work.materialQuantity}} {{work.materialUnit}}
                        <br/>
                    </span>
                </a>
                <span ng-if="field.id === 'montlyAct'">
                    {{pi.monthActNumber}} {{pi.invoiceRO1Number?pi.invoiceRO1Number+', ':''}} {{pi.invoiceRO2Number?pi.invoiceRO2Number+', ':''}} {{pi.invoiceRO3Number?pi.invoiceRO3Number+', ':''}}                    
                </span>
            </td>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="13" style="text-align: center">
                <a ng-disabled="filter.page <= 1" ng-click="filter.page <= 1 || selectPage(1)"
                   class="btn btn-pagination"> << </a>
                <a ng-disabled="filter.page <= 1" ng-click="filter.page <= 1 || prevPage()" class="btn btn-pagination">
                    < </a>
                <a ng-repeat="page in getPages()" ng-disabled="filter.page == page"
                   ng-click="filter.page == page || selectPage(page)"
                   ng-class="filter.page == page? 'btn-pagination-active':''" class="btn btn-pagination">{{page}}</a>
                <a ng-disabled="filter.page >= processInstancesPages"
                   ng-click="filter.page >= processInstancesPages || nextPage()" class="btn btn-pagination"> > </a>
                <a ng-disabled="filter.page >= processInstancesPages"
                   ng-click="filter.page >= processInstancesPages || selectPage(processInstancesPages)"
                   class="btn btn-pagination"> >> </a>
            </td>
        </tr>
        </tfoot>
    </table>
    <table class="table table-condensed table-hover" id="customXlsxRevisionsTable" name="customXlsxRevisionsTable"
           style="display: none;">
        <thead class="fixed-header">
        <tr>
            <th>#</th>
            <th ng-repeat="field in selectedCustomFields | orderBy: 'order'">{{field.name}}</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="pi in xlsxProcessInstances">
            <td>{{$index + 1}}</td>
            <td ng-repeat="field in selectedCustomFields | orderBy: 'order'">
                {{field.id === 'region' ? regionsMap[pi.siteRegion] : ''}}
                {{field.id === 'sitename' ? pi.site_name : ''}}
                {{field.id === 'jrNumber' ? pi.businessKey : ''}}
                {{field.id === 'executionTime' ? pi.executionTime + ' days' : ''}}
                <span ng-if="field.id === 'currentActivity' && !(hasGroup('revision_managers') || hasGroup('revision_audit'))"
                      ng-repeat="task in pi.tasks">{{$index+1}}. {{task.name}}<br/></span>
                <span ng-if="field.id === 'currentActivity'" ng-repeat="act in pi.otherActivities">{{pi.tasks.length+$index+1}}. {{act.activityName}}<br/></span>

                {{field.id === 'contractor' ? contractorShortName[pi.contractor] : ''}}
                {{field.id === 'reason' ? reasonShortName[pi.reason] : ''}}
                {{field.id === 'requestedby' ? (profiles[pi.startUserId] ? profiles[pi.startUserId].firstName :
                pi.startUserId) + ' ' + (profiles[pi.startUserId] ? profiles[pi.startUserId].lastName : '') : ''}}

                <span ng-if="field.id === 'currentAssignee'" ng-repeat="task in pi.tasks">{{$index+1}}. {{profiles[task.assignee] ? (profiles[task.assignee].firstName + ' ' + profiles[task.assignee].lastName) : 'Not claimed'}}<br/></span>
                <span ng-if="field.id === 'requestedDate'">{{pi.requestedDate | date:'dd MMM yyyy'}}</span>
                <span ng-if="field.id === 'validityDate'">{{pi.validityDate | date:'dd MMM yyyy'}}</span>
                <span ng-if="field.id === 'jobsList'" ng-repeat="work in pi.jobWorks">
                    {{worksTitle[work.sapServiceNumber]}}, works qty: {{work.quantity}}, materials qty: {{work.materialQuantity}} {{work.materialUnit}}
                    <br/>
                </span>
                <span ng-if="field.id === 'montlyAct'">
                    {{pi.monthActNumber}} {{pi.invoiceRO1Number?pi.invoiceRO1Number+', ':''}} {{pi.invoiceRO2Number?pi.invoiceRO2Number+', ':''}} {{pi.invoiceRO3Number?pi.invoiceRO3Number+', ':''}}                    
                </span>
            </td>
        </tbody>
    </table>

</div>
