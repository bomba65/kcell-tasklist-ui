<div class="col-sm-12 resources-container" style="overflow: auto;">
    <div class="col-sm-12" ng-style="{'min-width': (disabled?'100%':'1300px')}">
        <table class="table">
            <thead>
            <tr>
                <th ng-style="{'width': (disabled?'auto':'2%')}" ng-if="!disabled">
                    <a ng-click="addItem()" style="font-size: 25px;">
                        <span class="glyphicon glyphicon-plus-sign"></span>
                    </a>
                </th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Empl. type</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Dept.</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Role</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Description</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Expert</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Empl. Quantity</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Man\Hours in Month</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Period, Month</th>
                <th ng-style="{'width': (disabled?'auto':'5%')}">Existing?</th>
                <th ng-style="{'width': (disabled?(editprice?'10%':'auto'):'8%')}">Rate per Hour, KZT Gross</th>
                <th ng-style="{'width': (disabled?'auto':'8%')}">Amount, KZT Gross</th>
                <th ng-style="{'width': (disabled?'auto':'10%')}">Responsible</th>
                <th ng-style="{'width': (disabled?'auto':'3%')}" ng-if="!disabled"></th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="r in data track by $index">
                <td ng-if="!disabled"></td>
                <td>
                    <span ng-if="disabled">{{r.emplType}}</span>
                    <span ng-if="!disabled">
                        <select class="form-control" ng-model="r.emplType" name="resources_{{$index}}_emplType" ng-change="onEmplTypeChange($index)" required>
                            <option ng-repeat="(key, val) in catalogs" ng-value="key">{{key}}</option>
                        </select>
                        <span class="has-error" ng-if="form['resources_'+$index+'_emplType'].$error.required && ( form['resources_'+$index+'_emplType'].$touched || view.submitted)">Required field</span>
                    </span>
                </td>
                <td>
                    <span ng-if="disabled">{{r.department}}</span>
                    <span ng-if="!disabled">
                        <select class="form-control" ng-model="r.department" name="resources_{{$index}}_department" ng-change="onDepartmentChange($index)" required>
                            <option ng-repeat="(key, val) in catalogs[r.emplType]" ng-value="key">{{key}}</option>
                        </select>
                        <span class="has-error" ng-if="form['resources_'+$index+'_department'].$error.required && ( form['resources_'+$index+'_department'].$touched || view.submitted)">Required field</span>
                    </span>
                </td>
                <td>
                    <span ng-if="disabled">{{r.role.v}}</span>
                    <span ng-if="!disabled">
                        <demand-dropdown ng-model="r.role" search-field="true" options="catalogs[r.emplType][r.department]" object-list="true" display-prop="'v'" on-item-select="onRoleChange" index="$index" nowrap="true" field-name="'resources_'+$index+'_role'" is-required="true"></demand-dropdown>
                        <span class="has-error" ng-if="form['resources_'+$index+'_role'].$error.required && ( form['resources_'+$index+'_role'].$touched || view.submitted)">Required field</span>
                    </span>
                </td>
                <td>
                    <span ng-if="disabled || r.role.v != 'New role'">{{r.description}}</span>
                    <span ng-if="!disabled && r.role.v == 'New role' ">
                        <textarea rows="1" elastic-textarea class="form-control" ng-model="r.description" name="resources_{{$index}}_description" required></textarea>
                        <span class="has-error" ng-if="form['resources_'+$index+'_description'].$error.required && ( form['resources_'+$index+'_description'].$touched || view.submitted)">Required field</span>
                    </span>
                </td>
                <td>
                    {{r.role.expert.fio}}
                </td>
                <td>
                    <span ng-if="disabled">{{r.quantity}}</span>
                    <span ng-if="!disabled">
                        <input type="number" class="form-control" ng-model="r.quantity" name="resources_{{$index}}_quantity" ng-change="calcSumm($index)" required>
                        <span class="has-error" ng-if="form['resources_'+$index+'_quantity'].$error.required && ( form['resources_'+$index+'_quantity'].$touched || view.submitted)">Required field</span>
                    </span>
                </td>
                <td>
                    <span ng-if="disabled">{{r.hours}}</span>
                    <span ng-if="!disabled">
                        <input type="number" class="form-control" ng-model="r.hours" name="resources_{{$index}}_hours" ng-change="calcSumm($index)" required>
                        <span class="has-error" ng-if="form['resources_'+$index+'_hours'].$error.required && ( form['resources_'+$index+'_hours'].$touched || view.submitted)">Required field</span>
                    </span>
                </td>
                <td>
                    <span ng-if="disabled">{{r.period}}</span>
                    <span ng-if="!disabled">
                        <input type="number" class="form-control" ng-model="r.period" name="resources_{{$index}}_period" required>
                        <span class="has-error" ng-if="form['resources_'+$index+'_period'].$error.required && ( form['resources_'+$index+'_period'].$touched || view.submitted)">Required field</span>
                    </span>
                </td>
                <td>
                    <input type="checkbox" ng-model="r.existing" ng-disabled="disabled && !editprice">
                </td>
                <td>
                    <span ng-if="editprice">
                        <input type="text" class="form-control" ng-model="r.pprice" name="resources_{{$index}}_pprice" ng-change="setResponsible($index)" demand-number-format required>
                        <span class="has-error" ng-if="form['resources_'+$index+'_pprice'].$error.required && ( form['resources_'+$index+'_pprice'].$touched || view.submitted)">Required field</span>
                    </span>
                    <span ng-if="!editprice && !showprice">{{r.pprice?'Conf.':'Empt.'}}</span>
                    <span ng-if="!editprice && showprice">
                        {{r.pprice | number}}
                    </span>
                </td>
                <td>
                    <span ng-if="editprice || showprice">{{r.summ | number}}</span>
                    <span ng-if="!editprice && !showprice">{{r.summ?'Conf.':'Empt.'}}</span>
                </td>
                <td>
                    {{r.responsible.fio}}
                </td>
                <td ng-if="!disabled">
                    <button type="button" class="btn btn-default" ng-click="deleteItem($index)">Delete</button>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="col-sm-12" ng-if="totalSumm">
            <div class="col-sm-5 pull-right form-group" ng-if="data.length > 0">
                <label class="col-sm-5">Total amount, KZT Gross</label>
                <div class="col-sm-7">
                    <div class="col-sm-12 disabled-element">{{totalSumm | number}}</div>
                </div>
            </div>
        </div>
    </div>
</div>